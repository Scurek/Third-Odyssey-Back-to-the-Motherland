# Triggers and effects will be given the Actor's scope, with the Recipient's as FROM

# to_cancel_portuguese_trade_deal =  {
# 	category = economy
# 	require_acceptance = no
# 	is_visible = {
# 		OR = {
# 			AND = {
# 				has_country_modifier = nhs2_ely_por_trade
# 				FROM = {
# 					has_country_modifier = nhs2_por_ely_trade
# 				}
# 			}
# 			AND = {
# 				has_country_modifier = nhs2_por_ely_trade
# 				FROM = {
# 					has_country_modifier = nhs2_ely_por_trade
# 				}
# 			}
# 		}
# 	}
# 	is_allowed = {
# 		is_at_war = no
# 		FROM = {
# 			is_at_war = no
# 		}
# 	}
# 	on_accept = {
# 		random_country = {
# 			limit = {
# 				has_country_modifier = nhs2_ely_por_trade
# 			}
# 			nhs_break_por_deal = { REMOVE_ENCLAVES = yes }
# 		}
# 	}
# 	ai_will_do = {
# 		always = no
# 	}
# }

to_subsidise_subject_colony =  {
	category = economy
	require_acceptance = no
	is_visible = {
		overlord_of = FROM
		FROM = {
			num_of_colonists = 1
			is_colonial_nation = no
			NOT = { has_country_flag = to_subsidising_colonisation }
			NOT = { has_country_modifier = nhs_constrained_resources }
			to_can_receive_colonial_subsidies = yes
		}
	}
	is_allowed = {
		FROM = {
			custom_trigger_tooltip = {
				tooltip = to_is_not_subsidising_subject_colony_tt
				NOT = { has_country_flag = to_subsidising_colonisation }
			}
		}
	}
	on_accept = {
		FROM = {
			set_country_flag = to_subsidising_colonisation
		}
	}
	ai_will_do = {
		nhs_check_all_elysian_tags = { CONDITION = tag }
		FROM = {
			OR = {
				tag = CM1
				was_tag = CM1
			}
		}
	}
}

to_cancel_subsidize_subject_colony =  {
	category = economy
	require_acceptance = no
	is_visible = {
		overlord_of = FROM
		FROM = {
			num_of_colonists = 1
			has_country_flag = to_subsidising_colonisation
			NOT = { has_country_modifier = nhs_constrained_resources }
			to_can_receive_colonial_subsidies = yes
		}
	}
	is_allowed = {
		FROM = {
			custom_trigger_tooltip = {
				tooltip = to_is_subsidising_subject_colony_tt
				has_country_flag = to_subsidising_colonisation
			}
		}
	}
	on_accept = {
		FROM = {
			clr_country_flag = to_subsidising_colonisation
		}
	}
	ai_will_do = {
		NOT = {
			AND = {
				nhs_check_all_elysian_tags = { CONDITION = tag }
				FROM = {
					OR = {
						tag = CM1
						was_tag = CM1
					}
				}
			}
		}
	}
}

to_enforce_colony_religion =  {
	category = influence
	require_acceptance = no
	is_visible = {
		NOT = { has_dlc = "Common Sense" }
		overlord_of = FROM
		FROM = {
			NOT = { religion = ROOT }
			NOT = {
				OR = {
					is_subject_of_type = tributary_state
					is_subject_of_type = daimyo_vassal
					is_subject_of_type = to_confederation_subject
					is_subject_of_type = nhs_imperial_associate
					is_subject_of_type = nhs_protectorate
				}
			}
		}
	}
	is_allowed = {
		FROM = {
			NOT = { religion = ROOT }
			NOT = { liberty_desire = 50 }
		}
	}
	on_accept = {
		FROM = {
			change_religion = ROOT
			if = {
				limit = {
					religion_group = ROOT
				}
				add_liberty_desire = 50
			}
			else = {
				add_liberty_desire = 100
			}
		}
	}
	ai_will_do = {
		FROM = {
			NOT = { liberty_desire = 1 }
		}
	}
}

to_enforce_colony_culture = {
	category = influence
	require_acceptance = no
	is_visible = {
		overlord_of = FROM
		FROM = {
			NOT = { primary_culture = ROOT }
			OR = {
				NOT = { culture_group = byzantine }
				ROOT = {
					NOT = { culture_group = byzantine }
				}
				NOT = { to_nhs_has_dynamic_elysian_primary_culture = yes }
			}
			is_colonial_nation = yes
		}
	}
	is_allowed = {
		FROM = {
			religion = ROOT
			NOT = { primary_culture = ROOT }
			NOT = { liberty_desire = 50 }
		}
	}
	on_accept = {
		FROM = {
			if = {
				limit = {
					ROOT = {
						nhs_post_fragmentation_culturally_elysian = yes
					}
				}
				to_ely_country_culture_check = { 
					FLAG_SCOPE = ROOT 
					FLAG_SCOPE_BACKUP = yes
				}
				every_owned_province = {
					limit = {
						is_colony = no
					}
					to_ely_province_culture_check = {}
				}
			}
			else = {
				change_primary_culture = ROOT
			}
			add_liberty_desire = 25
		}
	}
	ai_will_do = {
		FROM = {
			NOT = { liberty_desire = 25 }
		}
	}
}

cancel_nhs_protectorate =  {
	category = influence
	require_acceptance = no
	is_visible = {
		overlord_of = FROM
		FROM = {
			is_subject_of_type = nhs_protectorate
		}
	}
	is_allowed = {
		is_at_war = no
		FROM = {
			is_at_war = no
		}
	}
	on_accept = {
		add_trust = {
			who = FROM
			value = -50
			mutual = yes
		}
		FROM = {
			grant_independence = yes
		}
	}
	ai_will_do = {
		always = no
	}
}

cancel_nhs_associate =  {
	category = influence
	require_acceptance = no
	is_visible = {
		overlord_of = FROM
		FROM = {
			is_subject_of_type = nhs_imperial_associate
		}
	}
	is_allowed = {
		is_at_war = no
		FROM = {
			is_at_war = no
		}
	}
	on_accept = {
		FROM = {
			grant_independence = yes
		}
	}
	ai_will_do = {
		always = no
	}
}

nhs_limit_expansion_on =  {
	category = influence
	require_acceptance = no
	is_visible = {
		nhs_check_all_elysian_tags = { CONDITION = tag }
		overlord_of = FROM
		FROM = {
			OR = {
				tag = SHQ
				tag = CM1
				tag = KYK
			}
			NOT = { has_country_flag = nhs_restricted_expansion_s }
		}
	}
	is_allowed = {
		FROM = {
			num_of_colonists = 1
			custom_trigger_tooltip = {
				tooltip = nhs_not_restricted_expansion_tt
				NOT = { has_country_flag = nhs_restricted_expansion_s }
			}
		}
	}
	on_accept = {
		FROM = {
			set_country_flag = nhs_restricted_expansion_s
		}
	}
	ai_will_do = {
		always = no
	}
}

nhs_limit_expansion_off =  {
	category = influence
	require_acceptance = no
	is_visible = {
		nhs_check_all_elysian_tags = { CONDITION = tag }
		overlord_of = FROM
		FROM = {
			OR = {
				tag = SHQ
				tag = CM1
				tag = KYK
			}
			has_country_flag = nhs_restricted_expansion_s
		}
	}
	is_allowed = {
		FROM = {
			custom_trigger_tooltip = {
				tooltip = nhs_not_unrestricted_expansion_tt
				has_country_flag = nhs_restricted_expansion_s
			}	
		}
	}
	on_accept = {
		FROM = {
			clr_country_flag = nhs_restricted_expansion_s
		}
	}
	ai_will_do = {
		always = no
	}
}

nhs_send_missionaries =  {
	category = influence
	require_acceptance = no
	is_visible = {
		ai = no
		capital_scope = {
			OR = {
				continent = north_america
				continent = south_america
			}
		}
		OR = {
			nhs_check_all_elysian_tags = { CONDITION = tag }
			num_of_cities = 20
		}
		religion = elysian_orthodoxy
		FROM = {
			religion = totemism
		}
	}
	is_allowed = {
		custom_trigger_tooltip = {
			NOT = { has_country_modifier = nhs2_missionaries_cooldown }
			tooltip = missionary_cooldown_tooltip
		}
		religion = elysian_orthodoxy
		NOT = { war_with = FROM }
		dip_power = 25
		FROM = {
			religion = totemism
			has_opinion = { who = ROOT value = 0 }
			NOT = { border_distance = { who = ROOT distance = 200 } }
			custom_trigger_tooltip = {
				tooltip = to_has_totemist_province_tt
				num_of_religion = { religion = totemism value = 1 }
			}
			custom_trigger_tooltip = {
				tooltip = nhs_not_recently_send_missionaries_to_tt
				NOT = { has_country_modifier = nhs2_missionaries_cooldown_target }
			}
		}
	}
	on_accept = {
		add_dip_power = -25
		add_country_modifier = {
			name = nhs2_missionaries_cooldown
			duration = 1825
			hidden = yes
		}
		FROM = {
			country_event = { id = nhs2_orthodoxevents.37 }
			add_country_modifier = {
				name = nhs2_missionaries_cooldown_target
				duration = 3650
				hidden = yes
			}
		}
	}
	ai_will_do = {
		always = no
	}
}

nhs_send_preachers =  {
	category = influence
	require_acceptance = no
	is_visible = {
		ai = no
		OR = {
			capital_scope = {
				continent = north_america
			}
			capital_scope = {
				continent = south_america
			}
		}
		OR = {
			tag = MSN
			num_of_cities = 20
		}
		religion = aztlan_worship
		FROM = {
			OR = {
				religion = totemism
				religion = nahuatl
				religion = mesoamerican_religion
			}
		}
		
	}
	is_allowed = {
		custom_trigger_tooltip = {
			NOT = { has_country_modifier = nhs2_missionaries_cooldown }
			tooltip = missionary_cooldown_tooltip
		}
		if = {
			limit = {
				tag = MSN
				has_reform = spartan_kingdom
				NOT = { has_global_flag = msg_reforms_done }
			}
			has_reform = msg_aztlan_priesthood_yes
		}
		else = {
			custom_trigger_tooltip = {
				tooltip = msg_has_reformed_priesthood_tt
				has_global_flag = msg_priesthood_done
			}
		}
		dip_power = 50
		NOT = { war_with = FROM }
		FROM = {
			OR = {
				religion = totemism
				religion = nahuatl
				religion = mesoamerican_religion
			}
			has_opinion = { who = ROOT value = 0 }
			NOT = { border_distance = { who = ROOT distance = 200 } }
			custom_trigger_tooltip = {
				tooltip = to_has_totemist_nahuatl_mesoamerican_province_tt
				any_owned_province = {
					OR = {
						religion = totemism
						religion = nahuatl
						religion = mesoamerican_religion
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = nhs_not_recently_send_missionaries_to_tt
				NOT = { has_country_modifier = nhs2_missionaries_cooldown_target }
			}
		}
	}
	on_accept = {
		add_dip_power = -50
		add_country_modifier = {
			name = nhs2_missionaries_cooldown
			duration = 1825
			hidden = yes
		}
		FROM = {
			country_event = { id = msg_religionevents.60 }
			add_country_modifier = {
				name = nhs2_missionaries_cooldown_target
				duration = 3650
				hidden = yes
			}
		}
	}
	ai_will_do = {
		always = no
	}
}

nhs_send_heralds =  {
	category = influence
	require_acceptance = no
	is_visible = {
		has_estate = estate_church
		ai = no
		capital_scope = {
			OR = {
				continent = north_america
				continent = south_america
			}
		}
		religion = pantheon_worship
		has_country_modifier = nhs_high_priests
		FROM = {
			religion = totemism
		}
		
	}
	is_allowed = {
		custom_trigger_tooltip = {
			NOT = { has_country_modifier = nhs2_missionaries_cooldown }
			tooltip = missionary_cooldown_tooltip
		}
		if = {
			limit = {
				NOT = { nhs_check_all_elysian_tags = { CONDITION = tag } }
				NOT = { nhs_check_all_spartan = { CONDITION = tag } }
			}
			num_of_cities = 20
		}
		if = {
			limit = {
				nhs_check_all_spartan = { CONDITION = tag }
				NOT = { has_global_flag = msg_heralds_done }
			}
			custom_trigger_tooltip = {
				tooltip = msg_no_heralds_tt
				always = no
			}
		}
		religion = pantheon_worship
		NOT = { war_with = FROM }
		dip_power = 25
		FROM = {
			religion = totemism
			has_opinion = { who = ROOT value = 0 }
			NOT = { border_distance = { who = ROOT distance = 200 } }
			custom_trigger_tooltip = {
				tooltip = to_has_totemist_province_tt
				num_of_religion = { religion = totemism value = 1 }
			}
			custom_trigger_tooltip = {
				tooltip = nhs_not_recently_send_missionaries_to_tt
				NOT = { has_country_modifier = nhs2_missionaries_cooldown_target }
			}
		}
	}
	on_accept = {
		add_dip_power = -25
		add_country_modifier = {
			name = nhs2_missionaries_cooldown
			duration = 1825
			hidden = yes
		}
		FROM = {
			country_event = { id = to_hellenic_events.9 }
			add_country_modifier = {
				name = nhs2_missionaries_cooldown_target
				duration = 3650
				hidden = yes
			}
		}
	}
	ai_will_do = {
		always = no
	}
}

nhs_annex_exarchate = {
	category = influence
	require_acceptance = no
	is_visible = {
		overlord_of = FROM
		FROM = {
			is_subject_of_type = elysian_subject
			NOT = { tag = ELG }
			NOT = { tag = CM1 }
			NOT = { tag = KYK }
		}
	}
	is_allowed = {
		is_at_war = no
		FROM = {
			is_at_war = no
		}
		OR = {
			AND = {
				adm_power = 150
				dip_power = 150
			}
			custom_trigger_tooltip = {
				tooltip = to_has_moved_capital_back_to_europe_tt
				mission_completed = to_basileus_basileon_mission
				capital = 151
			}
		}
		
	}
	on_accept = {
		inherit = FROM
		if = {
			limit = {
				NOT = {
					AND = {
						mission_completed = to_basileus_basileon_mission
						capital = 151
					}
				}
			}
			add_adm_power = -150
			add_dip_power = -150
		}
		every_province = {
			limit = {
				is_core = FROM
			}
			remove_core = FROM
		}
		set_country_flag = to_annexed_exarch@FROM
	}
	ai_will_do = {
		always = no
	}
}

nhs_annex_constantinia =  {
	category = influence
	require_acceptance = no
	is_visible = {
		overlord_of = FROM
		FROM = {
			tag = ELG
			is_subject_of_type = elysian_subject
		}
	}
	is_allowed = {
		is_at_war = no
		FROM = {
			is_at_war = no
		}
		adm_tech = 18
		adm_power = 200
		dip_power = 200
	}
	on_accept = {
		inherit = FROM
		add_adm_power = -200
		add_dip_power = -200
		every_owned_province = {
			limit = {
				is_core = ELG
			}
			add_unrest = 15
			add_local_autonomy = 30
		}
		set_country_flag = to_annexed_exarch@FROM
	}
	ai_will_do = {
		always = no
	}
}

# nhs_annex_creta =  {
# 	category = influence
# 	require_acceptance = no
# 	is_visible = {
# 		overlord_of = FROM
# 		FROM = {
# 			OR = {
# 				tag = CM1
# 				tag = KYK
# 			}
# 		}
# 	}
# 	is_allowed = {
# 		is_at_war = no
# 		FROM = {
# 			is_at_war = no
# 		}
# 		adm_tech = 18
# 		adm_power = 200
# 		dip_power = 200
# 	}
# 	on_accept = {
# 		inherit = FROM
# 		add_adm_power = -200
# 		add_dip_power = -200
# 		every_owned_province = {
# 			limit = {
# 				OR = {
# 					is_core = CM1
# 					is_core = KYK
# 				}
# 			}
# 			add_unrest = 15
# 			add_local_autonomy = 30
# 		}
# 	}
# 	ai_will_do = {
# 		always = no
# 	}
# }

nhs_annex_colony =  {
	category = influence
	require_acceptance = no
	is_visible = {
		OR = {
			technology_group = exiled_greek
			technology_group = exiled_spartan
			technology_group = viking
			has_government_attribute = to_free_annexation_of_colonial_nations
		}
		# OR = {
		# 	nhs_check_all_elysian_tags = { CONDITION = tag }
		# 	nhs_check_all_vinland = { CONDITION = tag }
		# 	has_government_attribute = to_free_annexation_of_colonial_nations
		# }
		FROM = {
			is_subject_of = ROOT
			OR = {
				is_subject_of_type = colony
				is_subject_of_type = crown_colony
				is_subject_of_type = private_enterprise
				is_subject_of_type = self_governing_colony
			}
		}
		# capital_scope = {
		# 	OR = {
		# 		continent = north_america
		# 		continent = south_america
		# 	}
		# }
		# FROM = {
		# 	any_owned_province = {
		# 		any_neighbor_province = {
		# 			is_in_capital_area = yes
		# 			owned_by = ROOT
		# 		}
		# 	}
		# }
	}
	is_allowed = {
		is_at_war = no
		FROM = {
			is_at_war = no
			# any_neighbor_country = {
			# 	tag = ROOT
			# }
			OR = {
				custom_trigger_tooltip = {
					tooltip = to_capital_on_the_same_continent_as_root_tt
					same_continent = ROOT
				}
				custom_trigger_tooltip = {
					tooltip = to_owns_a_province_in_capital_area
					any_owned_province = {
						any_neighbor_province = {
							is_in_capital_area = yes
							owned_by = ROOT
						}
					}
				}
				if = {
					limit = {
						ROOT = {
							nhs_check_all_elysian_tags = { CONDITION = tag }
						}
					}
					AND = {
						custom_trigger_tooltip = {
							tooltip = to_capital_on_south_america_tt
							capital_scope = {
								continent = south_america
							}
						}
						custom_trigger_tooltip = {
							tooltip = to_root_has_enacted_direct_control_from_capital_decision_tt
							ROOT = {
								has_country_flag = to_direct_control_from_capital
							}
						}
					}
				}
			}
		}
		if = {
			limit = {
				nhs_check_all_elysian_tags = { CONDITION = tag }
				OR = {
					has_country_modifier = nhs_constrained_resources
					has_country_modifier = nhs_organised_expansion
					has_country_modifier = nhs_organised_expansion_2
				}
			}
			mission_completed = to_colonial_ambitions_mission
		}
		else_if = {
			limit = {
				nhs_check_all_vinland = { CONDITION = tag }
				OR = {
					has_country_modifier = nhs_vov_population
					has_country_modifier = nhs_vov_organized_expansion
				}
			}
			has_country_modifier = nhs_vov_organized_expansion
		}
		if = {
			limit = {
				NOT = { mission_completed = to_the_promised_land_mission }
				NOT = { has_government_attribute = to_free_annexation_of_colonial_nations }
			}
			adm_power = 150
			dip_power = 150
		}
	}
	on_accept = {
		inherit = FROM
		add_adm_power = -150
		add_dip_power = -150
		hidden_effect = {
			every_province = {
				limit = {
					is_core = FROM
				}
				remove_core = FROM
			}
		}
	}
	ai_will_do = {
		always = no
	}
}

nhs_carribean_to_kykladia = {
	category = influence
	require_acceptance = no
	is_visible = {
		overlord_of = FROM
		FROM = {
			tag = KYK
		}
		any_owned_province = {
			region = carribeans_region
			is_colony = no
		}
	}
	is_allowed = {
		is_at_war = no
		FROM = {
			is_at_war = no
		}
	}
	on_accept = {
		hidden_effect = {
			every_owned_province = {
				limit = {
					region = carribeans_region
					is_colony = no
				}
				cede_province = FROM
				if = {
					limit = {
						is_core = ROOT
					}
					add_core = FROM
					#hidden_effect = {
					#	remove_core = ROOT
					#}
				}
			}
		}
	}
	ai_will_do = {
		always = no
	}
}

nhs_grant_all_local_land = {
	category = influence
	require_acceptance = no
	is_visible = {
		overlord_of = FROM
		FROM = {
			is_subject_of_type = elysian_subject
			# NOT = { tag = ELG }
			# NOT = { tag = CM1 }
			# NOT = { tag = KYK }
		}
		any_owned_province = {
			nhs_exarch_land = { SCOPE = FROM }
		}
	}
	is_allowed = {
		is_at_war = no
		FROM = {
			is_at_war = no
		}
	}
	on_accept = {
		hidden_effect = {
			every_owned_province = {
				limit = {
					nhs_exarch_land = { SCOPE = FROM }
				}
				cede_province = FROM
				if = {
					limit = {
						is_core = ROOT
					}
					add_core = FROM
					hidden_effect = {
						remove_core = ROOT
					}
				}
				if = {
					limit = {
						is_territorial_core = ROOT
					}
					add_territorial_core = FROM
				}
				if = {
					limit = { culture_group = FROM }
					add_nationalism = -10
				}
			}
		}
	}
	ai_will_do = {
		always = no
	}
}

nhs_vgd_grant_area = {
	category = influence
	require_acceptance = no
	is_visible = {
		nhs_check_all_elysian_tags = { CONDITION = tag }
		NOT = { has_country_flag = to_varangians_settled_on_malta }
		overlord_of = FROM
		FROM = {
			tag = VGD
		}
		# FROM = {
			# capital_scope = {
				# any_neighbor_province = {
					# area = PREV
					# owned_by = ROOT
				# }
			# }
		# }
	}
	is_allowed = {
		is_at_war = no
		FROM = {
			is_at_war = no
		}
		custom_trigger_tooltip = {
			tooltip = nhs_has_provinces_in_their_capital_area_tt
			any_owned_province = {
				any_province = {
					area = PREV
					is_capital = yes
					owned_by = FROM
				}
			}
		}
	}
	on_accept = {
		set_country_flag = nhs_var_area
		every_province = {
			limit = {
				owned_by = ROOT
				is_colony = no
				any_province = {
					area = PREV
					is_capital = yes
					owned_by = FROM
				}
			}
			if = {
				limit = {
					is_core = ROOT
				}
				add_core = FROM
			}
			if = {
				limit = {
					nhs_post_fragmentation_culturally_elysian = yes
				}
				if = {
					limit = {
						owner = {
							NOT = { has_country_flag = to_varangian_culture_change }
						}
					}
					change_culture = varangian_n
				}
				else = {
					change_culture = varangian_e
				}
				hidden_effect = {
					nhs_on_province_culture_converted_general = {}
				}
			}
			cede_province = FROM
		}
	}
	ai_will_do = {
		always = no
	}
}

nhs_change_setting_all_land = {
	category = influence
	require_acceptance = no
	is_visible = {
		overlord_of = FROM
		FROM = {
			is_subject_of_type = elysian_subject
			# NOT = { tag = ELG }
			# NOT = { tag = CM1 }
			# NOT = { tag = KYK }
		}
	}
	is_allowed = {
		custom_trigger_tooltip = {
			tooltip = nhs_not_nhs_setting_all_land
			FROM = {
				NOT = { has_country_flag = nhs_ely_march_all }
			}
		}
	}
	on_accept = {
		FROM = {
			clr_country_flag = nhs_ely_march_territory
			clr_country_flag = nhs_ely_march_no_core
			clr_country_flag = nhs_ely_march_no
			set_country_flag = nhs_ely_march_all
		}
	}
	ai_will_do = {
		always = no
	}
}

nhs_change_setting_territory = {
	category = influence
	require_acceptance = no
	is_visible = {
		overlord_of = FROM
		FROM = {
			is_subject_of_type = elysian_subject
			# NOT = { tag = ELG }
			# NOT = { tag = CM1 }
			# NOT = { tag = KYK }
		}
	}
	is_allowed = {
		custom_trigger_tooltip = {
			tooltip = nhs_not_nhs_setting_territory
			FROM = {
				NOT = { has_country_flag = nhs_ely_march_territory }
			}
		}
	}
	on_accept = {
		FROM = {
			clr_country_flag = nhs_ely_march_all
			clr_country_flag = nhs_ely_march_no_core
			clr_country_flag = nhs_ely_march_no
			set_country_flag = nhs_ely_march_territory
		}
	}
	ai_will_do = {
		always = no
	}
}

nhs_change_setting_no_core = {
	category = influence
	require_acceptance = no
	is_visible = {
		overlord_of = FROM
		FROM = {
			is_subject_of_type = elysian_subject
			# NOT = { tag = ELG }
			# NOT = { tag = CM1 }
			# NOT = { tag = KYK }
		}
	}
	is_allowed = {
		custom_trigger_tooltip = {
			tooltip = nhs_not_nhs_setting_no_core
			FROM = {
				NOT = { has_country_flag = nhs_ely_march_no_core }
			}
		}
	}
	on_accept = {
		FROM = {
			clr_country_flag = nhs_ely_march_all
			clr_country_flag = nhs_ely_march_territory
			clr_country_flag = nhs_ely_march_no
			set_country_flag = nhs_ely_march_no_core
		}
	}
	ai_will_do = {
		always = no
	}
}

nhs_change_setting_no = {
	category = influence
	require_acceptance = no
	is_visible = {
		overlord_of = FROM
		FROM = {
			is_subject_of_type = elysian_subject
			# NOT = { tag = ELG }
			# NOT = { tag = CM1 }
			# NOT = { tag = KYK }
		}
	}
	is_allowed = {
		custom_trigger_tooltip = {
			tooltip = nhs_not_nhs_setting_no
			FROM = {
				NOT = { has_country_flag = nhs_ely_march_no }
			}
		}
	}
	on_accept = {
		FROM = {
			clr_country_flag = nhs_ely_march_all
			clr_country_flag = nhs_ely_march_territory
			clr_country_flag = nhs_ely_march_no_core
			set_country_flag = nhs_ely_march_no 
		}
	}
	ai_will_do = {
		always = no
	}
}

nhs_fabricate_exarch_claim = {
	category = covert
	require_acceptance = no
	is_visible = {
		ROOT = {
			nhs_check_all_elysian_tags = { CONDITION = tag }
		}
		FROM = {
			NOT = { is_subject_of = ROOT }
			OR = {
				to_owns_potential_exarch_claim = { EXARCH_TAG = ELG }

				to_owns_potential_exarch_claim = { EXARCH_TAG = EEA }
				to_owns_potential_exarch_claim = { EXARCH_TAG = EEB }
				to_owns_potential_exarch_claim = { EXARCH_TAG = EEC }
				to_owns_potential_exarch_claim = { EXARCH_TAG = EED }
				to_owns_potential_exarch_claim = { EXARCH_TAG = EEE }

				to_owns_potential_exarch_claim = { EXARCH_TAG = EEF }
				to_owns_potential_exarch_claim = { EXARCH_TAG = EEG }
				to_owns_potential_exarch_claim = { EXARCH_TAG = EEH }
				to_owns_potential_exarch_claim = { EXARCH_TAG = EEI }
				to_owns_potential_exarch_claim = { EXARCH_TAG = EEJ }

				to_owns_potential_exarch_claim = { EXARCH_TAG = EEL }
				to_owns_potential_exarch_claim = { EXARCH_TAG = EEM }
				to_owns_potential_exarch_claim = { EXARCH_TAG = EEO }
				to_owns_potential_exarch_claim = { EXARCH_TAG = EER }
				to_owns_potential_exarch_claim = { EXARCH_TAG = EES }

				to_owns_potential_exarch_claim = { EXARCH_TAG = EET }
				to_owns_potential_exarch_claim = { EXARCH_TAG = EEU }
				to_owns_potential_exarch_claim = { EXARCH_TAG = EEV }
				to_owns_potential_exarch_claim = { EXARCH_TAG = EEP }
				to_owns_potential_exarch_claim = { EXARCH_TAG = EEQ }
			}
		}
	}
	is_allowed = {
		if = {
			limit = {
				FROM = {
					is_subject = no
				}
			}
			has_spy_network_in = {
				who = FROM
				value = 25
			}
		}
		else = {
			FROM = {
				overlord = {
					has_spy_network_from = {
						who = ROOT
						value = 25
					}
				}
			}
		}
		
		NOT = { war_with = FROM }
		custom_trigger_tooltip = {
			tooltip = nhs_fabricate_exarch_claim_tt
			FROM = {
				OR = {
					to_owns_exarch_claim = { EXARCH_TAG = ELG }

					to_owns_exarch_claim = { EXARCH_TAG = EEA }
					to_owns_exarch_claim = { EXARCH_TAG = EEB }
					to_owns_exarch_claim = { EXARCH_TAG = EEC }
					to_owns_exarch_claim = { EXARCH_TAG = EED }
					to_owns_exarch_claim = { EXARCH_TAG = EEE }

					to_owns_exarch_claim = { EXARCH_TAG = EEF }
					to_owns_exarch_claim = { EXARCH_TAG = EEG }
					to_owns_exarch_claim = { EXARCH_TAG = EEH }
					to_owns_exarch_claim = { EXARCH_TAG = EEI }
					to_owns_exarch_claim = { EXARCH_TAG = EEJ }

					to_owns_exarch_claim = { EXARCH_TAG = EEL }
					to_owns_exarch_claim = { EXARCH_TAG = EEM }
					to_owns_exarch_claim = { EXARCH_TAG = EEO }
					to_owns_exarch_claim = { EXARCH_TAG = EER }
					to_owns_exarch_claim = { EXARCH_TAG = EES }

					to_owns_exarch_claim = { EXARCH_TAG = EET }
					to_owns_exarch_claim = { EXARCH_TAG = EEU }
					to_owns_exarch_claim = { EXARCH_TAG = EEV }
					to_owns_exarch_claim = { EXARCH_TAG = EEP }
					to_owns_exarch_claim = { EXARCH_TAG = EEQ }
				}
			}
		}
	}
	on_accept = {
		if = {
			limit = {
				FROM = {
					is_subject = no
				}
			}
			add_spy_network_in = {
				who = FROM
				value = -25
			}
		}
		else = {
			FROM = {
				overlord = {
					add_spy_network_from = {
						who = ROOT
						value = -25
					}
				}
			}
		}
		FROM = {
			to_fabricate_exarch_claim_effect = { EXARCH_TAG = ELG }

			to_fabricate_exarch_claim_effect = { EXARCH_TAG = EEA }
			to_fabricate_exarch_claim_effect = { EXARCH_TAG = EEB }
			to_fabricate_exarch_claim_effect = { EXARCH_TAG = EEC }
			to_fabricate_exarch_claim_effect = { EXARCH_TAG = EED }
			to_fabricate_exarch_claim_effect = { EXARCH_TAG = EEE }
	
			to_fabricate_exarch_claim_effect = { EXARCH_TAG = EEF }
			to_fabricate_exarch_claim_effect = { EXARCH_TAG = EEG }
			to_fabricate_exarch_claim_effect = { EXARCH_TAG = EEH }
			to_fabricate_exarch_claim_effect = { EXARCH_TAG = EEI }
			to_fabricate_exarch_claim_effect = { EXARCH_TAG = EEJ }
	
			to_fabricate_exarch_claim_effect = { EXARCH_TAG = EEL }
			to_fabricate_exarch_claim_effect = { EXARCH_TAG = EEM }
			to_fabricate_exarch_claim_effect = { EXARCH_TAG = EEO }
			to_fabricate_exarch_claim_effect = { EXARCH_TAG = EER }
			to_fabricate_exarch_claim_effect = { EXARCH_TAG = EES }
	
			to_fabricate_exarch_claim_effect = { EXARCH_TAG = EET }
			to_fabricate_exarch_claim_effect = { EXARCH_TAG = EEU }
			to_fabricate_exarch_claim_effect = { EXARCH_TAG = EEV }
			to_fabricate_exarch_claim_effect = { EXARCH_TAG = EEP }
			to_fabricate_exarch_claim_effect = { EXARCH_TAG = EEQ }
		}
	}
	ai_will_do = {
		always = no
	}
}

to_change_elysian_governor_color = {
	category = influence
	require_acceptance = no
	is_visible = {
		FROM = {
			is_subject_of = ROOT
			OR = {
				tag = ED0
				tag = ED1
			}
		}
	}
	is_allowed = {
		FROM = {
			is_subject_of_type = to_elysian_governor
		}
	}
	on_accept = {
		FROM = {
			if = {
				limit = {
					tag = ED0
				}
				change_tag = ED1
			}
			else_if = {
				limit = {
					tag = ED1
				}
				change_tag = ED0
			}
		}
	}
	ai_will_do = {
		always = no
	}
}

to_release_as_protectorate = {
	category = influence
	require_acceptance = no
	is_visible = {
		mission_completed = to_a_world_empire_mission
		FROM = {
			is_subject_of = ROOT
			OR = {
				is_subject_of_type = vassal
				is_subject_of_type = march
			}
			OR = {
				technology_group = indian
				technology_group = east_african
				technology_group = central_african
				technology_group = chinese
				technology_group = sub_saharan
				technology_group = polynesian_tech
				technology_group = aboriginal_tech
			}
		}
	}
	is_allowed = {
		FROM = {
			OR = {
				is_subject_of_type = vassal
				is_subject_of_type = march
			}
		}
	}
	on_accept = {
		FROM = {
			set_country_flag = to_do_not_change_annexation_date
		}
		create_subject = {
			subject_type = nhs_protectorate
			subject = FROM
		}
		FROM = {
			clr_country_flag = to_do_not_change_annexation_date
		}
	}
	ai_will_do = {
		always = no
	}
}

to_establish_protectorate = {
	category = influence
	require_acceptance = yes
	is_visible = {
		mission_completed = to_a_world_empire_mission
		FROM = {
			is_subject = no
			OR = {
				technology_group = indian
				technology_group = east_african
				technology_group = central_african
				technology_group = chinese
				technology_group = sub_saharan
				technology_group = polynesian_tech
				technology_group = aboriginal_tech
			}
		}
	}
	is_allowed = {
		FROM = {
			is_at_war = no
			if = {
				limit = {
					OR = {
						has_dlc = "Rights of Man"
						has_dlc = "Emperor"
					}
				}
				is_great_power = no
			}
			has_opinion = { who = ROOT value = 50 }
			OR = {
				technology_group = indian
				technology_group = east_african
				technology_group = central_african
				technology_group = chinese
				technology_group = sub_saharan
				technology_group = polynesian_tech
				technology_group = aboriginal_tech
			}
			capital_scope = {
				trade_range = ROOT
			}
		}
	}
	on_accept = {
		create_subject = {
			subject_type = nhs_protectorate
			subject = FROM
		}
	}

	ai_acceptance = { # This works similarly to variable_arithmetic_trigger, but does not support triggers generally. Instead, "limit" will be evaluated first and the rest ignored if it isn't passed.
		add_entry = {
			name = TO_VASSALIZATION_ACCEPTANCE
			export_to_variable = {
				variable_name = ai_value
				value = modifier:accept_vassalization_reasons
			}

		}
		add_entry = {
			name = TO_RELATIVE_ECONOMIC_BASE
			limit = {
				to_relative_economic_base_above = { VALUE = 30 }
			}
			export_to_variable = {
				variable_name = ai_value
				value = 30
			}
		}
		add_entry = {
			name = TO_RELATIVE_ECONOMIC_BASE
			limit = {
				NOT = { to_relative_economic_base_above = { VALUE = 30 } }
			}
			# Adapted from https://eu4.paradoxwikis.com/Vassal#cite_note-1
			export_to_variable = {
				variable_name = ai_value
				value = 0
			}
			export_to_variable = {
				variable_name = own_development
				value = trigger_value:total_own_and_non_tributary_subject_development
			}
			change_variable = {
				which = own_development
				value = 10
			}
			divide_variable = {
				which = own_development
				value = 2
			}
			export_to_variable = {
				variable_name = their_development
				value = trigger_value:total_own_and_non_tributary_subject_development
				who = FROM
			}
			change_variable = {
				which = their_development
				value = 10
			}
			divide_variable = {
				which = their_development
				value = 2
			}

			change_variable = {
				which = own_development
				value = 1
			}
			multiply_variable = {
				which = their_development
				which = their_development
			}
			divide_variable = {
				which = their_development
				value = 2
			}
			change_variable = {
				which = their_development
				value = 1
			}

			change_variable = {
				which = ai_value
				which = own_development
			}

			divide_variable = {
				which = ai_value
				which = their_development
			}
			multiply_variable = {
				which = ai_value
				value = 30
			}
			subtract_variable = {
				which = ai_value
				value = 90
			}
		}

		add_entry = {
			name = TO_HOSTILE_ATTITUDE
			limit = {
				FROM = {
					ai_attitude = {
						who = ROOT
						attitude = attitude_hostile
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = -1000
			}
		}
		add_entry = {
			name = TO_RIVALRY_ATTITUDE
			limit = {
				FROM = {
					ai_attitude = {
						who = ROOT
						attitude = attitude_rivalry
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = -1000
			}
		}
		add_entry = {
			name = TO_ALLY_ATTITUDE
			limit = {
				FROM = {
					ai_attitude = {
						who = ROOT
						attitude = attitude_allied
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = 10
			}
		}
		add_entry = {
			name = TO_FRIENDLY_ATTITUDE
			limit = {
				FROM = {
					ai_attitude = {
						who = ROOT
						attitude = attitude_friendly
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = 10
			}
		}
		add_entry = {
			name = TO_THREATENED_ATTITUDE
			limit = {
				FROM = {
					ai_attitude = {
						who = ROOT
						attitude = attitude_threatened
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = 10
			}
		}
		add_entry = {
			name = TO_OUTRAGED_ATTITUDE
			limit = {
				FROM = {
					ai_attitude = {
						who = ROOT
						attitude = attitude_outraged
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = -1000
			}
		}
		add_entry = {
			name = TO_DEFENSIVE_ATTITUDE
			limit = {
				FROM = {
					ai_attitude = {
						who = ROOT
						attitude = attitude_defensive
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = -1000
			}
		}
		add_entry = {
			name = TO_DOMINEERING_ATTITUDE
			limit = {
				FROM = {
					ai_attitude = {
						who = ROOT
						attitude = attitude_domineering
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = -1000
			}
		}

		add_entry = {
			name = TO_HAS_ROYAL_MARRIAGE
			limit = {
				marriage_with = FROM
			}
			export_to_variable = {
				variable_name = ai_value
				value = 10
			}
		}

		add_entry = {
			name = TO_TRUST
			limit = {
				OR = {
					has_dlc = "Leviathan"
					has_dlc = "The Cossacks"
				}
				FROM = {
					trust = { who = ROOT value = 50 }
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = trust
				who = FROM
				with = ROOT
			}
			subtract_variable = {
				which = ai_value
				value = 50
			}
			divide_variable = {
				which = ai_value
				value = 5
			}
		}
		add_entry = {
			name = TO_TRUST
			limit = {
				OR = {
					has_dlc = "Leviathan"
					has_dlc = "The Cossacks"
				}
				FROM = {
					trust = { who = ROOT value = 30 }
					NOT = { trust = { who = ROOT value = 50 } }
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = trust
				who = FROM
				with = ROOT
			}
			subtract_variable = {
				which = ai_value
				value = 50
			}
			multiply_variable = {
				which = ai_value
				value = 2
			}
		}
		add_entry = {
			name = TO_TRUST
			limit = {
				OR = {
					has_dlc = "Leviathan"
					has_dlc = "The Cossacks"
				}
				FROM = {
					NOT = { trust = { who = ROOT value = 30 } }
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = -2000
			}
		}

		add_entry = {
			name = TO_DIPLOMATIC_REPUTATION
			export_to_variable = {
				variable_name = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 3 }
		}

		add_entry = {
			name = TO_GOVERNMENT_RANK
			limit = {
				OR = {
					AND = {
						government_rank = 3
						NOT = { FROM = { government_rank = 3 } }
					}
					AND = {
						government_rank = 2
						NOT = { FROM = { government_rank = 2 } }
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = trigger_value:government_rank
			}
			export_to_variable = {
				variable_name = gov_rank_from
				value = trigger_value:government_rank
				who = FROM
			}
			subtract_variable = {
				which = ai_value
				which = gov_rank_from
			}
			multiply_variable = { which = ai_value value = 10 }
		}

		add_entry = {
			name = TO_GOVERNMENT_RANK
			limit = {
				OR = {
					AND = {
						FROM = { government_rank = 3 }
						NOT = { government_rank = 3 }
					}
					AND = {
						FROM = { government_rank = 2 }
						NOT = { government_rank = 2 }
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = trigger_value:government_rank
			}
			export_to_variable = {
				variable_name = gov_rank_from
				value = trigger_value:government_rank
				who = FROM
			}
			subtract_variable = {
				which = ai_value
				which = gov_rank_from
			}
			multiply_variable = { which = ai_value value = 30 }
		}

		add_entry = {
			name = TO_TOO_MUCH_DEV
			limit = {
				FROM = {
					total_own_and_non_tributary_subject_development = 200
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = -1000
			}
		}

		add_entry = {
			name = TO_OWN_THEIR_CORES
			limit = {
				FROM = {
					any_core_province = {
						owned_by = ROOT
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = -1000
			}
		}

		add_entry = {
			name = TO_OPINION
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = 8 }
		}
	}

	ai_will_do = {
		always = no
	}
}

to_integrate_varangian_order = {
	category = influence
	require_acceptance = no
	is_visible = {
		nhs_check_all_elysian_tags = { CONDITION = tag }
		overlord_of = FROM
		FROM = { 
			tag = VGD 
		}
	}
	is_allowed = {
		adm_tech = 10
		is_at_war = no
		adm_power = 100
		dip_power = 200
		FROM = {
			is_at_war = no
			if = {
				limit = {
					has_country_flag = to_became_a_subject
				}
				if = {
					limit = {
						check_variable = {
							which = to_protectorate_annexation_month
							value = 1
						}
						check_variable = {
							which = to_protectorate_annexation_year_20
							value = 1
						}
					}
					custom_trigger_tooltip = {
						tooltip = to_integrate_varangians_date_specific_tt
						had_country_flag = {
							flag = to_became_a_subject
							days = 7300
						}
					}
				}
				else = {
					custom_trigger_tooltip = {
						tooltip = to_integrate_varangians_date_tt
						had_country_flag = {
							flag = to_became_a_subject
							days = 7300
						}
					}
				}
			}
		}
	}
	on_accept = {
		clr_country_flag = nhs_varangian_guard_substate
		set_country_flag = nhs_varangian_guard_integrated
		FROM = {
			capital_scope = {
				set_province_flag = vov_capital
			}
			every_owned_province = {
				cede_province = ROOT
				if = {
					limit = { has_province_flag = vov_capital }
					add_province_modifier = {
						name = to_varangian_headquarters
						duration = -1
					}
					clr_province_flag = vov_capital
				}
				else = {
					add_province_modifier = {
						name = to_varangian_stronghold
						duration = -1
					}
				}
				if = {
					limit = {
						is_core = FROM
					}
					add_core = ROOT
					remove_core = FROM 
				}
			}
		}
		every_owned_province = {
			limit = {
				has_province_modifier = to_varangian_stronghold_independent
			}
			remove_province_modifier = to_varangian_stronghold_independent
			add_province_modifier = {
				name = to_varangian_stronghold
				duration = -1
			}
		}
	}
}