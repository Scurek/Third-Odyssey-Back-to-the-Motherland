to_request_to_join_confederation = {
	category = alliance

	alert_index = 40
	alert_tooltip = to_request_to_join_confederation_tooltip

	require_acceptance = yes # Whether the recipient gets an option to decline

	is_visible = {
		# always = yes
		has_reform = native_basic_reform
		NOT = { has_subject_of_type = to_confederation_subject }
		NOT = { is_subject_of_type = to_confederation_subject }
		FROM = {
			has_reform = native_basic_reform
		}
	}
	is_allowed = {
		is_subject = no
		FROM = {
			is_subject = no
		}
	}
	on_accept = {
		FROM = {
			create_subject = {
				subject_type = to_confederation_subject
				subject = ROOT
			}
		}
		add_trust = {
			who = FROM
			value = 20
			mutual = yes
		}
	}
	on_decline =
	{
	}

	ai_acceptance = { # This works similarly to variable_arithmetic_trigger, but does not support triggers generally. Instead, "limit" will be evaluated first and the rest ignored if it isn't passed.
		add_entry = {
			name = ALLIANCE
			limit = { alliance_with = FROM }
			export_to_variable = {
                variable_name = ai_value
                value = 20
            }
		}
		add_entry = {
			name = RIVALRY
			limit = {
				FROM = {
					ai_attitude = {
						who = ROOT
						attitude = attitude_rivalry
					}
				}
			}
			export_to_variable = {
                variable_name = ai_value
                value = -50
            }
		}
		add_entry = {
			name = TRUST
			export_to_variable = {
				variable_name = ai_value
				value = trust
				who = FROM
			}
			subtract_variable = { which = ai_value value = 45 }
			multiply_variable = { which = ai_value value = 2 }
		}
		add_entry = {
			name = CULTURE_FOREIGN
			limit = { 
				NOT = { culture_group = FROM }
			}
			export_to_variable = {
                variable_name = ai_value
                value = -20
            }
		}
		add_entry = {
			name = CULTURE_SAME
			limit = { 
				primary_culture = FROM
			}
			export_to_variable = {
                variable_name = ai_value
                value = 40
            }
		}
		add_entry = {
			name = DISTANCE
			limit = {
				border_distance = {
					who = FROM
					distance = 20
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = border_distance
				who = FROM
			}
			subtract_variable = { which = ai_value value = 20 }
			multiply_variable = { which = ai_value value = -1 }
		}
		# add_entry = {
		# 	name = OPINION
		# 	export_to_variable = {
		# 		variable_name = ai_value
		# 		value = opinion
		# 		who = FROM
		# 		with = THIS
		# 	}
		# 	divide_variable = { which = ai_value value = 4 }
		# }
	}

	ai_will_do = { # this is a trigger
		always = yes
	}
}

to_cancel_confederation =  {
	category = alliance
	require_acceptance = no
	is_visible = {
		overlord_of = FROM
		FROM = {
			is_subject_of_type = to_confederation_subject
		}
	}
	is_allowed = {
		always = yes
	}
	on_accept = {
		add_trust = {
			who = FROM
			value = -100
			mutual = yes
		}
		FROM = {
			grant_independence = yes
		}
	}
	ai_will_do = {
		always = no
	}
}

