custom_icon = {
    name = to_elysian_silk_background
    potential = {
        ai = no
        nhs_check_all_elysian_tags = { CONDITION = tag }
        has_country_flag = to_elysian_silk_production_mechanic
    }
}

custom_text_box = {
    name = to_elysian_silk_text_box
    # tooltip = to_elysian_silk_panel_title
    potential = {
        ai = no
        nhs_check_all_elysian_tags = { CONDITION = tag }
        has_country_flag = to_elysian_silk_production_mechanic
    }
}

custom_text_box = {
    name = to_elysian_silk_trade_value
    tooltip = to_elysian_silk_trade_value_tooltip
    potential = {
        ai = no
        nhs_check_all_elysian_tags = { CONDITION = tag }
        has_country_flag = to_elysian_silk_production_mechanic
    }
}

custom_text_box = {
    name = to_elysian_silk_provinces
    tooltip = to_elysian_silk_provinces_tooltip
    potential = {
        ai = no
        nhs_check_all_elysian_tags = { CONDITION = tag }
        has_country_flag = to_elysian_silk_production_mechanic
    }
}

custom_button = {
    name = to_elysian_silk_button_1
    tooltip = to_elysian_silk_objective_1_tooltip
    potential = {
        ai = no
        nhs_check_all_elysian_tags = { CONDITION = tag }
        has_country_flag = to_elysian_silk_production_mechanic
        NOT = { has_global_flag = to_elysian_silk_price_increase_1_done }
    }
    trigger = {
        owns = 953
        num_of_light_ship = 20
    }
    effect = {
        set_global_flag = to_elysian_silk_price_increase_1_done

        add_dip_power = -50
        # custom_tooltip = to_lose_20_light_ships_in_953_tt
        # custom_tooltip = nhs_new_line_tt
        custom_tooltip = to_modify_silk_quarter_0_1_tt
        custom_tooltip = nhs_new_line_tt
        custom_tooltip = to_can_select_another_elysian_silk_province_tt
        hidden_effect = {
            953 = {
                kill_units = {
                    who = ROOT
                    type = light_ship
                    amount = 20
                }
            }
            to_add_elysian_silk_potential_provinces = {
                amount = 1
            }
            953 = {
                remove_province_triggered_modifier = to_silk_quarter_0_tm
                add_province_triggered_modifier = to_silk_quarter_1_tm
            }
        }
    }
}

custom_button = {
    name = to_elysian_silk_button_1_done
    tooltip = to_elysian_silk_objective_1_tooltip
    potential = {
        ai = no
        nhs_check_all_elysian_tags = { CONDITION = tag }
        has_country_flag = to_elysian_silk_production_mechanic
        has_global_flag = to_elysian_silk_price_increase_1_done
    }
    effect = {
        tooltip = {
            add_dip_power = -50
            custom_tooltip = to_modify_silk_quarter_0_1_tt
            custom_tooltip = nhs_new_line_tt
            custom_tooltip = to_can_select_another_elysian_silk_province_tt
        }
    }
}

custom_icon = {
    name = to_elysian_silk_arrow_1_no
    potential = {
        ai = no
        nhs_check_all_elysian_tags = { CONDITION = tag }
        has_country_flag = to_elysian_silk_production_mechanic
        NOT = { has_global_flag = to_elysian_silk_price_increase_1_done }
    }
}

custom_icon = {
    name = to_elysian_silk_arrow_1_yes
    potential = {
        ai = no
        nhs_check_all_elysian_tags = { CONDITION = tag }
        has_country_flag = to_elysian_silk_production_mechanic
        has_global_flag = to_elysian_silk_price_increase_1_done
    }
}

custom_button = {
    name = to_elysian_silk_button_2
    tooltip = to_elysian_silk_objective_2_tooltip
    potential = {
        ai = no
        nhs_check_all_elysian_tags = { CONDITION = tag }
        has_country_flag = to_elysian_silk_production_mechanic
        NOT = { has_global_flag = to_elysian_silk_price_increase_2_done }
    }
    trigger = {
        custom_trigger_tooltip = {
            tooltip = to_completed_elysian_silk_objective_1_tt
            has_global_flag = to_elysian_silk_price_increase_1_done
        }
        owns = 953
        953 = {
            has_production_building_trigger = yes
            OR = {
                base_production = 15
                development = 40
            }
        }
    }
    effect = {
        set_global_flag = to_elysian_silk_price_increase_2_done
        
        change_price = {
			trade_goods = elysian_silk
			key = TO_ELYSIAN_SILK_PRICE_INCREASE_2
			value = 0.25
			duration = -1
		}
        custom_tooltip = nhs_new_line_tt
        custom_tooltip = to_modify_silk_quarter_1_2_tt
        custom_tooltip = nhs_new_line_tt
        custom_tooltip = to_can_select_another_elysian_silk_province_tt
        hidden_effect = {
            change_variable = {
                which = to_elysian_silk_value
                value = 1
            }
            to_add_elysian_silk_potential_provinces = {
                amount = 1
            }
            953 = {
                remove_province_triggered_modifier = to_silk_quarter_1_tm
                add_province_triggered_modifier = to_silk_quarter_2_tm
            }
        }
    }
}

custom_button = {
    name = to_elysian_silk_button_2_done
    tooltip = to_elysian_silk_objective_2_tooltip
    potential = {
        ai = no
        nhs_check_all_elysian_tags = { CONDITION = tag }
        has_country_flag = to_elysian_silk_production_mechanic
        has_global_flag = to_elysian_silk_price_increase_2_done
    }
    effect = {
        tooltip = {
            change_price = {
                trade_goods = elysian_silk
                key = TO_ELYSIAN_SILK_PRICE_INCREASE_2
                value = 0.25
                duration = -1
            }
            custom_tooltip = nhs_new_line_tt
            custom_tooltip = to_modify_silk_quarter_1_2_tt
            custom_tooltip = nhs_new_line_tt
            custom_tooltip = to_can_select_another_elysian_silk_province_tt
        }        
    }
}

custom_icon = {
    name = to_elysian_silk_arrow_2_no
    potential = {
        ai = no
        nhs_check_all_elysian_tags = { CONDITION = tag }
        has_country_flag = to_elysian_silk_production_mechanic
        NOT = { has_global_flag = to_elysian_silk_price_increase_2_done }
    }
}

custom_icon = {
    name = to_elysian_silk_arrow_2_yes
    potential = {
        ai = no
        nhs_check_all_elysian_tags = { CONDITION = tag }
        has_country_flag = to_elysian_silk_production_mechanic
        has_global_flag = to_elysian_silk_price_increase_2_done
    }
}

custom_button = {
    name = to_elysian_silk_button_3
    tooltip = to_elysian_silk_objective_3_tooltip
    potential = {
        ai = no
        nhs_check_all_elysian_tags = { CONDITION = tag }
        has_country_flag = to_elysian_silk_production_mechanic
        NOT = { has_global_flag = to_elysian_silk_price_increase_3_done }
    }
    trigger = {
        custom_trigger_tooltip = {
            tooltip = to_completed_elysian_silk_objective_2_tt
            has_global_flag = to_elysian_silk_price_increase_2_done
        }
        owns = 953
        950 = {
            owned_by = ROOT
            has_great_project = {
                type = nhs_cothon
                tier = 2
            }
        }
        any_province = {
            country_or_subject_holds = ROOT
            has_great_project = {
                type = akrotirion
                tier = 2
            }
        }
    }
    effect = {
        set_global_flag = to_elysian_silk_price_increase_3_done
        
        custom_tooltip = to_modify_silk_quarter_2_3_tt
        custom_tooltip = nhs_new_line_tt
        custom_tooltip = to_can_select_two_elysian_silk_provinces_tt
        hidden_effect = {
            to_add_elysian_silk_potential_provinces = {
                amount = 2
            }
            953 = {
                remove_province_triggered_modifier = to_silk_quarter_2_tm
                add_province_triggered_modifier = to_silk_quarter_3_tm
            }
        }
    }
}

custom_button = {
    name = to_elysian_silk_button_3_done
    tooltip = to_elysian_silk_objective_3_tooltip
    potential = {
        ai = no
        nhs_check_all_elysian_tags = { CONDITION = tag }
        has_country_flag = to_elysian_silk_production_mechanic
        has_global_flag = to_elysian_silk_price_increase_3_done
    }
    effect = {
        tooltip = {
            custom_tooltip = to_modify_silk_quarter_2_3_tt
            custom_tooltip = nhs_new_line_tt
            custom_tooltip = to_can_select_two_elysian_silk_provinces_tt
        }
    }
}

custom_icon = {
    name = to_elysian_silk_arrow_3_no
    potential = {
        ai = no
        nhs_check_all_elysian_tags = { CONDITION = tag }
        has_country_flag = to_elysian_silk_production_mechanic
        NOT = { has_global_flag = to_elysian_silk_price_increase_3_done }
    }
}

custom_icon = {
    name = to_elysian_silk_arrow_3_yes
    potential = {
        ai = no
        nhs_check_all_elysian_tags = { CONDITION = tag }
        has_country_flag = to_elysian_silk_production_mechanic
        has_global_flag = to_elysian_silk_price_increase_3_done
    }
}

custom_button = {
    name = to_elysian_silk_button_4
    tooltip = to_elysian_silk_objective_4_tooltip
    potential = {
        ai = no
        nhs_check_all_elysian_tags = { CONDITION = tag }
        has_country_flag = to_elysian_silk_production_mechanic
        NOT = { has_global_flag = to_elysian_silk_price_increase_4_done }
    }
    trigger = {
        custom_trigger_tooltip = {
            tooltip = to_completed_elysian_silk_objective_3_tt
            has_global_flag = to_elysian_silk_price_increase_3_done
        }
        owns = 953
        has_institution = global_trade
        num_of_provinces_owned_or_owned_by_subjects_with = {
            value = 30
            province_has_center_of_trade_of_level = 1
        }
        if = {
            limit = {
                num_of_provinces_owned_or_owned_by_subjects_with = {
                    value = 6
                    development = 20
                    trade_goods = elysian_silk
                }
            }
            custom_trigger_tooltip = {
                tooltip = to_elysian_silk_objective_4_dip_cost_0_tt
                always = yes
            }
        }
        else_if = {
            limit = {
                num_of_provinces_owned_or_owned_by_subjects_with = {
                    value = 5
                    development = 20
                    trade_goods = elysian_silk
                } 
            }
            custom_trigger_tooltip = {
                tooltip = to_elysian_silk_objective_4_dip_cost_100_tt
                dip_power = 100
            }
        }
        else_if = {
            limit = {
                num_of_provinces_owned_or_owned_by_subjects_with = {
                    value = 4
                    development = 20
                    trade_goods = elysian_silk
                } 
            }
            custom_trigger_tooltip = {
                tooltip = to_elysian_silk_objective_4_dip_cost_200_tt
                dip_power = 200
            }
        }
        else_if = {
            limit = {
                num_of_provinces_owned_or_owned_by_subjects_with = {
                    value = 3
                    development = 20
                    trade_goods = elysian_silk
                } 
            }
            custom_trigger_tooltip = {
                tooltip = to_elysian_silk_objective_4_dip_cost_300_tt
                dip_power = 300
            }
        }
        else_if = {
            limit = {
                num_of_provinces_owned_or_owned_by_subjects_with = {
                    value = 2
                    development = 20
                    trade_goods = elysian_silk
                } 
            }
            custom_trigger_tooltip = {
                tooltip = to_elysian_silk_objective_4_dip_cost_400_tt
                dip_power = 400
            }
        }
        else_if = {
            limit = {
                num_of_provinces_owned_or_owned_by_subjects_with = {
                    value = 1
                    development = 20
                    trade_goods = elysian_silk
                } 
            }
            custom_trigger_tooltip = {
                tooltip = to_elysian_silk_objective_4_dip_cost_500_tt
                dip_power = 500
            }
        }
        else_if = {
            custom_trigger_tooltip = {
                tooltip = to_elysian_silk_objective_4_dip_cost_600_tt
                dip_power = 600
            }
        }
        # development_in_provinces = {
        #     value = 120
        #     trade_goods = elysian_silk
        # }
    }
    effect = {
        set_global_flag = to_elysian_silk_price_increase_4_done
        # custom_tooltip = to_cost_scales_with_non_developed_provinces_tt
        if = {
            limit = {
                NOT = {
                    num_of_provinces_owned_or_owned_by_subjects_with = {
                        value = 6
                        development = 20
                        trade_goods = elysian_silk
                    } 
                }
            }
            if = {
                limit = {
                    num_of_provinces_owned_or_owned_by_subjects_with = {
                        value = 5
                        development = 20
                        trade_goods = elysian_silk
                    } 
                }
                add_dip_power = -100
            }
            else_if = {
                limit = {
                    num_of_provinces_owned_or_owned_by_subjects_with = {
                        value = 4
                        development = 20
                        trade_goods = elysian_silk
                    } 
                }
                add_dip_power = -200
            }
            else_if = {
                limit = {
                    num_of_provinces_owned_or_owned_by_subjects_with = {
                        value = 3
                        development = 20
                        trade_goods = elysian_silk
                    } 
                }
                add_dip_power = -300
            }
            else_if = {
                limit = {
                    num_of_provinces_owned_or_owned_by_subjects_with = {
                        value = 2
                        development = 20
                        trade_goods = elysian_silk
                    } 
                }
                add_dip_power = -400
            }
            else_if = {
                limit = {
                    num_of_provinces_owned_or_owned_by_subjects_with = {
                        value = 1
                        development = 20
                        trade_goods = elysian_silk
                    } 
                }
                add_dip_power = -500
            }
            else_if = {
                add_dip_power = -600
            }
        }
        else = {
            custom_tooltip = nhs_lose_0_dip
        }
        # custom_tooltip = nhs_new_line_tt

        country_event = {
            id = nhs2_countryevents.32
            tooltip = to_trigger_finest_of_silk_event_tt
        }
        tooltip = {
            change_price = {
                trade_goods = elysian_silk
                key = TO_ELYSIAN_SILK_PRICE_INCREASE_4
                value = 0.50
                duration = -1
            }
            change_price = {
                trade_goods = silk
                key = ELYSIAN_SILK_BETTER
                value = -0.1
                duration = -1
            }
        }
        custom_tooltip = nhs_new_line_tt
        custom_tooltip = to_modify_silk_quarter_3_4_tt
        custom_tooltip = nhs_new_line_tt
        custom_tooltip = to_can_select_two_elysian_silk_provinces_tt
        hidden_effect = {
            change_variable = {
                which = to_elysian_silk_value
                value = 2
            }
            to_add_elysian_silk_potential_provinces = {
                amount = 2
            }
            953 = {
                remove_province_triggered_modifier = to_silk_quarter_3_tm
                add_province_triggered_modifier = to_silk_quarter_4_tm
            }
        }
    }
}

custom_button = {
    name = to_elysian_silk_button_4_done
    tooltip = to_elysian_silk_objective_4_tooltip
    potential = {
        ai = no
        nhs_check_all_elysian_tags = { CONDITION = tag }
        has_country_flag = to_elysian_silk_production_mechanic
        has_global_flag = to_elysian_silk_price_increase_4_done
    }
    effect = {
        tooltip = {
            custom_tooltip = to_trigger_finest_of_silk_event_tt
            custom_tooltip = nhs_new_line_tt
            custom_tooltip = to_modify_silk_quarter_3_4_tt
            custom_tooltip = nhs_new_line_tt
            custom_tooltip = to_can_select_two_elysian_silk_provinces_tt    
        }
    }
}

custom_icon = {
    name = to_elysian_silk_arrow_4_no
    potential = {
        ai = no
        nhs_check_all_elysian_tags = { CONDITION = tag }
        has_country_flag = to_elysian_silk_production_mechanic
        NOT = { has_global_flag = to_elysian_silk_price_increase_4_done }
    }
}

custom_icon = {
    name = to_elysian_silk_arrow_4_yes
    potential = {
        ai = no
        nhs_check_all_elysian_tags = { CONDITION = tag }
        has_country_flag = to_elysian_silk_production_mechanic
        has_global_flag = to_elysian_silk_price_increase_4_done
    }
}

custom_button = {
    name = to_elysian_silk_button_5
    tooltip = to_elysian_silk_objective_5_tooltip
    potential = {
        ai = no
        nhs_check_all_elysian_tags = { CONDITION = tag }
        has_country_flag = to_elysian_silk_production_mechanic
        NOT = { has_global_flag = to_elysian_silk_price_increase_5_done }
    }
    trigger = {
        custom_trigger_tooltip = {
            tooltip = to_completed_elysian_silk_objective_4_tt
            has_global_flag = to_elysian_silk_price_increase_4_done
        }
        owns = 953
        dip_power = 200
        num_of_owned_provinces_with = {
            value = 20
            has_building = textile
        }
        OR = {
            if = {
                limit = {
                    has_dlc = "Rule Britannia"
                }
                innovativeness = 75
            }
            else = {
                hidden_trigger = {
                    always = no
                }
            }
            has_institution = manufactories
            num_of_owned_provinces_with = {
                value = 50
                has_building = university
            }
        }
    }
    effect = {
        set_global_flag = to_elysian_silk_price_increase_5_done
        add_dip_power = -200
        country_event = {
            id = nhs2_countryevents.10
            tooltip = to_trigger_elysian_silk_objective_5_event_tt
        }
        custom_tooltip = nhs_new_line_tt
        custom_tooltip = to_can_select_elysian_silk_province_per_1000_dev_tt
    }
}

custom_button = {
    name = to_elysian_silk_button_5_done
    tooltip = to_elysian_silk_objective_5_tooltip
    potential = {
        ai = no
        nhs_check_all_elysian_tags = { CONDITION = tag }
        has_global_flag = to_elysian_silk_price_increase_5_done
        has_country_flag = to_elysian_silk_production_mechanic
    }
    effect = {
        tooltip = {
            add_dip_power = -200
            custom_tooltip = to_trigger_elysian_silk_objective_5_event_tt
            custom_tooltip = nhs_new_line_tt
            custom_tooltip = to_can_select_elysian_silk_province_per_1000_dev_tt    
        }
    }
}

custom_button = {
    name = to_add_elysian_silk_to_province
    tooltip = to_add_elysian_silk_to_province_tooltip
    potential = {
        is_city = yes
        owner = {
            OR = {
                AND = {
                    ai = no
                    nhs_check_all_elysian_tags = { CONDITION = tag }
                    has_country_flag = to_elysian_silk_production_mechanic
                }
                overlord = {
                    ai = no
                    nhs_check_all_elysian_tags = { CONDITION = tag }
                    has_country_flag = to_elysian_silk_production_mechanic
                }
            }
        }
        has_port = yes
        OR = {
            if = {
                limit = {
                    NOT = { has_global_flag = to_elysian_silk_price_increase_5_done }
                }
                OR = {
                    area = florida_area
                    area = lucayan_area
                    area = cuba_area
                    area = east_cuba_area
                    area = hispaniola_area
                }
            }
            else = {
                region = carribeans_region
            }
            area = thrace_area
            area = macedonia_area
            area = corsica_sardinia_area
            area = catalonia_area
            area = valencia_area
            area = baleares_area
            area = tunisia_area
        }
        NOT = { province_id = 151 }
        # OR = {
        #     if = {
        #         limit = {
        #             NOT = { has_global_flag = to_elysian_silk_price_increase_5_done }
        #         }
        #         province_id = 926
        #         province_id = 2536
        #         province_id = 482
        #         province_id = 485
        #         province_id = 2656
        #         province_id = 2654
        #     }
        #     else = {
        #         region = carribeans_region
        #     }
        #     AND = {
        #         has_port = yes
        #         OR = {
        #             area = thrace_area
        #             area = macedonia_area
        #             area = corsica_sardinia_area
        #             area = catalonia_area
        #             area = valencia_area
        #             area = baleares_area
        #             area = tunisia_area
        #         }
        #     }
        # }
    }
    trigger = {
        NOT = { trade_goods = elysian_silk }
        if = {
            limit = {
                province_id = 481
            }
            NOT = { province_id = 481 }
        }
        if = {
            limit = {
                owner = {
                    nhs_check_all_elysian_tags = { CONDITION = tag } 
                }
            }
            custom_trigger_tooltip = {
                tooltip = to_can_add_elysian_silk_province_tt
                owner = {
                    if = {
                        limit = {
                            OR = {
                                NOT = { has_global_flag = to_elysian_silk_price_increase_5_done }
                                NOT = { total_own_and_non_tributary_subject_development = 1000 }    
                            }
                        }
                        NOT = {
                            check_variable = {
                                which = to_elysian_silk_provinces
                                which = to_base_elysian_silk_provinces
                            }
                        }
                    }
                    else_if = {
                        limit = {
                            total_own_and_non_tributary_subject_development = 21000
                        }
                        NOT = {
                            check_variable = {
                                which = to_elysian_silk_provinces
                                value = 27
                            }
                        }
                    }
                    else = {
                        to_can_add_additional_silk_province = yes
                    }
                }
            }
        }
        else = {
            custom_trigger_tooltip = {
                tooltip = to_can_add_elysian_silk_province_overlord_tt
                owner = {
                    overlord = {
                        if = {
                            limit = {
                                OR = {
                                    NOT = { has_global_flag = to_elysian_silk_price_increase_5_done }
                                    NOT = { total_own_and_non_tributary_subject_development = 1000 }    
                                }
                            }
                            NOT = {
                                check_variable = {
                                    which = to_elysian_silk_provinces
                                    which = to_base_elysian_silk_provinces
                                }
                            }
                        }
                        else_if = {
                            limit = {
                                total_own_and_non_tributary_subject_development = 21000
                            }
                            NOT = {
                                check_variable = {
                                    which = to_elysian_silk_provinces
                                    value = 27
                                }
                            }
                        }
                        else = {
                            to_can_add_additional_silk_province = yes
                        }
                    }
                }
            }
        }
    }
    effect = {
        change_trade_goods = elysian_silk
        hidden_effect = {
            owner = {
                change_variable = {
                    which = to_elysian_silk_provinces
                    value = 1
                }
            }
        }
    }
}