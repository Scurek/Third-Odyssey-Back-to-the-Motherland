#########################
#### PROVINCE
#########################

custom_icon = {
    name = to_eip_tutorial_background
    potential = {
        to_can_see_exarch_province_ui_baseline = yes
        FROM = {
            has_country_flag = to_enable_exarch_click_here_box
        }
    }
}
custom_text_box = {
    name = to_eip_tutorial_text
    potential = {
        to_can_see_exarch_province_ui_baseline = yes
        FROM = {
            has_country_flag = to_enable_exarch_click_here_box
        }
    }
}

custom_icon = {
    name = to_eip_background
    potential = {
        to_can_see_exarch_province_ui = yes
    }
}
custom_icon = {
    name = to_eip_top_decor
    potential = {
        to_can_see_exarch_province_ui_baseline = yes
    }
}
custom_button = {
    name = to_exarch_button
    tooltip = to_exarch_button_tooltip
    potential = {
        to_can_see_exarch_province_ui_baseline = yes
    }
    trigger = {
    }
    effect = {
        hidden_effect = {
            FROM = {
                if = {
                    limit = {
                        has_country_flag = to_show_exarch_menu
                    }
                    clr_country_flag = to_show_exarch_menu
                }
                else = {
                    set_country_flag = to_show_exarch_menu
                }
                clr_country_flag = to_enable_exarch_click_here_box
            }
        }
    }
}

custom_text_box = {
    name = to_eip_exarch_name
    potential = {
        to_can_see_exarch_province_ui = yes
    }
}

custom_button = {
    name = to_eip_give_land
    tooltip = to_eip_give_land_tooltip
    potential = {
        to_can_see_exarch_province_ui = yes
    }
    trigger = {
        has_siege = no
        owned_by = FROM
        if = {
            limit = {
                to_exarch_trigger_from_province = {
                    TRIGGER = "
                    exists = yes
                    "
                }
            }
            to_exarch_trigger_from_province = {
                TRIGGER = "
                is_subject_of = FROM
                is_subject_of_type = elysian_subject
                "
            }
        }
    }
    effect = {
        clr_province_flag = nhs_exarch_province_exemption
        if = {
            limit = {
                nhs_EEA_province = yes
            }
            to_transfer_province_or_create_exarch = {
                CURRENT_OWNER = FROM
                EXARCH_TAG = EEA
            }
        }
        else_if = {
            limit = {
                nhs_EEB_province = yes
            }
            to_transfer_province_or_create_exarch = {
                CURRENT_OWNER = FROM
                EXARCH_TAG = EEB
            }
        }
        else_if = {
            limit = {
                nhs_EEC_province = yes
            }
            to_transfer_province_or_create_exarch = {
                CURRENT_OWNER = FROM
                EXARCH_TAG = EEC
            }
        }
        else_if = {
            limit = {
                nhs_EED_province = yes
            }
            to_transfer_province_or_create_exarch = {
                CURRENT_OWNER = FROM
                EXARCH_TAG = EED
            }
        }
        else_if = {
            limit = {
                nhs_EEE_province = yes
            }
            to_transfer_province_or_create_exarch = {
                CURRENT_OWNER = FROM
                EXARCH_TAG = EEE
            }
        }
        else_if = {
            limit = {
                nhs_EEF_province = yes
            }
            to_transfer_province_or_create_exarch = {
                CURRENT_OWNER = FROM
                EXARCH_TAG = EEF
            }
        }
        else_if = {
            limit = {
                nhs_EEG_province = yes
            }
            to_transfer_province_or_create_exarch = {
                CURRENT_OWNER = FROM
                EXARCH_TAG = EEG
            }
        }
        else_if = {
            limit = {
                nhs_EEH_province = yes
            }
            to_transfer_province_or_create_exarch = {
                CURRENT_OWNER = FROM
                EXARCH_TAG = EEH
            }
        }
        else_if = {
            limit = {
                nhs_EEI_province = yes
            }
            to_transfer_province_or_create_exarch = {
                CURRENT_OWNER = FROM
                EXARCH_TAG = EEI
            }
        }
        else_if = {
            limit = {
                nhs_EEJ_province = yes
            }
            to_transfer_province_or_create_exarch = {
                CURRENT_OWNER = FROM
                EXARCH_TAG = EEJ
            }
        }
        else_if = {
            limit = {
                nhs_EEL_province = yes
            }
            to_transfer_province_or_create_exarch = {
                CURRENT_OWNER = FROM
                EXARCH_TAG = EEL
            }
        }
        else_if = {
            limit = {
                nhs_EEM_province = yes
            }
            to_transfer_province_or_create_exarch = {
                CURRENT_OWNER = FROM
                EXARCH_TAG = EEM
            }
        }
        else_if = {
            limit = {
                nhs_EEO_province = yes
            }
            to_transfer_province_or_create_exarch = {
                CURRENT_OWNER = FROM
                EXARCH_TAG = EEO
            }
        }
        else_if = {
            limit = {
                nhs_EER_province = yes
            }
            to_transfer_province_or_create_exarch = {
                CURRENT_OWNER = FROM
                EXARCH_TAG = EER
            }
        }
        else_if = {
            limit = {
                nhs_EES_province = yes
            }
            to_transfer_province_or_create_exarch = {
                CURRENT_OWNER = FROM
                EXARCH_TAG = EES
            }
        }
        else_if = {
            limit = {
                nhs_EET_province = yes
            }
            to_transfer_province_or_create_exarch = {
                CURRENT_OWNER = FROM
                EXARCH_TAG = EET
            }
        }
        else_if = {
            limit = {
                nhs_EEU_province = yes
            }
            to_transfer_province_or_create_exarch = {
                CURRENT_OWNER = FROM
                EXARCH_TAG = EEU
            }
        }
        else_if = {
            limit = {
                nhs_EEV_province = yes
            }
            to_transfer_province_or_create_exarch = {
                CURRENT_OWNER = FROM
                EXARCH_TAG = EEV
            }
        }
        else_if = {
            limit = {
                nhs_EEQ_province = yes
            }
            to_transfer_province_or_create_exarch = {
                CURRENT_OWNER = FROM
                EXARCH_TAG = EEQ
            }
        }
        else_if = {
            limit = {
                nhs_EEP_province = yes
            }
            to_transfer_province_or_create_exarch = {
                CURRENT_OWNER = FROM
                EXARCH_TAG = EEP
            }
        }
        else_if = {
            limit = {
                exists = ELG
                nhs_ELG_province = yes
            }
            to_transfer_province_or_create_exarch = {
                CURRENT_OWNER = FROM
                EXARCH_TAG = ELG
            }
        }
    }
}

custom_button = {
    name = to_eip_seize_land
    tooltip = to_eip_seize_land_tooltip
    potential = {
        to_can_see_exarch_province_ui = yes
    }
    trigger = {
        has_siege = no
        owner = {
            num_of_cities = 5
            is_subject_of_type = elysian_subject
        }
    }
    effect = {
        set_province_flag = nhs_exarch_province_exemption
        if = {
            limit = {
                owner = {
                    is_subject_of_type = elysian_subject
                }
            }
            if = {
                limit = {
                    is_state_core = owner
                }
                remove_core = owner
                cede_province = FROM
                if = {
                    limit = {
                        NOT = { is_state_core = FROM }
                    }
                    add_core = FROM
                }
            }
            else_if = {
                limit = {
                    is_territorial_core = owner
                }
                remove_core = owner
                cede_province = FROM
                add_territorial_core = FROM
            }
            else_if = {
                limit = {
                    is_permanent_claim = owner
                }
                remove_claim = owner
                cede_province = FROM
                add_permanent_claim = FROM
            }
            else_if = {
                limit = {
                    is_claim = owner
                }
                remove_claim = owner
                cede_province = FROM
                add_claim = FROM
            }
            else = {
                cede_province = FROM
            }
        }
        else = {
            cede_province = FROM
            custom_tooltip = to_cede_root_to_from_tt
        }
    }
}

custom_button = {
    name = to_eip_add_province_exemption
    tooltip = to_eip_add_province_exemption_tooltip
    potential = {
        to_can_see_exarch_province_ui = yes
    }
    trigger = {
        owned_by = FROM
    }
    effect = {
        if = {
            limit = {
                has_province_flag = nhs_exarch_province_exemption
            }
            clr_province_flag = nhs_exarch_province_exemption
            custom_tooltip = to_add_exarch_province_no_transfer_remove_tt
        }
        else = {
            set_province_flag = nhs_exarch_province_exemption
            custom_tooltip = to_add_exarch_province_no_transfer_tt
        }
    }
    frame = {
        number = 2
        trigger = {
            has_province_flag = nhs_exarch_province_exemption
        }
    }
    frame = {
        number = 1
        trigger = {}
    }
}

custom_button = {
    name = to_eip_accept_culture
    tooltip = to_eip_accept_culture_tooltip
    potential = {
        to_can_see_exarch_province_ui = yes
    }
    trigger = {
        FROM = {
            #NOT = { primary_culture = PREV }
            #NOT = { culture_group = PREV }
            NOT = { accepted_culture = PREV }
        }
        FROM = {
            variable_arithmetic_trigger = {
                custom_tooltip = to_has_free_accept_culture_slots_tt
                export_to_variable = {
                    value = modifier:num_accepted_cultures
                    which = to_possible_accepted_cultures
                }
                export_to_variable = {
                    value = trigger_value:num_accepted_cultures
                    which = to_accepted_cultures
                }
    
                NOT = {
                    check_variable = {
                        which = to_accepted_cultures
                        which = to_possible_accepted_cultures
                    }
                }
            }
        }
    }
    effect = {
        FROM = {
            add_dip_power = -100
            add_accepted_culture = PREV
        }
    }
}

custom_button = {
    name = to_eip_auto_transfer_province
    tooltip = to_eip_auto_transfer_province_tooltip
    potential = {
        to_can_see_exarch_province_ui = yes
    }
    trigger = {
        has_siege = no
        NOT = { has_construction = core }
	    NOT = { has_construction = missionary }
        if = {
            limit = {
                has_province_modifier = nhs2_supply_lines_tm
            }
            NOT = { has_province_modifier = nhs2_supply_lines_tm }
        }
        if = {
            limit = {
                has_province_modifier = nhs2_base_of_operations_tm
            }
            NOT = { has_province_modifier = nhs2_base_of_operations_tm }
        }
        if = {
            limit = {
                has_province_modifier = to_varangian_headquarters
            }
            NOT = { has_province_modifier = to_varangian_headquarters }
        }
        custom_trigger_tooltip = {
            tooltip = to_has_not_claimed_province_tt
            NOT = { has_province_flag = nhs_exarch_province_exemption }
        }
        custom_trigger_tooltip = {
            tooltip = to_not_has_setting_no_tt
            to_exarch_trigger_from_province = {
                TRIGGER = "
                NOT = { has_country_flag = nhs_ely_march_no }
                "
            }
        }
        OR = {
            NOT = { is_state_core = FROM }
            custom_trigger_tooltip = {
                tooltip = to_has_setting_all_land_tt
                to_exarch_trigger_from_province = {
                    TRIGGER = "
                    has_country_flag = nhs_ely_march_all
                    "
                }
            }
        }
        OR = {
            is_owned_by_trade_company = no
            custom_trigger_tooltip = {
                tooltip = to_has_setting_all_land_tt
                to_exarch_trigger_from_province = {
                    TRIGGER = "
                    has_country_flag = nhs_ely_march_all
                    "
                }
            }
        }
        OR = {
            NOT = { is_territorial_core = FROM }
            custom_trigger_tooltip = {
                tooltip = to_has_setting_territory_tt
                to_exarch_trigger_from_province = {
                    TRIGGER = "
                    OR = {
                        has_country_flag = nhs_ely_march_all
                        has_country_flag = nhs_ely_march_territory
                    }
                    "
                }
            }
        }
        to_exarch_trigger_from_province = {
            TRIGGER = "
                NOT = { owns = PREV }
            "
        }
    }
    effect = {
    }
}

custom_button = {
    name = to_eip_full_land_privileges
    tooltip = to_eip_full_land_privileges_tooltip
    potential = {
        to_can_see_exarch_province_ui = yes
    }
    trigger = {
        # to_exarch_trigger_from_province = {
        #     TRIGGER = "
        #         exists = yes
        #         is_subject_of = FROM
        #         is_subject_of_type = elysian_subject
        #     "
        # }
        to_exarch_trigger_from_province = {
            TRIGGER = "
                OR = {
                    exists = no
                    AND = {
                        is_subject_of = FROM
                        is_subject_of_type = elysian_subject
                    }
                }
            "
        }
    }
    effect = {
        custom_tooltip = to_eip_full_land_privileges_tt
        hidden_effect = {
            to_exarch_effect_from_province = {
                EFFECT = "
                set_country_flag = nhs_ely_march_all
                clr_country_flag = nhs_ely_march_territory
                clr_country_flag = nhs_ely_march_no_core
                clr_country_flag = nhs_ely_march_no
                "
            }
        }
    }
    frame = {
        number = 2
        trigger = {
            # to_exarch_trigger_from_province = {
            #     TRIGGER = "
            #         exists = yes
            #         has_country_flag = nhs_ely_march_all
            #     "
            # }
            to_exarch_trigger_from_province = {
                TRIGGER = "
                    OR = {
                        exists = no
                        AND = {
                            is_subject_of = FROM
                            is_subject_of_type = elysian_subject
                        }
                    }
                    has_country_flag = nhs_ely_march_all
                "
            }
        }
    }
    frame = {
        number = 1
        trigger = {}
    }
}

custom_button = {
    name = to_eip_extensive_land_privileges
    tooltip = to_eip_extensive_land_privileges_tooltip
    potential = {
        to_can_see_exarch_province_ui = yes
    }
    trigger = {
        to_exarch_trigger_from_province = {
            TRIGGER = "
                OR = {
                    exists = no
                    AND = {
                        is_subject_of = FROM
                        is_subject_of_type = elysian_subject
                    }
                }
            "
        }
    }
    effect = {
        custom_tooltip = to_eip_extensive_land_privileges_tt
        hidden_effect = {
            to_exarch_effect_from_province = {
                EFFECT = "
                clr_country_flag = nhs_ely_march_all
                set_country_flag = nhs_ely_march_territory
                clr_country_flag = nhs_ely_march_no_core
                clr_country_flag = nhs_ely_march_no
                "
            }
        }
    }
    frame = {
        number = 2
        trigger = {
            to_exarch_trigger_from_province = {
                TRIGGER = "
                    has_country_flag = nhs_ely_march_territory
                "
            }
        }
    }
    frame = {
        number = 1
        trigger = {}
    }
}

custom_button = {
    name = to_eip_some_land_privileges
    tooltip = to_eip_some_land_privileges_tooltip
    potential = {
        to_can_see_exarch_province_ui = yes
    }
    trigger = {
        to_exarch_trigger_from_province = {
            TRIGGER = "
                OR = {
                    exists = no
                    AND = {
                        is_subject_of = FROM
                        is_subject_of_type = elysian_subject
                    }
                }
            "
        }
    }
    effect = {
        custom_tooltip = to_eip_some_land_privileges_tt
        hidden_effect = {
            to_exarch_effect_from_province = {
                EFFECT = "
                clr_country_flag = nhs_ely_march_all
                clr_country_flag = nhs_ely_march_territory
                set_country_flag = nhs_ely_march_no_core
                clr_country_flag = nhs_ely_march_no
                "
            }
        }
    }
    frame = {
        number = 2
        trigger = {
            to_exarch_trigger_from_province = {
                TRIGGER = "
                    OR = {
                        has_country_flag = nhs_ely_march_no_core
                        to_has_no_land_privilege = yes
                    }
                "
            }
        }
    }
    frame = {
        number = 1
        trigger = {}
    }
}

custom_button = {
    name = to_eip_no_land_privileges
    tooltip = to_eip_no_land_privileges_tooltip
    potential = {
        to_can_see_exarch_province_ui = yes
    }
    trigger = {
        to_exarch_trigger_from_province = {
            TRIGGER = "
                OR = {
                    exists = no
                    AND = {
                        is_subject_of = FROM
                        is_subject_of_type = elysian_subject
                    }
                }
            "
        }
    }
    effect = {
        custom_tooltip = to_eip_no_land_privileges_tt
        hidden_effect = {
            to_exarch_effect_from_province = {
                EFFECT = "
                clr_country_flag = nhs_ely_march_all
                clr_country_flag = nhs_ely_march_territory
                clr_country_flag = nhs_ely_march_no_core
                set_country_flag = nhs_ely_march_no
                "
            }
        }
    }
    frame = {
        number = 2
        trigger = {
            to_exarch_trigger_from_province = {
                TRIGGER = "
                    has_country_flag = nhs_ely_march_no
                "
            }
        }
    }
    frame = {
        number = 1
        trigger = {}
    }
}