nhs_unitus_deletus = {
	while = {
		limit = {
			any_owned_province = {
				OR = {
					infantry_in_province = ROOT
					cavalry_in_province = ROOT
					artillery_in_province = ROOT
					transports_in_province = ROOT
					galleys_in_province = ROOT
					light_ships_in_province = ROOT
					heavy_ships_in_province = ROOT
				}
			}
		}
		random_owned_province = {
			limit = {
				OR = {
					infantry_in_province = ROOT
					cavalry_in_province = ROOT
					artillery_in_province = ROOT
					transports_in_province = ROOT
					galleys_in_province = ROOT
					light_ships_in_province = ROOT
					heavy_ships_in_province = ROOT
				}
			}
			kill_units = {
				who = ROOT
				amount = 1
			}
		}
	}
	while = {
		limit = {
			any_province = {
				sea_zone = {
					OR = {
						transports_in_province = ROOT
						galleys_in_province = ROOT
						light_ships_in_province = ROOT
						heavy_ships_in_province = ROOT
					}
				}
			}
		}
		random_province = {
			limit = {
				sea_zone = {
					OR = {
						transports_in_province = ROOT
						galleys_in_province = ROOT
						light_ships_in_province = ROOT
						heavy_ships_in_province = ROOT
					}
				}
			}
			sea_zone = {
				kill_units = {
					who = ROOT
					amount = 1
				}
			}
		}
	}
}
nhs_low_supply_warning = {
	# if = {
		# limit = {
			# NOT = {
				# check_variable = {
					# which = nhs_new_flight_food_status
					# value = 1
				# }
			# }
		# }
		# custom_tooltip = nhs_low_supply_warning_tt
		# custom_tooltip = nhs_new_line_tt
	# }
}

nhs_lower_supplies = {
	# custom_tooltip = nhs_new_line_tt
	custom_tooltip = to_nhs_decrease_starting_cash_tt
	hidden_effect = {
		add_treasury = -75
		change_variable = {
			which = nhs_new_flight_space_status
			value = 1
		}
		change_variable = {
			which = nhs_new_flight_food_status
			value = -1
		}
	}
}

nhs_increase_supplies = {
	custom_tooltip = to_nhs_increase_starting_cash_tt
	hidden_effect = {
		add_treasury = 75
		change_variable = {
			which = nhs_new_flight_space_status
			value = -1
		}
		change_variable = {
			which = nhs_new_flight_food_status
			value = 1
		}
	}
}

nhs_switch_starting_event = {
	if = {
		limit = {
			is_year = 1445
			is_month = 2
		}
		custom_tooltip = nhs_enough_delay_flight_tt
		hidden_effect = {
			country_event = { id = nhs_new_flightevents.8 days = 7 }
		}
	}
	if = {
		limit = {
			NOT = {
				AND = {
					is_year = 1445
					is_month = 2
				}
			}
		}
		hidden_effect = {
			country_event = { id = nhs_new_flightevents.6 }
		}
	}
}

nhs_switch_starting_event_2 = {
	if = {
		limit = {
			is_year = 1445
			is_month = 2
		}
		custom_tooltip = nhs_enough_delay_flight_tt
		hidden_effect = {
			country_event = { id = nhs_new_flightevents.8 days = 7 }
		}
	}
	if = {
		limit = {
			NOT = {
				AND = {
					is_year = 1445
					is_month = 2
				}
			}
		}
		hidden_effect = {
			country_event = { id = nhs_new_flightevents.5 }
		}
	}
}

nhs_spawn_starting_flagship = {
	if = {
		limit = {
			has_dlc = "Golden Century"
		}
		custom_tooltip = nhs_starting_flagship_tt
		set_country_flag = nhs_first_flagship
		953 = {
			create_flagship = {	
				name = "Aghia Theotoke"
				type = heavy_ship
			}
		}
		clr_country_flag = nhs_first_flagship
	}
}

nhs_reduce_skoros_silk_price = {
	if = {
		limit = {
			any_province = {
				trade_goods = skoros_silk
			}
			NOT = { has_global_flag = nhs_skoros_silk_falls }
		}
		change_price = {
			trade_goods = skoros_silk
			key = NHS_SKOROS_FALLS
			value = -0.25
			duration = -1
		}
		custom_tooltip = nhs_new_line_tt
	}
	else_if = {
		limit = {
			NOT = { has_global_flag = nhs_skoros_silk_falls }
		}
		hidden_effect = {
			change_price = {
				trade_goods = skoros_silk
				key = NHS_SKOROS_FALLS
				value = -0.25
				duration = -1
			}
		}
	}
	set_global_flag = nhs_skoros_silk_falls
}

nhs_increase_skoros_silk_price = {
	if = {
		limit = {
			has_global_flag = nhs_skoros_silk_falls
			any_province = {
				trade_goods = skoros_silk
			}
		}
		change_price = {
			trade_goods = skoros_silk
			key = NHS_SKOROS_ISOLATIONISM
			value = 0.25
			duration = -1
		}
		custom_tooltip = nhs_new_line_tt
	}
	else_if = {
		limit = {
			has_global_flag = nhs_skoros_silk_falls
		}
		hidden_effect = {
			change_price = {
				trade_goods = skoros_silk
				key = NHS_SKOROS_ISOLATIONISM
				value = 0.25
				duration = -1
			}
		}
	}
}

vov_varangian_heir_ruler_general = {
	[[HEIR_FEMALE]
		custom_tooltip = vov_heir_to_general
	]
	[[HEIR_MALE]
		custom_tooltip = vov_heir_to_general
	]
	[[RULER_MALE]
		custom_tooltip = vov_ruler_to_general
	]
	[[RULER_FEMALE]
		custom_tooltip = vov_ruler_to_general
	]
	hidden_effect = {
		if = {
			limit = {
				NOT = { army_tradition = 75 }
			}
			add_army_tradition = 25
			[[HEIR_FEMALE]
				convert_female_heir_to_general = yes
			]
			[[HEIR_MALE]
				convert_heir_to_general = yes
			]
			[[RULER_MALE]
				convert_ruler_to_general = yes
			]
			[[RULER_FEMALE]
				convert_female_ruler_to_general = yes
			]
			add_army_tradition = -25
		}
		else = {
			set_variable = {
				which = vov_trad_var
				value = 0
			}
			while = {
				limit = {
					NOT = { army_tradition = 100 }
				}
				change_variable = {
					which = vov_trad_var
					value = 1
				}
				add_army_tradition = 1
			}
			[[HEIR_FEMALE]
				convert_female_heir_to_general = yes
			]
			[[HEIR_MALE]
				convert_heir_to_general = yes
			]
			[[RULER_MALE]
				convert_ruler_to_general = yes
			]
			[[RULER_FEMALE]
				convert_female_ruler_to_general = yes
			]
			while = {
				limit = {
					check_variable = {
						which = vov_trad_var
						value = 1
					}
				}
				change_variable = {
					which = vov_trad_var
					value = -1
				}
				add_army_tradition = -1
			}
		}
	}
}

nhs_change_to_proper_orthodox_religion = {
	if = {
		limit = {
			OR = {
				ROOT = {
					religion = orthodox
				}
				NOT = { has_global_flag = nhs2_patriarchate_established }
			}
		}
		change_religion = orthodox
	}
	else = {
		change_religion = elysian_orthodoxy
	}
}

nhs_increase_variable = {
	change_variable = {
		which = $VARIABLE$
		value = $VAL$
	}
	if = {
		limit = {
			check_variable = {
				which = $VARIABLE$
				value = $MAX$
			}
		}
		set_variable = {
			which = $VARIABLE$
			value = $MAX$
		}
	}
}

nhs_release_elysian_splinter = {
	if = {
		limit = {
			any_owned_province = {
				culture = $CULTURE$
			}
		}
		every_owned_province = {
			limit = {
				culture = $CULTURE$
				NOT = { is_core = $TAG$ }
			}
			add_core = $TAG$
		}
		if = {
			limit = {
				NOT = { exists = $TAG$ }
			}
			release = $TAG$
			$TAG$ = {
				change_religion = ROOT
			}
		}
		else = {
			every_owned_province = {
				limit = {
					culture = $CULTURE$
				}
				cede_province = $TAG$
			}
		}
	}
}

nhs_decrease_variable = {
	subtract_variable = {
		which = $VARIABLE$
		value = $VAL$
	}
	if = {
		limit = {
			NOT = {
				check_variable = {
					which = $VARIABLE$
					value = $MIN$
				}
			}
		}
		set_variable = {
			which = $VARIABLE$
			value = $MIN$
		}
	}
}

nhs_building_counter_clear_flag = {
	clr_province_flag = $FLAG$_$BUILDING$
}
nhs_building_counter_set_flag = {
	set_province_flag = $FLAG$_$BUILDING$
}
nhs_building_counter_effect_add = {
	if = {
		limit = {
			owner = {
				has_country_flag = $FLAG$ # nhs_high_tier_building_counter
			}
			NOT = {
				nhs_building_counter_had_building = { 
					FLAG = $FLAG$ 
					BUILDING = $BUILDING$ 
				}
			}
			[[ADDITIONAL_TRIGGER]
				$ADDITIONAL_TRIGGER$ = yes
			]
		}
		nhs_building_counter_set_flag = { 
			FLAG = $FLAG$ 
			BUILDING = $BUILDING$ 
		}
		owner = {
			change_variable = {
				which = $VAR$ # nhs_HighTierBuildingCount
				value = 1
			}
		}
	}
}
nhs_building_counter_effect_sub = {
	if = {
		limit = {
			nhs_building_counter_had_building = { 
				FLAG = $FLAG$ 
				BUILDING = $BUILDING$ 
			}
			owner = {
				has_country_flag = $FLAG$ # nhs_high_tier_building_counter
			}
		}
		nhs_building_counter_clear_flag = { 
			FLAG = $FLAG$ 
			BUILDING = $BUILDING$ 
		}
		owner = {
			subtract_variable = {
				which = $VAR$ # nhs_HighTierBuildingCount
				value = 1
			}
		}
	}
}
nhs_building_counter_effect_add_with_obsolete = {
	if = {
		limit = {
			owner = {
				has_country_flag = $FLAG$ # nhs_high_tier_building_counter
			}
			NOT = {
				nhs_building_counter_had_building = { 
					FLAG = $FLAG$ 
					BUILDING = $BUILDING$ 
				}
			}
			[[ADDITIONAL_TRIGGER]
				$ADDITIONAL_TRIGGER$ = yes
			]
		}
		if = {
			limit = {
				NOT = {
					nhs_building_counter_had_building = { 
						FLAG = $FLAG$ 
						BUILDING = $OLD_BUILDING$ 
					}
				}
			}
			nhs_building_counter_set_flag = { 
				FLAG = $FLAG$ 
				BUILDING = $BUILDING$ 
			}
			owner = {
				change_variable = {
					which = $VAR$ # nhs_HighTierBuildingCount
					value = 1
				}
			}
		}
		else = {
			nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = $OLD_BUILDING$ }
			nhs_building_counter_set_flag = { FLAG = $FLAG$ BUILDING = $BUILDING$ }
		}
	}
}
nhs_building_counter_effect_add_with_two_obsolete = {
	if = {
		limit = {
			owner = {
				has_country_flag = $FLAG$
			}
			NOT = {
				nhs_building_counter_had_building = { 
					FLAG = $FLAG$ 
					BUILDING = $BUILDING$ 
				}
			}
			[[ADDITIONAL_TRIGGER]
				$ADDITIONAL_TRIGGER$ = yes
			]
		}
		if = {
			limit = {
				nhs_building_counter_had_building = { 
					FLAG = $FLAG$ 
					BUILDING = $OLD_BUILDING$ 
				}
			}
			nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = $OLD_BUILDING$ }
			nhs_building_counter_set_flag = { FLAG = $FLAG$ BUILDING = $BUILDING$ }
		}
		else_if = {
			limit = {
				nhs_building_counter_had_building = { 
					FLAG = $FLAG$ 
					BUILDING = $OLD_BUILDING_2$ 
				}
			}
			nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = $OLD_BUILDING_2$ }
			nhs_building_counter_set_flag = { FLAG = $FLAG$ BUILDING = $BUILDING$ }
		}
		else = {
			nhs_building_counter_set_flag = { 
				FLAG = $FLAG$ 
				BUILDING = $BUILDING$ 
			}
			owner = {
				change_variable = {
					which = $VAR$
					value = 1
				}
			}
		}
	}
}
nhs_building_counter_effect_add_with_three_obsolete = {
	if = {
		limit = {
			owner = {
				has_country_flag = $FLAG$
			}
			NOT = {
				nhs_building_counter_had_building = { 
					FLAG = $FLAG$ 
					BUILDING = $BUILDING$ 
				}
			}
			[[ADDITIONAL_TRIGGER]
				$ADDITIONAL_TRIGGER$ = yes
			]
		}
		if = {
			limit = {
				nhs_building_counter_had_building = { 
					FLAG = $FLAG$ 
					BUILDING = $OLD_BUILDING$ 
				}
			}
			nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = $OLD_BUILDING$ }
			nhs_building_counter_set_flag = { FLAG = $FLAG$ BUILDING = $BUILDING$ }
		}
		else_if = {
			limit = {
				nhs_building_counter_had_building = { 
					FLAG = $FLAG$ 
					BUILDING = $OLD_BUILDING_2$ 
				}
			}
			nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = $OLD_BUILDING_2$ }
			nhs_building_counter_set_flag = { FLAG = $FLAG$ BUILDING = $BUILDING$ }
		}
		else_if = {
			limit = {
				nhs_building_counter_had_building = { 
					FLAG = $FLAG$ 
					BUILDING = $OLD_BUILDING_3$ 
				}
			}
			nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = $OLD_BUILDING_3$ }
			nhs_building_counter_set_flag = { FLAG = $FLAG$ BUILDING = $BUILDING$ }
		}
		else = {
			nhs_building_counter_set_flag = { 
				FLAG = $FLAG$ 
				BUILDING = $BUILDING$ 
			}
			owner = {
				change_variable = {
					which = $VAR$
					value = 1
				}
			}
		}
	}
}

nhs_building_counter_local_province_check_building = {
	if = {
		limit = {
			has_building = $BUILDING$
			NOT = {
				nhs_building_counter_had_building = { 
					FLAG = $FLAG$ 
					BUILDING = $BUILDING$ 
				} 
			}
		}
		nhs_building_counter_set_flag = {
			FLAG = $FLAG$ 
			BUILDING = $BUILDING$ 
		}
		owner = {
			change_variable = {
				which = $VAR$
				value = 1
			}
		}
	}
}
nhs_building_counter_former_province_check_building = {
	if = {
		limit = {
			nhs_building_counter_had_building = { 
				FLAG = $FLAG$  
				BUILDING = $BUILDING$ 
			} 
		}
		nhs_building_counter_clear_flag = {
			FLAG = $FLAG$  
			BUILDING = $BUILDING$  
		}
		FROM = {
			subtract_variable = {
				which = $VAR$
				value = 1
			}
		}
	}
}
nhs_building_counter_clear_flags = {
	nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = marketplace }
	nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = workshop }
	nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = temple }
	nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = barracks }
	nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = shipyard }
	nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = fort_15th }
	nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = coastal_defence }

	nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = courthouse }
	nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = dock }
	nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = regimental_camp }
	nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = fort_16th }
	nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = naval_battery }

	nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = cathedral }
	nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = university }
	nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = trade_depot }
	nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = grand_shipyard }
	nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = training_fields }
	nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = fort_17th }

	nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = stock_exchange }
	nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = counting_house }
	nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = town_hall }
	nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = drydock }
	nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = conscription_center }
	nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = fort_18th }

	nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = wharf }
	nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = weapons }
	nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = textile }
	nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = plantations }
	nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = tradecompany }
	nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = farm_estate }
	nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = mills }
	nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = furnace }

	nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = ramparts }
	nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = soldier_households }
	nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = impressment_offices }
	nhs_building_counter_clear_flag = { FLAG = $FLAG$ BUILDING = state_house }
}

nhs_initiate_homelands_building_counter = {
	nhs_end_homelands_building_counter = yes
	set_variable = {
		which = nhs_HomelandsBuildingCount
		value = 0
	}
	set_country_flag = nhs_homelands_build_counter
	every_province = {
		limit = {
			owned_by = ROOT
			nhs_homelands_building_counter_trigger = yes
		}
		nhs_homelands_building_counter_eval_local_province = yes
	}
}

nhs_end_homelands_building_counter = {
	set_variable = {
		which = nhs_HomelandsBuildingCount
		value = 0
	}
	clr_country_flag = nhs_homelands_build_counter
	every_owned_province = {
		limit = {
			nhs_homelands_building_counter_trigger = yes
		}
		nhs_building_counter_clear_flags = { FLAG = nhs_homelands_build_counter }
	}
}

nhs_homelands_building_counter_eval_local_province = {
	nhs_building_counter_local_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = marketplace }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = workshop }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = temple }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = barracks }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = shipyard }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = fort_15th }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = coastal_defence }

	nhs_building_counter_local_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = courthouse }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = dock }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = regimental_camp }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = fort_16th }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = naval_battery }

	nhs_building_counter_local_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = cathedral }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = university }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = trade_depot }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = grand_shipyard }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = training_fields }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = fort_17th }

	nhs_building_counter_local_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = stock_exchange }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = counting_house }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = town_hall }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = drydock }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = conscription_center }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = fort_18th }

	nhs_building_counter_local_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = wharf }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = weapons }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = textile }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = plantations }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = tradecompany }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = farm_estate }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = mills }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = furnace }

	nhs_building_counter_local_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = ramparts }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = soldier_households }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = impressment_offices }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = state_house }
}
nhs_homelands_building_counter_eval_former_province = {
	nhs_building_counter_former_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = marketplace }
	nhs_building_counter_former_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = workshop }
	nhs_building_counter_former_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = temple }
	nhs_building_counter_former_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = barracks }
	nhs_building_counter_former_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = shipyard }
	nhs_building_counter_former_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = fort_15th }
	nhs_building_counter_former_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = coastal_defence }

	nhs_building_counter_former_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = courthouse }
	nhs_building_counter_former_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = dock }
	nhs_building_counter_former_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = regimental_camp }
	nhs_building_counter_former_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = fort_16th }
	nhs_building_counter_former_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = naval_battery }

	nhs_building_counter_former_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = cathedral }
	nhs_building_counter_former_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = university }
	nhs_building_counter_former_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = trade_depot }
	nhs_building_counter_former_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = grand_shipyard }
	nhs_building_counter_former_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = training_fields }
	nhs_building_counter_former_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = fort_17th }

	nhs_building_counter_former_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = stock_exchange }
	nhs_building_counter_former_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = counting_house }
	nhs_building_counter_former_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = town_hall }
	nhs_building_counter_former_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = drydock }
	nhs_building_counter_former_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = conscription_center }
	nhs_building_counter_former_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = fort_18th }

	nhs_building_counter_former_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = wharf }
	nhs_building_counter_former_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = weapons }
	nhs_building_counter_former_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = textile }
	nhs_building_counter_former_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = plantations }
	nhs_building_counter_former_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = tradecompany }
	nhs_building_counter_former_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = farm_estate }
	nhs_building_counter_former_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = mills }
	nhs_building_counter_former_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = furnace }

	nhs_building_counter_former_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = ramparts }
	nhs_building_counter_former_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = soldier_households }
	nhs_building_counter_former_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = impressment_offices }
	nhs_building_counter_former_province_check_building = { FLAG = nhs_homelands_build_counter VAR = nhs_HomelandsBuildingCount BUILDING = state_house }
}

nhs_initiate_hightier_building_counter = {
	nhs_end_hightier_building_counter = yes
	set_variable = {
		which = nhs_HighTierBuildingCount
		value = 0
	}
	set_country_flag = nhs_high_tier_building_counter
	every_province = {
		limit = {
			owned_by = ROOT
			nhs_hightier_building_counter_trigger = yes
		}
		nhs_hightier_building_counter_eval_local_province = yes
	}
}
nhs_end_hightier_building_counter = {
	set_variable = {
		which = nhs_HighTierBuildingCount
		value = 0
	}
	clr_country_flag = nhs_high_tier_building_counter
	every_owned_province = {
		limit = {
			nhs_hightier_building_counter_trigger = yes
		}
		nhs_building_counter_clear_flags = { FLAG = nhs_high_tier_building_counter }
	}
}
nhs_hightier_building_counter_eval_local_province = {
	nhs_building_counter_local_province_check_building = { FLAG = nhs_high_tier_building_counter VAR = nhs_HighTierBuildingCount BUILDING = cathedral }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_high_tier_building_counter VAR = nhs_HighTierBuildingCount BUILDING = university }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_high_tier_building_counter VAR = nhs_HighTierBuildingCount BUILDING = trade_depot }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_high_tier_building_counter VAR = nhs_HighTierBuildingCount BUILDING = grand_shipyard }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_high_tier_building_counter VAR = nhs_HighTierBuildingCount BUILDING = training_fields }

	nhs_building_counter_local_province_check_building = { FLAG = nhs_high_tier_building_counter VAR = nhs_HighTierBuildingCount BUILDING = stock_exchange }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_high_tier_building_counter VAR = nhs_HighTierBuildingCount BUILDING = counting_house }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_high_tier_building_counter VAR = nhs_HighTierBuildingCount BUILDING = town_hall }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_high_tier_building_counter VAR = nhs_HighTierBuildingCount BUILDING = drydock }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_high_tier_building_counter VAR = nhs_HighTierBuildingCount BUILDING = conscription_center }

	nhs_building_counter_local_province_check_building = { FLAG = nhs_high_tier_building_counter VAR = nhs_HighTierBuildingCount BUILDING = wharf }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_high_tier_building_counter VAR = nhs_HighTierBuildingCount BUILDING = weapons }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_high_tier_building_counter VAR = nhs_HighTierBuildingCount BUILDING = textile }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_high_tier_building_counter VAR = nhs_HighTierBuildingCount BUILDING = plantations }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_high_tier_building_counter VAR = nhs_HighTierBuildingCount BUILDING = tradecompany }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_high_tier_building_counter VAR = nhs_HighTierBuildingCount BUILDING = farm_estate }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_high_tier_building_counter VAR = nhs_HighTierBuildingCount BUILDING = mills }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_high_tier_building_counter VAR = nhs_HighTierBuildingCount BUILDING = furnace }

	nhs_building_counter_local_province_check_building = { FLAG = nhs_high_tier_building_counter VAR = nhs_HighTierBuildingCount BUILDING = ramparts }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_high_tier_building_counter VAR = nhs_HighTierBuildingCount BUILDING = soldier_households }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_high_tier_building_counter VAR = nhs_HighTierBuildingCount BUILDING = impressment_offices }
	nhs_building_counter_local_province_check_building = { FLAG = nhs_high_tier_building_counter VAR = nhs_HighTierBuildingCount BUILDING = state_house }
}
# province
# FROM = old owner
nhs_hightier_building_counter_eval_former_province = {
	if = {
		limit = {
			nhs_building_counter_had_building = { 
				FLAG = nhs_high_tier_building_counter 
				BUILDING = town_hall
			} 
		}
		nhs_building_counter_clear_flag = {
			FLAG = nhs_high_tier_building_counter 
			BUILDING = town_hall 
		}
		FROM = {
			subtract_variable = {
				which = nhs_HighTierBuildingCount
				value = 1
			}
		}
	}
	if = {
		limit = {
			nhs_building_counter_had_building = { 
				FLAG = nhs_high_tier_building_counter 
				BUILDING = counting_house 
			} 
		}
		nhs_building_counter_clear_flag = { 
			FLAG = nhs_high_tier_building_counter 
			BUILDING = counting_house 
		}
		FROM = {
			subtract_variable = {
				which = nhs_HighTierBuildingCount
				value = 1
			}
		}
	}
	if = {
		limit = {
			nhs_building_counter_had_building = { 
				FLAG = nhs_high_tier_building_counter 
				BUILDING = cathedral 
			} 
		}
		nhs_building_counter_clear_flag = { 
			FLAG = nhs_high_tier_building_counter 
			BUILDING = cathedral 
		}
		FROM = {
			subtract_variable = {
				which = nhs_HighTierBuildingCount
				value = 1
			}
		}
	}
	if = {
		limit = {
			nhs_building_counter_had_building = { 
				FLAG = nhs_high_tier_building_counter 
				BUILDING = university 
			} 
		}
		nhs_building_counter_clear_flag = { 
			FLAG = nhs_high_tier_building_counter 
			BUILDING = university 
		}
		FROM = {
			subtract_variable = {
				which = nhs_HighTierBuildingCount
				value = 1
			}
		}
	}
	if = {
		limit = {
			nhs_building_counter_had_building = { 
				FLAG = nhs_high_tier_building_counter 
				BUILDING = grand_shipyard 
			} 
		}
		nhs_building_counter_clear_flag = { 
			FLAG = nhs_high_tier_building_counter 
			BUILDING = grand_shipyard 
		}
		FROM = {
			subtract_variable = {
				which = nhs_HighTierBuildingCount
				value = 1
			}
		}
	}
	if = {
		limit = {
			nhs_building_counter_had_building = { 
				FLAG = nhs_high_tier_building_counter 
				BUILDING = drydock 
			} 
		}
		nhs_building_counter_clear_flag = { 
			FLAG = nhs_high_tier_building_counter 
			BUILDING = drydock 
		}
		FROM = {
			subtract_variable = {
				which = nhs_HighTierBuildingCount
				value = 1
			}
		}
	}
	if = {
		limit = {
			nhs_building_counter_had_building = { 
				FLAG = nhs_high_tier_building_counter 
				BUILDING = stock_exchange 
			}
		}
		nhs_building_counter_clear_flag = { 
			FLAG = nhs_high_tier_building_counter 
			BUILDING = stock_exchange
		}
		FROM = {
			subtract_variable = {
				which = nhs_HighTierBuildingCount
				value = 1
			}
		}
	}
	if = {
		limit = {
			nhs_building_counter_had_building = { 
				FLAG = nhs_high_tier_building_counter 
				BUILDING = training_fields 
			} 
		}
		nhs_building_counter_clear_flag = { 
			FLAG = nhs_high_tier_building_counter 
			BUILDING = training_fields
		}
		FROM = {
			subtract_variable = {
				which = nhs_HighTierBuildingCount
				value = 1
			}
		}
	}
	if = {
		limit = {
			nhs_building_counter_had_building = { 
				FLAG = nhs_high_tier_building_counter 
				BUILDING = trade_depot 
			} 
		}
		nhs_building_counter_clear_flag = { 
			FLAG = nhs_high_tier_building_counter 
			BUILDING = trade_depot
		}
		FROM = {
			subtract_variable = {
				which = nhs_HighTierBuildingCount
				value = 1
			}
		}
	}
	if = {
		limit = {
			nhs_building_counter_had_building = { 
				FLAG = nhs_high_tier_building_counter 
				BUILDING = conscription_center 
			} 
		}
		nhs_building_counter_clear_flag = { 
			FLAG = nhs_high_tier_building_counter 
			BUILDING = conscription_center
		}
		FROM = {
			subtract_variable = {
				which = nhs_HighTierBuildingCount
				value = 1
			}
		}
	}
	if = {
		limit = {
			nhs_building_counter_had_building = { 
				FLAG = nhs_high_tier_building_counter 
				BUILDING = manufactory 
			} 
		}
		nhs_building_counter_clear_flag = { 
			FLAG = nhs_high_tier_building_counter 
			BUILDING = manufactory
		}
		FROM = {
			subtract_variable = {
				which = nhs_HighTierBuildingCount
				value = 1
			}
		}
	}
	if = {
		limit = {
			nhs_building_counter_had_building = { 
				FLAG = nhs_high_tier_building_counter 
				BUILDING = ramparts 
			}
		}
		nhs_building_counter_clear_flag = { 
			FLAG = nhs_high_tier_building_counter 
			BUILDING = ramparts
		}
		FROM = {
			subtract_variable = {
				which = nhs_HighTierBuildingCount
				value = 1
			}
		}
	}
	if = {
		limit = {
			nhs_building_counter_had_building = { 
				FLAG = nhs_high_tier_building_counter 
				BUILDING = soldier_households 
			} 
		}
		nhs_building_counter_clear_flag = { 
			FLAG = nhs_high_tier_building_counter 
			BUILDING = soldier_households
		}
		FROM = {
			subtract_variable = {
				which = nhs_HighTierBuildingCount
				value = 1
			}
		}
	}
	if = {
		limit = {
			nhs_building_counter_had_building = { 
				FLAG = nhs_high_tier_building_counter 
				BUILDING = impressment_offices 
			} 
		}
		nhs_building_counter_clear_flag = { 
			FLAG = nhs_high_tier_building_counter 
			BUILDING = impressment_offices
		}
		FROM = {
			subtract_variable = {
				which = nhs_HighTierBuildingCount
				value = 1
			}
		}
	}
	if = {
		limit = {
			nhs_building_counter_had_building = { 
				FLAG = nhs_high_tier_building_counter 
				BUILDING = state_house 
			} 
		}
		nhs_building_counter_clear_flag = { 
			FLAG = nhs_high_tier_building_counter 
			BUILDING = state_house
		}
		FROM = {
			subtract_variable = {
				which = nhs_HighTierBuildingCount
				value = 1
			}
		}
	}
}


nhs_display_rel_center = {
	tooltip = {
		add_permanent_province_modifier = {
			name = religious_center
			duration = -1
		}
	}
}

to_assign_provinces_to_exarch = {
	if = {
		limit = {
			any_owned_province = {
				NOT = { is_core = ROOT }
				NOT = { has_construction = core }
				is_owned_by_trade_company = no
				NOT = { has_province_flag = nhs_exarch_province_exemption }
				NOT = { has_province_modifier = to_varangian_headquarters }
				religion = ROOT
				nhs_$TAG$_province = yes
				development = 25
				NOT = { province_has_center_of_trade_of_level = 1 }
				NOT = { has_province_modifier = nhs2_supply_lines_tm }
			}
			
		}
		random_owned_province = {
			limit = {
				NOT = { is_core = ROOT }
				NOT = { has_construction = core }
				is_owned_by_trade_company = no
				NOT = { has_province_flag = nhs_exarch_province_exemption }
				NOT = { has_province_modifier = to_varangian_headquarters }
				religion = ROOT
				nhs_$TAG$_province = yes
				development = 25
				NOT = { province_has_center_of_trade_of_level = 1 }
				NOT = { has_province_modifier = nhs2_supply_lines_tm }
			}
			to_add_core_and_release_exarch = { TAG = $TAG$ }
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				NOT = { is_core = ROOT }
				NOT = { has_construction = core }
				is_owned_by_trade_company = no
				NOT = { has_province_flag = nhs_exarch_province_exemption }
				NOT = { has_province_modifier = to_varangian_headquarters }
				nhs_$TAG$_province = yes
				development = 25
				NOT = { province_has_center_of_trade_of_level = 1 }
				NOT = { has_province_modifier = nhs2_supply_lines_tm }
			}
		}
		random_owned_province = {
			limit = {
				NOT = { is_core = ROOT }
				NOT = { has_construction = core }
				is_owned_by_trade_company = no
				NOT = { has_province_flag = nhs_exarch_province_exemption }
				NOT = { has_province_modifier = to_varangian_headquarters }
				nhs_$TAG$_province = yes
				development = 25
				NOT = { province_has_center_of_trade_of_level = 1 }
				NOT = { has_province_modifier = nhs2_supply_lines_tm }
			}
			to_add_core_and_release_exarch = { TAG = $TAG$ }
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				NOT = { is_core = ROOT }
				NOT = { has_construction = core }
				is_owned_by_trade_company = no
				NOT = { has_province_flag = nhs_exarch_province_exemption }
				NOT = { has_province_modifier = to_varangian_headquarters }
				religion = ROOT
				nhs_$TAG$_province = yes
				development = 15
				NOT = { province_has_center_of_trade_of_level = 1 }
				NOT = { has_province_modifier = nhs2_supply_lines_tm }
			}
			
		}
		random_owned_province = {
			limit = {
				NOT = { is_core = ROOT }
				NOT = { has_construction = core }
				is_owned_by_trade_company = no
				NOT = { has_province_flag = nhs_exarch_province_exemption }
				NOT = { has_province_modifier = to_varangian_headquarters }
				religion = ROOT
				nhs_$TAG$_province = yes
				development = 15
				NOT = { province_has_center_of_trade_of_level = 1 }
				NOT = { has_province_modifier = nhs2_supply_lines_tm }
			}
			to_add_core_and_release_exarch = { TAG = $TAG$ }
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				NOT = { is_core = ROOT }
				NOT = { has_construction = core }
				is_owned_by_trade_company = no
				NOT = { has_province_flag = nhs_exarch_province_exemption }
				NOT = { has_province_modifier = to_varangian_headquarters }
				nhs_$TAG$_province = yes
				development = 15
				NOT = { province_has_center_of_trade_of_level = 1 }
				NOT = { has_province_modifier = nhs2_supply_lines_tm }
			}
		}
		random_owned_province = {
			limit = {
				NOT = { is_core = ROOT }
				NOT = { has_construction = core }
				is_owned_by_trade_company = no
				NOT = { has_province_flag = nhs_exarch_province_exemption }
				NOT = { has_province_modifier = to_varangian_headquarters }
				nhs_$TAG$_province = yes
				development = 15
				NOT = { province_has_center_of_trade_of_level = 1 }
				NOT = { has_province_modifier = nhs2_supply_lines_tm }
			}
			to_add_core_and_release_exarch = { TAG = $TAG$ }
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				nhs_$TAG$_province = yes
				NOT = { is_core = ROOT }
				NOT = { has_construction = core }
				is_owned_by_trade_company = no
				NOT = { has_province_flag = nhs_exarch_province_exemption }
				NOT = { has_province_modifier = to_varangian_headquarters }
				NOT = { has_province_modifier = nhs2_supply_lines_tm }
				religion = ROOT
			}
		}
		random_owned_province = {
			limit = {
				nhs_$TAG$_province = yes
				NOT = { is_core = ROOT }
				NOT = { has_construction = core }
				is_owned_by_trade_company = no
				NOT = { has_province_flag = nhs_exarch_province_exemption }
				NOT = { has_province_modifier = to_varangian_headquarters }
				NOT = { has_province_modifier = nhs2_supply_lines_tm }
				religion = ROOT
			}
			to_add_core_and_release_exarch = { TAG = $TAG$ }
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				nhs_$TAG$_province = yes
				NOT = { is_core = ROOT }
				NOT = { has_construction = core }
				is_owned_by_trade_company = no
				NOT = { has_province_flag = nhs_exarch_province_exemption }
				NOT = { has_province_modifier = to_varangian_headquarters }
				NOT = { has_province_modifier = nhs2_supply_lines_tm }
			}
		}
		random_owned_province = {
			limit = {
				nhs_$TAG$_province = yes
				NOT = { is_core = ROOT }
				NOT = { has_construction = core }
				is_owned_by_trade_company = no
				NOT = { has_province_flag = nhs_exarch_province_exemption }
				NOT = { has_province_modifier = to_varangian_headquarters }
				NOT = { has_province_modifier = nhs2_supply_lines_tm }
			}
			to_add_core_and_release_exarch = { TAG = $TAG$ }
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				NOT = { is_state_core = ROOT }
				NOT = { has_construction = core }
				is_owned_by_trade_company = no
				NOT = { has_province_flag = nhs_exarch_province_exemption }
				NOT = { has_province_modifier = to_varangian_headquarters }
				religion = ROOT
				nhs_$TAG$_province = yes
				development = 25
				NOT = { province_has_center_of_trade_of_level = 1 }
				NOT = { has_province_modifier = nhs2_supply_lines_tm }
			}
			
		}
		random_owned_province = {
			limit = {
				NOT = { is_state_core = ROOT }
				NOT = { has_construction = core }
				is_owned_by_trade_company = no
				NOT = { has_province_flag = nhs_exarch_province_exemption }
				NOT = { has_province_modifier = to_varangian_headquarters }
				religion = ROOT
				nhs_$TAG$_province = yes
				development = 25
				NOT = { province_has_center_of_trade_of_level = 1 }
				NOT = { has_province_modifier = nhs2_supply_lines_tm }
			}
			to_add_core_and_release_exarch = { TAG = $TAG$ }
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				NOT = { is_state_core = ROOT }
				NOT = { has_construction = core }
				is_owned_by_trade_company = no
				NOT = { has_province_flag = nhs_exarch_province_exemption }
				NOT = { has_province_modifier = to_varangian_headquarters }
				nhs_$TAG$_province = yes
				development = 25
				NOT = { province_has_center_of_trade_of_level = 1 }
				NOT = { has_province_modifier = nhs2_supply_lines_tm }
			}
		}
		random_owned_province = {
			limit = {
				NOT = { is_state_core = ROOT }
				NOT = { has_construction = core }
				is_owned_by_trade_company = no
				NOT = { has_province_flag = nhs_exarch_province_exemption }
				NOT = { has_province_modifier = to_varangian_headquarters }
				nhs_$TAG$_province = yes
				development = 25
				NOT = { province_has_center_of_trade_of_level = 1 }
				NOT = { has_province_modifier = nhs2_supply_lines_tm }
			}
			to_add_core_and_release_exarch = { TAG = $TAG$ }
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				NOT = { is_state_core = ROOT }
				NOT = { has_construction = core }
				is_owned_by_trade_company = no
				NOT = { has_province_flag = nhs_exarch_province_exemption }
				NOT = { has_province_modifier = to_varangian_headquarters }
				religion = ROOT
				nhs_$TAG$_province = yes
				development = 15
				NOT = { province_has_center_of_trade_of_level = 1 }
				NOT = { has_province_modifier = nhs2_supply_lines_tm }
			}
			
		}
		random_owned_province = {
			limit = {
				NOT = { is_state_core = ROOT }
				NOT = { has_construction = core }
				is_owned_by_trade_company = no
				NOT = { has_province_flag = nhs_exarch_province_exemption }
				NOT = { has_province_modifier = to_varangian_headquarters }
				religion = ROOT
				nhs_$TAG$_province = yes
				development = 15
				NOT = { province_has_center_of_trade_of_level = 1 }
				NOT = { has_province_modifier = nhs2_supply_lines_tm }
			}
			to_add_core_and_release_exarch = { TAG = $TAG$ }
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				NOT = { is_state_core = ROOT }
				NOT = { has_construction = core }
				is_owned_by_trade_company = no
				NOT = { has_province_flag = nhs_exarch_province_exemption }
				NOT = { has_province_modifier = to_varangian_headquarters }
				nhs_$TAG$_province = yes
				development = 15
				NOT = { province_has_center_of_trade_of_level = 1 }
				NOT = { has_province_modifier = nhs2_supply_lines_tm }
			}
		}
		random_owned_province = {
			limit = {
				NOT = { is_state_core = ROOT }
				NOT = { has_construction = core }
				is_owned_by_trade_company = no
				NOT = { has_province_flag = nhs_exarch_province_exemption }
				NOT = { has_province_modifier = to_varangian_headquarters }
				nhs_$TAG$_province = yes
				development = 15
				NOT = { province_has_center_of_trade_of_level = 1 }
				NOT = { has_province_modifier = nhs2_supply_lines_tm }
			}
			to_add_core_and_release_exarch = { TAG = $TAG$ }
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				nhs_$TAG$_province = yes
				NOT = { is_state_core = ROOT }
				NOT = { has_construction = core }
				is_owned_by_trade_company = no
				NOT = { has_province_flag = nhs_exarch_province_exemption }
				NOT = { has_province_modifier = to_varangian_headquarters }
				NOT = { has_province_modifier = nhs2_supply_lines_tm }
				religion = ROOT
			}
		}
		random_owned_province = {
			limit = {
				nhs_$TAG$_province = yes
				NOT = { is_state_core = ROOT }
				NOT = { has_construction = core }
				is_owned_by_trade_company = no
				NOT = { has_province_flag = nhs_exarch_province_exemption }
				NOT = { has_province_modifier = to_varangian_headquarters }
				NOT = { has_province_modifier = nhs2_supply_lines_tm }
				religion = ROOT
			}
			to_add_core_and_release_exarch = { TAG = $TAG$ }
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				nhs_$TAG$_province = yes
				NOT = { is_state_core = ROOT }
				NOT = { has_construction = core }
				is_owned_by_trade_company = no
				NOT = { has_province_flag = nhs_exarch_province_exemption }
				NOT = { has_province_modifier = to_varangian_headquarters }
				NOT = { has_province_modifier = nhs2_supply_lines_tm }
			}
		}
		random_owned_province = {
			limit = {
				nhs_$TAG$_province = yes
				NOT = { is_state_core = ROOT }
				NOT = { has_construction = core }
				is_owned_by_trade_company = no
				NOT = { has_province_flag = nhs_exarch_province_exemption }
				NOT = { has_province_modifier = to_varangian_headquarters }
				NOT = { has_province_modifier = nhs2_supply_lines_tm }
			}
			to_add_core_and_release_exarch = { TAG = $TAG$ }
		}
	}
	create_subject = {
		subject_type = elysian_subject
		subject = $TAG$
	}
	to_transfer_provinces_to_exarch = {
		TAG = $TAG$
	}
}

to_transfer_provinces_to_exarch = {
	hidden_effect = {
		if = {
			limit = {
				any_province = {
					nhs_$TAG$_province = yes
					NOT = { has_province_flag = nhs_exarch_province_exemption }
					NOT = { has_province_modifier = to_varangian_headquarters }
					NOT = { is_core = ROOT }
					NOT = { is_territorial_core = ROOT }
					NOT = { has_construction = core }
					NOT = { has_construction = missionary }
					is_owned_by_trade_company = no
					OR = {
						owned_by = ROOT
						owner = {
							tag = ELG
							is_subject_of = ROOT
						}
					}
					NOT = { has_province_modifier = nhs2_supply_lines_tm }
				}
			}
			every_province = {
				limit = {
					nhs_$TAG$_province = yes
					NOT = { has_province_flag = nhs_exarch_province_exemption }
					NOT = { has_province_modifier = to_varangian_headquarters }
					NOT = { is_core = ROOT }
					NOT = { is_territorial_core = ROOT }
					NOT = { has_construction = core }
					NOT = { has_construction = missionary }
					is_owned_by_trade_company = no
					OR = {
						owned_by = ROOT
						owner = {
							tag = ELG
							is_subject_of = ROOT
						}
					}
					NOT = { has_province_modifier = nhs2_supply_lines_tm }
				}
				cede_province = $TAG$
				if = {
					limit = {
						is_core = ROOT
					}
					hidden_effect = {
						remove_core = ROOT
					}
					add_core = ROOT
				}
				if = {
					limit = {
						is_territorial_core = ROOT
					}
					add_territorial_core = ROOT
				}
			}
		}
	}
}

to_add_core_and_release_exarch = {
	tooltip = {
		cede_province = $TAG$
	}
	add_core = $TAG$
	remove_core = ROOT
	hidden_effect = {
		# set_province_flag = to_ignore_triumph_check
		ROOT = {
			release = $TAG$
		}
		# clr_province_flag = to_ignore_triumph_check
	}
}

to_initialize_exarch = {
	to_assign_provinces_to_exarch = { TAG = $EXARCH_TAG$ }
	hidden_effect = {
		$EXARCH_TAG$ = {
			nhs_change_government = { GOV = monarchy }
			nhs_add_gov_reform = { REF = autocracy_reform }
			change_religion = ROOT
			nhs_set_unit_type = yes
			swap_free_idea_group = yes
			
			if = {
				limit = {
					capital_scope = { culture_group = $CULTURE_GROUP$ }
				}
				change_primary_culture = CAPITAL
				capital_scope = {
					PREV = {
						set_ruler_culture = PREV
					}
				}
			}
			else = {
				to_set_country_ruler_heir_consort_culture = { CULTURE = $PRIMARY_CULTURE$ }
			}
			every_owned_province = {
				limit = { culture_group = PREV }
				add_nationalism = -10
			}
			clr_country_flag = nhs_ely_march_all
			clr_country_flag = nhs_ely_march_territory
			clr_country_flag = nhs_ely_march_no
			set_country_flag = nhs_ely_march_no_core
			add_legitimacy = 100
			add_legitimacy = -50
			if = {
				limit = {
					NOT = { prestige = 15 }
				}
				add_prestige = 20
			}
			if = {
				limit = {
					NOT = { treasury = 100 }
				}
				add_treasury = 150
			}
			if = {
				limit = {
					NOT = { manpower = 3 }
				}
				add_manpower = 5
			}
			capital_scope = {
				area = {
					limit = {
						owned_by = $EXARCH_TAG$
					}
					add_core = $EXARCH_TAG$
				}
			}
		}
	}
}

nhs_add_greek_areas_claims = {
	custom_tooltip = nhs_greek_areas_permanent_claims_tt
	hidden_effect = {
		every_province = {
			limit = {
				owner = {
					NOT = { culture_group = byzantine }
				}
				nhs_greek_areas = yes
				continent = europe
			}
			add_permanent_claim = ROOT
		}
	}
}

nhs_set_base_of_operations_target = {
	set_country_flag = nhs_bo
	set_country_flag = nhs_claims_greek
	custom_tooltip = nhs_how_to_secure_bo_tt
	if = {
		limit = {
			$PROVINCE_ID$ = {
				OR = {
					country_or_subject_holds = ROOT
					controller = {
						OR = {
							tag = ROOT
							is_subject_of = ROOT
						}
					}
				}
			}
		}
		if = {
			limit = {
				$PROVINCE_ID$ = {
					NOT = { is_core = ROOT }
				}
			}
			$PROVINCE_ID$ = {
				add_core = ROOT
			}
		}
		if = {
			limit = {
				$PROVINCE_ID$ = {
					owned_by = ROOT
				}
			}
			country_event = { id = nhs2_mainlandevents.13 }
		}
		if = {
			limit = {
				$PROVINCE_ID$ = {
					NOT = { owned_by = ROOT }
				}
			}
			$PROVINCE_ID$ = {
				cede_province = ROOT
			}
			tooltip = {
				country_event = { id = nhs2_mainlandevents.13 }
			}
		}
		custom_tooltip = nhs_new_line_tt
		if = {
			limit = {
				NOT = { has_country_flag = nhs_got_bo_buff }
			}
			add_country_modifier = {
				name = $MODIFIER$
				duration = 7300
			}
		}
		set_country_flag = nhs_got_bo_buff
		nhs_add_greek_areas_claims = yes
	}
	if = {
		limit = {
			NOT = {
				$PROVINCE_ID$ = {
					OR = {
						country_or_subject_holds = ROOT
						controller = {
							OR = {
								tag = ROOT
								is_subject_of = ROOT
							}
						}
					}
				}
			}
		}
		custom_tooltip = nhs_new_line_tt
		$PROVINCE_ID$ = {
			add_core = ROOT
			# if = {
			# 	limit = {
			# 		owner = {
			# 			religion_group = christian
			# 			AND = {
			# 				culture_group = byzantine
			# 				NOT = { primary_culture = turkish }
			# 			}
			# 		}
			# 	}
			# 	owner = {
			# 		country_event = { id = nhs2_mainlandevents.10 days = 1 }
			# 	}
			# 	ROOT = {
			# 		if = {
			# 			limit = {
			# 				NOT = {
			# 					religion_group = christian
			# 				}
			# 			}
			# 			add_dip_power = -50
			# 		}
			# 	}
			# }
		}
		if = {
			limit = {
				$PROVINCE_ID$ = {
					owner = {
						OR = {
							AND = {
								religion_group = christian
								AND = {
									culture_group = byzantine
									NOT = { primary_culture = turkish }
								}
							}
							AND = {
								is_subject = yes
								overlord = {
									religion_group = christian
									AND = {
										culture_group = byzantine
										NOT = { primary_culture = turkish }
									}
								}
							}
						}
					}
				}
			}
			random_country = {
				limit = {
					is_subject = no
					owns_or_subject_of = $PROVINCE_ID$
				}
				country_event = { id = nhs2_mainlandevents.10 days = 1 }
			}
			if = {
				limit = {
					NOT = {
						religion_group = christian
					}
				}
				add_dip_power = -50
			}
		}
		custom_tooltip = nhs_new_line_tt
		if = {
			limit = {
				NOT = { has_country_flag = nhs_got_bo_buff }
			}
			add_country_modifier = {
				name = $MODIFIER$
				duration = 7300
			}
		}
		set_country_flag = nhs_got_bo_buff
		nhs_add_greek_areas_claims = yes
		custom_tooltip = nhs_new_line_tt
		custom_tooltip = nhs_enable_change_base_of_operations_tt
	}
}

nhs_handle_supply_lines = {
	if = {
		limit = {
			owner = {
				nhs_check_all_elysian_tags = { CONDITION = tag }
				has_country_flag = nhs_supply_lines
				NOT = { has_country_flag = nhs_supply_lines_secured }
				NOT = { has_country_flag = nhs_invasion_over }
			}
			nhs_is_target_supply_lines_province = { FLAG_SCOPE = owner }
		}
		owner = {
			country_event = { id = nhs2_mainlandevents.8 }
		}
	}
}

nhs_handle_base_of_operations = {
	if = {
		limit = {
			has_province_modifier = nhs2_base_of_operations_tm
			owner = {
				is_subject = yes
				nhs_check_all_elysian_tags_with_if = { CONDITION = is_subject_of }
			}
		}
		owner = {
			overlord = {
				ROOT = {
					cede_province = PREV
				}
			}
		}
	}
	# if = {
	# 	limit = {
	# 		owner = {
	# 			nhs_check_all_elysian_tags = { CONDITION = tag }
	# 			has_country_flag = nhs_bo
	# 			NOT = { has_country_flag = nhs_invasion_over }
	# 			NOT = { has_country_flag = nhs_bo_secured }
	# 			OR = {
	# 				AND = {
	# 					has_country_flag = nhs_bo_athens
	# 					ROOT = { province_id = 146 }
	# 				}
	# 				AND = {
	# 					has_country_flag = nhs_bo_macedonia
	# 					ROOT = { province_id = 148 }
	# 				}
	# 				AND = {
	# 					has_country_flag = nhs_bo_sparta
	# 					ROOT = { province_id = 145 }
	# 				}
	# 				AND = {
	# 					has_country_flag = nhs_bo_rhodes
	# 					ROOT = { province_id = 320 }
	# 				}
	# 			}
	# 		}
	# 	}
	# 	owner = {
	# 		country_event = { id = nhs2_mainlandevents.13 }
	# 	}
	# }
	# if = {
	# 	limit = {
	# 		owner = {
	# 			is_subject = yes
	# 			overlord = {
	# 				nhs_check_all_elysian_tags = { CONDITION = tag }
	# 				has_country_flag = nhs_bo
	# 				NOT = { has_country_flag = nhs_invasion_over }
	# 				NOT = { has_country_flag = nhs_bo_secured }
	# 				OR = {
	# 					AND = {
	# 						has_country_flag = nhs_bo_athens
	# 						ROOT = { province_id = 146 }
	# 					}
	# 					AND = {
	# 						has_country_flag = nhs_bo_macedonia
	# 						ROOT = { province_id = 148 }
	# 					}
	# 					AND = {
	# 						has_country_flag = nhs_bo_sparta
	# 						ROOT = { province_id = 145 }
	# 					}
	# 					AND = {
	# 						has_country_flag = nhs_bo_rhodes
	# 						ROOT = { province_id = 320 }
	# 					}
	# 				}
	# 			}
	# 		}
	# 	}
	# 	owner = {
	# 		overlord = {
	# 			country_event = { id = nhs2_mainlandevents.13 }
	# 		}
	# 	}
	# }
}

nhs_set_unit_type = {
	if = {
		limit = {
			technology_group = western
		}
		change_unit_type = western
	}
	if = {
		limit = {
			technology_group = eastern
		}
		change_unit_type = eastern
	}
	if = {
		limit = {
			technology_group = ottoman
		}
		change_unit_type = ottoman
	}
	if = {
		limit = {
			technology_group = muslim
		}
		change_unit_type = muslim
	}
}

to_initialize_elysian_governor = {
	custom_tooltip = to_initialize_elysian_governor_tt
	hidden_effect = {
		every_owned_province = {
			limit = {
				continent = north_america
			}
			add_core = $GOVERNOR_TAG$
		}
		release = $GOVERNOR_TAG$
		create_subject = {
			subject_type = to_elysian_governor
			subject = $GOVERNOR_TAG$
		}
		$GOVERNOR_TAG$ = {
			nhs_change_government = { GOV = monarchy }
			nhs_add_gov_reform = { REF = autocracy_reform }
			change_religion = ROOT
			swap_free_idea_group = yes
			to_set_country_ruler_heir_consort_culture = { CULTURE = ROOT }
			add_legitimacy = 100
		}
	}
}

nhs_remove_reforms = {
	if = {
		limit = {
			has_country_modifier = to_ad_conscript_natives
		}
		remove_country_modifier = to_ad_conscript_natives
	}
	if = {
		limit = {
			has_country_modifier = to_ad_expand_militia
		}
		remove_country_modifier = to_ad_expand_militia
	}
	if = {
		limit = {
			OR = {
				has_country_modifier = to_ad_janissaries
				has_country_modifier = to_ad_encourage_janissaries
				has_country_modifier = to_ad_janissary_core
			}			
		}
		remove_country_modifier = to_ad_janissaries
		remove_country_modifier = to_ad_encourage_janissaries
		remove_country_modifier = to_ad_janissary_core
		set_country_flag = to_had_orhans_jannisaries_ad
	}
	if = {
		limit = {
			has_country_modifier = to_ad_lessons_from_the_frontier
		}
		remove_country_modifier = to_ad_lessons_from_the_frontier
	}
	if = {
		limit = {
			has_country_modifier = to_ad_reformed_theme_system
		}
		remove_country_modifier = to_ad_reformed_theme_system
	}
	if = {
		limit = {
			has_country_modifier = to_ad_foreign_advisors
		}
		remove_country_modifier = to_ad_foreign_advisors
	}
	if = {
		limit = {
			has_country_modifier = to_ad_greek_fire
		}
		remove_country_modifier = to_ad_greek_fire
	}
	if = {
		limit = {
			has_country_modifier = to_ad_pike_and_shot
		}
		remove_country_modifier = to_ad_pike_and_shot
	}
	if = {
		limit = {
			has_country_modifier = to_ad_cataphract_army_core
		}
		remove_country_modifier = to_ad_cataphract_army_core
	}
	if = {
		limit = {
			has_country_modifier = to_ad_volley_fire
		}
		remove_country_modifier = to_ad_volley_fire
	}
	if = {
		limit = {
			has_country_modifier = to_ad_volley_fire_nodlc
		}
		remove_country_modifier = to_ad_volley_fire_nodlc
	}
	if = {
		limit = {
			has_country_modifier = to_ad_greek_fire2
		}
		remove_country_modifier = to_ad_greek_fire2
	}
	if = {
		limit = {
			has_country_modifier = to_ad_administration_reform
		}
		remove_country_modifier = to_ad_administration_reform
	}
	if = {
		limit = {
			has_country_modifier = to_ad_professional_army
		}
		remove_country_modifier = to_ad_professional_army
	}
	if = {
		limit = {
			has_country_modifier = to_ad_professional_army_nodlc
		}
		remove_country_modifier = to_ad_professional_army_nodlc
	}
	if = {
		limit = {
			has_country_modifier = to_ad_expeditionary_forces
		}
		remove_country_modifier = to_ad_expeditionary_forces
	}
	if = {
		limit = {
			has_country_modifier = to_ad_hussars_and_cataphracts
		}
		remove_country_modifier = to_ad_hussars_and_cataphracts
	}
	if = {
		limit = {
			has_country_modifier = to_ad_greek_fire3
		}
		remove_country_modifier = to_ad_greek_fire3
	}
}
to_check_dlc_locked_army_reforms = {
	if = {
		limit = {
			NOT = { has_dlc = "Cradle of Civilization" }
		}
		if = {
			limit = {
				has_country_modifier = to_ad_volley_fire
			}
			remove_country_modifier = to_ad_volley_fire
			add_country_modifier = {
				name = to_ad_volley_fire_nodlc
				duration = -1
			}
		}
		else_if = {
			limit = {
				has_country_modifier = to_ad_professional_army
			}
			remove_country_modifier = to_ad_professional_army
			add_country_modifier = {
				name = to_ad_professional_army_nodlc
				duration = -1
			}
		}
	}
	else = {
		if = {
			limit = {
				has_country_modifier = to_ad_volley_fire_nodlc
			}
			remove_country_modifier = to_ad_volley_fire_nodlc
			add_country_modifier = {
				name = to_ad_volley_fire
				duration = -1
			}
		}
		else_if = {
			limit = {
				has_country_modifier = to_ad_professional_army_nodlc
			}
			remove_country_modifier = to_ad_professional_army_nodlc
			add_country_modifier = {
				name = to_ad_professional_army
				duration = -1
			}
		}
	}
}
to_replace_merc_ideas_with_group = {
	if = {
		limit = {
			has_idea_group = mercenary_ideas
			NOT = { has_idea_group = $IDEA_GROUP$ }
			[[TRIGGER]
			$TRIGGER$
			]
		}
		remove_idea_group = mercenary_ideas
		add_idea_group = $IDEA_GROUP$
		if = {
			limit = {
				mercenary_ideas = 7
			}
			add_idea = $IDEA_1$
			add_idea = $IDEA_2$
			add_idea = $IDEA_3$
			add_idea = $IDEA_4$
			add_idea = $IDEA_5$
			add_idea = $IDEA_6$
			add_idea = $IDEA_7$
		}
		else_if = {
			limit = {
				mercenary_ideas = 6
			}
			add_idea = $IDEA_1$
			add_idea = $IDEA_2$
			add_idea = $IDEA_3$
			add_idea = $IDEA_4$
			add_idea = $IDEA_5$
			add_idea = $IDEA_6$
		}
		else_if = {
			limit = {
				mercenary_ideas = 5
			}
			add_idea = $IDEA_1$
			add_idea = $IDEA_2$
			add_idea = $IDEA_3$
			add_idea = $IDEA_4$
			add_idea = $IDEA_5$
		}
		else_if = {
			limit = {
				mercenary_ideas = 4
			}
			add_idea = $IDEA_1$
			add_idea = $IDEA_2$
			add_idea = $IDEA_3$
			add_idea = $IDEA_4$
		}
		else_if = {
			limit = {
				mercenary_ideas = 3
			}
			add_idea = $IDEA_1$
			add_idea = $IDEA_2$
			add_idea = $IDEA_3$
		}
		else_if = {
			limit = {
				mercenary_ideas = 2
			}
			add_idea = $IDEA_1$
			add_idea = $IDEA_2$
		}
		else_if = {
			limit = {
				mercenary_ideas = 1
			}
			add_idea = $IDEA_1$
		}
	}
	else_if = {
		limit = {
			has_idea_group = mercenary_ideas
		}
		to_refund_mercenary_ideas = yes
	}
}
to_refund_mercenary_ideas = {
	if = {
		limit = {
			mercenary_ideas = 7
		}
		add_mil_power = 700
	}
	else_if = {
		limit = {
			mercenary_ideas = 6
		}
		add_mil_power = 600
	}
	else_if = {
		limit = {
			mercenary_ideas = 5
		}
		add_mil_power = 500
	}
	else_if = {
		limit = {
			mercenary_ideas = 4
		}
		add_mil_power = 400
	}
	else_if = {
		limit = {
			mercenary_ideas = 3
		}
		add_mil_power = 300
	}
	else_if = {
		limit = {
			mercenary_ideas = 2
		}
		add_mil_power = 200
	}
	else_if = {
		limit = {
			mercenary_ideas = 1
		}
		add_mil_power = 100
	}
}

nhs_set_the_fire_on = {
	if = {
		limit = {
			has_country_flag = nhs_fire_later
		}
		if = {
			limit = {
				has_country_modifier = nhs_greekfire_later_w
			}
			remove_country_modifier = nhs_greekfire_later_w
		}
		if = {
			limit = {
				NOT = { has_country_modifier = nhs_greekfire_later }
			}
			add_country_modifier = {
				name = nhs_greekfire_later
				duration = -1
			}
		}
	}
	else_if = {
		limit = {
			NOT = { has_country_flag = nhs_updated_fire }
		}
		if = {
			limit = {
				has_country_modifier = nhs_secrets_greekfire_w
			}
			remove_country_modifier = nhs_secrets_greekfire_w
		}
		if = {
			limit = {
				has_country_modifier = nhs_greekfire_update_w
			}
			remove_country_modifier = nhs_greekfire_update_w
		}
		if = {
			limit = {
				NOT = { has_country_modifier = nhs_secrets_greekfire }
			}
			add_country_modifier = {
				name = nhs_secrets_greekfire
				duration = -1
			}
		}
	}
	else_if = {
		limit = {
			has_country_flag = nhs_updated_fire
		}
		if = {
			limit = {
				has_country_modifier = nhs_secrets_greekfire_w
			}
			remove_country_modifier = nhs_secrets_greekfire_w
		}
		if = {
			limit = {
				has_country_modifier = nhs_greekfire_update_w
			}
			remove_country_modifier = nhs_greekfire_update_w
		}
		if = {
			limit = {
				NOT = { has_country_modifier = nhs_greekfire_update }
			}
			add_country_modifier = {
				name = nhs_greekfire_update
				duration = -1
			}
		}
	}
	if = {
		limit = {
			has_country_flag = nhs_fire_reform
		}
		if = {
			limit = {
				has_country_modifier = nhs_fire_reform_w
			}
			remove_country_modifier = nhs_fire_reform_w
		}
		if = {
			limit = {
				has_country_modifier = nhs_fire_reform_w_update
			}
			remove_country_modifier = nhs_fire_reform_w_update
		}
		if = {
			limit = {
				has_country_flag = nhs_second_a_reform
			}
			add_country_modifier = {
				name = to_ad_greek_fire
				duration = -1
			}
		}
		if = {
			limit = {
				has_country_flag = nhs_third_a_reform
			}
			add_country_modifier = {
				name = to_ad_greek_fire2
				duration = -1
			}
		}
		if = {
			limit = {
				has_country_flag = nhs_fourth_a_reform
			}
			add_country_modifier = {
				name = to_ad_greek_fire3
				duration = -1
			}
		}
	}
	nhs_remove_fire_depleting_modifier = yes
}
nhs_set_the_fire_off = {
	if = {
		limit = {
			NOT = { nhs_has_greek_fire_reform = yes }
		}
		if = {
			limit = {
				OR = {
					has_country_flag = nhs_fire_later
					has_country_modifier = nhs_greekfire_later
				}
			}
			if = {
				limit = {
					has_country_modifier = nhs_greekfire_later
				}
				remove_country_modifier = nhs_greekfire_later
			}
			add_country_modifier = {
				name = nhs_greekfire_later_w
				duration = 14600
			}
		}
		else_if = {
			limit = {
				OR = {
					NOT = { has_country_flag = nhs_updated_fire }
					has_country_modifier = nhs_secrets_greekfire
				}
			}
			if = {
				limit = {
					has_country_modifier = nhs_secrets_greekfire
				}
				remove_country_modifier = nhs_secrets_greekfire
			}
			if = {
				limit = {
					has_country_modifier = nhs_greekfire_update
				}
				remove_country_modifier = nhs_greekfire_update
			}
			add_country_modifier = {
				name = nhs_secrets_greekfire_w
				duration = 14600
			}
		}
		else_if = {
			limit = {
				OR = {
					has_country_flag = nhs_updated_fire
					has_country_modifier = nhs_greekfire_update
				}
			}
			if = {
				limit = {
					has_country_modifier = nhs_secrets_greekfire
				}
				remove_country_modifier = nhs_secrets_greekfire
			}
			if = {
				limit = {
					has_country_modifier = nhs_greekfire_update
				}
				remove_country_modifier = nhs_greekfire_update
			}
			add_country_modifier = {
				name = nhs_greekfire_update_w
				duration = 14600
			}
		}
	}
	else = {
		if = {
			limit = {
				OR = {
					has_country_flag = nhs_fire_later
					has_country_modifier = nhs_greekfire_later
				}
			}
			if = {
				limit = {
					has_country_modifier = to_ad_greek_fire
				}
				remove_country_modifier = to_ad_greek_fire
			}
			if = {
				limit = {
					has_country_modifier = to_ad_greek_fire2
				}
				remove_country_modifier = to_ad_greek_fire2
			}
			if = {
				limit = {
					has_country_modifier = to_ad_greek_fire3
				}
				remove_country_modifier = to_ad_greek_fire3
			}
			add_country_modifier = {
				name = nhs_fire_reform_w_later
				duration = 14600
			}
		}
		else_if = {
			limit = {
				OR = {
					NOT = { has_country_flag = nhs_updated_fire }
					has_country_modifier = nhs_secrets_greekfire
				}
			}
			if = {
				limit = {
					has_country_modifier = to_ad_greek_fire
				}
				remove_country_modifier = to_ad_greek_fire
			}
			if = {
				limit = {
					has_country_modifier = to_ad_greek_fire2
				}
				remove_country_modifier = to_ad_greek_fire2
			}
			if = {
				limit = {
					has_country_modifier = to_ad_greek_fire3
				}
				remove_country_modifier = to_ad_greek_fire3
			}
			add_country_modifier = {
				name = nhs_fire_reform_w
				duration = 14600
			}
		}
		else_if = {
			limit = {
				OR = {
					has_country_flag = nhs_updated_fire
					has_country_modifier = nhs_greekfire_update
				}
			}
			if = {
				limit = {
					has_country_modifier = to_ad_greek_fire
				}
				remove_country_modifier = to_ad_greek_fire
			}
			if = {
				limit = {
					has_country_modifier = to_ad_greek_fire2
				}
				remove_country_modifier = to_ad_greek_fire2
			}
			if = {
				limit = {
					has_country_modifier = to_ad_greek_fire3
				}
				remove_country_modifier = to_ad_greek_fire3
			}
			add_country_modifier = {
				name = nhs_fire_reform_w_update
				duration = 14600
			}
		}
	}
	nhs_remove_fire_depleting_modifier = yes
}
# province
# FROM = old owner
nhs_handle_naphtha = {
	if = {
		limit = {
			is_city = yes
		}
		if = {
			limit = {
				has_province_modifier = nhs2_source_of_naphta
			}
			if = {
				limit = {
					owner = {
						nhs_check_all_elysian_tags = { CONDITION = tag }
						has_country_flag = nhs_searching_for_naphtha
					}
				}
				owner = {
					country_event = { id = nhs2_greek_fire.5 days = 1 }
				}
			}
			if = {
				limit = {
					owner = {
						OR = {
							has_country_modifier = nhs_greek_fire_deal
							AND = {
								is_subject = yes
								overlord = {
									nhs_check_all_elysian_tags = { CONDITION = tag }
									has_country_flag = nhs_searching_for_naphtha
								}
							}
						}
					}
				}
				overlord = {
					country_event = { id = nhs2_greek_fire.5 days = 1 }
				}
			}
		}
		if = {
			limit = {
				has_province_modifier = nhs2_source_of_naphta_e
				owner = {
					NOT = {
						OR = {
							AND = {
								nhs_check_all_elysian_tags = { CONDITION = tag }
								has_country_flag = nhs_searching_for_naphtha
							}
							has_country_modifier = nhs_greek_fire_deal
							AND = {
								is_subject = yes
								overlord = {
									nhs_check_all_elysian_tags = { CONDITION = tag }
									has_country_flag = nhs_searching_for_naphtha
								}
							}
						}
					}
				}
			}
			remove_province_modifier = nhs2_source_of_naphta_e
			add_permanent_province_modifier = {
				name = nhs2_source_of_naphta
				duration = -1
			}
			# NHS = {
			# 	add_treasury = 1000
			# 	country_event = { id = nhs2_greek_fire.6 days = 1 }
			# }
			if = {
				limit = {
					FROM = {
						nhs_check_all_elysian_tags = { CONDITION = tag }
					}
				}
				FROM = {
					country_event = { id = nhs2_greek_fire.6 }
				}
			}
			if = {
				limit = {
					FROM = {
						has_country_modifier = nhs_greek_fire_deal
					}
				}
				FROM = {
					country_event = { id = nhs2_greek_fire.8 }
				}
				nhs_effect_for_existing_elysian_tag = { EFFECT = "nhs_trigger_province_lost_event_from_trading_partner = yes" }
			}
			if = {
				limit = {
					FROM = {
						is_subject = yes
						overlord = {
							nhs_check_all_elysian_tags = { CONDITION = tag }
							has_country_flag = nhs_searching_for_naphtha
						}
					}
				}
				FROM = {
					overlord = {
						country_event = { id = nhs2_greek_fire.6 }
					}
				}
			}
			# else = {
			# 	nhs_effect_for_existing_elysian_tag = { EFFECT = "nhs_trigger_province_lost_event_from_trading_partner = yes" }
			# }
		}
	}
}

# ROOT = Overlord, FROM = Minor
nhs_handle_naphtha_in_subject = {
	if = {
		limit = {
			nhs_check_all_elysian_tags = { CONDITION = tag }
			has_country_flag = nhs_searching_for_naphtha
			FROM = {
				any_owned_province = {
					is_city = yes
					has_province_modifier = nhs2_source_of_naphta
					NOT = { has_province_modifier = nhs2_source_of_naphta_e }
				}
			}
		}
		country_event = { id = nhs2_greek_fire.5 days = 1 }
	}
	if = {
		limit = {
			NOT = { nhs_check_all_elysian_tags = { CONDITION = tag } }
			FROM = {
				NOT = { has_country_modifier = nhs_greek_fire_deal }
				any_owned_province = {
					is_city = yes
					has_province_modifier = nhs2_source_of_naphta_e
				}
			}
		}
		nhs_effect_for_existing_elysian_tag = {
			EFFECT = "country_event = { id = nhs2_greek_fire.6 }"
		}
	}
}

nhs_trigger_province_lost_event_from_trading_partner = {
	set_country_flag = nhs_naphta_lost_in_trading_partner
	country_event = { id = nhs2_greek_fire.6 }
	clr_country_flag = nhs_naphta_lost_in_trading_partner
}
nhs_set_fire_depleting_modifier = {
	if = {
		limit = {
			OR = {
				has_country_modifier = nhs_secrets_greekfire
				has_country_modifier = nhs_greekfire_later
			}
			NOT = { nhs_has_greek_fire_reform = yes }
		}
		add_country_modifier = {
			name = nhs2_depleting_fire_fuel
			duration = 1825
		}
	}
	else_if = {
		limit = {
			has_country_modifier = nhs_greekfire_update
			NOT = { nhs_has_greek_fire_reform = yes }
		}
		add_country_modifier = {
			name = nhs2_depleting_fire_fuel_update
			duration = 1825
		}
	}
	else_if = {
		limit = {
			OR = {
				has_country_modifier = nhs_secrets_greekfire
				has_country_modifier = nhs_greekfire_later
			}
			nhs_has_greek_fire_reform = yes
		}
		add_country_modifier = {
			name = nhs2_depleting_fire_fuel_reform
			duration = 1825
		}
	}
	else_if = {
		limit = {
			has_country_modifier = nhs_greekfire_update
			nhs_has_greek_fire_reform = yes
		}
		add_country_modifier = {
			name = nhs2_depleting_fire_fuel_reform_update
			duration = 1825
		}
	}
}
nhs_remove_fire_depleting_modifier = {
	remove_country_modifier = nhs2_depleting_fire_fuel
	remove_country_modifier = nhs2_depleting_fire_fuel_update
	remove_country_modifier = nhs2_depleting_fire_fuel_reform
	remove_country_modifier = nhs2_depleting_fire_fuel_reform_update
	remove_country_modifier = nhs2_depleting_fire_fuel_timer
}

to_enable_siege_flamethrowers = {
	if = {
		limit = {
			NOT = { has_country_flag = to_got_siege_flamethrowers }
		}
		custom_tooltip = nhs_dotted_line_tt
		set_country_flag = to_got_siege_flamethrowers
		custom_tooltip = to_enable_greek_firethrower_unit_flavor_tt
		custom_tooltip = nhs_new_line_tt
		custom_tooltip = to_enable_greek_firethrower_unit_tt
		hidden_effect = {
			if = {
				limit = {
					NOT = { mil_tech = 7 }
				}
				change_unit_type = western
				change_unit_type = exiled_greek
			}
		}
	}
}

viking_discovery = {
	discover_province = 980
	discover_province = 981
	discover_province = 2573
	discover_province = 997
	discover_province = 2575
	discover_province = 2574
	discover_province = 996
	discover_province = 2576
	discover_province = 2577
	discover_province = 2578
	discover_province = 995
	discover_province = 994
	discover_province = 2583
	discover_province = 2582
	discover_province = 986
	discover_province = 2572
	discover_province = 985
	discover_province = 2571
	discover_province = 2570
	discover_province = 2566
	discover_province = 983
	discover_province = 984
	discover_province = 2569
	discover_province = 2568
	discover_province = 982
	discover_province = 1104
	discover_province = 1105
	discover_province = 1482
	discover_province = 1483
	discover_province = 1493
	discover_province = 1490
	discover_province = 1495
	discover_province = 1494
	discover_province = 1491
	discover_province = 1492

}
thorfinn_bay_discovery = {
	discover_province = 998
	discover_province = 999
	discover_province = 1000
	discover_province = 1003
	discover_province = 1004
	discover_province = 1005
	discover_province = 1006
	discover_province = 2592
}
great_lakes_discovery = {
	discover_province = 989
	discover_province = 961
	discover_province = 960 
	discover_province = 959 
	discover_province = 958 
	discover_province = 2670 
	discover_province = 987 
	discover_province = 954 
	discover_province = 947 
	discover_province = 946 
	discover_province = 944 
	discover_province = 2521 
	discover_province = 2587 
	discover_province = 2586 
	discover_province = 988 
	discover_province = 2671 
	discover_province = 1001 
	discover_province = 945 
	discover_province = 911 
	discover_province = 914 
	discover_province = 915 
	discover_province = 942 
	discover_province = 2522 
	discover_province = 2518 
	discover_province = 2517 
	discover_province = 910 
	discover_province = 1007 
	discover_province = 2015
}

erikson_river_discovery = {
	discover_province = 994 
	discover_province = 2583 
	discover_province = 990 
	discover_province = 993 
	discover_province = 2584 
	discover_province = 2585 
	discover_province = 2559 
	discover_province = 989 
	discover_province = 961 
	erikson_river_area = {
		ROOT = {
			discover_province = PREV
		}
	}
}

disputed_lands_coast_discovery = {
	discover_province = 2570 
	discover_province = 2566 
	discover_province = 2013 
	discover_province = 970 
	discover_province = 971 
	discover_province = 968 
	discover_province = 2561 
	discover_province = 967 
}

elysian_coast_discovery = {
	discover_province = 2010 
	discover_province = 2560 
	discover_province = 965 
	discover_province = 2639 
	discover_province = 962 
	discover_province = 957 
	discover_province = 2554 
	discover_province = 953 
	discover_province = 2550 
	discover_province = 952 
	discover_province = 950 
	discover_province = 2547 
	discover_province = 938 
	discover_province = 2546  
}
erikson_gulf_discovery = {
	discover_province = 980 
	discover_province = 981 
	discover_province = 981 
	discover_province = 982 
	discover_province = 983 
	discover_province = 984 
	discover_province = 985 
	discover_province = 986 
	discover_province = 994 
	discover_province = 995 
	discover_province = 996 
	discover_province = 997 
	discover_province = 2568 
	discover_province = 2569 
	discover_province = 2572 
	discover_province = 2573 
	discover_province = 2574 
	discover_province = 2575 
	discover_province = 2576 
	discover_province = 2577 
	discover_province = 2578 
	discover_province = 2582 
	discover_province = 2583
}

north_elysian_sea_discovery = {
	discover_province = 1501 
	discover_province = 1500 
	discover_province = 1499 
	discover_province = 1492 
}

south_elysian_sea_discovery = {
	discover_province = 1501 
	discover_province = 1502 
	discover_province = 1503 
}

vinlandic_sea_discovery = {
	discover_province = 1483 
	discover_province = 1490 
	discover_province = 1491 
	discover_province = 1493 
	discover_province = 1494 
	discover_province = 1495
}

thorfinn_sea_discovery = {
	discover_province = 1485
	discover_province = 1488 
	discover_province = 1486 
	discover_province = 1487 
	discover_province = 1484
	discover_province = 1489
}

great_lakes_sea_discovery = {
	discover_province = 1659
	discover_province = 1660
	discover_province = 1661
	discover_province = 1662
	discover_province = 1663
}

# greenland_discovery = {


# }

# north_sea_discovery = {


# }

nhs_set_herald_preach = {
	hidden_effect = {
		if = {
			limit = {
				NOT = { has_country_modifier = nhs_heralds1 }
			}
			add_country_modifier = {
				name = nhs_heralds1
				duration = 1825
				hidden = yes
			}
		}
		else_if = {
			limit = {
				has_country_modifier = nhs_heralds1
				NOT = { has_country_modifier = nhs_heralds2 }
			}
			add_country_modifier = {
				name = nhs_heralds2
				duration = 1825
				hidden = yes
			}
		}
		else_if = {
			limit = {
				has_country_modifier = nhs_heralds1
				has_country_modifier = nhs_heralds2
				NOT = { has_country_modifier = nhs_heralds3 }
			}
			add_country_modifier = {
				name = nhs_heralds3
				duration = 1825
				hidden = yes
			}
		}
		else_if = {
			limit = {
				has_country_modifier = nhs_heralds1
				has_country_modifier = nhs_heralds2
				has_country_modifier = nhs_heralds3
				NOT = { has_country_modifier = nhs_heralds4 }
			}
			add_country_modifier = {
				name = nhs_heralds4
				duration = 1825
				hidden = yes
			}
		}
	}
}

nhs_set_herald_7300 = {
	hidden_effect = {
		if = {
			limit = {
				has_country_modifier = nhs_heralds1
				has_country_modifier = nhs_heralds2
				has_country_modifier = nhs_heralds3
				NOT = { has_country_modifier = nhs_heralds4 }
			}
			add_country_modifier = {
				name = nhs_heralds4
				duration = 7300
				hidden = yes
			}
		}
		if = {
			limit = {
				has_country_modifier = nhs_heralds1
				has_country_modifier = nhs_heralds2
				NOT = { has_country_modifier = nhs_heralds3 }
			}
			add_country_modifier = {
				name = nhs_heralds3
				duration = 7300
				hidden = yes
			}
		}
		if = {
			limit = {
				has_country_modifier = nhs_heralds1
				NOT = { has_country_modifier = nhs_heralds2 }
			}
			add_country_modifier = {
				name = nhs_heralds2
				duration = 7300
				hidden = yes
			}
		}
		if = {
			limit = {
				NOT = { has_country_modifier = nhs_heralds1 }
			}
			add_country_modifier = {
				name = nhs_heralds1
				duration = 7300
				hidden = yes
			}
		}
	}
}

nhs_give_province = {
	if = {
		limit = {
			has_province_flag = nhs_p2
		}
		ROOT = {
			change_variable = { which = nhs_pm value = -1 }
		}
		random_neighbor_province = {
			limit = {
				has_province_flag = nhs_p1
			}
			cede_province = ROOT
			set_province_flag = nhs_province
		}
		## END
		country_event = { id = nhs2_p.3 }			
	}
	if = {
		limit = {
			has_province_flag = nhs_p3
		}
		ROOT = {
			change_variable = { which = nhs_pm value = -1 }
		}
		random_neighbor_province = {
			limit = {
				has_province_flag = nhs_p2
				any_neighbor_province = {
					has_province_flag = nhs_p1
				}
			}
			cede_province = ROOT
			set_province_flag = nhs_province
		}		
	}
	if = {
		limit = {
			has_province_flag = nhs_p4
		}
		ROOT = {
			change_variable = { which = nhs_pm value = -1 }
		}
		random_neighbor_province = {
			limit = {
				has_province_flag = nhs_p3
				any_neighbor_province = {
					has_province_flag = nhs_p2
					any_neighbor_province = {
						has_province_flag = nhs_p1
					}
				}
			}
			cede_province = ROOT
			set_province_flag = nhs_province
		}		
	}
	if = {
		limit = {
			has_province_flag = nhs_p5
		}
		ROOT = {
			change_variable = { which = nhs_pm value = -1 }
		}
		random_neighbor_province = {
			limit = {
				has_province_flag = nhs_p4
				any_neighbor_province = {
					has_province_flag = nhs_p3
					any_neighbor_province = {
						has_province_flag = nhs_p2
						any_neighbor_province = {
							has_province_flag = nhs_p1
						}
					}
				}
			}
			cede_province = ROOT
			set_province_flag = nhs_province
		}		
	}
}

nhs_roll_the_next_battle = {
	if = {
		limit = {
			OR = {
				MK1 = { NOT = { num_of_cities = 2 } }
				HLL = { NOT = { num_of_cities = 2 } }
			}
		}
		country_event = { id = nhs_vov_civil_war.9 days = 25 }
	}
	if = {
		limit = {
			any_province = {
				OR = {
					owned_by = MK1
					owned_by = HLL
				}
				NOT = { region = canada_region }
			}
			NOT = {
				OR = {
					MK1 = { NOT = { num_of_cities = 2 } }
					HLL = { NOT = { num_of_cities = 2 } }
				}
			}
		}
		if = {
			limit = {
				OR = {
					AND = {
						OR = {
							any_province = {
								owned_by = MK1
								any_neighbor_province = {
									owned_by = HLL
									is_capital = yes
								}
							}
							HLL = { NOT = { num_of_cities = 2 } }
						}
						HLL = { NOT = { num_of_cities = 10 } }
						NOT = {
							trading_with_helluland = yes
						}
					}
					AND = {
						OR = {
							any_province = {
								owned_by = HLL
								any_neighbor_province = {
									owned_by = MK1
									is_capital = yes
								}
							}
							MK1 = { NOT = { num_of_cities = 2 } }
						}
						MK1 = { NOT = { num_of_cities = 10 } }
						NOT = {
							trading_with_markland = yes
						}
					}
				}
			}
			random_list = {
				70 = {
					country_event = { id = nhs_vov_civil_war.10 days = 50 }
				}
				30 = {
					country_event = { id = nhs_vov_civil_war.9 days = 50 }
				}
			}
		}
		if = {
			limit = {
				NOT = {
					OR = {
						AND = {
							OR = {
								any_province = {
									owned_by = MK1
									any_neighbor_province = {
										owned_by = HLL
										is_capital = yes
									}
								}
								HLL = { NOT = { num_of_cities = 2 } }
							}
							HLL = { NOT = { num_of_cities = 10 } }
							NOT = {
								trading_with_helluland = yes
							}
						}
						AND = {
							OR = {
								any_province = {
									owned_by = HLL
									any_neighbor_province = {
										owned_by = MK1
										is_capital = yes
									}
								}
								MK1 = { NOT = { num_of_cities = 2 } }
							}
							MK1 = { NOT = { num_of_cities = 10 } }
							NOT = { 
								trading_with_markland = yes
							}
						}
					}
				}
			}
			random_list = {
				70 = {
					country_event = { id = nhs_vov_civil_war.9 days = 50 }
				}
				30 = {
					country_event = { id = nhs_vov_civil_war.5 days = 50 }
				}
			}
		}
	}
	###
	if = {
		limit = {
			NOT = {
				any_province = {
					OR = {
						owned_by = MK1
						owned_by = HLL
					}
					NOT = { region = canada_region }
				}
			}
			NOT = {
				OR = {
					MK1 = { NOT = { num_of_cities = 2 } }
					HLL = { NOT = { num_of_cities = 2 } }
				}
			}
		}
		if = {
			limit = {
				OR = {
					AND = {
						OR = {
							any_province = {
								owned_by = MK1
								any_neighbor_province = {
									owned_by = HLL
									is_capital = yes
								}
							}
							HLL = { NOT = { num_of_cities = 2 } }
						}
						HLL = { NOT = { num_of_cities = 10 } }
						NOT = {
							trading_with_helluland = yes
						}
					}
					AND = {
						OR = {
							any_province = {
								owned_by = HLL
								any_neighbor_province = {
									owned_by = MK1
									is_capital = yes
								}
							}
							MK1 = { NOT = { num_of_cities = 2 } }
						}
						MK1 = { NOT = { num_of_cities = 10 } }
						NOT = { 
							trading_with_markland = yes
						}
					}
				}	
			}
			random_list = {
				70 = {
					country_event = { id = nhs_vov_civil_war.9 days = 50 }
				}
				30 = {
					country_event = { id = nhs_vov_civil_war.5 days = 50 }
				}
			}
		}
		if = {
			limit = {
				NOT = {
					OR = {
						AND = {
							OR = {
								any_province = {
									owned_by = MK1
									any_neighbor_province = {
										owned_by = HLL
										is_capital = yes
									}
								}
								HLL = { NOT = { num_of_cities = 2 } }
							}
							HLL = { NOT = { num_of_cities = 10 } }
							NOT = {
								trading_with_helluland = yes
							}
						}
						AND = {
							OR = {
								any_province = {
									owned_by = HLL
									any_neighbor_province = {
										owned_by = MK1
										is_capital = yes
									}
								}
								MK1 = { NOT = { num_of_cities = 2 } }
							}
							MK1 = { NOT = { num_of_cities = 10 } }
							NOT = { 
								trading_with_markland = yes
							}
						}
					}
				}
			}
			country_event = { id = nhs_vov_civil_war.5 days = 50 }
		}
	}
}

nhs_improve_portuguese_enclave_from_small = {
	clr_country_flag = nhs_has_small_por_enclave
	set_country_flag = nhs_has_por_enclave
	custom_tooltip = nhs_enclave_expansion_tt
	custom_tooltip = to_breaking_por_deal_costs_stability_tt
	custom_tooltip = nhs_institution_spread_enclave_increased_tt
	if = {
		limit = {
			any_owned_province = {
				has_province_modifier = nhs2_small_por_enclave
			}
		}
		random_owned_province = {
			limit = {
				has_province_modifier = nhs2_small_por_enclave
			}
			
			remove_province_modifier = nhs2_small_por_enclave
			add_permanent_province_modifier = {
				name = nhs2_por_enclave
				duration = -1
			}
		}
	}
}

# RECIPIENT - country that provinces are ceeded to
nhs_cede_elysian_brazilian_settlements = {
	if = {
		limit = {
			any_province = {
				continent = south_america
				owner = {
					OR = {
						nhs_check_all_elysian_tags = { CONDITION = tag }
						AND = {
							is_colonial_nation = yes
							colonial_parent = {
								nhs_check_all_elysian_tags = { CONDITION = tag }
							}
						}
						AND = {
							nhs_check_all_elysian_tags = { CONDITION = is_subject_of }
							NOT = {
								capital_scope = {
									continent = south_america
								}
							}
						}
					}
				}
			}
		}
		every_province = {
			limit = {
				continent = south_america
				owner = {
					OR = {
						nhs_check_all_elysian_tags = { CONDITION = tag }
						AND = {
							is_colonial_nation = yes
							colonial_parent = {
								nhs_check_all_elysian_tags = { CONDITION = tag }
							}
						}
						AND = {
							nhs_check_all_elysian_tags = { CONDITION = is_subject_of }
							NOT = {
								capital_scope = {
									continent = south_america
								}
							}
						}
					}
				}
			}
			cede_province = $RECIPIENT$
			hidden_effect = {
				add_core = $RECIPIENT$
				every_country = {
					limit = {
						OR = {
							nhs_check_all_elysian_tags = { CONDITION = tag }
							AND = {
								is_colonial_nation = yes
								colonial_parent = {
									nhs_check_all_elysian_tags = { CONDITION = tag }
								}
							}
							AND = {
								nhs_check_all_elysian_tags = { CONDITION = is_subject_of }
								NOT = {
									capital_scope = {
										continent = south_america
									}
								}
							}
						}
					}
					remove_core = PREV
				}
			}
		}
	}
}

nhs_move_por_settlements = {
	every_province = {
		limit = {
			continent = north_america
			OR = {
				owned_by = ROOT
				owner = {
					AND = {
						is_colonial_nation = yes
						colonial_parent = {
							tag = ROOT
						}
					}
				}
			}
		}
		if = {
			limit = {
				NOT = { nhs_culturally_native = yes }
				to_nat_has_culture_flag = yes
			}
			to_nat_restore_original_culture_from_flag = { CHANGE_ORIGINAL_CULTURE = yes }
		}
		else = {
			change_culture = arawak
			change_religion = animist
		}
		add_colonysize = -1000
		cede_province = ---
		change_trade_goods = unknown
		ROOT = {
			clr_country_flag = nhs_found_move_por_settlements_target
			random_province = {
				limit = {
					is_empty = yes
					has_port = yes
					region = brazil_region
					any_neighbor_province = {
						OR = {
							owned_by = ROOT
							owner = {
								is_colonial_nation = yes
								colonial_parent = {
									tag = ROOT
								}
							}
						}
					}
				}
				ROOT = {
					set_country_flag = nhs_found_move_por_settlements_target
				}
				save_event_target_as = nhs_move_por_settlements_target
			}
			if = {
				limit = {
					NOT = { has_country_flag = nhs_found_move_por_settlements_target }
				}
				random_province = {
					limit = {
						is_empty = yes
						has_port = yes
						region = brazil_region
						range = ROOT
						province_has_center_of_trade_of_level = 1
					}
					ROOT = {
						set_country_flag = nhs_found_move_por_settlements_target
					}
					save_event_target_as = nhs_move_por_settlements_target
				}
			}
			if = {
				limit = {
					NOT = { has_country_flag = nhs_found_move_por_settlements_target }
				}
				random_province = {
					limit = {
						is_empty = yes
						has_port = yes
						region = brazil_region
						range = ROOT
					}
					ROOT = {
						set_country_flag = nhs_found_move_por_settlements_target
					}
					save_event_target_as = nhs_move_por_settlements_target
				}
			}
			if = {
				limit = {
					NOT = { has_country_flag = nhs_found_move_por_settlements_target }
				}
				random_province = {
					limit = {
						is_empty = yes
						region = brazil_region
						any_neighbor_province = {
							OR = {
								owned_by = ROOT
								owner = {
									is_colonial_nation = yes
									colonial_parent = {
										tag = ROOT
									}
								}
							}
						}
					}
					ROOT = {
						set_country_flag = nhs_found_move_por_settlements_target
					}
					save_event_target_as = nhs_move_por_settlements_target
				}
			}
			if = {
				limit = {
					NOT = { has_country_flag = nhs_found_move_por_settlements_target }
				}
				random_province = {
					limit = {
						continent = south_america
						region = colombia_region
						has_port = yes
						is_empty = yes
						any_neighbor_province = {
							OR = {
								owned_by = ROOT
								owner = {
									is_colonial_nation = yes
									colonial_parent = {
										tag = ROOT
									}
								}
							}
						}
					}
					ROOT = {
						set_country_flag = nhs_found_move_por_settlements_target
					}
					save_event_target_as = nhs_move_por_settlements_target
				}
			}
			if = {
				limit = {
					NOT = { has_country_flag = nhs_found_move_por_settlements_target }
				}
				random_province = {
					limit = {
						is_empty = yes
						has_port = yes
						region = colombia_region
						range = ROOT
						province_has_center_of_trade_of_level = 1
					}
					ROOT = {
						set_country_flag = nhs_found_move_por_settlements_target
					}
					save_event_target_as = nhs_move_por_settlements_target
				}
			}
			if = {
				limit = {
					NOT = { has_country_flag = nhs_found_move_por_settlements_target }
				}
				random_province = {
					limit = {
						is_empty = yes
						has_port = yes
						region = colombia_region
						range = ROOT
					}
					ROOT = {
						set_country_flag = nhs_found_move_por_settlements_target
					}
					save_event_target_as = nhs_move_por_settlements_target
				}
			}
			if = {
				limit = {
					NOT = { has_country_flag = nhs_found_move_por_settlements_target }
				}
				random_province = {
					limit = {
						continent = south_america
						region = colombia_region
						is_empty = yes
						any_neighbor_province = {
							OR = {
								owned_by = ROOT
								owner = {
									is_colonial_nation = yes
									colonial_parent = {
										tag = ROOT
									}
								}
							}
						}
					}
					ROOT = {
						set_country_flag = nhs_found_move_por_settlements_target
					}
					save_event_target_as = nhs_move_por_settlements_target
				}
			}
			if = {
				limit = {
					has_country_flag = nhs_found_move_por_settlements_target
				}
				event_target:nhs_move_por_settlements_target = {
					cede_province = ROOT
					change_culture = ROOT
					change_religion = ROOT
					add_core = ROOT
				}
			}
			# At this point we say GG

			# else_if = {
			# 	limit = {
			# 		any_province = {
			# 			region = brazil_region
			# 			is_empty = yes
			# 		}
			# 	}
			# 	random_province = {
			# 		limit = {
			# 			region = brazil_region
			# 			is_empty = yes
			# 		}
			# 		cede_province = ROOT
			# 		change_culture = ROOT
			# 		change_religion = ROOT
			# 	}
			# }
			# else_if = {
			# 	limit = {
			# 		any_province = {
			# 			continent = south_america
			# 			is_empty = yes
			# 		}
			# 	}
			# 	random_province = {
			# 		limit = {
			# 			continent = south_america
			# 			is_empty = yes
			# 		}
			# 		cede_province = ROOT
			# 		change_culture = ROOT
			# 		change_religion = ROOT
			# 	}
			# }
			clr_country_flag = nhs_found_move_por_settlements_target
		}
	}
}

nhs_discover_treaty_provinces_ely = {
	every_province = {
		limit = {
			region = brazil_region
			owner = {
				OR = {
					tag = ROOT
					AND = {
						is_colonial_nation = yes
						colonial_parent = {
							tag = ROOT
						}
					}
				}
			}
		}
		discover_country = FROM
		if = {
			limit = {
				has_port = yes
			}
			sea_zone = {
				discover_country = FROM
			}
		}
	}
	# FROM = {	
		# discover_province = 1530
		# discover_province = 1529
		# discover_province = 1528
		# discover_province = 747
		# discover_province = 2890
		# discover_province = 748
		# discover_province = 2927
		# discover_province = 2886
		# discover_province = 751
		# discover_province = 753
		# discover_province = 749
		# discover_province = 2938
	# }
}

nhs_set_por_colonial_capital = {
	set_global_flag = nhs_treaty_of_lantanopolis
	custom_tooltip = nhs_por_loses_claims_in_na_por_perspective_tt
	custom_tooltip = nhs_lose_claims_in_sa_por_perspective_tt
	hidden_effect = {
		every_province = {
			limit = {
				continent = south_america
				OR = {
					is_claim = FROM
					is_permanent_claim = FROM
					any_country = {
						is_subject_of = FROM
						OR = {
							is_claim = PREV
							PREV = {
								is_permanent_claim = PREV 
							}
						}
					}
				}
			}
			remove_claim = FROM
		}
		FROM = {
			every_subject_country = {
				every_province = {
					limit = {
						continent = south_america
						OR = {
							is_claim = PREV
							is_permanent_claim = PREV 
						}
					}
					remove_claim = PREV
				}
				every_subject_country = {
					limit = {
						any_province = {
							continent = south_america
							OR = {
								is_claim = PREV
								is_permanent_claim = PREV 
							}
						}
					}
					every_province = {
						limit = {
							continent = south_america
							OR = {
								is_claim = PREV
								is_permanent_claim = PREV 
							}
						}
						remove_claim = PREV
					}
				}
			}
		}
		every_province = {
			limit = {
				continent = north_america
				OR = {
					is_claim = ROOT
					is_permanent_claim = ROOT
				}
			}
			remove_claim = ROOT
		}
		every_subject_country = {
			every_province = {
				limit = {
					continent = north_america
					OR = {
						is_claim = PREV
						is_permanent_claim = PREV 
					}
				}
				remove_claim = PREV
			}
			every_subject_country = {
				limit = {
					any_province = {
						continent = north_america
						OR = {
							is_claim = PREV
							is_permanent_claim = PREV 
						}
					}
				}
				every_province = {
					limit = {
						continent = north_america
						OR = {
							is_claim = PREV
							is_permanent_claim = PREV 
						}
					}
					remove_claim = PREV
				}
			}
		}
	}
	if = {
		limit = {
			has_dlc = "Golden Century"
			has_mission = gc_por_caribbean
		}
		custom_tooltip = to_disable_gc_por_caribbean_mission_tt
	}
	add_country_modifier = {
		name = nhs2_treaty_of_lantanopolis_por
		duration = -1
	}
	hidden_effect = {
		if = {
			limit = {
				has_dlc = "Golden Century"
				has_mission = gc_por_caribbean
			}
			swap_non_generic_missions = yes
		}
	}
	if = {
		limit = {
			$TARGET_PROVINCE$ = {
				is_empty = yes
			}
		}
		$TARGET_PROVINCE$ = {
			# tooltip = {
			# 	create_colony = 1000
			# }
			cede_province = ROOT
			add_core = ROOT
			change_culture = ROOT
			change_religion = ROOT
		}
	}
	else_if = {
		limit = {
			$TARGET_PROVINCE$ = {
				NOT = {
					owner = {
						OR = {
							tag = ROOT
							AND = {
								is_colonial_nation = yes
								colonial_parent = {
									tag = POR
								}
							}
						}
					}
				}
			}
		}
		$TARGET_PROVINCE$ = {
			cede_province = ROOT
			add_core = ROOT
			change_culture = ROOT
			change_religion = ROOT
		}
	}
	nhs_cede_elysian_brazilian_settlements = { RECIPIENT = ROOT }
	if = {
		limit = {
			any_province = {
				continent = north_america
				OR = {
					owned_by = POR
					owner = {
						AND = {
							is_colonial_nation = yes
							colonial_parent = {
								tag = POR
							}
						}
					}
				}
			}
		}
		custom_tooltip = nhs_fate_of_o_settlements_tt #Our current settlements will be relocated to SA
		hidden_effect = {
			nhs_move_por_settlements = yes
		}
	}
}

to_rome_breaks_port_deal = {
	set_country_flag = to_show_advanced_economic_reforms
	set_country_flag = to_portuguese_deal_broken_recently

	clr_global_flag = nhs_treaty_of_lantanopolis
	clr_global_flag = to_portugal_hates_colonizers
	remove_country_modifier = nhs2_ely_por_trade
	if = {
		limit = {
			has_country_flag = nhs_has_large_por_enclave
		}
		add_stability = -2
		add_country_modifier = {
			name = to_broken_port_trade_deal_major
			duration = 5475
		}
	}
	else_if = {
		limit = {
			has_country_flag = nhs_has_por_enclave
		}
		add_stability = -1
	}
	clr_country_flag = nhs_has_small_por_enclave
	clr_country_flag = nhs_has_por_enclave
	clr_country_flag = nhs_has_large_por_enclave
	[[TRIGGER_POLICY_EVENT]
	country_event = { id = nhs2_european_trade_events.14 days = 30 }
	custom_tooltip = nhs_new_line_tt	
	]
	# This convoluded nonsense is due to how code formats in the tooltip. Do try putting the tooltip inside the scope!
	tooltip = {
		random_country = {
			limit = {
				NOT = { tag = PREV }
				has_country_flag = nhs_portugese_secret
			}
			set_country_flag = to_break_por_deal_flag
			if = {
				limit = {
					NOT = { war_with = PREV }
				}
				add_truce_with = PREV
			}
			remove_historical_friend = PREV
			remove_country_modifier = nhs2_por_ely_trade
			remove_country_modifier = nhs2_treaty_of_lantanopolis_por
			if = {
				limit = {
					any_province = {
						has_province_modifier = to_por_gateway_to_elysia
					}
				}
				random_province = {
					limit = {
						has_province_modifier = to_por_gateway_to_elysia
					}
					remove_province_modifier = to_por_gateway_to_elysia
				}
			}
			add_trust = { who = PREV value = -40 }
			custom_tooltip = nhs_por_remove_150_opinion_tt
			reverse_remove_opinion = {
				who = PREV
				modifier = nhs_por_trade_deal
			}
			if = {
				limit = {
					PREV = {
						has_country_flag = nhs_has_large_por_enclave
					}
				}
				add_country_modifier = {
					name = to_broken_port_trade_deal_minor
					duration = 5475
				}
			}
		}
	}
	hidden_effect = {
		random_country = {
			limit = {
				has_country_flag = to_break_por_deal_flag
			}
			clr_country_flag = to_break_por_deal_flag
			#does not work here for some reason
			#add_truce_with = PREV
			remove_historical_friend = PREV
			add_trust = { who = PREV value = -40 }
			add_opinion = {
				who = PREV
				modifier = nhs_broke_the_deals
			}
			remove_opinion = {
				who = PREV
				modifier = nhs_por_trade_deal
			}
			# remove_opinion = {
			# 	who = PREV
			# 	modifier = nhs_unchecked_expansion
			# }
		}
	}
	[[REMOVE_ENCLAVES]
		if = {
			limit = {
				any_province = {
					has_province_modifier = nhs2_small_por_enclave
				}
			}
			every_province = {
				limit = {
					has_province_modifier = nhs2_small_por_enclave
				}
				remove_province_modifier = nhs2_small_por_enclave
			}
		}
		if = {
			limit = {
				any_province = {
					has_province_modifier = nhs2_por_enclave
				}
			}
			every_province = {
				limit = {
					has_province_modifier = nhs2_por_enclave
				}
				remove_province_modifier = nhs2_por_enclave
			}
		}
		if = {
			limit = {
				any_province = {
					has_province_modifier = nhs2_large_por_enclave
				}
			}
			every_province = {
				limit = {
					has_province_modifier = nhs2_large_por_enclave
				}
				remove_province_modifier = nhs2_large_por_enclave
			}
		}
	]
}

to_rome_breaks_port_deal_portugal_response = {
	remove_country_modifier = nhs2_por_ely_trade
	remove_country_modifier = nhs2_treaty_of_lantanopolis_por
	if = {
		limit = {
			any_province = {
				has_province_modifier = to_por_gateway_to_elysia
			}
		}
		random_province = {
			limit = {
				has_province_modifier = to_por_gateway_to_elysia
			}
			remove_province_modifier = to_por_gateway_to_elysia
		}
	}
	if = {
		limit = {
			has_country_flag = to_port_trade_deal_penalty
		}
		add_country_modifier = {
			name = to_broken_port_trade_deal_minor
			duration = 5475
		}
	}
	tooltip = {
		if = {
			limit = {
				NOT = { war_with = $OFFENDER_SCOPE$ }
			}
			add_truce_with = $OFFENDER_SCOPE$
		}
		remove_historical_friend = $OFFENDER_SCOPE$
	}
	hidden_effect = {
		$OFFENDER_SCOPE$ = {
			remove_historical_friend = ROOT
		}
	}
	tooltip = {
		add_trust = { who = $OFFENDER_SCOPE$ value = -40 }
	}
	if = {
		limit = {
			has_opinion_modifier = {
				who = $OFFENDER_SCOPE$
				modifier = nhs_por_trade_deal
			}
		}
		remove_opinion = {
			who = $OFFENDER_SCOPE$
			modifier = nhs_por_trade_deal
		}
	}
	custom_tooltip = nhs_por_remove_150_opinion_reverse_tt
	if = {
		limit = {
			has_country_flag = to_port_trade_deal_penalty
		}
		tooltip = {
			$OFFENDER_SCOPE$ = {
				add_stability = -2
				add_country_modifier = {
					name = to_broken_port_trade_deal_major
					duration = 5475
				}
			}
		}
	}
	hidden_effect = {
		clr_country_flag = to_port_trade_deal_penalty
		if = {
			limit = {
				tag = POR
				has_dlc = "Golden Century"
				NOT = { has_mission = gc_por_caribbean }
			}
			swap_non_generic_missions = yes
		}
	}
}

to_rome_port_deal_breaks_down = {
	set_country_flag = to_show_advanced_economic_reforms
	set_country_flag = to_portuguese_deal_broken_recently

	clr_global_flag = nhs_treaty_of_lantanopolis
	clr_global_flag = to_portugal_hates_colonizers
	remove_country_modifier = nhs2_ely_por_trade
	if = {
		limit = {
			has_country_flag = nhs_has_por_enclave
			has_country_flag = nhs_has_large_por_enclave
		}
		add_country_modifier = {
			name = to_broken_port_trade_deal_minor
			duration = 5475
		}
	}
	country_event = { id = nhs2_european_trade_events.14 days = 30 }
	custom_tooltip = nhs_new_line_tt	
	clr_country_flag = nhs_has_por_enclave
	clr_country_flag = nhs_has_large_por_enclave
	clr_country_flag = nhs_has_small_por_enclave
	if = {
		limit = {
			any_province = {
				has_province_modifier = nhs2_small_por_enclave
			}
		}
		every_province = {
			limit = {
				has_province_modifier = nhs2_small_por_enclave
			}
			remove_province_modifier = nhs2_small_por_enclave
		}
	}
	if = {
		limit = {
			any_province = {
				has_province_modifier = nhs2_por_enclave
			}
		}
		every_province = {
			limit = {
				has_province_modifier = nhs2_por_enclave
			}
			remove_province_modifier = nhs2_por_enclave
		}
	}
	if = {
		limit = {
			any_province = {
				has_province_modifier = nhs2_large_por_enclave
			}
		}
		every_province = {
			limit = {
				has_province_modifier = nhs2_large_por_enclave
			}
			remove_province_modifier = nhs2_large_por_enclave
		}
	}
	if = {
		limit = {
			any_province = {
				has_province_modifier = to_por_gateway_to_elysia
			}
		}
		random_province = {
			limit = {
				has_province_modifier = to_por_gateway_to_elysia
			}
			remove_province_modifier = to_por_gateway_to_elysia
		}
	}
}

to_port_breaks_rome_deal = {
	remove_country_modifier = nhs2_por_ely_trade
	remove_country_modifier = nhs2_treaty_of_lantanopolis_por
	clr_global_flag = nhs_treaty_of_lantanopolis
	clr_global_flag = to_portugal_hates_colonizers
	if = {
		limit = {
			any_province = {
				has_province_modifier = to_por_gateway_to_elysia
			}
		}
		random_province = {
			limit = {
				has_province_modifier = to_por_gateway_to_elysia
			}
			remove_province_modifier = to_por_gateway_to_elysia
		}
	}
	if = {
		limit = {
			OR = {
				has_global_flag = to_portugal_hates_colonizers
				has_country_flag = to_port_trade_deal_penalty
			}
		}
		add_stability = -1
		add_country_modifier = {
			name = to_broken_port_trade_deal_major
			duration = 5475
		}
	}
	tooltip = {
		random_country = {
			limit = {
				NOT = { tag = PREV }
				nhs_check_all_elysian_tags = { CONDITION = tag }
			}
			set_country_flag = to_break_por_deal_flag
			if = {
				limit = {
					NOT = { war_with = PREV }
				}
				add_truce_with = PREV
			}
			remove_historical_friend = PREV
			remove_country_modifier = nhs2_ely_por_trade
			add_trust = { who = PREV value = -40 }
			custom_tooltip = nhs_por_remove_150_opinion_tt
			reverse_remove_opinion = {
				who = PREV
				modifier = nhs_por_trade_deal
			}
			if = {
				limit = {
					PREV = {
						OR = {
							has_global_flag = to_portugal_hates_colonizers
							has_country_flag = to_port_trade_deal_penalty
						}
					}
				}
				custom_tooltip = nhs_new_line_tt
				add_stability = -1
				add_country_modifier = {
					name = to_broken_port_trade_deal_minor
					duration = 5475
				}
			}
		}
	}
	hidden_effect = {
		clr_country_flag = to_port_trade_deal_penalty
		random_country = {
			limit = {
				has_country_flag = to_break_por_deal_flag
			}
			clr_country_flag = to_break_por_deal_flag
			remove_historical_friend = PREV
			add_trust = { who = PREV value = -40 }
			add_opinion = {
				who = PREV
				modifier = nhs_broke_the_deals
			}
			remove_opinion = {
				who = PREV
				modifier = nhs_por_trade_deal
			}
		}
		if = {
			limit = {
				tag = POR
				has_dlc = "Golden Century"
				NOT = { has_mission = gc_por_caribbean }
			}
			swap_non_generic_missions = yes
		}
	}
}

to_port_breaks_rome_deal_response = {
	set_country_flag = to_show_advanced_economic_reforms
	set_country_flag = to_portuguese_deal_broken_recently

	remove_country_modifier = nhs2_ely_por_trade
	if = {
		limit = {
			has_country_flag = nhs_has_large_por_enclave
		}
		add_stability = -1
		add_country_modifier = {
			name = to_broken_port_trade_deal_minor
			duration = 5475
		}
	}
	country_event = { id = nhs2_european_trade_events.14 days = 30 }
	custom_tooltip = nhs_new_line_tt	
	clr_country_flag = nhs_has_small_por_enclave
	clr_country_flag = nhs_has_por_enclave
	clr_country_flag = nhs_has_large_por_enclave
	tooltip = {
		if = {
			limit = {
				NOT = { war_with = $OFFENDER_SCOPE$ }
			}
			add_truce_with = $OFFENDER_SCOPE$
		}
		remove_historical_friend = $OFFENDER_SCOPE$
	}
	hidden_effect = {
		$OFFENDER_SCOPE$ = {
			remove_historical_friend = ROOT
		}
	}
	tooltip = {
		add_trust = { who = $OFFENDER_SCOPE$ value = -40 }
	}
	if = {
		limit = {
			has_opinion_modifier = {
				who = $OFFENDER_SCOPE$
				modifier = nhs_por_trade_deal
			}
		}
		remove_opinion = {
			who = $OFFENDER_SCOPE$
			modifier = nhs_por_trade_deal
		}
	}
	custom_tooltip = nhs_por_remove_150_opinion_reverse_tt
	if = {
		limit = {
			has_country_flag = nhs_has_large_por_enclave
		}
		tooltip = {
			$OFFENDER_SCOPE$ = {
				add_stability = -1
				add_country_modifier = {
					name = to_broken_port_trade_deal_major
					duration = 5475
				}
			}
		}
	}
	[[REMOVE_ENCLAVES]
		if = {
			limit = {
				any_province = {
					has_province_modifier = nhs2_small_por_enclave
				}
			}
			every_province = {
				limit = {
					has_province_modifier = nhs2_small_por_enclave
				}
				remove_province_modifier = nhs2_small_por_enclave
			}
		}
		if = {
			limit = {
				any_province = {
					has_province_modifier = nhs2_por_enclave
				}
			}
			every_province = {
				limit = {
					has_province_modifier = nhs2_por_enclave
				}
				remove_province_modifier = nhs2_por_enclave
			}
		}
		if = {
			limit = {
				any_province = {
					has_province_modifier = nhs2_large_por_enclave
				}
			}
			every_province = {
				limit = {
					has_province_modifier = nhs2_large_por_enclave
				}
				remove_province_modifier = nhs2_large_por_enclave
			}
		}
	]
}

to_port_rome_deal_breaks_down = {
	remove_country_modifier = nhs2_por_ely_trade
	remove_country_modifier = nhs2_treaty_of_lantanopolis_por
	clr_global_flag = nhs_treaty_of_lantanopolis
	if = {
		limit = {
			has_global_flag = to_portugal_hates_colonizers
		}
		add_country_modifier = {
			name = to_broken_port_trade_deal_minor
			duration = 5475
		}
	}
	clr_global_flag = to_portugal_hates_colonizers
	if = {
		limit = {
			any_province = {
				has_province_modifier = to_por_gateway_to_elysia
			}
		}
		random_province = {
			limit = {
				has_province_modifier = to_por_gateway_to_elysia
			}
			remove_province_modifier = to_por_gateway_to_elysia
		}
	}
	hidden_effect = {
		if = {
			limit = {
				tag = POR
				has_dlc = "Golden Century"
				NOT = { has_mission = gc_por_caribbean }
			}
			swap_non_generic_missions = yes
		}
	}
}

nhs_add_proper_enclave = {
	owner = { clr_country_flag = nhs_enclave_pending }
	if = {
		limit = {
			owner = { has_country_flag = nhs_has_small_por_enclave }
		}
		add_permanent_province_modifier = {
			name = nhs2_small_por_enclave
			duration = -1
		}
	}
	if = {
		limit = {
			owner = { has_country_flag = nhs_has_por_enclave }
		}
		add_permanent_province_modifier = {
			name = nhs2_por_enclave
			duration = -1
		}
	}
	if = {
		limit = {
			owner = { has_country_flag = nhs_has_large_por_enclave }
		}
		add_permanent_province_modifier = {
			name = nhs2_large_por_enclave
			duration = -1
		}
	}
	if = {
		limit = {
			owner = { to_has_foreign_trade_quarter = yes }
		}
		add_permanent_province_modifier = {
			name = nhs2_european_enclave
			duration = -1
		}
	}
}

to_add_enclave_to_province = {
	# set_province_flag = to_has_enclave
	add_permanent_province_modifier = {
		name = $ENCLAVE_MODIFIER$
		duration = -1
	}
}

to_nhs_spawn_enclave = {
	if = {
		limit = {
			950 = {
				owned_by = ROOT
				NOT = { has_albanian_majority_modifier = yes }
			}
		}
		950 = {
			to_add_enclave_to_province = { ENCLAVE_MODIFIER = $ENCLAVE_MODIFIER$ }
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				OR = {
					province_id = 962
					province_id = 2547
				}
				culture_group = ROOT
				NOT = { has_albanian_majority_modifier = yes }
			}
		}
		random_owned_province = {
			limit = {
				OR = {
					province_id = 962
					province_id = 2547
				}
				culture_group = ROOT
				NOT = { has_albanian_majority_modifier = yes }
			}
			custom_tooltip = nhs_temporary_enclave_tt
			to_add_enclave_to_province = { ENCLAVE_MODIFIER = $ENCLAVE_MODIFIER$ }
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				OR = {
					province_id = 962
					province_id = 2547
				}
				NOT = { has_albanian_majority_modifier = yes }
			}
		}
		random_owned_province = {
			limit = {
				OR = {
					province_id = 962
					province_id = 2547
				}
				NOT = { has_albanian_majority_modifier = yes }
			}
			custom_tooltip = nhs_temporary_enclave_tt
			to_add_enclave_to_province = { ENCLAVE_MODIFIER = $ENCLAVE_MODIFIER$ }
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				OR = {
					area = carolinas_area
					area = new_york_area
				}
				has_port = yes
				culture_group = ROOT
				NOT = { has_albanian_majority_modifier = yes }
			}
		}
		random_owned_province = {
			limit = {
				OR = {
					area = carolinas_area
					area = new_york_area
				}
				has_port = yes
				culture_group = ROOT
				NOT = { has_albanian_majority_modifier = yes }
			}
			custom_tooltip = nhs_temporary_enclave_tt
			to_add_enclave_to_province = { ENCLAVE_MODIFIER = $ENCLAVE_MODIFIER$ }
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				OR = {
					area = carolinas_area
					area = new_york_area
				}
				has_port = yes
				NOT = { has_albanian_majority_modifier = yes }
			}
		}
		random_owned_province = {
			limit = {
				OR = {
					area = carolinas_area
					area = new_york_area
				}
				has_port = yes
				NOT = { has_albanian_majority_modifier = yes }
			}
			custom_tooltip = nhs_temporary_enclave_tt
			to_add_enclave_to_province = { ENCLAVE_MODIFIER = $ENCLAVE_MODIFIER$ }
		}
	}
	else_if = {
		limit = {
			owns = 957
			957 = {
				culture_group = ROOT
				NOT = { has_albanian_majority_modifier = yes }
			}
		}
		957 = {
			custom_tooltip = nhs_temporary_enclave_tt
			to_add_enclave_to_province = { ENCLAVE_MODIFIER = $ENCLAVE_MODIFIER$ }
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				nhs_eligible_for_enclave = yes
				culture_group = ROOT
				nhs_homelands = yes
				is_capital = no
				NOT = { has_albanian_majority_modifier = yes }
			}
		}
		random_owned_province = {
			limit = {
				nhs_eligible_for_enclave = yes
				culture_group = ROOT
				nhs_homelands = yes
				is_capital = no
				NOT = { has_albanian_majority_modifier = yes }
			}
			custom_tooltip = nhs_temporary_enclave_tt
			to_add_enclave_to_province = { ENCLAVE_MODIFIER = $ENCLAVE_MODIFIER$ }
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				nhs_eligible_for_enclave = yes
				culture_group = ROOT
				is_capital = no
				NOT = { has_albanian_majority_modifier = yes }
			}
		}
		random_owned_province = {
			limit = {
				nhs_eligible_for_enclave = yes
				culture_group = ROOT
				NOT = { has_albanian_majority_modifier = yes }
			}
			custom_tooltip = nhs_temporary_enclave_tt
			to_add_enclave_to_province = { ENCLAVE_MODIFIER = $ENCLAVE_MODIFIER$ }
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				nhs_eligible_for_enclave = yes
				culture_group = ROOT
				NOT = { has_albanian_majority_modifier = yes }
			}
		}
		random_owned_province = {
			limit = {
				nhs_eligible_for_enclave = yes
				culture_group = ROOT
				NOT = { has_albanian_majority_modifier = yes }
			}
			custom_tooltip = nhs_temporary_enclave_tt
			to_add_enclave_to_province = { ENCLAVE_MODIFIER = $ENCLAVE_MODIFIER$ }
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				nhs_eligible_for_enclave = yes
				culture_group = ROOT
			}
		}
		random_owned_province = {
			limit = {
				nhs_eligible_for_enclave = yes
				culture_group = ROOT
			}
			custom_tooltip = nhs_temporary_enclave_tt
			to_add_enclave_to_province = { ENCLAVE_MODIFIER = $ENCLAVE_MODIFIER$ }
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				nhs_eligible_for_enclave = yes
			}
		}
		random_owned_province = {
			limit = {
				nhs_eligible_for_enclave = yes
				culture_group = ROOT
			}
			custom_tooltip = nhs_temporary_enclave_tt
			to_add_enclave_to_province = { ENCLAVE_MODIFIER = $ENCLAVE_MODIFIER$ }
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				nhs_eligible_for_enclave_with_canada = yes
				culture_group = ROOT
			}
		}
		random_owned_province = {
			limit = {
				nhs_eligible_for_enclave_with_canada = yes
				culture_group = ROOT
			}
			custom_tooltip = nhs_temporary_enclave_tt
			to_add_enclave_to_province = { ENCLAVE_MODIFIER = $ENCLAVE_MODIFIER$ }
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				nhs_eligible_for_enclave_with_canada = yes
			}
		}
		random_owned_province = {
			limit = {
				nhs_eligible_for_enclave_with_canada = yes
			}
			custom_tooltip = nhs_temporary_enclave_tt
			to_add_enclave_to_province = { ENCLAVE_MODIFIER = $ENCLAVE_MODIFIER$ }
		}
	}
	else = {
		custom_tooltip = nhs_will_get_enclave_later_tt
		set_country_flag = nhs_enclave_pending
	}
}

nhs_move_t_post = {
	if = {
		limit = {
			has_province_modifier = nhs2_european_enclave
		}
		remove_province_modifier = nhs2_european_enclave
		ROOT = {
			to_nhs_spawn_enclave = { ENCLAVE_MODIFIER = nhs2_european_enclave }
		}
	}
	if = {
		limit = {
			has_province_modifier = nhs2_small_por_enclave
		}
		remove_province_modifier = nhs2_small_por_enclave
		ROOT = {
			to_nhs_spawn_enclave = { ENCLAVE_MODIFIER = nhs2_small_por_enclave }
		}
	}
	if = {
		limit = {
			has_province_modifier = nhs2_por_enclave
		}
		remove_province_modifier = nhs2_por_enclave
		ROOT = {
			to_nhs_spawn_enclave = { ENCLAVE_MODIFIER = nhs2_por_enclave }
		}
	}
	if = {
		limit = {
			has_province_modifier = nhs2_large_por_enclave
		}
		remove_province_modifier = nhs2_large_por_enclave
		ROOT = {
			to_nhs_spawn_enclave = { ENCLAVE_MODIFIER = nhs2_large_por_enclave }
		}
	}
}

to_on_enclave_conquered = {
	if = {
		limit = {
			has_province_modifier = nhs2_european_enclave
		}
		remove_province_modifier = nhs2_european_enclave
		if = {
			limit = {
				FROM = {
					to_has_foreign_trade_quarter = yes
				}
			}
			FROM = { country_event = { id = nhs2_european_trade_events.3 } }
		}
	}
}

nhs_heir_age_mm_10_pregen = {
	clr_country_flag = nhs_heir_age_choice_$HT$_1
	clr_country_flag = nhs_heir_age_choice_$HT$_2
	clr_country_flag = nhs_heir_age_choice_$HT$_3
	clr_country_flag = nhs_heir_age_choice_$HT$_4
	clr_country_flag = nhs_heir_age_choice_$HT$_5
	clr_country_flag = nhs_heir_age_choice_$HT$_6
	clr_country_flag = nhs_heir_age_choice_$HT$_7
	clr_country_flag = nhs_heir_age_choice_$HT$_8
	clr_country_flag = nhs_heir_age_choice_$HT$_9
	clr_country_flag = nhs_heir_age_choice_$HT$_10
	random_list = {
		5 = {
			set_country_flag = nhs_heir_age_choice_$HT$_1
		}
		5 = {
			set_country_flag = nhs_heir_age_choice_$HT$_2
		}
		5 = {
			set_country_flag = nhs_heir_age_choice_$HT$_3
		}
		5 = {
			set_country_flag = nhs_heir_age_choice_$HT$_4
		}
		5 = {
			set_country_flag = nhs_heir_age_choice_$HT$_5
		}
		5 = {
			set_country_flag = nhs_heir_age_choice_$HT$_6
		}
		5 = {
			set_country_flag = nhs_heir_age_choice_$HT$_7
		}
		5 = {
			set_country_flag = nhs_heir_age_choice_$HT$_8
		}
		5 = {
			set_country_flag = nhs_heir_age_choice_$HT$_9
		}
		5 = {
			set_country_flag = nhs_heir_age_choice_$HT$_10
		}
	}
}

nhs_heir_age_mm_10 = {
	trigger_switch = {
		on_trigger = has_country_flag 
		nhs_heir_age_choice_$HT$_1 = {
			#add_treasury = $AGE1$0
			define_heir = {
				[[DYNASTY]
					dynasty = $DYNASTY$
				]
				[[NAME]
					name = $NAME$
				]
				age = $AGE1$0
				[[MIN_R_ADM]
					change_adm = $MIN_R_ADM$
				]
				[[MIN_R_DIP]
					change_dip = $MIN_R_DIP$
				]
				[[MIN_R_MIL]
					change_mil = $MIN_R_MIL$
				]
				[[MAX_R_ADM]
					max_random_adm = $MAX_R_ADM$
				]
				[[MAX_R_DIP]
					max_random_dip = $MAX_R_DIP$
				]
				[[MAX_R_MIL]
					max_random_mil = $MAX_R_MIL$
				]
				[[IS_MALE]
					male = yes
				]
				[[IS_FEMALE]
					female = yes
				]
			}
		}
		nhs_heir_age_choice_$HT$_2 = {
			#add_treasury = $AGE1$1
			define_heir = {
				[[DYNASTY]
					dynasty = $DYNASTY$
				]
				[[NAME]
					name = $NAME$
				]
				age = $AGE1$1
				[[MIN_R_ADM]
					change_adm = $MIN_R_ADM$
				]
				[[MIN_R_DIP]
					change_dip = $MIN_R_DIP$
				]
				[[MIN_R_MIL]
					change_mil = $MIN_R_MIL$
				]
				[[MAX_R_ADM]
					max_random_adm = $MAX_R_ADM$
				]
				[[MAX_R_DIP]
					max_random_dip = $MAX_R_DIP$
				]
				[[MAX_R_MIL]
					max_random_mil = $MAX_R_MIL$
				]
				[[IS_MALE]
					male = yes
				]
				[[IS_FEMALE]
					female = yes
				]
			}
		}
		nhs_heir_age_choice_$HT$_3 = {
			#add_treasury = $AGE1$2
			define_heir = {
				[[DYNASTY]
					dynasty = $DYNASTY$
				]
				[[NAME]
					name = $NAME$
				]
				age = $AGE1$2
				[[MIN_R_ADM]
					change_adm = $MIN_R_ADM$
				]
				[[MIN_R_DIP]
					change_dip = $MIN_R_DIP$
				]
				[[MIN_R_MIL]
					change_mil = $MIN_R_MIL$
				]
				[[MAX_R_ADM]
					max_random_adm = $MAX_R_ADM$
				]
				[[MAX_R_DIP]
					max_random_dip = $MAX_R_DIP$
				]
				[[MAX_R_MIL]
					max_random_mil = $MAX_R_MIL$
				]
				[[IS_MALE]
					male = yes
				]
				[[IS_FEMALE]
					female = yes
				]
			}
		}
		nhs_heir_age_choice_$HT$_4 = {
			#add_treasury = $AGE1$3
			define_heir = {
				[[DYNASTY]
					dynasty = $DYNASTY$
				]
				[[NAME]
					name = $NAME$
				]
				age = $AGE1$3
				[[MIN_R_ADM]
					change_adm = $MIN_R_ADM$
				]
				[[MIN_R_DIP]
					change_dip = $MIN_R_DIP$
				]
				[[MIN_R_MIL]
					change_mil = $MIN_R_MIL$
				]
				[[MAX_R_ADM]
					max_random_adm = $MAX_R_ADM$
				]
				[[MAX_R_DIP]
					max_random_dip = $MAX_R_DIP$
				]
				[[MAX_R_MIL]
					max_random_mil = $MAX_R_MIL$
				]
				[[IS_MALE]
					male = yes
				]
				[[IS_FEMALE]
					female = yes
				]
			}
		}
		nhs_heir_age_choice_$HT$_5 = {
			#add_treasury = $AGE1$4
			define_heir = {
				[[DYNASTY]
					dynasty = $DYNASTY$
				]
				[[NAME]
					name = $NAME$
				]
				age = $AGE1$4
				[[MIN_R_ADM]
					change_adm = $MIN_R_ADM$
				]
				[[MIN_R_DIP]
					change_dip = $MIN_R_DIP$
				]
				[[MIN_R_MIL]
					change_mil = $MIN_R_MIL$
				]
				[[MAX_R_ADM]
					max_random_adm = $MAX_R_ADM$
				]
				[[MAX_R_DIP]
					max_random_dip = $MAX_R_DIP$
				]
				[[MAX_R_MIL]
					max_random_mil = $MAX_R_MIL$
				]
				[[IS_MALE]
					male = yes
				]
				[[IS_FEMALE]
					female = yes
				]
			}
		}
		nhs_heir_age_choice_$HT$_6 = {
			#add_treasury = $AGE1$5
			define_heir = {
				[[DYNASTY]
					dynasty = $DYNASTY$
				]
				[[NAME]
					name = $NAME$
				]
				age = $AGE1$5
				[[MIN_R_ADM]
					change_adm = $MIN_R_ADM$
				]
				[[MIN_R_DIP]
					change_dip = $MIN_R_DIP$
				]
				[[MIN_R_MIL]
					change_mil = $MIN_R_MIL$
				]
				[[MAX_R_ADM]
					max_random_adm = $MAX_R_ADM$
				]
				[[MAX_R_DIP]
					max_random_dip = $MAX_R_DIP$
				]
				[[MAX_R_MIL]
					max_random_mil = $MAX_R_MIL$
				]
				[[IS_MALE]
					male = yes
				]
				[[IS_FEMALE]
					female = yes
				]
			}
		}
		nhs_heir_age_choice_$HT$_7 = {
			#add_treasury = $AGE1$6
			define_heir = {
				[[DYNASTY]
					dynasty = $DYNASTY$
				]
				[[NAME]
					name = $NAME$
				]
				age = $AGE1$6
				[[MIN_R_ADM]
					change_adm = $MIN_R_ADM$
				]
				[[MIN_R_DIP]
					change_dip = $MIN_R_DIP$
				]
				[[MIN_R_MIL]
					change_mil = $MIN_R_MIL$
				]
				[[MAX_R_ADM]
					max_random_adm = $MAX_R_ADM$
				]
				[[MAX_R_DIP]
					max_random_dip = $MAX_R_DIP$
				]
				[[MAX_R_MIL]
					max_random_mil = $MAX_R_MIL$
				]
				[[IS_MALE]
					male = yes
				]
				[[IS_FEMALE]
					female = yes
				]
			}
		}
		nhs_heir_age_choice_$HT$_8 = {
			#add_treasury = $AGE1$7
			define_heir = {
				[[DYNASTY]
					dynasty = $DYNASTY$
				]
				[[NAME]
					name = $NAME$
				]
				age = $AGE1$7
				[[MIN_R_ADM]
					change_adm = $MIN_R_ADM$
				]
				[[MIN_R_DIP]
					change_dip = $MIN_R_DIP$
				]
				[[MIN_R_MIL]
					change_mil = $MIN_R_MIL$
				]
				[[MAX_R_ADM]
					max_random_adm = $MAX_R_ADM$
				]
				[[MAX_R_DIP]
					max_random_dip = $MAX_R_DIP$
				]
				[[MAX_R_MIL]
					max_random_mil = $MAX_R_MIL$
				]
				[[IS_MALE]
					male = yes
				]
				[[IS_FEMALE]
					female = yes
				]
			}
		}
		nhs_heir_age_choice_$HT$_9 = {
			#add_treasury = $AGE1$8
			define_heir = {
				[[DYNASTY]
					dynasty = $DYNASTY$
				]
				[[NAME]
					name = $NAME$
				]
				age = $AGE1$8
				[[MIN_R_ADM]
					change_adm = $MIN_R_ADM$
				]
				[[MIN_R_DIP]
					change_dip = $MIN_R_DIP$
				]
				[[MIN_R_MIL]
					change_mil = $MIN_R_MIL$
				]
				[[MAX_R_ADM]
					max_random_adm = $MAX_R_ADM$
				]
				[[MAX_R_DIP]
					max_random_dip = $MAX_R_DIP$
				]
				[[MAX_R_MIL]
					max_random_mil = $MAX_R_MIL$
				]
				[[IS_MALE]
					male = yes
				]
				[[IS_FEMALE]
					female = yes
				]
			}
		}
		nhs_heir_age_choice_$HT$_10 = {
			#add_treasury = $AGE1$9
			define_heir = {
				[[DYNASTY]
					dynasty = $DYNASTY$
				]
				[[NAME]
					name = $NAME$
				]
				age = $AGE1$9
				[[MIN_R_ADM]
					change_adm = $MIN_R_ADM$
				]
				[[MIN_R_DIP]
					change_dip = $MIN_R_DIP$
				]
				[[MIN_R_MIL]
					change_mil = $MIN_R_MIL$
				]
				[[MAX_R_ADM]
					max_random_adm = $MAX_R_ADM$
				]
				[[MAX_R_DIP]
					max_random_dip = $MAX_R_DIP$
				]
				[[MAX_R_MIL]
					max_random_mil = $MAX_R_MIL$
				]
				[[IS_MALE]
					male = yes
				]
				[[IS_FEMALE]
					female = yes
				]
			}
		}
	}
}

nhs_heir_age_mm_20_pregen = {
	clr_country_flag = nhs_heir_age_choice_$HT$_1
	clr_country_flag = nhs_heir_age_choice_$HT$_2
	clr_country_flag = nhs_heir_age_choice_$HT$_3
	clr_country_flag = nhs_heir_age_choice_$HT$_4
	clr_country_flag = nhs_heir_age_choice_$HT$_5
	clr_country_flag = nhs_heir_age_choice_$HT$_6
	clr_country_flag = nhs_heir_age_choice_$HT$_7
	clr_country_flag = nhs_heir_age_choice_$HT$_8
	clr_country_flag = nhs_heir_age_choice_$HT$_9
	clr_country_flag = nhs_heir_age_choice_$HT$_10
	clr_country_flag = nhs_heir_age_choice_$HT$_11
	clr_country_flag = nhs_heir_age_choice_$HT$_12
	clr_country_flag = nhs_heir_age_choice_$HT$_13
	clr_country_flag = nhs_heir_age_choice_$HT$_14
	clr_country_flag = nhs_heir_age_choice_$HT$_15
	clr_country_flag = nhs_heir_age_choice_$HT$_16
	clr_country_flag = nhs_heir_age_choice_$HT$_17
	clr_country_flag = nhs_heir_age_choice_$HT$_18
	clr_country_flag = nhs_heir_age_choice_$HT$_19
	clr_country_flag = nhs_heir_age_choice_$HT$_20
	random_list = {
		5 = {
			set_country_flag = nhs_heir_age_choice_$HT$_1
		}
		5 = {
			set_country_flag = nhs_heir_age_choice_$HT$_2
		}
		5 = {
			set_country_flag = nhs_heir_age_choice_$HT$_3
		}
		5 = {
			set_country_flag = nhs_heir_age_choice_$HT$_4
		}
		5 = {
			set_country_flag = nhs_heir_age_choice_$HT$_5
		}
		5 = {
			set_country_flag = nhs_heir_age_choice_$HT$_6
		}
		5 = {
			set_country_flag = nhs_heir_age_choice_$HT$_7
		}
		5 = {
			set_country_flag = nhs_heir_age_choice_$HT$_8
		}
		5 = {
			set_country_flag = nhs_heir_age_choice_$HT$_9
		}
		5 = {
			set_country_flag = nhs_heir_age_choice_$HT$_10
		}
		5 = {
			set_country_flag = nhs_heir_age_choice_$HT$_11
		}
		5 = {
			set_country_flag = nhs_heir_age_choice_$HT$_12
		}
		5 = {
			set_country_flag = nhs_heir_age_choice_$HT$_13
		}
		5 = {
			set_country_flag = nhs_heir_age_choice_$HT$_14
		}
		5 = {
			set_country_flag = nhs_heir_age_choice_$HT$_15
		}
		5 = {
			set_country_flag = nhs_heir_age_choice_$HT$_16
		}
		5 = {
			set_country_flag = nhs_heir_age_choice_$HT$_17
		}
		5 = {
			set_country_flag = nhs_heir_age_choice_$HT$_18
		}
		5 = {
			set_country_flag = nhs_heir_age_choice_$HT$_19
		}
		5 = {
			set_country_flag = nhs_heir_age_choice_$HT$_20
		}
	}
}

nhs_heir_age_mm_20 = {
	trigger_switch = {
		on_trigger = has_country_flag 
		nhs_heir_age_choice_$HT$_1 = {
			#add_treasury = $AGE1$0
			define_heir = {
				[[DYNASTY]
					dynasty = $DYNASTY$
				]
				[[NAME]
					name = $NAME$
				]
				age = $AGE1$0
				[[MIN_R_ADM]
					change_adm = $MIN_R_ADM$
				]
				[[MIN_R_DIP]
					change_dip = $MIN_R_DIP$
				]
				[[MIN_R_MIL]
					change_mil = $MIN_R_MIL$
				]
				[[MAX_R_ADM]
					max_random_adm = $MAX_R_ADM$
				]
				[[MAX_R_DIP]
					max_random_dip = $MAX_R_DIP$
				]
				[[MAX_R_MIL]
					max_random_mil = $MAX_R_MIL$
				]
				[[IS_MALE]
					male = yes
				]
				[[IS_FEMALE]
					female = yes
				]
			}
		}
		nhs_heir_age_choice_$HT$_2 = {
			#add_treasury = $AGE1$1
			define_heir = {
				[[DYNASTY]
					dynasty = $DYNASTY$
				]
				[[NAME]
					name = $NAME$
				]
				age = $AGE1$1
				[[MIN_R_ADM]
					change_adm = $MIN_R_ADM$
				]
				[[MIN_R_DIP]
					change_dip = $MIN_R_DIP$
				]
				[[MIN_R_MIL]
					change_mil = $MIN_R_MIL$
				]
				[[MAX_R_ADM]
					max_random_adm = $MAX_R_ADM$
				]
				[[MAX_R_DIP]
					max_random_dip = $MAX_R_DIP$
				]
				[[MAX_R_MIL]
					max_random_mil = $MAX_R_MIL$
				]
				[[IS_MALE]
					male = yes
				]
				[[IS_FEMALE]
					female = yes
				]
			}
		}
		nhs_heir_age_choice_$HT$_3 = {
			#add_treasury = $AGE1$2
			define_heir = {
				[[DYNASTY]
					dynasty = $DYNASTY$
				]
				[[NAME]
					name = $NAME$
				]
				age = $AGE1$2
				[[MIN_R_ADM]
					change_adm = $MIN_R_ADM$
				]
				[[MIN_R_DIP]
					change_dip = $MIN_R_DIP$
				]
				[[MIN_R_MIL]
					change_mil = $MIN_R_MIL$
				]
				[[MAX_R_ADM]
					max_random_adm = $MAX_R_ADM$
				]
				[[MAX_R_DIP]
					max_random_dip = $MAX_R_DIP$
				]
				[[MAX_R_MIL]
					max_random_mil = $MAX_R_MIL$
				]
				[[IS_MALE]
					male = yes
				]
				[[IS_FEMALE]
					female = yes
				]
			}
		}
		nhs_heir_age_choice_$HT$_4 = {
			#add_treasury = $AGE1$3
			define_heir = {
				[[DYNASTY]
					dynasty = $DYNASTY$
				]
				[[NAME]
					name = $NAME$
				]
				age = $AGE1$3
				[[MIN_R_ADM]
					change_adm = $MIN_R_ADM$
				]
				[[MIN_R_DIP]
					change_dip = $MIN_R_DIP$
				]
				[[MIN_R_MIL]
					change_mil = $MIN_R_MIL$
				]
				[[MAX_R_ADM]
					max_random_adm = $MAX_R_ADM$
				]
				[[MAX_R_DIP]
					max_random_dip = $MAX_R_DIP$
				]
				[[MAX_R_MIL]
					max_random_mil = $MAX_R_MIL$
				]
				[[IS_MALE]
					male = yes
				]
				[[IS_FEMALE]
					female = yes
				]
			}
		}
		nhs_heir_age_choice_$HT$_5 = {
			#add_treasury = $AGE1$4
			define_heir = {
				[[DYNASTY]
					dynasty = $DYNASTY$
				]
				[[NAME]
					name = $NAME$
				]
				age = $AGE1$4
				[[MIN_R_ADM]
					change_adm = $MIN_R_ADM$
				]
				[[MIN_R_DIP]
					change_dip = $MIN_R_DIP$
				]
				[[MIN_R_MIL]
					change_mil = $MIN_R_MIL$
				]
				[[MAX_R_ADM]
					max_random_adm = $MAX_R_ADM$
				]
				[[MAX_R_DIP]
					max_random_dip = $MAX_R_DIP$
				]
				[[MAX_R_MIL]
					max_random_mil = $MAX_R_MIL$
				]
				[[IS_MALE]
					male = yes
				]
				[[IS_FEMALE]
					female = yes
				]
			}
		}
		nhs_heir_age_choice_$HT$_6 = {
			#add_treasury = $AGE1$5
			define_heir = {
				[[DYNASTY]
					dynasty = $DYNASTY$
				]
				[[NAME]
					name = $NAME$
				]
				age = $AGE1$5
				[[MIN_R_ADM]
					change_adm = $MIN_R_ADM$
				]
				[[MIN_R_DIP]
					change_dip = $MIN_R_DIP$
				]
				[[MIN_R_MIL]
					change_mil = $MIN_R_MIL$
				]
				[[MAX_R_ADM]
					max_random_adm = $MAX_R_ADM$
				]
				[[MAX_R_DIP]
					max_random_dip = $MAX_R_DIP$
				]
				[[MAX_R_MIL]
					max_random_mil = $MAX_R_MIL$
				]
				[[IS_MALE]
					male = yes
				]
				[[IS_FEMALE]
					female = yes
				]
			}
		}
		nhs_heir_age_choice_$HT$_7 = {
			#add_treasury = $AGE1$6
			define_heir = {
				[[DYNASTY]
					dynasty = $DYNASTY$
				]
				[[NAME]
					name = $NAME$
				]
				age = $AGE1$6
				[[MIN_R_ADM]
					change_adm = $MIN_R_ADM$
				]
				[[MIN_R_DIP]
					change_dip = $MIN_R_DIP$
				]
				[[MIN_R_MIL]
					change_mil = $MIN_R_MIL$
				]
				[[MAX_R_ADM]
					max_random_adm = $MAX_R_ADM$
				]
				[[MAX_R_DIP]
					max_random_dip = $MAX_R_DIP$
				]
				[[MAX_R_MIL]
					max_random_mil = $MAX_R_MIL$
				]
				[[IS_MALE]
					male = yes
				]
				[[IS_FEMALE]
					female = yes
				]
			}
		}
		5nhs_heir_age_choice_$HT$_8 = {
			#add_treasury = $AGE1$7
			define_heir = {
				[[DYNASTY]
					dynasty = $DYNASTY$
				]
				[[NAME]
					name = $NAME$
				]
				age = $AGE1$7
				[[MIN_R_ADM]
					change_adm = $MIN_R_ADM$
				]
				[[MIN_R_DIP]
					change_dip = $MIN_R_DIP$
				]
				[[MIN_R_MIL]
					change_mil = $MIN_R_MIL$
				]
				[[MAX_R_ADM]
					max_random_adm = $MAX_R_ADM$
				]
				[[MAX_R_DIP]
					max_random_dip = $MAX_R_DIP$
				]
				[[MAX_R_MIL]
					max_random_mil = $MAX_R_MIL$
				]
				[[IS_MALE]
					male = yes
				]
				[[IS_FEMALE]
					female = yes
				]
			}
		}
		nhs_heir_age_choice_$HT$_9 = {
			#add_treasury = $AGE1$8
			define_heir = {
				[[DYNASTY]
					dynasty = $DYNASTY$
				]
				[[NAME]
					name = $NAME$
				]
				age = $AGE1$8
				[[MIN_R_ADM]
					change_adm = $MIN_R_ADM$
				]
				[[MIN_R_DIP]
					change_dip = $MIN_R_DIP$
				]
				[[MIN_R_MIL]
					change_mil = $MIN_R_MIL$
				]
				[[MAX_R_ADM]
					max_random_adm = $MAX_R_ADM$
				]
				[[MAX_R_DIP]
					max_random_dip = $MAX_R_DIP$
				]
				[[MAX_R_MIL]
					max_random_mil = $MAX_R_MIL$
				]
				[[IS_MALE]
					male = yes
				]
				[[IS_FEMALE]
					female = yes
				]
			}
		}
		nhs_heir_age_choice_$HT$_10 = {
			#add_treasury = $AGE1$9
			define_heir = {
				[[DYNASTY]
					dynasty = $DYNASTY$
				]
				[[NAME]
					name = $NAME$
				]
				age = $AGE1$9
				[[MIN_R_ADM]
					change_adm = $MIN_R_ADM$
				]
				[[MIN_R_DIP]
					change_dip = $MIN_R_DIP$
				]
				[[MIN_R_MIL]
					change_mil = $MIN_R_MIL$
				]
				[[MAX_R_ADM]
					max_random_adm = $MAX_R_ADM$
				]
				[[MAX_R_DIP]
					max_random_dip = $MAX_R_DIP$
				]
				[[MAX_R_MIL]
					max_random_mil = $MAX_R_MIL$
				]
				[[IS_MALE]
					male = yes
				]
				[[IS_FEMALE]
					female = yes
				]
			}
		}
		nhs_heir_age_choice_$HT$_11 = {
			#add_treasury = $AGE2$0
			define_heir = {
				[[DYNASTY]
					dynasty = $DYNASTY$
				]
				[[NAME]
					name = $NAME$
				]
				age = $AGE2$0
				[[MIN_R_ADM]
					change_adm = $MIN_R_ADM$
				]
				[[MIN_R_DIP]
					change_dip = $MIN_R_DIP$
				]
				[[MIN_R_MIL]
					change_mil = $MIN_R_MIL$
				]
				[[MAX_R_ADM]
					max_random_adm = $MAX_R_ADM$
				]
				[[MAX_R_DIP]
					max_random_dip = $MAX_R_DIP$
				]
				[[MAX_R_MIL]
					max_random_mil = $MAX_R_MIL$
				]
				[[IS_MALE]
					male = yes
				]
				[[IS_FEMALE]
					female = yes
				]
			}
		}
		nhs_heir_age_choice_$HT$_12 = {
			#add_treasury = $AGE2$1
			define_heir = {
				[[DYNASTY]
					dynasty = $DYNASTY$
				]
				[[NAME]
					name = $NAME$
				]
				age = $AGE2$1
				[[MIN_R_ADM]
					change_adm = $MIN_R_ADM$
				]
				[[MIN_R_DIP]
					change_dip = $MIN_R_DIP$
				]
				[[MIN_R_MIL]
					change_mil = $MIN_R_MIL$
				]
				[[MAX_R_ADM]
					max_random_adm = $MAX_R_ADM$
				]
				[[MAX_R_DIP]
					max_random_dip = $MAX_R_DIP$
				]
				[[MAX_R_MIL]
					max_random_mil = $MAX_R_MIL$
				]
				[[IS_MALE]
					male = yes
				]
				[[IS_FEMALE]
					female = yes
				]
			}
		}
		nhs_heir_age_choice_$HT$_13 = {
			#add_treasury = $AGE2$2
			define_heir = {
				[[DYNASTY]
					dynasty = $DYNASTY$
				]
				[[NAME]
					name = $NAME$
				]
				age = $AGE2$2
				[[MIN_R_ADM]
					change_adm = $MIN_R_ADM$
				]
				[[MIN_R_DIP]
					change_dip = $MIN_R_DIP$
				]
				[[MIN_R_MIL]
					change_mil = $MIN_R_MIL$
				]
				[[MAX_R_ADM]
					max_random_adm = $MAX_R_ADM$
				]
				[[MAX_R_DIP]
					max_random_dip = $MAX_R_DIP$
				]
				[[MAX_R_MIL]
					max_random_mil = $MAX_R_MIL$
				]
				[[IS_MALE]
					male = yes
				]
				[[IS_FEMALE]
					female = yes
				]
			}
		}
		nhs_heir_age_choice_$HT$_14 = {
			#add_treasury = $AGE2$3
			define_heir = {
				[[DYNASTY]
					dynasty = $DYNASTY$
				]
				[[NAME]
					name = $NAME$
				]
				age = $AGE2$3
				[[MIN_R_ADM]
					change_adm = $MIN_R_ADM$
				]
				[[MIN_R_DIP]
					change_dip = $MIN_R_DIP$
				]
				[[MIN_R_MIL]
					change_mil = $MIN_R_MIL$
				]
				[[MAX_R_ADM]
					max_random_adm = $MAX_R_ADM$
				]
				[[MAX_R_DIP]
					max_random_dip = $MAX_R_DIP$
				]
				[[MAX_R_MIL]
					max_random_mil = $MAX_R_MIL$
				]
				[[IS_MALE]
					male = yes
				]
				[[IS_FEMALE]
					female = yes
				]
			}
		}
		nhs_heir_age_choice_$HT$_15 = {
			#add_treasury = $AGE2$4
			define_heir = {
				[[DYNASTY]
					dynasty = $DYNASTY$
				]
				[[NAME]
					name = $NAME$
				]
				age = $AGE2$4
				[[MIN_R_ADM]
					change_adm = $MIN_R_ADM$
				]
				[[MIN_R_DIP]
					change_dip = $MIN_R_DIP$
				]
				[[MIN_R_MIL]
					change_mil = $MIN_R_MIL$
				]
				[[MAX_R_ADM]
					max_random_adm = $MAX_R_ADM$
				]
				[[MAX_R_DIP]
					max_random_dip = $MAX_R_DIP$
				]
				[[MAX_R_MIL]
					max_random_mil = $MAX_R_MIL$
				]
				[[IS_MALE]
					male = yes
				]
				[[IS_FEMALE]
					female = yes
				]
			}
		}
		nhs_heir_age_choice_$HT$_16 = {
			#add_treasury = $AGE2$5
			define_heir = {
				[[DYNASTY]
					dynasty = $DYNASTY$
				]
				[[NAME]
					name = $NAME$
				]
				age = $AGE2$5
				[[MIN_R_ADM]
					change_adm = $MIN_R_ADM$
				]
				[[MIN_R_DIP]
					change_dip = $MIN_R_DIP$
				]
				[[MIN_R_MIL]
					change_mil = $MIN_R_MIL$
				]
				[[MAX_R_ADM]
					max_random_adm = $MAX_R_ADM$
				]
				[[MAX_R_DIP]
					max_random_dip = $MAX_R_DIP$
				]
				[[MAX_R_MIL]
					max_random_mil = $MAX_R_MIL$
				]
				[[IS_MALE]
					male = yes
				]
				[[IS_FEMALE]
					female = yes
				]
			}
		}
		nhs_heir_age_choice_$HT$_17 = {
			#add_treasury = $AGE2$6
			define_heir = {
				[[DYNASTY]
					dynasty = $DYNASTY$
				]
				[[NAME]
					name = $NAME$
				]
				age = $AGE2$6
				[[MIN_R_ADM]
					change_adm = $MIN_R_ADM$
				]
				[[MIN_R_DIP]
					change_dip = $MIN_R_DIP$
				]
				[[MIN_R_MIL]
					change_mil = $MIN_R_MIL$
				]
				[[MAX_R_ADM]
					max_random_adm = $MAX_R_ADM$
				]
				[[MAX_R_DIP]
					max_random_dip = $MAX_R_DIP$
				]
				[[MAX_R_MIL]
					max_random_mil = $MAX_R_MIL$
				]
				[[IS_MALE]
					male = yes
				]
				[[IS_FEMALE]
					female = yes
				]
			}
		}
		nhs_heir_age_choice_$HT$_18 = {
			#add_treasury = $AGE2$7
			define_heir = {
				[[DYNASTY]
					dynasty = $DYNASTY$
				]
				[[NAME]
					name = $NAME$
				]
				age = $AGE2$7
				[[MIN_R_ADM]
					change_adm = $MIN_R_ADM$
				]
				[[MIN_R_DIP]
					change_dip = $MIN_R_DIP$
				]
				[[MIN_R_MIL]
					change_mil = $MIN_R_MIL$
				]
				[[MAX_R_ADM]
					max_random_adm = $MAX_R_ADM$
				]
				[[MAX_R_DIP]
					max_random_dip = $MAX_R_DIP$
				]
				[[MAX_R_MIL]
					max_random_mil = $MAX_R_MIL$
				]
				[[IS_MALE]
					male = yes
				]
				[[IS_FEMALE]
					female = yes
				]
			}
		}
		nhs_heir_age_choice_$HT$_19 = {
			#add_treasury = $AGE2$8
			define_heir = {
				[[DYNASTY]
					dynasty = $DYNASTY$
				]
				[[NAME]
					name = $NAME$
				]
				age = $AGE2$8
				[[MIN_R_ADM]
					change_adm = $MIN_R_ADM$
				]
				[[MIN_R_DIP]
					change_dip = $MIN_R_DIP$
				]
				[[MIN_R_MIL]
					change_mil = $MIN_R_MIL$
				]
				[[MAX_R_ADM]
					max_random_adm = $MAX_R_ADM$
				]
				[[MAX_R_DIP]
					max_random_dip = $MAX_R_DIP$
				]
				[[MAX_R_MIL]
					max_random_mil = $MAX_R_MIL$
				]
				[[IS_MALE]
					male = yes
				]
				[[IS_FEMALE]
					female = yes
				]
			}
		}
		nhs_heir_age_choice_$HT$_20 = {
			#add_treasury = $AGE2$9
			define_heir = {
				[[DYNASTY]
					dynasty = $DYNASTY$
				]
				[[NAME]
					name = $NAME$
				]
				age = $AGE2$9
				[[MIN_R_ADM]
					change_adm = $MIN_R_ADM$
				]
				[[MIN_R_DIP]
					change_dip = $MIN_R_DIP$
				]
				[[MIN_R_MIL]
					change_mil = $MIN_R_MIL$
				]
				[[MAX_R_ADM]
					max_random_adm = $MAX_R_ADM$
				]
				[[MAX_R_DIP]
					max_random_dip = $MAX_R_DIP$
				]
				[[MAX_R_MIL]
					max_random_mil = $MAX_R_MIL$
				]
				[[IS_MALE]
					male = yes
				]
				[[IS_FEMALE]
					female = yes
				]
			}
		}
	}
}

#nhs_heir_age_mm_20 = {
#	random_list = {
#		5 = {
#			#add_treasury = $AGE1$0
#			define_heir = {
#				[[DYNASTY]
#					dynasty = $DYNASTY$
#				]
#				[[NAME]
#					name = $NAME$
#				]
#				age = $AGE1$0
#				[[MIN_R_ADM]
#					change_adm = $MIN_R_ADM$
#				]
#				[[MIN_R_DIP]
#					change_dip = $MIN_R_DIP$
#				]
#				[[MIN_R_MIL]
#					change_mil = $MIN_R_MIL$
#				]
#				[[MAX_R_ADM]
#					max_random_adm = $MAX_R_ADM$
#				]
#				[[MAX_R_DIP]
#					max_random_dip = $MAX_R_DIP$
#				]
#				[[MAX_R_MIL]
#					max_random_mil = $MAX_R_MIL$
#				]
#				[[IS_MALE]
#					male = yes
#				]
#				[[IS_FEMALE]
#					female = yes
#				]
#			}
#		}
#		5 = {
#			#add_treasury = $AGE1$1
#			define_heir = {
#				[[DYNASTY]
#					dynasty = $DYNASTY$
#				]
#				[[NAME]
#					name = $NAME$
#				]
#				age = $AGE1$1
#				[[MIN_R_ADM]
#					change_adm = $MIN_R_ADM$
#				]
#				[[MIN_R_DIP]
#					change_dip = $MIN_R_DIP$
#				]
#				[[MIN_R_MIL]
#					change_mil = $MIN_R_MIL$
#				]
#				[[MAX_R_ADM]
#					max_random_adm = $MAX_R_ADM$
#				]
#				[[MAX_R_DIP]
#					max_random_dip = $MAX_R_DIP$
#				]
#				[[MAX_R_MIL]
#					max_random_mil = $MAX_R_MIL$
#				]
#				[[IS_MALE]
#					male = yes
#				]
#				[[IS_FEMALE]
#					female = yes
#				]
#			}
#		}
#		5 = {
#			#add_treasury = $AGE1$2
#			define_heir = {
#				[[DYNASTY]
#					dynasty = $DYNASTY$
#				]
#				[[NAME]
#					name = $NAME$
#				]
#				age = $AGE1$2
#				[[MIN_R_ADM]
#					change_adm = $MIN_R_ADM$
#				]
#				[[MIN_R_DIP]
#					change_dip = $MIN_R_DIP$
#				]
#				[[MIN_R_MIL]
#					change_mil = $MIN_R_MIL$
#				]
#				[[MAX_R_ADM]
#					max_random_adm = $MAX_R_ADM$
#				]
#				[[MAX_R_DIP]
#					max_random_dip = $MAX_R_DIP$
#				]
#				[[MAX_R_MIL]
#					max_random_mil = $MAX_R_MIL$
#				]
#				[[IS_MALE]
#					male = yes
#				]
#				[[IS_FEMALE]
#					female = yes
#				]
#			}
#		}
#		5 = {
#			#add_treasury = $AGE1$3
#			define_heir = {
#				[[DYNASTY]
#					dynasty = $DYNASTY$
#				]
#				[[NAME]
#					name = $NAME$
#				]
#				age = $AGE1$3
#				[[MIN_R_ADM]
#					change_adm = $MIN_R_ADM$
#				]
#				[[MIN_R_DIP]
#					change_dip = $MIN_R_DIP$
#				]
#				[[MIN_R_MIL]
#					change_mil = $MIN_R_MIL$
#				]
#				[[MAX_R_ADM]
#					max_random_adm = $MAX_R_ADM$
#				]
#				[[MAX_R_DIP]
#					max_random_dip = $MAX_R_DIP$
#				]
#				[[MAX_R_MIL]
#					max_random_mil = $MAX_R_MIL$
#				]
#				[[IS_MALE]
#					male = yes
#				]
#				[[IS_FEMALE]
#					female = yes
#				]
#			}
#		}
#		5 = {
#			#add_treasury = $AGE1$4
#			define_heir = {
#				[[DYNASTY]
#					dynasty = $DYNASTY$
#				]
#				[[NAME]
#					name = $NAME$
#				]
#				age = $AGE1$4
#				[[MIN_R_ADM]
#					change_adm = $MIN_R_ADM$
#				]
#				[[MIN_R_DIP]
#					change_dip = $MIN_R_DIP$
#				]
#				[[MIN_R_MIL]
#					change_mil = $MIN_R_MIL$
#				]
#				[[MAX_R_ADM]
#					max_random_adm = $MAX_R_ADM$
#				]
#				[[MAX_R_DIP]
#					max_random_dip = $MAX_R_DIP$
#				]
#				[[MAX_R_MIL]
#					max_random_mil = $MAX_R_MIL$
#				]
#				[[IS_MALE]
#					male = yes
#				]
#				[[IS_FEMALE]
#					female = yes
#				]
#			}
#		}
#		5 = {
#			#add_treasury = $AGE1$5
#			define_heir = {
#				[[DYNASTY]
#					dynasty = $DYNASTY$
#				]
#				[[NAME]
#					name = $NAME$
#				]
#				age = $AGE1$5
#				[[MIN_R_ADM]
#					change_adm = $MIN_R_ADM$
#				]
#				[[MIN_R_DIP]
#					change_dip = $MIN_R_DIP$
#				]
#				[[MIN_R_MIL]
#					change_mil = $MIN_R_MIL$
#				]
#				[[MAX_R_ADM]
#					max_random_adm = $MAX_R_ADM$
#				]
#				[[MAX_R_DIP]
#					max_random_dip = $MAX_R_DIP$
#				]
#				[[MAX_R_MIL]
#					max_random_mil = $MAX_R_MIL$
#				]
#				[[IS_MALE]
#					male = yes
#				]
#				[[IS_FEMALE]
#					female = yes
#				]
#			}
#		}
#		5 = {
#			#add_treasury = $AGE1$6
#			define_heir = {
#				[[DYNASTY]
#					dynasty = $DYNASTY$
#				]
#				[[NAME]
#					name = $NAME$
#				]
#				age = $AGE1$6
#				[[MIN_R_ADM]
#					change_adm = $MIN_R_ADM$
#				]
#				[[MIN_R_DIP]
#					change_dip = $MIN_R_DIP$
#				]
#				[[MIN_R_MIL]
#					change_mil = $MIN_R_MIL$
#				]
#				[[MAX_R_ADM]
#					max_random_adm = $MAX_R_ADM$
#				]
#				[[MAX_R_DIP]
#					max_random_dip = $MAX_R_DIP$
#				]
#				[[MAX_R_MIL]
#					max_random_mil = $MAX_R_MIL$
#				]
#				[[IS_MALE]
#					male = yes
#				]
#				[[IS_FEMALE]
#					female = yes
#				]
#			}
#		}
#		5 = {
#			#add_treasury = $AGE1$7
#			define_heir = {
#				[[DYNASTY]
#					dynasty = $DYNASTY$
#				]
#				[[NAME]
#					name = $NAME$
#				]
#				age = $AGE1$7
#				[[MIN_R_ADM]
#					change_adm = $MIN_R_ADM$
#				]
#				[[MIN_R_DIP]
#					change_dip = $MIN_R_DIP$
#				]
#				[[MIN_R_MIL]
#					change_mil = $MIN_R_MIL$
#				]
#				[[MAX_R_ADM]
#					max_random_adm = $MAX_R_ADM$
#				]
#				[[MAX_R_DIP]
#					max_random_dip = $MAX_R_DIP$
#				]
#				[[MAX_R_MIL]
#					max_random_mil = $MAX_R_MIL$
#				]
#				[[IS_MALE]
#					male = yes
#				]
#				[[IS_FEMALE]
#					female = yes
#				]
#			}
#		}
#		5 = {
#			#add_treasury = $AGE1$8
#			define_heir = {
#				[[DYNASTY]
#					dynasty = $DYNASTY$
#				]
#				[[NAME]
#					name = $NAME$
#				]
#				age = $AGE1$8
#				[[MIN_R_ADM]
#					change_adm = $MIN_R_ADM$
#				]
#				[[MIN_R_DIP]
#					change_dip = $MIN_R_DIP$
#				]
#				[[MIN_R_MIL]
#					change_mil = $MIN_R_MIL$
#				]
#				[[MAX_R_ADM]
#					max_random_adm = $MAX_R_ADM$
#				]
#				[[MAX_R_DIP]
#					max_random_dip = $MAX_R_DIP$
#				]
#				[[MAX_R_MIL]
#					max_random_mil = $MAX_R_MIL$
#				]
#				[[IS_MALE]
#					male = yes
#				]
#				[[IS_FEMALE]
#					female = yes
#				]
#			}
#		}
#		5 = {
#			#add_treasury = $AGE1$9
#			define_heir = {
#				[[DYNASTY]
#					dynasty = $DYNASTY$
#				]
#				[[NAME]
#					name = $NAME$
#				]
#				age = $AGE1$9
#				[[MIN_R_ADM]
#					change_adm = $MIN_R_ADM$
#				]
#				[[MIN_R_DIP]
#					change_dip = $MIN_R_DIP$
#				]
#				[[MIN_R_MIL]
#					change_mil = $MIN_R_MIL$
#				]
#				[[MAX_R_ADM]
#					max_random_adm = $MAX_R_ADM$
#				]
#				[[MAX_R_DIP]
#					max_random_dip = $MAX_R_DIP$
#				]
#				[[MAX_R_MIL]
#					max_random_mil = $MAX_R_MIL$
#				]
#				[[IS_MALE]
#					male = yes
#				]
#				[[IS_FEMALE]
#					female = yes
#				]
#			}
#		}
#		5 = {
#			#add_treasury = $AGE2$0
#			define_heir = {
#				[[DYNASTY]
#					dynasty = $DYNASTY$
#				]
#				[[NAME]
#					name = $NAME$
#				]
#				age = $AGE2$0
#				[[MIN_R_ADM]
#					change_adm = $MIN_R_ADM$
#				]
#				[[MIN_R_DIP]
#					change_dip = $MIN_R_DIP$
#				]
#				[[MIN_R_MIL]
#					change_mil = $MIN_R_MIL$
#				]
#				[[MAX_R_ADM]
#					max_random_adm = $MAX_R_ADM$
#				]
#				[[MAX_R_DIP]
#					max_random_dip = $MAX_R_DIP$
#				]
#				[[MAX_R_MIL]
#					max_random_mil = $MAX_R_MIL$
#				]
#				[[IS_MALE]
#					male = yes
#				]
#				[[IS_FEMALE]
#					female = yes
#				]
#			}
#		}
#		5 = {
#			#add_treasury = $AGE2$1
#			define_heir = {
#				[[DYNASTY]
#					dynasty = $DYNASTY$
#				]
#				[[NAME]
#					name = $NAME$
#				]
#				age = $AGE2$1
#				[[MIN_R_ADM]
#					change_adm = $MIN_R_ADM$
#				]
#				[[MIN_R_DIP]
#					change_dip = $MIN_R_DIP$
#				]
#				[[MIN_R_MIL]
#					change_mil = $MIN_R_MIL$
#				]
#				[[MAX_R_ADM]
#					max_random_adm = $MAX_R_ADM$
#				]
#				[[MAX_R_DIP]
#					max_random_dip = $MAX_R_DIP$
#				]
#				[[MAX_R_MIL]
#					max_random_mil = $MAX_R_MIL$
#				]
#				[[IS_MALE]
#					male = yes
#				]
#				[[IS_FEMALE]
#					female = yes
#				]
#			}
#		}
#		5 = {
#			#add_treasury = $AGE2$2
#			define_heir = {
#				[[DYNASTY]
#					dynasty = $DYNASTY$
#				]
#				[[NAME]
#					name = $NAME$
#				]
#				age = $AGE2$2
#				[[MIN_R_ADM]
#					change_adm = $MIN_R_ADM$
#				]
#				[[MIN_R_DIP]
#					change_dip = $MIN_R_DIP$
#				]
#				[[MIN_R_MIL]
#					change_mil = $MIN_R_MIL$
#				]
#				[[MAX_R_ADM]
#					max_random_adm = $MAX_R_ADM$
#				]
#				[[MAX_R_DIP]
#					max_random_dip = $MAX_R_DIP$
#				]
#				[[MAX_R_MIL]
#					max_random_mil = $MAX_R_MIL$
#				]
#				[[IS_MALE]
#					male = yes
#				]
#				[[IS_FEMALE]
#					female = yes
#				]
#			}
#		}
#		5 = {
#			#add_treasury = $AGE2$3
#			define_heir = {
#				[[DYNASTY]
#					dynasty = $DYNASTY$
#				]
#				[[NAME]
#					name = $NAME$
#				]
#				age = $AGE2$3
#				[[MIN_R_ADM]
#					change_adm = $MIN_R_ADM$
#				]
#				[[MIN_R_DIP]
#					change_dip = $MIN_R_DIP$
#				]
#				[[MIN_R_MIL]
#					change_mil = $MIN_R_MIL$
#				]
#				[[MAX_R_ADM]
#					max_random_adm = $MAX_R_ADM$
#				]
#				[[MAX_R_DIP]
#					max_random_dip = $MAX_R_DIP$
#				]
#				[[MAX_R_MIL]
#					max_random_mil = $MAX_R_MIL$
#				]
#				[[IS_MALE]
#					male = yes
#				]
#				[[IS_FEMALE]
#					female = yes
#				]
#			}
#		}
#		5 = {
#			#add_treasury = $AGE2$4
#			define_heir = {
#				[[DYNASTY]
#					dynasty = $DYNASTY$
#				]
#				[[NAME]
#					name = $NAME$
#				]
#				age = $AGE2$4
#				[[MIN_R_ADM]
#					change_adm = $MIN_R_ADM$
#				]
#				[[MIN_R_DIP]
#					change_dip = $MIN_R_DIP$
#				]
#				[[MIN_R_MIL]
#					change_mil = $MIN_R_MIL$
#				]
#				[[MAX_R_ADM]
#					max_random_adm = $MAX_R_ADM$
#				]
#				[[MAX_R_DIP]
#					max_random_dip = $MAX_R_DIP$
#				]
#				[[MAX_R_MIL]
#					max_random_mil = $MAX_R_MIL$
#				]
#				[[IS_MALE]
#					male = yes
#				]
#				[[IS_FEMALE]
#					female = yes
#				]
#			}
#		}
#		5 = {
#			#add_treasury = $AGE2$5
#			define_heir = {
#				[[DYNASTY]
#					dynasty = $DYNASTY$
#				]
#				[[NAME]
#					name = $NAME$
#				]
#				age = $AGE2$5
#				[[MIN_R_ADM]
#					change_adm = $MIN_R_ADM$
#				]
#				[[MIN_R_DIP]
#					change_dip = $MIN_R_DIP$
#				]
#				[[MIN_R_MIL]
#					change_mil = $MIN_R_MIL$
#				]
#				[[MAX_R_ADM]
#					max_random_adm = $MAX_R_ADM$
#				]
#				[[MAX_R_DIP]
#					max_random_dip = $MAX_R_DIP$
#				]
#				[[MAX_R_MIL]
#					max_random_mil = $MAX_R_MIL$
#				]
#				[[IS_MALE]
#					male = yes
#				]
#				[[IS_FEMALE]
#					female = yes
#				]
#			}
#		}
#		5 = {
#			#add_treasury = $AGE2$6
#			define_heir = {
#				[[DYNASTY]
#					dynasty = $DYNASTY$
#				]
#				[[NAME]
#					name = $NAME$
#				]
#				age = $AGE2$6
#				[[MIN_R_ADM]
#					change_adm = $MIN_R_ADM$
#				]
#				[[MIN_R_DIP]
#					change_dip = $MIN_R_DIP$
#				]
#				[[MIN_R_MIL]
#					change_mil = $MIN_R_MIL$
#				]
#				[[MAX_R_ADM]
#					max_random_adm = $MAX_R_ADM$
#				]
#				[[MAX_R_DIP]
#					max_random_dip = $MAX_R_DIP$
#				]
#				[[MAX_R_MIL]
#					max_random_mil = $MAX_R_MIL$
#				]
#				[[IS_MALE]
#					male = yes
#				]
#				[[IS_FEMALE]
#					female = yes
#				]
#			}
#		}
#		5 = {
#			#add_treasury = $AGE2$7
#			define_heir = {
#				[[DYNASTY]
#					dynasty = $DYNASTY$
#				]
#				[[NAME]
#					name = $NAME$
#				]
#				age = $AGE2$7
#				[[MIN_R_ADM]
#					change_adm = $MIN_R_ADM$
#				]
#				[[MIN_R_DIP]
#					change_dip = $MIN_R_DIP$
#				]
#				[[MIN_R_MIL]
#					change_mil = $MIN_R_MIL$
#				]
#				[[MAX_R_ADM]
#					max_random_adm = $MAX_R_ADM$
#				]
#				[[MAX_R_DIP]
#					max_random_dip = $MAX_R_DIP$
#				]
#				[[MAX_R_MIL]
#					max_random_mil = $MAX_R_MIL$
#				]
#				[[IS_MALE]
#					male = yes
#				]
#				[[IS_FEMALE]
#					female = yes
#				]
#			}
#		}
#		5 = {
#			#add_treasury = $AGE2$8
#			define_heir = {
#				[[DYNASTY]
#					dynasty = $DYNASTY$
#				]
#				[[NAME]
#					name = $NAME$
#				]
#				age = $AGE2$8
#				[[MIN_R_ADM]
#					change_adm = $MIN_R_ADM$
#				]
#				[[MIN_R_DIP]
#					change_dip = $MIN_R_DIP$
#				]
#				[[MIN_R_MIL]
#					change_mil = $MIN_R_MIL$
#				]
#				[[MAX_R_ADM]
#					max_random_adm = $MAX_R_ADM$
#				]
#				[[MAX_R_DIP]
#					max_random_dip = $MAX_R_DIP$
#				]
#				[[MAX_R_MIL]
#					max_random_mil = $MAX_R_MIL$
#				]
#				[[IS_MALE]
#					male = yes
#				]
#				[[IS_FEMALE]
#					female = yes
#				]
#			}
#		}
#		5 = {
#			#add_treasury = $AGE2$9
#			define_heir = {
#				[[DYNASTY]
#					dynasty = $DYNASTY$
#				]
#				[[NAME]
#					name = $NAME$
#				]
#				age = $AGE2$9
#				[[MIN_R_ADM]
#					change_adm = $MIN_R_ADM$
#				]
#				[[MIN_R_DIP]
#					change_dip = $MIN_R_DIP$
#				]
#				[[MIN_R_MIL]
#					change_mil = $MIN_R_MIL$
#				]
#				[[MAX_R_ADM]
#					max_random_adm = $MAX_R_ADM$
#				]
#				[[MAX_R_DIP]
#					max_random_dip = $MAX_R_DIP$
#				]
#				[[MAX_R_MIL]
#					max_random_mil = $MAX_R_MIL$
#				]
#				[[IS_MALE]
#					male = yes
#				]
#				[[IS_FEMALE]
#					female = yes
#				]
#			}
#		}
#	}
#}
#nhs_heir_age_mm_10 = {
#	random_list = {
#		5 = {
#			add_treasury = $AGE1$
#			define_heir = {
#				[[NAME]
#					name = $NAME$
#				]
#				age = $AGE1$
#				[[MIN_R_ADM]
#					change_adm = $MIN_R_ADM$
#				]
#				[[MIN_R_DIP]
#					change_dip = $MIN_R_DIP$
#				]
#				[[MIN_R_MIL]
#					change_mil = $MIN_R_MIL$
#				]
#				[[MAX_R_ADM]
#					max_random_adm = $MAX_R_ADM$
#				]
#				[[MAX_R_DIP]
#					max_random_dip = $MAX_R_DIP$
#				]
#				[[MAX_R_MIL]
#					max_random_mil = $MAX_R_MIL$
#				]
#				[[IS_MALE]
#					male = yes
#				]
#				[[IS_FEMALE]
#					female = yes
#				]
#			}
#		}
#		5 = {
#			add_treasury = $AGE2$
#			define_heir = {
#				[[NAME]
#					name = $NAME$
#				]
#				age = $AGE2$
#				[[MIN_R_ADM]
#					change_adm = $MAX_R_ADM$
#				]
#				[[MIN_R_DIP]
#					change_dip = $MAX_R_DIP$
#				]
#				[[MIN_R_MIL]
#					change_mil = $MAX_R_MIL$
#				]
#				[[MAX_R_ADM]
#					max_random_adm = $MAX_R_ADM$
#				]
#				[[MAX_R_DIP]
#					max_random_dip = $MAX_R_DIP$
#				]
#				[[MAX_R_MIL]
#					max_random_mil = $MAX_R_MIL$
#				]
#				[[IS_MALE]
#					male = yes
#				]
#				[[IS_FEMALE]
#					female = yes
#				]
#			}
#		}
#		5 = {
#			add_treasury = $AGE3$
#			define_heir = {
#				[[NAME]
#					name = $NAME$
#				]
#				age = $AGE3$
#				[[MIN_R_ADM]
#					change_adm = $MAX_R_ADM$
#				]
#				[[MIN_R_DIP]
#					change_dip = $MAX_R_DIP$
#				]
#				[[MIN_R_MIL]
#					change_mil = $MAX_R_MIL$
#				]
#				[[MAX_R_ADM]
#					max_random_adm = $MAX_R_ADM$
#				]
#				[[MAX_R_DIP]
#					max_random_dip = $MAX_R_DIP$
#				]
#				[[MAX_R_MIL]
#					max_random_mil = $MAX_R_MIL$
#				]
#				[[IS_MALE]
#					male = yes
#				]
#				[[IS_FEMALE]
#					female = yes
#				]
#			}
#		}
#		5 = {
#			add_treasury = $AGE4$
#			define_heir = {
#				[[NAME]
#					name = $NAME$
#				]
#				age = $AGE4$
#				[[MIN_R_ADM]
#					change_adm = $MAX_R_ADM$
#				]
#				[[MIN_R_DIP]
#					change_dip = $MAX_R_DIP$
#				]
#				[[MIN_R_MIL]
#					change_mil = $MAX_R_MIL$
#				]
#				[[MAX_R_ADM]
#					max_random_adm = $MAX_R_ADM$
#				]
#				[[MAX_R_DIP]
#					max_random_dip = $MAX_R_DIP$
#				]
#				[[MAX_R_MIL]
#					max_random_mil = $MAX_R_MIL$
#				]
#				[[IS_MALE]
#					male = yes
#				]
#				[[IS_FEMALE]
#					female = yes
#				]
#			}
#		}
#		5 = {
#			add_treasury = $AGE5$
#			define_heir = {
#				[[NAME]
#					name = $NAME$
#				]
#				age = $AGE5$
#				[[MIN_R_ADM]
#					change_adm = $MAX_R_ADM$
#				]
#				[[MIN_R_DIP]
#					change_dip = $MAX_R_DIP$
#				]
#				[[MIN_R_MIL]
#					change_mil = $MAX_R_MIL$
#				]
#				[[MAX_R_ADM]
#					max_random_adm = $MAX_R_ADM$
#				]
#				[[MAX_R_DIP]
#					max_random_dip = $MAX_R_DIP$
#				]
#				[[MAX_R_MIL]
#					max_random_mil = $MAX_R_MIL$
#				]
#				[[IS_MALE]
#					male = yes
#				]
#				[[IS_FEMALE]
#					female = yes
#				]
#			}
#		}
#		5 = {
#			add_treasury = $AGE6$
#			define_heir = {
#				[[NAME]
#					name = $NAME$
#				]
#				age = $AGE6$
#				[[MIN_R_ADM]
#					change_adm = $MAX_R_ADM$
#				]
#				[[MIN_R_DIP]
#					change_dip = $MAX_R_DIP$
#				]
#				[[MIN_R_MIL]
#					change_mil = $MAX_R_MIL$
#				]
#				[[MAX_R_ADM]
#					max_random_adm = $MAX_R_ADM$
#				]
#				[[MAX_R_DIP]
#					max_random_dip = $MAX_R_DIP$
#				]
#				[[MAX_R_MIL]
#					max_random_mil = $MAX_R_MIL$
#				]
#				[[IS_MALE]
#					male = yes
#				]
#				[[IS_FEMALE]
#					female = yes
#				]
#			}
#		}
#		5 = {
#			add_treasury = $AGE7$
#			define_heir = {
#				[[NAME]
#					name = $NAME$
#				]
#				age = $AGE7$
#				[[MIN_R_ADM]
#					change_adm = $MAX_R_ADM$
#				]
#				[[MIN_R_DIP]
#					change_dip = $MAX_R_DIP$
#				]
#				[[MIN_R_MIL]
#					change_mil = $MAX_R_MIL$
#				]
#				[[MAX_R_ADM]
#					max_random_adm = $MAX_R_ADM$
#				]
#				[[MAX_R_DIP]
#					max_random_dip = $MAX_R_DIP$
#				]
#				[[MAX_R_MIL]
#					max_random_mil = $MAX_R_MIL$
#				]
#				[[IS_MALE]
#					male = yes
#				]
#				[[IS_FEMALE]
#					female = yes
#				]
#			}
#		}
#		5 = {
#			add_treasury = $AGE8$
#			define_heir = {
#				[[NAME]
#					name = $NAME$
#				]
#				age = $AGE8$
#				[[MIN_R_ADM]
#					change_adm = $MAX_R_ADM$
#				]
#				[[MIN_R_DIP]
#					change_dip = $MAX_R_DIP$
#				]
#				[[MIN_R_MIL]
#					change_mil = $MAX_R_MIL$
#				]
#				[[MAX_R_ADM]
#					max_random_adm = $MAX_R_ADM$
#				]
#				[[MAX_R_DIP]
#					max_random_dip = $MAX_R_DIP$
#				]
#				[[MAX_R_MIL]
#					max_random_mil = $MAX_R_MIL$
#				]
#				[[IS_MALE]
#					male = yes
#				]
#				[[IS_FEMALE]
#					female = yes
#				]
#			}
#		}
#		5 = {
#			add_treasury = $AGE9$
#			define_heir = {
#				[[NAME]
#					name = $NAME$
#				]
#				age = $AGE9$
#				[[MIN_R_ADM]
#					change_adm = $MAX_R_ADM$
#				]
#				[[MIN_R_DIP]
#					change_dip = $MAX_R_DIP$
#				]
#				[[MIN_R_MIL]
#					change_mil = $MAX_R_MIL$
#				]
#				[[MAX_R_ADM]
#					max_random_adm = $MAX_R_ADM$
#				]
#				[[MAX_R_DIP]
#					max_random_dip = $MAX_R_DIP$
#				]
#				[[MAX_R_MIL]
#					max_random_mil = $MAX_R_MIL$
#				]
#				[[IS_MALE]
#					male = yes
#				]
#				[[IS_FEMALE]
#					female = yes
#				]
#			}
#		}
#		5 = {
#			add_treasury = $AGE10$
#			define_heir = {
#				[[NAME]
#					name = $NAME$
#				]
#				age = $AGE10$
#				[[MIN_R_ADM]
#					change_adm = $MAX_R_ADM$
#				]
#				[[MIN_R_DIP]
#					change_dip = $MAX_R_DIP$
#				]
#				[[MIN_R_MIL]
#					change_mil = $MAX_R_MIL$
#				]
#				[[MAX_R_ADM]
#					max_random_adm = $MAX_R_ADM$
#				]
#				[[MAX_R_DIP]
#					max_random_dip = $MAX_R_DIP$
#				]
#				[[MAX_R_MIL]
#					max_random_mil = $MAX_R_MIL$
#				]
#				[[IS_MALE]
#					male = yes
#				]
#				[[IS_FEMALE]
#					female = yes
#				]
#			}
#		}
#	}
#}

nhs_restore_ruler = {
	ELF = {
		#limit = {
			#ai = yes
			#is_subject = no
			#NOT = {
			##	num_of_unions = 1
			#}
			#NOT = { tag = PAP }
			
		#}
		#exile_ruler_as = { name = nhs_temp_ruler }
		if = {
			limit = {
				has_global_flag = $HEIR_FLAG$
				has_global_flag = $RULER_FLAG$
			}
			set_ruler = $RULER_EXILE$
			set_heir = $HEIR_EXILE$
			#log = "RULER AND HEIR"
			if = {
				limit = {
					ruler_age = 70
				}
				#log = "RULER TOO OLD"
				if = {
					limit = {
						heir_age = 80
					}
					#log = "HEIR TOO OLD"
					ROOT = {
						define_ruler = {
							dynasty = PREV
							claim = 50
							#age = 20
							min_age = 30
							max_age = 40
						}
						if = {
							limit = {
								ruler_age = 60
								has_heir = no
							}
							kill_ruler = yes
							define_heir = {
								dynasty = PREV
								claim = 50
								age = 15
							}
						}
					}
				}
				else = {
					#log = "Ruler 1: [ELF.Monarch.GetName]"
					#log = "Heir 1: [ELF.Heir.GetName]"
					#exile_ruler_as = { name = nhs_temp_exile }
					#log = "Ruler 2: [ELF.Monarch.GetName]"
					#exile_ruler_as = { name = $RULER_EXILE$ }
					exile_heir_as = $HEIR_EXILE$
					#log = "Ruler 3: [ELF.Monarch.GetName]"
					#log = "Heir 3: [ELF.Heir.GetName]"
					ROOT = {
						define_ruler = {
							name = "(Interregnum)"
							adm = 3
							dip = 3
							mil = 1
							regency = yes
						}
						set_heir = $HEIR_EXILE$
						add_legitimacy = 100
						add_legitimacy = -20
						if = {
							limit = {
								heir_age = 60
							}
							kill_ruler = yes
							if = {
								limit = {
									has_heir = no
								}
								define_heir = {
									dynasty = PREV
									claim = 50
									age = 15
								}
							}
						}
					}
				}
			}
			else = {
				if = {
					limit = {
						heir_age = 70
					}
					#log = "HEIR TOO OLD"
					exile_ruler_as = { name = $RULER_EXILE$ }
					ROOT = {
						set_ruler = $RULER_EXILE$
						if = {
							limit = {
								ruler_age = 50
								has_heir = no
							}
							define_heir = {
								dynasty = PREV
								claim = 50
								age = 15
							}
						}
					}
				}
				else = {
					exile_heir_as = $HEIR_EXILE$
					exile_ruler_as = { name = $RULER_EXILE$ }
					ROOT = {
						set_heir = $HEIR_EXILE$
						set_ruler = $RULER_EXILE$
						add_legitimacy = 100
						add_legitimacy = -20
					}
				}
			}
		}
		else_if = {
			limit = {
				has_global_flag = $HEIR_FLAG$
				NOT = { has_global_flag = $RULER_FLAG$ }
			}
			#log = "HEIR"
			set_heir = $HEIR_EXILE$
			#log = "Ruler 1: [ELF.Monarch.GetName]"
			#log = "Heir 1: [ELF.Heir.GetName]"
			#kill_ruler = yes
			#log = "Ruler 1: [ELF.Monarch.GetName]"
			#log = "Heir 1: [ELF.Heir.GetName]"
			if = {
				limit = {
					heir_age = 80
				}
				#log = "RULER TOO OLD"
				ROOT = {
					define_ruler = {
						dynasty = PREV
						claim = 50
						age = 21
					}
				}
			}
			else = {
				exile_heir_as = $HEIR_EXILE$
				ROOT = {
					define_ruler = {
						name = "(Interregnum)"
						adm = 3
						dip = 3
						mil = 1
						regency = yes
					}
					set_heir = $HEIR_EXILE$
					add_legitimacy = 100
					add_legitimacy = -20
					if = {
						limit = {
							heir_age = 60
						}
						kill_ruler = yes
						if = {
							limit = {
								has_heir = no
							}
							define_heir = {
								dynasty = PREV
								claim = 50
								age = 15
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				NOT = { has_global_flag = $HEIR_FLAG$ }
				has_global_flag = $RULER_FLAG$
			}
			#log = "RULER"
			set_ruler = $RULER_EXILE$
			if = {
				limit = {
					ruler_age = 80
				}
				log = "RULER TOO OLD"
				ROOT = {
					define_ruler = {
						dynasty = PREV
						claim = 50
						age = 21
					}
				}
			}
			else = {
				exile_ruler_as = { name = $RULER_EXILE$ }
				ROOT = {
					set_ruler = $RULER_EXILE$
					if = {
						limit = {
							ruler_age = 50
							has_heir = no
						}
						define_heir = {
							dynasty = PREV
							claim = 50
							age = 15
						}
					}
				}
			}
		}
		else = {
			ROOT = {
				define_ruler = {
					dynasty = "historic_dynasty"
					claim = 40
					age = 21
				}
			}
		}
		clr_global_flag = $HEIR_FLAG$
		clr_global_flag = $RULER_FLAG$
	}
}

# nhs_assign_names_ely = {
# 	trigger_switch = {
# 		on_trigger = province_id
# 		968 = { rename_capital = "Maiandros"  }
# 		970 = { rename_capital = "Phokaia"  }
# 		2013 = { rename_capital = "Kourion"  }
# 		2561 = { rename_capital = "Polychna"  }
# 		966 = { rename_capital = "Makistos"  }
# 		967 = { rename_capital = "Halaitos"  }
# 		2010 = { rename_capital = "Senithyre"  }
# 		2560 = { rename_capital = "Tanais"  }
# 		2562 = { rename_capital = "Amphissa"  }
# 		963 = { rename_capital = "Gordion"  }
# 		965 = { rename_capital = "Kalydon"  }
# 		2558 = { rename_capital = "Tomis"  }
# 		2639 = { rename_capital = "Chryse"  }
# 		956 = { rename_capital = "Labinion"  }
# 		962 = { rename_capital = "Atlapolis"  }
# 		2023 = { rename_capital = "Rhodan"  }
# 		960 = { rename_capital = "Dyvela"  }
# 		961 = { rename_capital = "Korydalla"  }
# 		964 = { rename_capital = "Klazomenai"  }
# 		2559 = { rename_capital = "Leuktra"  }
# 		954 = { rename_capital = "Thespiai"  }
# 		958 = { rename_capital = "Hykara"  }
# 		959 = { rename_capital = "Ethyphleia"  }
# 		955 = { rename_capital = "Kydonia"  }
# 		2555 = { rename_capital = "Epeion"  }
# 		2556 = { rename_capital = "Agathe"  }
# 		2557 = { rename_capital = "Teichos"  }
# 		949 = { rename_capital = "Aeolis"  }
# 		2011 = { rename_capital = "Pyrgos"  }
# 		2552 = { rename_capital = "Siphai"  }
# 		2553 = { rename_capital = "Doriskos"  }
# 		2549 = { rename_capital = "Alexandroupolis"  }
# 		933 = { rename_capital = "Ambrakia"  }
# 		937 = { rename_capital = "Aperlai"  }
# 		2541 = { rename_capital = "Istros"  }
# 		2545 = { rename_capital = "Kelainai"  }
# 		2544 = { rename_capital = "Argos"  }
# 		938 = { rename_capital = "Tyros"  }
# 		2546 = { rename_capital = "Neauios"  }
# 		2547 = { rename_capital = "Mykene"  }
# 		932 = { rename_capital = "Tiveris"  }
# 		2542 = { rename_capital = "Ephesos"  }
# 		2543 = { rename_capital = "Khlorion"  }
# 		929 = { rename_capital = "Phaleron"  }
# 		2537 = { rename_capital = "Perrhaibia"  }
# 		2539 = { rename_capital = "Kyzikos"  }
# 		930 = { rename_capital = "Lydeia"  }
# 		2538 = { rename_capital = "Limnaia"  }
# 		2540 = { rename_capital = "Vreithon"  }
# 		926 = { rename_capital = "Maionion"  }
# 		2535 = { rename_capital = "Kyaneai"  }
# 		2536 = { rename_capital = "Akatos"  }
# 		4626 = { rename_capital = "Loryma"  }
# 		927 = { rename_capital = "Mara"  }
# 		928 = { rename_capital = "Kestros"  }
# 		2534 = { rename_capital = "Kynares"  }
# 		4625 = { rename_capital = "Pagasa "  }
# 		951 = { rename_capital = "Amelas"  }
# 		2548 = { rename_capital = "Nysreia"  }
# 		2551 = { rename_capital = "Nea Amorion"  }
# 		931 = { rename_capital = "Keryneia"  }
# 		935 = { rename_capital = "Potidaia"  }
# 		936 = { rename_capital = "Perinthos"  }
# 		921 = { rename_capital = "Klousion"  }
# 		922 = { rename_capital = "Stageira"  }
# 		923 = { rename_capital = "Boion"  }
# 		2530 = { rename_capital = "Daskyleion"  }
# 		2533 = { rename_capital = "Limyra"  }
# 		918 = { rename_capital = "Lepreon"  }
# 		919 = { rename_capital = "Myrkinos"  }
# 		939 = { rename_capital = "Soreos"  }
# 		920 = { rename_capital = "Koroneia"  }
# 		2528 = { rename_capital = "Kyme"  }
# 		2529 = { rename_capital = "Nea Dyrrakhion"  }
# 		924 = { rename_capital = "Ioulianos"  }
# 		925 = { rename_capital = "Azoros"  }
# 		2531 = { rename_capital = "Phaselis"  }
# 		2532 = { rename_capital = "Chrysaoris"  }
# 		2527 = { rename_capital = "Medeon"  }
# 		934 = { rename_capital = "Oropos"  }
# 		940 = { rename_capital = "Sardeis"  }
# 		941 = { rename_capital = "Erytheia"  }
# 		2526 = { rename_capital = "Maiotis"  }
# 		946 = { rename_capital = "Astraios"  }
# 		947 = { rename_capital = "Phanagoria"  }
# 		948 = { rename_capital = "Thyateira"  }
# 		2525 = { rename_capital = "Orchomenos"  }
# 		943 = { rename_capital = "Sarachyl"  }
# 		2523 = { rename_capital = "Stratonikeia"  }
# 		2524 = { rename_capital = "Teos"  }
# 		915 = { rename_capital = "Thymbre"  }
# 		942 = { rename_capital = "Sounion"  }
# 		2519 = { rename_capital = "Olynthos"  }
# 		916 = { rename_capital = "Orestias"  }
# 		917 = { rename_capital = "Andronikopolis"  }
# 		2513 = { rename_capital = "Myrina"  }
# 		2520 = { rename_capital = "Himera"  }
# 		944 = { rename_capital = "Anaia"  }
# 		945 = { rename_capital = "Aisymi"  }
# 		2521 = { rename_capital = "Sigeion"  }
# 		2522 = { rename_capital = "Rhosos"  }
# 		910 = { rename_capital = "Mekone"  }
# 		2517 = { rename_capital = "Neokastro"  }
# 		2518 = { rename_capital = "Mendai"  }
# 		911 = { rename_capital = "Pitane"  }
# 		912 = { rename_capital = "Triphylia"  }
# 		913 = { rename_capital = "Philomelion"  }
# 		914 = { rename_capital = "Doliche"  }
# 		894 = { rename_capital = "Metauros"  }
# 		895 = { rename_capital = "Andriake"  }
# 		2014 = { rename_capital = "Atarneus"  }
# 		2516 = { rename_capital = "Stauroupolis"  }
# 		900 = { rename_capital = "Temnos"  }
# 		902 = { rename_capital = "Eirenoupolis"  }
# 		2514 = { rename_capital = "Kolossai"  }
# 		897 = { rename_capital = "Nemea"  }
# 		899 = { rename_capital = "Emathia"  }
# 		2515 = { rename_capital = "Galepsos"  }
# 		890 = { rename_capital = "Mainolos"  }
# 		891 = { rename_capital = "Skamandria"  }
# 		892 = { rename_capital = "Hyele"  }
# 		896 = { rename_capital = "Laodikeia"  }
# 		2509 = { rename_capital = "Tiryns"  }
# 		898 = { rename_capital = "Rhyendre"  }
# 		901 = { rename_capital = "Skotoussa"  }
# 		903 = { rename_capital = "Phthia"  }
# 		2508 = { rename_capital = "Prasia"  }
# 		2672 = { rename_capital = "Kleonai"  }
# 		906 = { rename_capital = "Veronikeia"  }
# 		908 = { rename_capital = "Stente"  }
# 		909 = { rename_capital = "Sagalassos"  }
# 		2007 = { rename_capital = "Demetrias"  }
# 		2512 = { rename_capital = "Thurioi"  }
# 		904 = { rename_capital = "Kolophon"  }
# 		905 = { rename_capital = "Akanthos"  }
# 		907 = { rename_capital = "Phleious"  }
# 		2502 = { rename_capital = "Aulai"  }
# 		2503 = { rename_capital = "Pythion"  }
# 		2510 = { rename_capital = "Tymphaia"  }
# 		2501 = { rename_capital = "Pallantion"  }
# 		1809 = { rename_capital = "Karia"  }
# 		2008 = { rename_capital = "Helike"  }
# 		2009 = { rename_capital = "Eryx"  }
# 		2505 = { rename_capital = "Knidos"  }
# 		882 = { rename_capital = "Heraia"  }
# 		885 = { rename_capital = "Sarpeidion"  }
# 		2496 = { rename_capital = "Antheia"  }
# 		2497 = { rename_capital = "Molossia"  }
# 		4630 = { rename_capital = "Oiniadai"  }
# 		884 = { rename_capital = "Karallia"  }
# 		887 = { rename_capital = "Idrias"  }
# 		888 = { rename_capital = "Phalkon"  }
# 		2665 = { rename_capital = "Miletos"  }
# 		2669 = { rename_capital = "Pella"  }
# 		883 = { rename_capital = "Pergamon"  }
# 		886 = { rename_capital = "Kopais"  }
# 		2500 = { rename_capital = "Sestos"  }
# 		4627 = { rename_capital = "Sylleion"  }
# 		987 = { rename_capital = "Sikyon"  }
# 		989 = { rename_capital = "Blachernai"  }
# 		2585 = { rename_capital = "Cheldia"  }
# 		2670 = { rename_capital = "Myndos"  }
# 		991 = { rename_capital = "Kaikos"  }
# 		1001 = { rename_capital = "Abdera"  }
# 		1007 = { rename_capital = "Melia"  }
# 		2015 = { rename_capital = "Argyre"  }
# 		2593 = { rename_capital = "Kadmeis"  }
# 		988 = { rename_capital = "Gerakioupolis"  }
# 		2586 = { rename_capital = "Nisaia"  }
# 		2587 = { rename_capital = "Azanoi"  }
# 		2671 = { rename_capital = "Rhamnos"  }
# 		1008 = { rename_capital = "Aphidnai"  }
# 		1010 = { rename_capital = "Priene"  }
# 		2016 = { rename_capital = "Pellene"  }
# 		2511 = { rename_capital = "Neo Chalkedon"  }
# 		2596 = { rename_capital = "Daphnai"  }
# 		2597 = { rename_capital = "Okaleia"  }
# 		2598 = { rename_capital = "Dekeleia"  }
# 		2005 = { rename_capital = "Phaistos"  }
# 		861 = { rename_capital = "Rhegion"  }
# 		2619 = { rename_capital = "Kremna"  }
# 		2666 = { rename_capital = "Pessinos"  }
# 		2667 = { rename_capital = "Magydos"  }
# 		4606 = { rename_capital = "Phaiakia"  }
# 		863 = { rename_capital = "Apollonia"  }
# 		864 = { rename_capital = "Ainis"  }
# 		2618 = { rename_capital = "Epiphania"  }
# 		4644 = { rename_capital = "Machara"  }
# 		2498 = { rename_capital = "Dikella"  }
# 		4628 = { rename_capital = "Akraiphia"  }
# 		4629 = { rename_capital = "Parauaia"  }
# 		858 = { rename_capital = "Amyklai"  }
# 		2499 = { rename_capital = "Hysia"  }
# 		2614 = { rename_capital = "Plataia"  }
# 		2668 = { rename_capital = "Troas"  }
# 		484 = { rename_capital = "Tousklon"  }
# 		485 = { rename_capital = "Geilyn"  }
# 		4622 = { rename_capital = "Teukos"  }
# 		4623 = { rename_capital = "Aigiroessa"  }
# 		4624 = { rename_capital = "Kibyra"  }
# 		486 = { rename_capital = "Tartessos"  }
# 		2654 = { rename_capital = "Graivion"  }
# 		2655 = { rename_capital = "Ivros"  }
# 		2656 = { rename_capital = "Messapia"  }
# 		488 = { rename_capital = "Brauron"  }
# 		489 = { rename_capital = "Thyreai"  }
# 		4618 = { rename_capital = "Iapygia"  }
# 		4619 = { rename_capital = "Oisyme"  }
# 		490 = { rename_capital = "Pherai"  }
# 		2658 = { rename_capital = "Megaria"  }
# 		2659 = { rename_capital = "Vetriakon"  }
# 		4620 = { rename_capital = "Scheria"  }
# 		4621 = { rename_capital = "Issos"  }
# 		487 = { rename_capital = "Lerna"  }
# 		491 = { rename_capital = "Xanthos"  }
# 		492 = { rename_capital = "Iolkos"  }
# 		482 = { rename_capital = "Brasiai"  }
# 		483 = { rename_capital = "Antigoneia"  }
# 		493 = { rename_capital = "Skillous"  }
# 		494 = { rename_capital = "Chiloune"  }
# 		495 = { rename_capital = "Pteleon"  }
# 		496 = { rename_capital = "Vareine"  }
# 		1881 = { rename_capital = "Nyssa"  }
# 		497 = { rename_capital = "Diaskourios"  }
# 		498 = { rename_capital = "Ophrynion"  }
# 		499 = { rename_capital = "Anthele"  }
# 		500 = { rename_capital = "Thapsakos"  }
# 		501 = { rename_capital = "Stymphalos"  }
# 		1011 = { rename_capital = "Skala"  }
# 		1009 = { rename_capital = "Askalon"  }
# 		1813 = { rename_capital = "Traianoupolis"  }
# 		2595 = { rename_capital = "Selymbria"  }
# 		889 = { rename_capital = "Kroton"  }
# 		2507 = { rename_capital = "Olpai"  }
# 		2625 = { rename_capital = "Levedos"  }
# 		2600 = { rename_capital = "Euromos"  }
# 		2599 = { rename_capital = "Tauris"  }
# 		2601 = { rename_capital = "Orikon"  }
# 		2004 = { rename_capital = "Borysthenes"  }
# 		2602 = { rename_capital = "Hybla"  }
# 		969 = { rename_capital = "Beryna" }
# 	}
# }


# nhs_assign_names_effect = {
# 	if = {
# 		limit = {
# 			is_empty = no
# 			NOT = { province_id = 953 }
# 		}
# 		if = {
# 			limit = {
# 				NOT = { has_province_flag = nhs_prevent_changing_province_capital }
# 				culture_group = owner
# 				# owner =	{
# 					# culture_group = PREV
# 				# }
# 				OR = {
# 					is_colony = yes
# 					owner = {
# 						OR = {
# 							culture_group = byzantine
# 							primary_culture = apogonoi
# 							AND = {
# 								culture_group = byzantine
# 								NOT = { primary_culture = turkish }
# 							}
# 						}
# 					}
# 				}
# 			}
# 			nhs_assign_names_ely = yes
# 		}
# 	}
# }

nhs_ai_picks_secrets = {
	random_list = {
		10 = {
			set_variable = {
				which = nhs_new_flight_food_status
				value = 4
			}
		}
		30 = {
			set_variable = {
				which = nhs_new_flight_food_status
				value = 3
			}
			random_list = {
				50 = {
					set_country_flag = nhs_new_flight_taken_books
					add_country_modifier = {
						name = "nhs_secrets_books"
						duration = -1
					}
				}
				30 = {
					set_country_flag = nhs_new_flight_taken_silk
					add_country_modifier = {
						name = "nhs_secrets_silk"
						duration = -1
					}
				}
				20 = {
					set_country_flag = nhs_new_flight_taken_venetians
					set_global_flag = nhs_enable_venetian_merchant_estate_g
				}
			}
		}
		50 = {
			set_variable = {
				which = nhs_new_flight_food_status
				value = 2
			}
			random_list = {
				33 = {
					set_country_flag = nhs_new_flight_taken_books
					add_country_modifier = {
						name = "nhs_secrets_books"
						duration = -1
					}
					set_country_flag = nhs_new_flight_taken_silk
					add_country_modifier = {
						name = "nhs_secrets_silk"
						duration = -1
					}
				}
				33 = {
					set_country_flag = nhs_new_flight_taken_books
					add_country_modifier = {
						name = "nhs_secrets_books"
						duration = -1
					}
					set_country_flag = nhs_new_flight_taken_venetians
					set_global_flag = nhs_enable_venetian_merchant_estate_g
				}
				33 = {
					set_country_flag = nhs_new_flight_taken_silk
					add_country_modifier = {
						name = "nhs_secrets_silk"
						duration = -1
					}
					set_country_flag = nhs_new_flight_taken_venetians
					set_global_flag = nhs_enable_venetian_merchant_estate_g
				}
			}
		}
		10 = {
			set_variable = {
				which = nhs_new_flight_food_status
				value = 1
			}
			set_country_flag = nhs_new_flight_taken_books
			add_country_modifier = {
				name = "nhs_secrets_books"
				duration = -1
			}
			set_country_flag = nhs_new_flight_taken_silk
			add_country_modifier = {
				name = "nhs_secrets_silk"
				duration = -1
			}
			set_country_flag = nhs_new_flight_taken_venetians
			set_global_flag = nhs_enable_venetian_merchant_estate_g
		}
	}
}

nhs_settler_boost_on_colony_created = {
	if = {
		limit = {
			owner = {
				has_idea = colonial_administration
			}
			NOT = { has_province_flag = nhs_got_boost }
			NOT = { colonysize = 200 }
			continent = north_america
		}
		set_province_flag = nhs_got_boost
		add_colonysize = 200
	}
}

nhs_remove_fort = {
	if = {
		limit = {
			has_building = fort_15th
		}
		remove_building = fort_15th
	}
	else_if = {
		limit = {
			has_building = fort_16th
		}
		remove_building = fort_16th
	}
	else_if = {
		limit = {
			has_building = fort_17th
		}
		remove_building = fort_17th
	}
	else_if = {
		limit = {
			has_building = fort_18th
		}
		remove_building = fort_18th
	}
}

nhs_highest_dev_province = {
	set_variable = {
		which = nhs_highest_province_dev
		value = 0
	}
	every_owned_province = {
		limit = {
			$PROVINCE_CONDITION$ = yes
		}
		ROOT = {
			export_to_variable = {
				which = nhs_local_dev
				value = development
				who = PREV
			}
		}
		
		[[TRADE_CENTER_BONUS]
			if = {
				limit = {
					province_has_center_of_trade_of_level = 1
				}
				ROOT = {
					change_variable = {            
						which = nhs_local_dev
						value = $TRADE_CENTER_BONUS$
					}
				}
			}
		]
		ROOT = {
			if = {
				limit = {
					check_variable = { 
						which = nhs_local_dev 
						which = nhs_highest_province_dev 
					}
				}
				set_variable = {
					which = nhs_highest_province_dev 
					which = nhs_local_dev 
				}
				PREV = {
					save_event_target_as = $EVENT_TARGET$
				}
			}
		}
	}
}

# PROVINCE - target province, TAG - owner tag
remove_shipyards_in_province = {
	$PROVINCE$ = {
		if = {
			limit = {
				has_building = shipyard
			}
			remove_building = shipyard
		}
		if = {
			limit = {
				has_building = grand_shipyard
			}
			remove_building = grand_shipyard
		}
	}
}

to_ely_province_culture_check = {
	if = {
		limit = {
			culture_group = byzantine
			to_nhs_has_dynamic_elysian_culture = yes
			NOT = { has_albanian_majority_modifier = yes }
		}
		if = {
			limit = {
				owner = {
					has_country_flag = nhs_borealians_appeared_country
				}
				nhs_borealian_province = yes	
			}
			if = {
				limit = {
					NOT = { culture = borealian }
				}
				change_culture = borealian
				[[CHANGE_ORIGINAL_CULTURE]
				change_original_culture = borealian
				]
			}
		}
		else_if = {
			limit = {
				owner = {
					has_country_flag = nhs_hyperborealians_appeared_country
				}
				nhs_hyperborealian_province = yes
			}
			if = {
				limit = {
					NOT = { culture = hyperborealian }
				}
				change_culture = hyperborealian
				[[CHANGE_ORIGINAL_CULTURE]
				change_original_culture = hyperborealian
				]
			}
		}
		else_if = {
			limit = {
				owner = {
					has_country_flag = nhs_hesperidians_appeared_country
				}
				nhs_hesperidian_province = yes
			}
			if = {
				limit = {
					NOT = { culture = hesperidian }
				}
				change_culture = hesperidian
				[[CHANGE_ORIGINAL_CULTURE]
				change_original_culture = hesperidian
				]
			}
		}
		else_if = {
			limit = {
				owner = {
					has_country_flag = nhs_kykladian_appeared_country
				}
				nhs_kykladian_province = yes
			}
			if = {
				limit = {
					NOT = { culture = kykladian }
				}
				change_culture = kykladian
				[[CHANGE_ORIGINAL_CULTURE]
				change_original_culture = kykladian
				]
			}
		}
		else_if = {
			limit = {
				owner = {
					has_country_flag = nhs_elyric_appeared_country
				}
				nhs_elyric_province = yes
			}
			if = {
				limit = {
					NOT = { culture = elyric }
				}
				change_culture = elyric
				[[CHANGE_ORIGINAL_CULTURE]
				change_original_culture = elyric
				]
			}
		}
		else_if = {
			limit = {
				owner = {
					has_country_flag = nhs_arkadians_appeared_country
				}
				nhs_arkadian_province = yes
			}
			if = {
				limit = {
					NOT = { culture = arkadian }
				}
				change_culture = arkadian
				[[CHANGE_ORIGINAL_CULTURE]
				change_original_culture = arkadian
				]
			}
		}
		else_if = {
			limit = {
				owner = {
					has_country_flag = nhs_eleutheroi_appeared_country
				}
				nhs_eleutheroi_province = yes
			}
			if = {
				limit = {
					NOT = { culture = eleutheroi }
				}
				change_culture = eleutheroi
				[[CHANGE_ORIGINAL_CULTURE]
				change_original_culture = eleutheroi
				]
			}
		}
		else_if = {
			limit = {
				OR = {
					region = northeast_america_region
					region = southeast_america_region
				}
			}
			if = {
				limit = {
					NOT = { culture = elysian }
				}
				to_nhs_change_culture_to_romaic_or_elysian = yes
				[[CHANGE_ORIGINAL_CULTURE]
				to_nhs_change_original_culture_to_romaic_or_elysian = yes
				]
			}
		}
		else_if = {
			limit = {
				any_neighbor_province = {
					culture_group = byzantine
					NOT = { culture = elysameric }
					NOT = { culture = shqipproi }
				}
			}
			random_neighbor_province = {
				limit = {
					culture_group = byzantine
					NOT = { culture = elysameric }
					NOT = { culture = shqipproi }
				}
				PREV = {
					if = {
						limit = {
							NOT = { culture = PREV }
						}
						change_culture = PREV
						[[CHANGE_ORIGINAL_CULTURE]
						change_original_culture = PREV
						]
					}
				}
			}
		}
	}
}

to_nhs_change_culture_to_romaic_or_elysian = {
	if = {
		limit = {
			to_nhs_eligible_for_romaic_culture = yes
		}
		if = {
			limit = {
				NOT = { culture = romaic }
			}
			change_culture = romaic
		}
	}
	else_if = {
		limit = {
			NOT = { culture = elysian }
		}
		change_culture = elysian
	}
}

to_nhs_change_original_culture_to_romaic_or_elysian = {
	if = {
		limit = {
			to_nhs_eligible_for_romaic_culture = yes
		}
		change_original_culture = romaic
	}
	else = {
		change_original_culture = elysian
	}
}

to_nhs_assign_correct_elysian_culture = {
	if = {
		limit = {
			owner = {
				NOT = { nhs_post_fragmentation_culturally_elysian = yes }
			}
		}
		custom_tooltip = to_change_culture_to_owner_tt
		hidden_effect = {
			owner = {
				PREV = {
					change_culture = PREV
				}
			}
		}
	}
	else_if = {
		limit = {
			owner = {
				primary_culture = shqipproi
			}
		}
		change_culture = shqipproi
	}
	else_if = {
		limit = {
			owner = {
				has_country_flag = nhs_borealians_appeared_country
			}
			nhs_borealian_province = yes
		}
		change_culture = borealian
	}
	else_if = {
		limit = {
			owner = {
				has_country_flag = nhs_hyperborealians_appeared_country
			}
			nhs_hyperborealian_province = yes
		}
		change_culture = hyperborealian
	}
	else_if = {
		limit = {
			owner = {
				has_country_flag = nhs_hesperidians_appeared_country
			}
			nhs_hesperidian_province = yes
		}
		change_culture = hesperidian
	}
	else_if = {
		limit = {
			owner = {
				has_country_flag = nhs_kykladian_appeared_country
			}
			nhs_kykladian_province = yes
		}
		change_culture = kykladian
	}
	else_if = {
		limit = {
			owner = {
				has_country_flag = nhs_elyric_appeared_country
			}
			nhs_elyric_province = yes
		}
		change_culture = elyric
	}
	else_if = {
		limit = {
			owner = {
				has_country_flag = nhs_arkadians_appeared_country
			}
			nhs_arkadian_province = yes
		}
		change_culture = arkadian
	}
	else_if = {
		limit = {
			owner = {
				has_country_flag = nhs_eleutheroi_appeared_country
			}
			nhs_eleutheroi_province = yes
		}
		change_culture = eleutheroi
	}
	else_if = {
		limit = {
			OR = {
				region = northeast_america_region
				region = southeast_america_region
			}
		}
		to_nhs_change_culture_to_romaic_or_elysian = yes
	}
	# else_if = {
	# 	limit = {
	# 		has_saved_event_target = nhs_countryevents25_neighbor_province_target
	# 		event_target:nhs_countryevents25_neighbor_province_target = {
	# 			culture_group = byzantine
	# 			NOT = { culture = elysameric }
	# 			NOT = { culture = shqipproi }
	# 		}
	# 	}
	# 	change_culture = event_target:nhs_countryevents25_neighbor_province_target
	# }
	else = {
		custom_tooltip = to_change_culture_to_owner_tt
		hidden_effect = {
			owner = {
				PREV = {
					change_culture = PREV
				}
			}
		}
	}
}

to_ely_country_culture_check = {
	if = {
		limit = {
			$FLAG_SCOPE$ = {
				has_country_flag = nhs_borealians_appeared_country
			}
			capital_scope = {
				nhs_borealian_province = yes
			}
		}
		if = {
			limit = {
				NOT = { has_country_flag = nhs_borealians_appeared_country }
			}
			set_country_flag = nhs_borealians_appeared_country
		}
		if = {
			limit = {
				NOT = { primary_culture = borealian }
			}
			to_primary_culture_and_ruler_heir_consort_culture_if_primary = { 
				CULTURE = borealian
				PRIMARY_CULTURE = THIS
			}
		}
	}
	else_if = {
		limit = {
			$FLAG_SCOPE$ = {
				has_country_flag = nhs_hyperborealians_appeared_country
			}
			capital_scope = {
				nhs_hyperborealian_province = yes
			}
		}
		if = {
			limit = {
				NOT = { has_country_flag = nhs_hyperborealians_appeared_country }
			}
			set_country_flag = nhs_hyperborealians_appeared_country
		}
		if = {
			limit = {
				NOT = { primary_culture = hyperborealian }
			}
			to_primary_culture_and_ruler_heir_consort_culture_if_primary = { 
				CULTURE = hyperborealian
				PRIMARY_CULTURE = THIS
			}
		}
	}
	else_if = {
		limit = {
			$FLAG_SCOPE$ = {
				has_country_flag = nhs_hesperidians_appeared_country
			}
			capital_scope = {
				nhs_hesperidian_province = yes
			}
		}
		if = {
			limit = {
				NOT = { has_country_flag = nhs_hesperidians_appeared_country }
			}
			set_country_flag = nhs_hesperidians_appeared_country
		}
		if = {
			limit = {
				NOT = { primary_culture = hesperidian }
			}
			to_primary_culture_and_ruler_heir_consort_culture_if_primary = { 
				CULTURE = hesperidian
				PRIMARY_CULTURE = THIS
			}
		}
	}
	else_if = {
		limit = {
			$FLAG_SCOPE$ = {
				has_country_flag = nhs_kykladian_appeared_country
			}
			capital_scope = {
				nhs_kykladian_province = yes
			}
		}
		if = {
			limit = {
				NOT = { has_country_flag = nhs_kykladian_appeared_country }
			}
			set_country_flag = nhs_kykladian_appeared_country
		}
		if = {
			limit = {
				NOT = { primary_culture = kykladian }
			}
			to_primary_culture_and_ruler_heir_consort_culture_if_primary = { 
				CULTURE = kykladian
				PRIMARY_CULTURE = THIS
			}
		}
	}
	else_if = {
		limit = {
			$FLAG_SCOPE$ = {
				has_country_flag = nhs_elyric_appeared_country
			}
			capital_scope = {
				nhs_elyric_province = yes
			}
		}
		if = {
			limit = {
				NOT = { has_country_flag = nhs_elyric_appeared_country }
			}
			set_country_flag = nhs_elyric_appeared_country
		}
		if = {
			limit = {
				NOT = { primary_culture = elyric }
			}
			to_primary_culture_and_ruler_heir_consort_culture_if_primary = {
				CULTURE = elyric
				PRIMARY_CULTURE = THIS
			}
		}
	}
	else_if = {
		limit = {
			$FLAG_SCOPE$ = {
				has_country_flag = nhs_arkadians_appeared_country
			}
			capital_scope = {
				nhs_arkadian_province = yes
			}
		}
		if = {
			limit = {
				NOT = { has_country_flag = nhs_arkadians_appeared_country }
			}
			set_country_flag = nhs_arkadians_appeared_country
		}
		if = {
			limit = {
				NOT = { primary_culture = arkadian }
			}
			to_primary_culture_and_ruler_heir_consort_culture_if_primary = {
				CULTURE = arkadian
				PRIMARY_CULTURE = THIS
			}
		}
	}
	else_if = {
		limit = {
			$FLAG_SCOPE$ = {
				has_country_flag = nhs_eleutheroi_appeared_country
			}
			capital_scope = {
				nhs_eleutheroi_province = yes
			}
		}
		if = {
			limit = {
				NOT = { has_country_flag = nhs_eleutheroi_appeared_country }
			}
			set_country_flag = nhs_eleutheroi_appeared_country
		}
		if = {
			limit = {
				NOT = { primary_culture = eleutheroi }
			}
			to_primary_culture_and_ruler_heir_consort_culture_if_primary = {
				CULTURE = eleutheroi
				PRIMARY_CULTURE = THIS
			}
		}
	}
	else_if = {
		limit  = {
			capital_scope = {
				OR = {
					region = northeast_america_region
					region = southeast_america_region
				}
			}
		}
		if = {
			limit = {
				NOT = { primary_culture = elysian }
				NOT = { primary_culture = romaic }
			}
			if = {
				limit = {
					NOT = { has_global_flag = nhs_romaic_to_elysian }
				}
				to_primary_culture_and_ruler_heir_consort_culture_if_primary = {
					CULTURE = romaic
					PRIMARY_CULTURE = THIS
				}
			}
			else = {
				to_primary_culture_and_ruler_heir_consort_culture_if_primary = {
					CULTURE = elysian
					PRIMARY_CULTURE = THIS
				}
			}			
		}
	}
	else_if = {
		limit = {
			always = $FLAG_SCOPE_BACKUP$
		}
		if = {
			limit = {
				$FLAG_SCOPE$ = {
					NOT = {
						primary_culture = PREV
					}
				}
			}
			$FLAG_SCOPE$ = {
				PREV = {
					to_primary_culture_and_ruler_heir_consort_culture_if_primary = {
						CULTURE = PREV
						PRIMARY_CULTURE = THIS
					}
				}
			}
		}
	}
	else = {
		if = {
			limit = {
				NOT = { primary_culture = elysian }
				NOT = { primary_culture = romaic }
			}
			if = {
				limit = {
					NOT = { has_global_flag = nhs_romaic_to_elysian }
				}
				to_primary_culture_and_ruler_heir_consort_culture_if_primary = {
					CULTURE = romaic
					PRIMARY_CULTURE = THIS
				}
			}
			else = {
				to_primary_culture_and_ruler_heir_consort_culture_if_primary = {
					CULTURE = elysian
					PRIMARY_CULTURE = THIS
				}
			}			
		}
	}
}

to_ely_province_culture_add_autonomy = {
	if = {
		limit = {
			culture_group = byzantine
			to_nhs_has_dynamic_elysian_culture = yes
			NOT = { has_province_flag = nhs_got_autonomy }
			NOT = { has_albanian_majority_modifier = yes }
		}
		if = {
			limit = {
				culture = borealian
				nhs_borealian_province = yes
				owner = { to_gets_autonomy_borealian = yes }
			}
			set_province_flag = nhs_got_autonomy
			add_local_autonomy = 20
		}
		else_if = {
			limit = {
				culture = hyperborealian
				nhs_hyperborealian_province = yes
				owner = { to_gets_autonomy_hyperborealian = yes }
			}
			set_province_flag = nhs_got_autonomy
			add_local_autonomy = 20
		}
		else_if = {
			limit = {
				culture = hesperidian
				nhs_hesperidian_province = yes
				owner = { to_gets_autonomy_hesperidian = yes }
			}
			set_province_flag = nhs_got_autonomy
			add_local_autonomy = 20
		}
		else_if = {
			limit = {
				culture = kykladian
				nhs_kykladian_province = yes
				owner = { to_gets_autonomy_kykladian = yes }
			}
			set_province_flag = nhs_got_autonomy
			add_local_autonomy = 20
		}
	}
}

# nhs_discover_adjacent = {
# 	if = {
# 		limit = {
# 			owner = {
# 				has_idea_group = new_hellas_ideas
# 			}
# 		}
# 		every_neighbor_province = {
# 			every_country = {
# 				limit = { tag = ROOT }
# 				discover_province = PREV
# 			}
# 		}
# 		every_empty_neighbor_province = {
# 			every_country = {
# 				limit = { tag = ROOT }
# 				discover_province = PREV
# 			}
# 		}
# 	}
# }

nhs_handle_fort_manpower = {
	if = {
		limit = {
			owner = {
				mission_completed = to_establish_militia_mission
			}
		}
		if = {
			limit = {
				has_building = fort_15th
			}
			add_province_modifier = {
				name = nhs_fort_manpower_2
				duration = -1
				hidden = yes
			}
			remove_province_modifier = nhs_fort_manpower_4
			remove_province_modifier = nhs_fort_manpower_6
			remove_province_modifier = nhs_fort_manpower_8
		}
		else_if = {
			limit = {
				has_building = fort_16th
			}
			remove_province_modifier = nhs_fort_manpower_2
			add_province_modifier = {
				name = nhs_fort_manpower_4
				duration = -1
				hidden = yes
			}
			remove_province_modifier = nhs_fort_manpower_6
			remove_province_modifier = nhs_fort_manpower_8
		}
		else_if = {
			limit = {
				has_building = fort_17th
			}
			remove_province_modifier = nhs_fort_manpower_2
			remove_province_modifier = nhs_fort_manpower_4
			add_province_modifier = {
				name = nhs_fort_manpower_6
				duration = -1
				hidden = yes
			}
			remove_province_modifier = nhs_fort_manpower_8
		}
		else_if = {
			limit = {
				has_building = fort_18th
			}
			remove_province_modifier = nhs_fort_manpower_2
			remove_province_modifier = nhs_fort_manpower_4
			remove_province_modifier = nhs_fort_manpower_6
			add_province_modifier = {
				name = nhs_fort_manpower_8
				duration = -1
				hidden = yes
			}
		}
	}
}

# FORT_LEVEL - level of the modifier
nhs_fort_manpower_add_modifier = {
	if = {
		limit = {
			owner = {
				mission_completed = to_establish_militia_mission
			}
		}
		custom_tooltip = nhs_fort_manpower_modifier_$FORT_LEVEL$_tt
		hidden_effect = {
			add_province_modifier = {
				name = nhs_fort_manpower_$FORT_LEVEL$
				duration = -1
				hidden = yes
			}
		}
	}
}

nhs_fort_manpower_remove_all_modifiers = {
	remove_province_modifier = nhs_fort_manpower_2
	remove_province_modifier = nhs_fort_manpower_4
	remove_province_modifier = nhs_fort_manpower_6
	remove_province_modifier = nhs_fort_manpower_8
}

to_ely_true_nation_mission_trigger_reduce = {
	custom_tooltip = nhs_true_nation_mission_trigger_reduce_tt
	hidden_effect = {
		change_variable = {
			which = nhs_early_missions_completed
			value = 1
		}
	}
}

to_nhs_spawn_pre_disaster_hellenic_rebels = {
	if = {
		limit = {
			owner = {
				has_country_flag = hellenic_conversion_preacher
				NOT = { has_disaster = nhs_hcd_hellenic_crisis }
			}
		}
		custom_tooltip = to_nhs_pre_disaster_hellenic_rebels_tt
	}
	spawn_rebels = {
		type = pantheon_worship_rebels
		size = $SIZE$
	}
}

to_death_of_georgios_province_effect = {
	if = {
		limit = {
			has_saved_event_target = to_georgios_funeral_province
			event_target:to_georgios_funeral_province = {
				owned_by = ROOT
				controlled_by = ROOT
			}
		}
		$EFFECT$
	}
	else_if = {
		limit = {
			any_owned_province = {
				is_capital = no
				area_for_scope_province = {
					is_capital = yes
				}
				culture_group = ROOT
				controlled_by = ROOT
			}
		}
		random_owned_province = {
			limit = {
				is_capital = no
				area_for_scope_province = {
					is_capital = yes
				}
				culture_group = ROOT
				controlled_by = ROOT
			}
			$EFFECT$
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				is_capital = no
				culture_group = ROOT
				controlled_by = ROOT
			}
		}
		random_owned_province = {
			limit = {
				is_capital = no
				culture_group = ROOT
				controlled_by = ROOT
			}
			$EFFECT$
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				is_capital = no
				area_for_scope_province = {
					is_capital = yes
				}
				controlled_by = ROOT
			}
		}
		random_owned_province = {
			limit = {
				is_capital = no
				area_for_scope_province = {
					is_capital = yes
				}
				controlled_by = ROOT
			}
			$EFFECT$
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				is_capital = no
				controlled_by = ROOT
			}
		}
		random_owned_province = {
			limit = {
				is_capital = no
				controlled_by = ROOT
			}
			$EFFECT$
		}
	}
	else = {
		capital_scope = {
			$EFFECT$
		}
	}
}

to_nhs_decrease_hellenic_crisis_disaster_progress = {
	add_disaster_progress = {
		disaster = nhs_hcd_hellenic_crisis
		value = -24
	}
}

to_nhs_increase_hellenic_crisis_disaster_progress = {
	add_disaster_progress = {
		disaster = nhs_hcd_hellenic_crisis
		value = 12
	}
}

to_nhs_exempt_all_non_greek_provinces_from_hellenic_disaster = {
	custom_tooltip = to_nhs_exempt_all_non_greek_provinces_from_hellenic_disaster_tt
	hidden_effect = {
		every_owned_province = {
			add_province_triggered_modifier = nhs_hcd_exempt_from_disaster_tm
		}
	}
}

to_nhs_handle_exemption_from_hellenic_disaster = {
	if = {
		limit = {
			is_empty = no
			owner = {
				has_disaster = nhs_hcd_hellenic_crisis
			}
		}
		add_province_triggered_modifier = nhs_hcd_exempt_from_disaster_tm
	}
	else = {
		remove_province_triggered_modifier = nhs_hcd_exempt_from_disaster_tm
	}
}

to_nhs_handle_post_disaster_tolerance_modifier_all_provinces = {
	every_owned_province = {
		to_nhs_handle_post_disaster_tolerance_modifier = yes
	}
}

to_nhs_handle_post_disaster_tolerance_modifier = {
	if = {
		limit = {
			is_empty = no
			owner = {
				OR = {
					has_country_flag = nhs_enable_semi_tolerated_minority
					has_country_flag = nhs_enable_tolerated_minority
				}
				culture_group = PREV
			}
			OR = {
				NOT = {
					OR = {
						culture = greek
						culture = pontic_greek
					}
				}
				owner = {
					OR = {
						primary_culture = greek
						primary_culture = pontic_greek
					}
				}
			}
			OR = {
				AND = {
					religion = pantheon_worship
					owner = {
						OR = {
							religion = orthodox
							religion = elysian_orthodoxy
						}
					}
				}
				AND = {
					religion = orthodox
					owner = {
						OR = {
							religion = pantheon_worship
							religion = aztlan_worship
						}
					}
				}
			}
		}
		if = {
			limit = {
				owner = {
					has_country_flag = nhs_enable_tolerated_minority
				}
			}
			if = {
				limit = {
					religion = pantheon_worship
				}
				add_province_modifier = {
					name = nhs_tolerated_minority
					duration = -1
					desc = "NHS_TOLERANCE_HELLENIC_DESC"
				}
			}
			else = {
				add_province_modifier = {
					name = nhs_tolerated_minority
					duration = -1
					desc = "NHS_TOLERANCE_ORTHODOX_DESC"
				}
			}
		}
		else = {
			if = {
				limit = {
					religion = pantheon_worship
				}
				add_province_modifier = {
					name = nhs_semi_tolerated_minority
					duration = -1
					desc = "NHS_TOLERANCE_HELLENIC_DESC"
				}
			}
			else = {
				add_province_modifier = {
					name = nhs_semi_tolerated_minority
					duration = -1
					desc = "NHS_TOLERANCE_ORTHODOX_DESC"
				}
			}
		}
	}
	else_if = {
		limit = {
			OR = {
				has_province_modifier = nhs_tolerated_minority
				has_province_modifier = nhs_semi_tolerated_minority
			}
		}
		remove_province_modifier = nhs_tolerated_minority
		remove_province_modifier = nhs_semi_tolerated_minority
	}
}

to_nhs_remove_post_disaster_tolerance_modifier_albanians = {
	if = {
		limit = {
			OR = {
				has_province_modifier = nhs_tolerated_minority
				has_province_modifier = nhs_semi_tolerated_minority
			}
		}
		remove_province_modifier = nhs_tolerated_minority
		remove_province_modifier = nhs_semi_tolerated_minority
	}
}

to_nhs_handle_post_disaster_tolerance_modifier_albanians = {
	if = {
		limit = {
			$COUNTRY_SCOPE$ = {
				has_country_flag = nhs_enable_tolerated_minority
				religion = pantheon_worship
				[[CHECK_FLAG]
					has_global_flag = nhs_shqiperi_into_elysian
				]
			}
		}
		add_province_modifier = {
			name = nhs_tolerated_minority
			duration = -1
			desc = "NHS_TOLERANCE_ORTHODOX_DESC"
		}
	}
	else_if = {
		limit = {
			has_province_modifier = nhs_tolerated_minority
		}
		remove_province_modifier = nhs_tolerated_minority
	}
}

to_nhs_handle_post_disaster_tolerance_modifier_culture_integration = {
	if = {
		limit = {
			is_empty = no
			owner = {
				OR = {
					has_country_flag = nhs_enable_semi_tolerated_minority
					has_country_flag = nhs_enable_tolerated_minority
				}
			}
			OR = {
				AND = {
					religion = pantheon_worship
					owner = {
						OR = {
							religion = orthodox
							religion = elysian_orthodoxy
						}
					}
				}
				AND = {
					religion = orthodox
					owner = {
						OR = {
							religion = pantheon_worship
							religion = aztlan_worship
						}
					}
				}
			}
		}
		if = {
			limit = {
				owner = {
					has_country_flag = nhs_enable_tolerated_minority
				}
			}
			if = {
				limit = {
					religion = pantheon_worship
				}
				add_province_modifier = {
					name = nhs_tolerated_minority
					duration = -1
					desc = "NHS_TOLERANCE_HELLENIC_DESC"
				}
			}
			else = {
				add_province_modifier = {
					name = nhs_tolerated_minority
					duration = -1
					desc = "NHS_TOLERANCE_ORTHODOX_DESC"
				}
			}
		}
		else = {
			if = {
				limit = {
					religion = pantheon_worship
				}
				add_province_modifier = {
					name = nhs_semi_tolerated_minority
					duration = -1
					desc = "NHS_TOLERANCE_HELLENIC_DESC"
				}
			}
			else = {
				add_province_modifier = {
					name = nhs_semi_tolerated_minority
					duration = -1
					desc = "NHS_TOLERANCE_ORTHODOX_DESC"
				}
			}
		}
	}
}

to_nhs_remove_pre_hellenic_disaster_country_modifiers = {
	remove_country_modifier = nhs_hcd_hellenic_struggles
	remove_country_modifier = nhs_hcd_hellenic_struggles_legacy
	remove_country_modifier = nhs_hcd_hellenic_struggles_legacy_1
	remove_country_modifier = nhs_hcd_hellenic_struggles_legacy_2
	remove_country_modifier = nhs_hcd_hellenic_struggles_legacy_3
	remove_country_modifier = nhs_hcd_hellenic_coup
	remove_country_modifier = nhs_hcd_hellenic_representation
	remove_country_modifier = nhs_hcd_pagan_concessions
}

to_nhs_remove_pre_hellenic_disaster_anti_hellenic_province_modifiers = {
	if = {
		limit = {
			any_owned_province = {
				has_province_modifier = nhs_hcd_Pagan_taxes
			}
		}
		every_owned_province = {
			limit = {
				has_province_modifier = nhs_hcd_Pagan_taxes
			}
			remove_province_modifier = nhs_hcd_Pagan_taxes
		}
	}
	if = {
		limit = {
			any_owned_province = {
				has_province_modifier = nhs_hcd_Pagan_persecution
			}
		}
		every_owned_province = {
			limit = {
				has_province_modifier = nhs_hcd_Pagan_persecution
			}
			remove_province_modifier = nhs_hcd_Pagan_persecution
		}
	}
}

to_nhs_remove_pre_hellenic_disaster_hellenic_province_modifiers = {
	every_owned_province = {
		limit = {
			has_province_modifier = nhs_hcd_famine_aid
		}
		remove_province_modifier = nhs_hcd_famine_aid
	}
	every_owned_province = {
		limit = {
			has_province_modifier = nhs_hcd_famine_exempt
		}
		remove_province_modifier = nhs_hcd_famine_exempt
	}
}

to_nhs_remove_pre_hellenic_disaster_conflict_province_modifiers = {
	to_nhs_remove_pre_hellenic_disaster_anti_hellenic_province_modifiers = yes
	every_owned_province = {
		limit = {
			has_province_modifier = nhs_hcd_hellenic_conversion_strife
		}
		remove_province_modifier = nhs_hcd_hellenic_conversion_strife
	}
	every_owned_province = {
		limit = {
			has_province_modifier = nhs_hcd_land_dispute
		}
		remove_province_modifier = nhs_hcd_land_dispute
	}
	every_owned_province = {
		limit = {
			has_province_modifier = nhs_hcd_colonial_tensions
		}
		remove_province_modifier = nhs_hcd_colonial_tensions
	}
}

to_nhs_remove_pre_hellenic_disaster_province_modifiers = {
	to_nhs_remove_pre_hellenic_disaster_conflict_province_modifiers = yes
	to_nhs_remove_pre_hellenic_disaster_hellenic_province_modifiers = yes
}

to_nhs_remove_pre_hellenic_disaster_flags = {
	clr_country_flag = hellenic_conversion_preacher
	clr_country_flag = to_had_hellenic_disaster_random_event
	clr_country_flag = to_had_pagan_assemblies_event
	clr_country_flag = to_had_inquisition_event

	clr_country_flag = TO_hcd_picked_major_event
	clr_country_flag = TO_nhs_hellenicconversion_2
	clr_country_flag = TO_nhs_hellenicconversion_3
	clr_country_flag = TO_nhs_hellenicconversion_4
	clr_country_flag = TO_nhs_hellenicconversion_101
	clr_country_flag = TO_nhs_hellenicconversion_102
	clr_country_flag = TO_nhs_hellenicconversion_103
	clr_country_flag = TO_nhs_hellenicconversion_104
	clr_country_flag = TO_nhs_hellenicconversion_105
	clr_country_flag = TO_nhs_hellenicconversion_106
	clr_country_flag = TO_nhs_hellenicconversion_107
	clr_country_flag = TO_nhs_hellenicconversion_21

	clr_country_flag = nhs_had_hellenicconversion_41
	clr_country_flag = nhs_had_hellenicconversion_43
	clr_country_flag = nhs_had_hellenicconversion_44

	clr_country_flag = nhs_had_hellenicconversion_51
	clr_country_flag = nhs_had_hellenicconversion_52
	clr_country_flag = nhs_had_hellenicconversion_53

	clr_country_flag = nhs_pagan_assemblies
	# clr_country_flag = nhs_hcd_opposed_the_inquisition

	clr_country_flag = to_computed_zealous_heir_stats
}

to_trigger_hellenic_disaster_random_event = {
	if = {
		limit = {
			NOT = { is_year = 1468 }
			nhs_check_existing_elysian_tags_with_full_condition = {
				CONDITION = "
				has_country_flag = hellenic_conversion_preacher
				OR = {
					NOT = { has_country_flag = to_had_hellenic_disaster_random_event }
					had_country_flag = {
						flag = to_had_hellenic_disaster_random_event
						days = 650
					}
				}
				"
			}
		}
		nhs_effect_for_existing_elysian_tag = {
			EFFECT = "
				clr_country_flag = to_had_hellenic_disaster_random_event
				set_country_flag = to_had_hellenic_disaster_random_event
				country_event = { 
					id = nhs_hellenicconversion.100
					days = 120
					random = 120
				}
			"
		}
	}
}

to_trigger_pagan_assemblies_event = {
	if = {
		limit = {
			NOT = { is_year = 1468 }
			nhs_check_existing_elysian_tags_with_full_condition = {
				CONDITION = "
				has_country_flag = nhs_pagan_assemblies
				OR = {
					NOT = { has_country_flag = to_had_pagan_assemblies_event }
					had_country_flag = {
						flag = to_had_pagan_assemblies_event
						days = 1000
					}
				}
				"
			}
		}
		random_list = {
			50 = {
				nhs_effect_for_existing_elysian_tag = {
					EFFECT = "
						clr_country_flag = to_had_pagan_assemblies_event
						set_country_flag = to_had_pagan_assemblies_event
						country_event = { 
							id = nhs_hellenicconversion.1000
							days = 1
							random = 120
						}
					"
				}
			}
			50 = {
				nhs_effect_for_existing_elysian_tag = {
					EFFECT = "
						clr_country_flag = to_had_pagan_assemblies_event
						set_country_flag = to_had_pagan_assemblies_event
						country_event = { 
							id = nhs_hellenicconversion.1000
							days = 240
							random = 120
						}
					"
				}
			}
		}
	}
}

to_trigger_inquisition_event = {
	if = {
		limit = {
			NOT = { is_year = 1468 }
			nhs_check_existing_elysian_tags_with_full_condition = {
				CONDITION = "
				to_nhs_hellenic_disaster_eligible_for_inquisition_events = yes
				OR = {
					NOT = { has_country_flag = to_had_inquisition_event }
					had_country_flag = {
						flag = to_had_inquisition_event
						days = 1000
					}
				}
				"
			}
		}
		random_list = {
			50 = {
				nhs_effect_for_existing_elysian_tag = {
					EFFECT = "
						clr_country_flag = to_had_inquisition_event
						set_country_flag = to_had_inquisition_event
						country_event = { 
							id = nhs_hellenicconversion.1001
							days = 1
							random = 120
						}
					"
				}
			}
			50 = {
				nhs_effect_for_existing_elysian_tag = {
					EFFECT = "
						clr_country_flag = to_had_inquisition_event
						set_country_flag = to_had_inquisition_event
						country_event = { 
							id = nhs_hellenicconversion.1001
							days = 240
							random = 120
						}
					"
				}
			}
		}
	}
}

to_nhs_remove_all_clergy_privileges = {
	custom_tooltip = to_nhs_remove_all_clergy_privileges_tt
	hidden_effect = {
		if = {
			limit = {
				has_estate_privilege = estate_church_land_rights
			}
			remove_estate_privilege = estate_church_land_rights
			change_estate_land_share = {
				estate = estate_church
				share = -5
			}
		}
		if = {
			limit = {
				has_estate_privilege = estate_church_religious_state
			}
			remove_estate_privilege = estate_church_religious_state
			change_estate_land_share = {
				estate = estate_church
				share = -10
			}
		}
		if = {
			limit = {
				has_estate_privilege = estate_church_independent_inquisition
			}
			remove_estate_privilege = estate_church_independent_inquisition
		}
		if = {
			limit = {
				has_estate_privilege = estate_church_new_world_mission
			}
			remove_estate_privilege = estate_church_new_world_mission
		}
		if = {
			limit = {
				has_estate_privilege = estate_church_clerical_ministers
			}
			remove_estate_privilege = estate_church_clerical_ministers
		}
		if = {
			limit = {
				has_estate_privilege = estate_church_clerical_oversight
			}
			remove_estate_privilege = estate_church_clerical_oversight
		}
		if = {
			limit = {
				has_estate_privilege = estate_church_enforced_one_faith
			}
			remove_estate_privilege = estate_church_enforced_one_faith
		}
		if = {
			limit = {
				has_estate_privilege = estate_church_administrative_privileges
			}
			remove_estate_privilege = estate_church_administrative_privileges
			change_estate_land_share = {
				estate = estate_church
				share = -5
			}
		}
		if = {
			limit = {
				has_estate_privilege = estate_church_monopoly_of_incense
			}
			remove_estate_privilege = estate_church_monopoly_of_incense
		}
		if = {
			limit = {
				has_estate_privilege = estate_church_monopoly_of_wool
			}
			remove_estate_privilege = estate_church_monopoly_of_wool
		}
		if = {
			limit = {
				has_estate_privilege = estate_church_monopoly_of_wine
			}
			remove_estate_privilege = estate_church_monopoly_of_wine
		}
		if = {
			limit = {
				has_estate_privilege = estate_church_for_the_faith
			}
			remove_estate_privilege = estate_church_for_the_faith
		}
		if = {
			limit = {
				has_estate_privilege = estate_church_statutory_rights
			}
			remove_estate_privilege = estate_church_statutory_rights
		}
		if = {
			limit = {
				has_estate_privilege = estate_church_religious_diplomats
			}
			remove_estate_privilege = estate_church_religious_diplomats
		}
		if = {
			limit = {
				has_estate_privilege = estate_church_one_faith_one_culture
			}
			remove_estate_privilege = estate_church_one_faith_one_culture
			change_estate_land_share = {
				estate = estate_church
				share = -5
			}
		}
		if = {
			limit = {
				has_estate_privilege = estate_church_development_of_temples
			}
			remove_estate_privilege = estate_church_development_of_temples
		}
		if = {
			limit = {
				has_estate_privilege = estate_church_expand_the_theology
			}
			remove_estate_privilege = estate_church_expand_the_theology
		}
		if = {
			limit = {
				has_estate_privilege = estate_church_clerical_education
			}
			remove_estate_privilege = estate_church_clerical_education
		}
		if = {
			limit = {
				has_estate_privilege = estate_church_religious_delegation
			}
			remove_estate_privilege = estate_church_religious_delegation
		}
		if = {
			limit = {
				has_estate_privilege = estate_church_institutionalized_clergy
			}
			remove_estate_privilege = estate_church_institutionalized_clergy
		}
		if = {
			limit = {
				has_estate_privilege = estate_church_donation_right
			}
			remove_estate_privilege = estate_church_donation_right
		}
		if = {
			limit = {
				has_estate_privilege = estate_church_nhs_inquisition_privilege
			}
			remove_estate_privilege = estate_church_nhs_inquisition_privilege
		}

		remove_country_modifier = new_world_missions
	}
}

to_nhs_remove_all_non_tolerant_clergy_privileges = {
	if = {
		limit = {
			has_estate_privilege = estate_church_nhs_inquisition_privilege
		}
		remove_estate_privilege = estate_church_nhs_inquisition_privilege
	}
	if = {
		limit = {
			has_estate_privilege = estate_church_one_faith_one_culture
		}
		remove_estate_privilege = estate_church_one_faith_one_culture
	}
	if = {
		limit = {
			has_estate_privilege = estate_church_enforced_one_faith
		}
		remove_estate_privilege = estate_church_enforced_one_faith
	}
}

nhs_set_clergy_loyalty_to_50 = {
	custom_tooltip = nhs_set_clergy_loyalty_to_50_tt
	hidden_effect = {
		add_estate_loyalty = {
			estate = estate_church
			loyalty = 100
		}
		add_estate_loyalty = {
			estate = estate_church
			loyalty = -50
		}
	}
}

nhs_set_clergy_loyalty_to_80 = {
	custom_tooltip = nhs_set_clergy_loyalty_to_80_tt
	hidden_effect = {
		add_estate_loyalty = {
			estate = estate_church
			loyalty = 100
		}
		add_estate_loyalty = {
			estate = estate_church
			loyalty = -20
		}
	}
}

to_compute_zealous_ruler_heir_stats = {
	if = {
		limit = {
			NOT = { has_country_flag = to_computed_zealous_heir_stats }
		}
		set_country_flag = to_computed_zealous_heir_stats
		export_to_variable = {
			variable_name = to_heir_adm
			value = trigger_value:$SOURCE_ADM$
		}
		export_to_variable = {
			variable_name = to_heir_dip
			value = trigger_value:$SOURCE_DIP$
		}
		export_to_variable = {
			variable_name = to_heir_mil
			value = trigger_value:$SOURCE_MIL$
		}
		set_variable = {
			which = ForLoopCounter
			value = 2
		}	
		while = {
			limit = {
				check_variable = {
					which = ForLoopCounter
					value = 1
				}
			}
			if = {
				limit = {
					check_variable = {
						which = to_heir_dip
						value = 1
					}
				}
				change_variable = {
					which = to_heir_dip
					value = -1
				}
			}
			else_if = {
				limit = {
					check_variable = {
						which = to_heir_mil
						value = 1
					}
				}
				change_variable = {
					which = to_heir_mil
					value = -1
				}
			}
			else_if = {
				limit = {
					check_variable = {
						which = to_heir_adm
						value = 1
					}
				}
				change_variable = {
					which = to_heir_adm
					value = -1
				}
			}
			subtract_variable = {
				which = ForLoopCounter
				value = 1
			}
		}
		if = {
			limit = {
				NOT = {
					check_variable = {
						which = to_heir_mil
						value = 6
					}
				}
			}
			change_variable = {
				which = to_heir_mil
				value = 1
			}
		}
		else_if = {
			limit = {
				NOT = {
					check_variable = {
						which = to_heir_adm
						value = 6
					}
				}
			}
			change_variable = {
				which = to_heir_adm
				value = 1
			}
		}
		else_if = {
			limit = {
				NOT = {
					check_variable = {
						which = to_heir_dip
						value = 6
					}
				}
			}
			change_variable = {
				which = to_heir_dip
				value = 1
			}
		}
		if = {
			limit = {
				NOT = {
					check_variable = {
						which = to_heir_adm
						value = 6
					}
				}
			}
			change_variable = {
				which = to_heir_adm
				value = 1
			}
		}
		else_if = {
			limit = {
				NOT = {
					check_variable = {
						which = to_heir_mil
						value = 6
					}
				}
			}
			change_variable = {
				which = to_heir_mil
				value = 1
			}
		}
		else_if = {
			limit = {
				NOT = {
					check_variable = {
						which = to_heir_dip
						value = 6
					}
				}
			}
			change_variable = {
				which = to_heir_dip
				value = 1
			}
		}
	}
}

to_assign_zealous_heir = {
	if = {
		limit = {
			has_dlc = "Rights of Man"
		}
		custom_tooltip = to_get_zealous_heir_with_personality_tt
	}
	else = {
		custom_tooltip = to_get_zealous_heir_tt
	}
	hidden_effect = {
		to_generate_ruler_from_variable = {
			ADM_VARIABLE = to_heir_adm
			DIP_VARIABLE = to_heir_dip
			MIL_VARIABLE = to_heir_mil
			EFFECT = "to_generate_zealous_heir"
		}
		if = {
			limit = {
				has_dlc = "Rights of Man"
			}
			add_heir_personality = zealot_personality
		}
	}
}

to_assign_zealous_ruler = {
	if = {
		limit = {
			has_dlc = "Rights of Man"
		}
		custom_tooltip = to_get_zealous_ruler_with_personality_tt
	}
	else = {
		custom_tooltip = to_get_zealous_ruler_tt
	}
	hidden_effect = {
		to_generate_ruler_from_variable = {
			ADM_VARIABLE = to_heir_adm
			DIP_VARIABLE = to_heir_dip
			MIL_VARIABLE = to_heir_mil
			EFFECT = "to_generate_zealous_ruler"
		}
		if = {
			limit = {
				has_dlc = "Rights of Man"
			}
			add_ruler_personality = zealot_personality
		}
	}
}

to_generate_zealous_heir = {
	define_heir = {
		dynasty = ROOT
		adm = $ADM$
		dip = $DIP$
		mil = $MIL$
		max_random_adm = $ADM$
		max_random_dip = $DIP$
		max_random_mil = $MIL$
		birth_date = "1447.9.18"
		claim = 75
		religion = orthodox
		no_consort_with_heir = yes
		female = no
	}
}

to_generate_zealous_ruler = {
	define_ruler = {
		dynasty = ROOT
		adm = $ADM$
		dip = $DIP$
		mil = $MIL$
		max_random_adm = $ADM$
		max_random_dip = $DIP$
		max_random_mil = $MIL$
		min_age = 15
		max_age = 21
		claim = 75
		religion = orthodox
		female = no
	}
}

to_restore_heir_claim_hellenic = {
	if = {
		limit = {
			OR = {
				has_heir_flag = to_heir_lost_claim_hellenic
				has_heir_flag = to_heir_lost_claim_hellenic_minor
			}
		}
		custom_tooltip = nhs_new_line_tt
		custom_tooltip = to_restore_lost_heir_claim_hellenic_tt
		if = {
			limit = {
				has_heir_flag = to_heir_lost_claim_hellenic
			}
			clr_heir_flag = to_heir_lost_claim_hellenic
			add_heir_claim = 33
		}
		else = {
			clr_heir_flag = to_heir_lost_claim_hellenic_minor
			add_heir_claim = 10
		}
	}
	else_if = {
		limit = {
			has_heir_flag = to_heir_lost_claim_hellenic_major
		}
		clr_heir_flag = to_heir_lost_claim_hellenic_major
		custom_tooltip = nhs_new_line_tt
		custom_tooltip = to_restore_lost_heir_claim_hellenic_major_tt
		add_heir_claim = 75
	}
}

to_nhs_spawn_inquisition_revolt = {
	set_country_flag = nhs_hcd_inquisition_revolt
	capital_scope = {
		spawn_rebels = {
			type = to_inquisition_mob_rebels
			size = 1
		}
	}
	if = {
		limit = {
			has_saved_event_target = $EVENT_TARGET$
			event_target:$EVENT_TARGET$ = {
				owned_by = ROOT
			}
		}
		event_target:$EVENT_TARGET$ = {
			spawn_rebels = {
				type = to_inquisition_mob_rebels
				size = 2
				win = yes
			}
			add_province_modifier = {
				name = nhs_hcd_inquisition_headquarters
				duration = -1
				desc = "END_OF_INQUISITION_REVOLT"
			}
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				is_capital = no
				NOT = { has_province_modifier = nhs_hcd_Pagan_minority }
				religion = orthodox
			}
		}
		random_owned_province = {
			limit = {
				is_capital = no
				NOT = { has_province_modifier = nhs_hcd_Pagan_minority }
				religion = orthodox
			}
			spawn_rebels = {
				type = to_inquisition_mob_rebels
				size = 2
				win = yes
			}
			add_province_modifier = {
				name = nhs_hcd_inquisition_headquarters
				duration = -1
				desc = "END_OF_INQUISITION_REVOLT"
			}
		}
	}
	else = {
		capital_scope = {
			spawn_rebels = {
				type = to_inquisition_mob_rebels
				size = 2
				win = yes
			}
			add_province_modifier = {
				name = nhs_hcd_inquisition_headquarters
				duration = -1
				desc = "END_OF_INQUISITION_REVOLT"
			}
		}
	}
	[[EVENT_TARGET_2]
	if = {
		limit = {
			has_saved_event_target = $EVENT_TARGET_2$
			event_target:$EVENT_TARGET_2$ = {
				owned_by = ROOT
			}
		}
		event_target:$EVENT_TARGET_2$ = {
			spawn_rebels = {
				type = to_inquisition_mob_rebels
				size = 2
			}
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				is_capital = no
				NOT = { has_province_modifier = nhs_hcd_Pagan_minority }
				religion = orthodox
			}
		}
		random_owned_province = {
			limit = {
				is_capital = no
				NOT = { has_province_modifier = nhs_hcd_Pagan_minority }
				religion = orthodox
			}
			spawn_rebels = {
				type = to_inquisition_mob_rebels
				size = 2
			}
		}
	}
	else = {
		capital_scope = {
			spawn_rebels = {
				type = to_inquisition_mob_rebels
				size = 2
			}
		}
	}
	]

	[[EVENT_TARGET_3]
	if = {
		limit = {
			has_saved_event_target = $EVENT_TARGET_3$
			event_target:$EVENT_TARGET_3$ = {
				owned_by = ROOT
			}
		}
		event_target:$EVENT_TARGET_3$ = {
			spawn_rebels = {
				type = to_inquisition_mob_rebels
				size = 1
			}
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				is_capital = no
				NOT = { has_province_modifier = nhs_hcd_Pagan_minority }
				religion = orthodox
			}
		}
		random_owned_province = {
			limit = {
				is_capital = no
				NOT = { has_province_modifier = nhs_hcd_Pagan_minority }
				religion = orthodox
			}
			spawn_rebels = {
				type = to_inquisition_mob_rebels
				size = 1
			}
		}
	}
	else = {
		capital_scope = {
			spawn_rebels = {
				type = to_inquisition_mob_rebels
				size = 1
			}
		}
	}
	]
}

to_nhs_spawn_inquisition_revolt_disaster = {
	if = {
		limit = {
			OR = {
				has_estate_privilege = estate_church_nhs_inquisition_privilege
				has_country_flag = to_has_inquisition
			}
		}
		clr_country_flag = to_has_inquisition
		custom_tooltip = to_nhs_inquisition_dissaproves_tt
		set_country_flag = nhs_hcd_inquisition_revolt
		# add_stability = -1
		[[REDUCE_LOYALTY]
			add_estate_loyalty = {
				estate = estate_church
				loyalty = -10
			}
		]
		# if = {
		# 	limit = {
		# 		always = $REDUCE_LOYALTY$
		# 	}
			
		# }
		remove_estate_privilege = estate_church_nhs_inquisition_privilege
		to_nhs_spawn_inquisition_revolt = { 
			EVENT_TARGET = $EVENT_TARGET$
			[[EVENT_TARGET_2]
			EVENT_TARGET_2 = $EVENT_TARGET_2$
			]
			[[EVENT_TARGET_3]
			EVENT_TARGET_3 = $EVENT_TARGET_3$
			]
		}
		[[DOTTED_LINE]
		custom_tooltip = nhs_dotted_line_tt
		]
	}
}

to_nhs_hellenic_disaster_anger_hellenic_minor = {
	custom_tooltip = hellenicconversion_anger_pagans.tt
	hidden_effect = {
		change_variable = {
			which = HellenicUprising
			value = 1
		}
	}
}

to_nhs_hellenic_disaster_anger_hellenic_major = {
	custom_tooltip = hellenicconversion_anger_pagans_more.tt
	hidden_effect = {
		change_variable = {
			which = HellenicUprising
			value = 2
		}
	}
}

to_nhs_hellenic_disaster_anger_hellenic_huge = {
	custom_tooltip = hellenicconversion_anger_pagans_more_more.tt
	hidden_effect = {
		change_variable = {
			which = HellenicUprising
			value = 3
		}
	}
}

to_nhs_hellenic_disaster_anger_orthodox_minor = {
	custom_tooltip = hellenicconversion_anger_orthodox.tt
	hidden_effect = {
		change_variable = {
			which = OrthodoxUprising
			value = 1
		}
	}
}

to_nhs_hellenic_disaster_anger_orthodox_major = {
	custom_tooltip = hellenicconversion_anger_orthodox_more.tt
	hidden_effect = {
		change_variable = {
			which = OrthodoxUprising
			value = 2
		}
	}
}

to_nhs_hellenic_disaster_anger_orthodox_huge = {
	custom_tooltip = hellenicconversion_anger_orthodox_more_more.tt
	hidden_effect = {
		change_variable = {
			which = OrthodoxUprising
			value = 3
		}
	}
}

to_byz_undiscover_flight_path = {
	undiscover_province = 1566
    undiscover_province = 1567
    undiscover_province = 1580
    undiscover_province = 1583
    undiscover_province = 1575
    undiscover_province = 1574
    undiscover_province = 1571
    undiscover_province = 1501
}

to_byz_discover_next_flight_path_province = {
	if = {
		limit = {
			has_country_flag = to_byz_flight_discovery_path_1
		}
		discover_province = 1566
		clr_country_flag = to_byz_flight_discovery_path_1
		set_country_flag = to_byz_flight_discovery_path_2
	}
	else_if = {
		limit = {
			has_country_flag = to_byz_flight_discovery_path_2
		}
		discover_province = 1567
		clr_country_flag = to_byz_flight_discovery_path_2
		set_country_flag = to_byz_flight_discovery_path_3
	}
	else_if = {
		limit = {
			has_country_flag = to_byz_flight_discovery_path_3
		}
		discover_province = 1580
		clr_country_flag = to_byz_flight_discovery_path_3
		set_country_flag = to_byz_flight_discovery_path_4
	}
	else_if = {
		limit = {
			has_country_flag = to_byz_flight_discovery_path_4
		}
		discover_province = 1583
		clr_country_flag = to_byz_flight_discovery_path_4
		set_country_flag = to_byz_flight_discovery_path_5
	}
	else_if = {
		limit = {
			has_country_flag = to_byz_flight_discovery_path_5
		}
		discover_province = 1575
		clr_country_flag = to_byz_flight_discovery_path_5
		set_country_flag = to_byz_flight_discovery_path_6
	}
	else_if = {
		limit = {
			has_country_flag = to_byz_flight_discovery_path_6
		}
		discover_province = 1574
		clr_country_flag = to_byz_flight_discovery_path_6
		set_country_flag = to_byz_flight_discovery_path_7
	}
	else_if = {
		limit = {
			has_country_flag = to_byz_flight_discovery_path_7
		}
		discover_province = 1571
		clr_country_flag = to_byz_flight_discovery_path_7
		set_country_flag = to_byz_flight_discovery_path_8
	}
	else_if = {
		limit = {
			has_country_flag = to_byz_flight_discovery_path_8
		}
		discover_province = 1501
		clr_country_flag = to_byz_flight_discovery_path_8
		set_country_flag = to_byz_flight_discovery_path_9
	}
	else_if = {
		limit = {
			has_country_flag = to_byz_flight_discovery_path_9
		}
		discover_province = 5377
		clr_country_flag = to_byz_flight_discovery_path_9
	}
}

to_nhs_spawn_hellenic_disaster_revolt = {
	if = {
		limit = {
			has_saved_event_target = nhs_$RELIGION$_first_revolt_province
			event_target:nhs_$RELIGION$_first_revolt_province = {
				owned_by = ROOT
			}
		}
		custom_tooltip = nhs_$RELIGION$_rebels_during_the_disaster_tt
		event_target:nhs_$RELIGION$_first_revolt_province = {
			spawn_rebels = {
				size = 2
				type = $RELIGION$_rebels
				win = yes
			}
		}
	}
	else_if = {
		limit = {
			has_saved_event_target = nhs_$RELIGION$_first_revolt_province
			any_owned_province = {
				is_capital = no
			}
		}
		custom_tooltip = nhs_$RELIGION$_rebels_during_the_disaster_tt
		random_owned_province = {
			limit = {
				is_capital = no
			}
			spawn_rebels = {
				size = 2
				type = $RELIGION$_rebels
				win = yes
			}
		}
	}
	if = {
		limit = {
			has_saved_event_target = nhs_$RELIGION$_second_revolt_province
			event_target:nhs_$RELIGION$_second_revolt_province = {
				owned_by = ROOT
			}
		}
		event_target:nhs_$RELIGION$_second_revolt_province = {
			spawn_rebels = {
				size = 1
				type = $RELIGION$_rebels
			}
		}
	}
	else_if = {
		limit = {
			has_saved_event_target = nhs_$RELIGION$_second_revolt_province
			any_owned_province = {
				is_capital = no
			}
		}
		random_owned_province = {
			limit = {
				is_capital = no
			}
			spawn_rebels = {
				size = 1
				type = $RELIGION$_rebels
			}
		}
	}
	# custom_tooltip = nhs_rebels_during_the_disaster_tt
}

to_nhs_spawn_hellenic_disaster_revolt_moderate = {
	if = {
		limit = {
			to_nhs_hellenic_disaster_attitude_hostile = {
				ATTITUDE_VARIABLE = $ATTITUDE_VARIABLE$
			}
		}
		custom_tooltip = nhs_new_line_tt
		custom_tooltip = to_nhs_consequences_moderate_hostile_$RELIGION$_tt
		if = {
			limit = {
				has_saved_event_target = nhs_$RELIGION$_first_revolt_province
				event_target:nhs_$RELIGION$_first_revolt_province = {
					owned_by = ROOT
				}
			}
			# custom_tooltip = nhs_$RELIGION$_rebels_during_the_disaster_tt
			event_target:nhs_$RELIGION$_first_revolt_province = {
				spawn_rebels = {
					size = 2
					type = $RELIGION$_rebels
					win = yes
				}
			}
		}
		else_if = {
			limit = {
				has_saved_event_target = nhs_$RELIGION$_first_revolt_province
				any_owned_province = {
					is_capital = no
				}
			}
			# custom_tooltip = nhs_$RELIGION$_rebels_during_the_disaster_tt
			random_owned_province = {
				limit = {
					is_capital = no
				}
				spawn_rebels = {
					size = 2
					type = $RELIGION$_rebels
					win = yes
				}
			}
		}
	}
	else_if = {
		limit = {
			to_nhs_hellenic_disaster_attitude_unfriendly = {
				ATTITUDE_VARIABLE = $ATTITUDE_VARIABLE$
			}
		}
		custom_tooltip = nhs_new_line_tt
		custom_tooltip = to_nhs_consequences_moderate_unfriendly_$RELIGION$_tt
		if = {
			limit = {
				has_saved_event_target = nhs_$RELIGION$_first_revolt_province
				event_target:nhs_$RELIGION$_first_revolt_province = {
					owned_by = ROOT
				}
			}
			# custom_tooltip = nhs_$RELIGION$_rebels_during_the_disaster_tt
			event_target:nhs_$RELIGION$_first_revolt_province = {
				spawn_rebels = {
					size = 1
					type = $RELIGION$_rebels
					win = yes
				}
			}
		}
		else_if = {
			limit = {
				has_saved_event_target = nhs_$RELIGION$_first_revolt_province
				any_owned_province = {
					is_capital = no
				}
			}
			# custom_tooltip = nhs_$RELIGION$_rebels_during_the_disaster_tt
			random_owned_province = {
				limit = {
					is_capital = no
				}
				spawn_rebels = {
					size = 1
					type = $RELIGION$_rebels
					win = yes
				}
			}
		}
	}
	else_if = {
		limit = {
			to_nhs_hellenic_disaster_attitude_friendly = {
				ATTITUDE_VARIABLE = $ATTITUDE_VARIABLE$
			}
			has_spawned_rebels = $RELIGION$_rebels
		}
		custom_tooltip = to_nhs_consequences_moderate_friendly_$RELIGION$_tt
		tooltip = {
			disband_rebels = $RELIGION$_rebels
		}
	}
}

to_spawn_orthodox_revolt = {
	if = {
		limit = {
			any_owned_province = {
				is_capital = no
				religion = orthodox
				culture_group = ROOT
				OR = {
					controlled_by = ROOT
					has_rebel_faction = orthodox_rebels
				}
			}
		}
		random_owned_province = {
			limit = {
				is_capital = no
				religion = orthodox
				culture_group = ROOT
				OR = {
					controlled_by = ROOT
					has_rebel_faction = orthodox_rebels
				}
			}
			spawn_rebels = {
				size = $SIZE$
				type = orthodox_rebels
				win = yes
			}
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				is_capital = no
				culture_group = ROOT
				OR = {
					controlled_by = ROOT
					has_rebel_faction = orthodox_rebels
				}
			}
		}
		random_owned_province = {
			limit = {
				is_capital = no
				culture_group = ROOT
				OR = {
					controlled_by = ROOT
					has_rebel_faction = orthodox_rebels
				}
			}
			spawn_rebels = {
				size = $SIZE$
				type = orthodox_rebels
				win = yes
			}
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				culture_group = ROOT
				OR = {
					controlled_by = ROOT
					has_rebel_faction = orthodox_rebels
				}
			}
		}
		random_owned_province = {
			limit = {
				culture_group = ROOT
				OR = {
					controlled_by = ROOT
					has_rebel_faction = orthodox_rebels
				}
			}
			spawn_rebels = {
				size = $SIZE$
				type = orthodox_rebels
				win = yes
			}
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				culture_group = ROOT
			}
		}
		random_owned_province = {
			limit = {
				culture_group = ROOT
			}
			spawn_rebels = {
				size = $SIZE$
				type = orthodox_rebels
				win = yes
			}
		}
	}
	else = {
		random_owned_province = {
			spawn_rebels = {
				size = $SIZE$
				type = orthodox_rebels
				win = yes
			}
		}
	}
}

to_orthodox_revolt_potential_province = {
	if = {
		limit = {
			any_owned_province = {
				is_capital = no
				religion = orthodox
				culture_group = ROOT
				OR = {
					controlled_by = ROOT
					has_rebel_faction = orthodox_rebels
				}
				[[ADDITIONAL_TRIGGER]
				$ADDITIONAL_TRIGGER$
				]
			}
		}
		random_owned_province = {
			limit = {
				is_capital = no
				religion = orthodox
				culture_group = ROOT
				OR = {
					controlled_by = ROOT
					has_rebel_faction = orthodox_rebels
				}
				[[ADDITIONAL_TRIGGER]
				$ADDITIONAL_TRIGGER$
				]
			}
			save_event_target_as = $EVENT_TARGET$
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				is_capital = no
				culture_group = ROOT
				OR = {
					controlled_by = ROOT
					has_rebel_faction = orthodox_rebels
				}
				[[ADDITIONAL_TRIGGER]
				$ADDITIONAL_TRIGGER$
				]
			}
		}
		random_owned_province = {
			limit = {
				is_capital = no
				culture_group = ROOT
				OR = {
					controlled_by = ROOT
					has_rebel_faction = orthodox_rebels
				}
				[[ADDITIONAL_TRIGGER]
				$ADDITIONAL_TRIGGER$
				]
			}
			save_event_target_as = $EVENT_TARGET$
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				culture_group = ROOT
				OR = {
					controlled_by = ROOT
					has_rebel_faction = orthodox_rebels
				}
				[[ADDITIONAL_TRIGGER]
				$ADDITIONAL_TRIGGER$
				]
			}
		}
		random_owned_province = {
			limit = {
				culture_group = ROOT
				OR = {
					controlled_by = ROOT
					has_rebel_faction = orthodox_rebels
				}
				[[ADDITIONAL_TRIGGER]
				$ADDITIONAL_TRIGGER$
				]
			}
			save_event_target_as = $EVENT_TARGET$
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				culture_group = ROOT
				[[ADDITIONAL_TRIGGER]
				$ADDITIONAL_TRIGGER$
				]
			}
		}
		random_owned_province = {
			limit = {
				culture_group = ROOT
				[[ADDITIONAL_TRIGGER]
				$ADDITIONAL_TRIGGER$
				]
			}
			save_event_target_as = $EVENT_TARGET$
		}
	}
	else = {
		random_owned_province = {
			limit = {
				[[ADDITIONAL_TRIGGER]
				$ADDITIONAL_TRIGGER$
				]
			}
			save_event_target_as = $EVENT_TARGET$
		}
	}
}

to_orthodox_spawn_revolt_in_potential_province = {
	if = {
		limit = {
			event_target:$EVENT_TARGET$ = {
				owned_by = ROOT
			}
		}
		event_target:$EVENT_TARGET$ = {
			spawn_rebels = {
				size = $SIZE$
				type = orthodox_rebels
				win = yes
			}
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				is_capital = no
				religion = orthodox
				culture_group = ROOT
				OR = {
					controlled_by = ROOT
					has_rebel_faction = orthodox_rebels
				}
			}
		}
		random_owned_province = {
			limit = {
				is_capital = no
				religion = orthodox
				culture_group = ROOT
				OR = {
					controlled_by = ROOT
					has_rebel_faction = orthodox_rebels
				}
			}
			spawn_rebels = {
				size = $SIZE$
				type = orthodox_rebels
				win = yes
			}
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				is_capital = no
				culture_group = ROOT
				OR = {
					controlled_by = ROOT
					has_rebel_faction = orthodox_rebels
				}
			}
		}
		random_owned_province = {
			limit = {
				is_capital = no
				culture_group = ROOT
				OR = {
					controlled_by = ROOT
					has_rebel_faction = orthodox_rebels
				}
			}
			spawn_rebels = {
				size = $SIZE$
				type = orthodox_rebels
				win = yes
			}
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				culture_group = ROOT
				OR = {
					controlled_by = ROOT
					has_rebel_faction = orthodox_rebels
				}
			}
		}
		random_owned_province = {
			limit = {
				culture_group = ROOT
				OR = {
					controlled_by = ROOT
					has_rebel_faction = orthodox_rebels
				}
			}
			spawn_rebels = {
				size = $SIZE$
				type = orthodox_rebels
				win = yes
			}
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				culture_group = ROOT
			}
		}
		random_owned_province = {
			limit = {
				culture_group = ROOT
			}
			spawn_rebels = {
				size = $SIZE$
				type = orthodox_rebels
				win = yes
			}
		}
	}
	else = {
		random_owned_province = {
			spawn_rebels = {
				size = $SIZE$
				type = orthodox_rebels
				win = yes
			}
		}
	}
}

to_nhs_enable_monument = {
	custom_tooltip = to_nhs_enable_monument_$GREAT_PROJECT$_tt
	hidden_effect = {
		$PROVINCE_ID$ = {
			add_great_project = {
				type = $GREAT_PROJECT$
				instant = yes
			}
		}
	}
}

to_nhs_setup_church_land = {
	if = {
		limit = {
			has_country_flag = nhs_setting_church_land
			has_estate = estate_church
		}
		clr_country_flag = nhs_setting_church_land
		change_estate_land_share = {
			estate = estate_church
			share = -100
		}
		change_estate_land_share = {
			estate = estate_church
			share = 20
		}
		if = {
			limit = {
				has_estate_privilege = estate_church_religious_state
			}
			change_estate_land_share = {
				estate = estate_church
				share = 10
			}
		}
		if = {
			limit = {
				has_estate_privilege = estate_church_land_rights
			}
			change_estate_land_share = {
				estate = estate_church
				share = 5
			}
		}
		if = {
			limit = {
				has_estate_privilege = estate_church_one_faith_one_culture
			}
			change_estate_land_share = {
				estate = estate_church
				share = 5
			}
		}
		if = {
			limit = {
				check_variable = {
					which = to_reduce_starting_loyalty_estate_church
					value = 1
				}
			}
			for_variable_amount = {
				variable = to_reduce_starting_loyalty_estate_church
				effect = "
				add_estate_loyalty = {
					estate = estate_church
					loyalty = -10
				}"
			}
		}
	}
}

to_nhs_handle_capital_area_cores_colonisation = {
	if = {
		limit = {
			nhs_homelands_no_capital = yes
			NOT = { has_province_flag = nhs_got_core }
			owner = {
				nhs_check_all_elysian_tags = { CONDITION = tag }
				NOT = { has_country_flag = to_homelands_event_active }
			}
		}
		province_event = { id = nhs2_countryevents.2 }
	}
}

to_nhs_handle_capital_area_cores_conquest = {
	if = {
		limit = {
			nhs_homelands_no_capital = yes
			is_city = yes
			NOT = { has_province_flag = nhs_is_colony }
			NOT = { has_province_flag = nhs_got_core }
			owner = {
				nhs_check_all_elysian_tags = { CONDITION = tag }
			}
		}
		if = {
			limit = {
				province_id = 952
			}
			if = {
				limit = {
					NOT = {
						owner = {
							is_core = PREV 
						}
					}
				}
				province_event = { id = nhs2_countryevents.21 }
			}
		}
		if = {
			limit = {
				NOT = {
					province_id = 952
				}
				owner = {
					NOT = { has_country_flag = to_homelands_event_active }
				}
			}
			province_event = { id = nhs2_countryevents.2 }
		}
	}
}

to_nhs_discover_carribean = {
	bahama_channel_area = {
		every_country = {
			limit = {
				tag = $TAG$
			}
			discover_province = PREV
		}
	}
	caribbean_sea_area = {
		every_country = {
			limit = {
				tag = $TAG$
			}
			discover_province = PREV
		}
	}
	carribeans_region = {
		every_country = {
			limit = {
				tag = $TAG$
			}
			discover_province = PREV
		}
	}
	$TAG$ = {
		discover_province = 1504
		discover_province = 1571
		discover_province = 1572
		discover_province = 1574
		discover_province = 1526
		discover_province = 1575
	}
}

to_nhs_handle_lots_of_people_modifiers = {
	if = {
		limit = {
			owner = {
				OR = {
					has_country_modifier = nhs_lots_of_ppl1
					has_country_modifier = nhs_lots_of_ppl2
					has_country_modifier = nhs_lots_of_ppl3
				}
			}
		}
		owner = {
			change_variable = {
				which = nhs_finished_colonies
				value = 1
			}
			if = {
				limit = {
					has_country_modifier = nhs_lots_of_ppl1
					check_variable = {
						which = nhs_finished_colonies
						value = 2
					}
				}
				remove_country_modifier = nhs_lots_of_ppl1
				add_country_modifier = {
					name = nhs_lots_of_ppl2
					duration = -1
				}
			}
			if = {
				limit = {
					has_country_modifier = nhs_lots_of_ppl2
					check_variable = {
						which = nhs_finished_colonies
						value = 4
					}
				}
				remove_country_modifier = nhs_lots_of_ppl2
				add_country_modifier = {
					name = nhs_lots_of_ppl3
					duration = -1
				}
			}
			if = {
				limit = {
					has_country_modifier = nhs_lots_of_ppl3
					check_variable = {
						which = nhs_finished_colonies
						value = 7
					}
				}
				remove_country_modifier = nhs_lots_of_ppl3
			}
		}
	}
	else_if = {
		limit = {
			owner = {
				OR = {
					has_country_modifier = nhs_lots_of_ppl1_halved
					has_country_modifier = nhs_lots_of_ppl2_halved
					has_country_modifier = nhs_lots_of_ppl3_halved
				}
			}
		}
		owner = {
			change_variable = {
				which = nhs_finished_colonies
				value = 1
			}
			if = {
				limit = {
					has_country_modifier = nhs_lots_of_ppl1_halved
					check_variable = {
						which = nhs_finished_colonies
						value = 2
					}
				}
				remove_country_modifier = nhs_lots_of_ppl1_halved
				add_country_modifier = {
					name = nhs_lots_of_ppl2_halved
					duration = -1
				}
			}
			if = {
				limit = {
					has_country_modifier = nhs_lots_of_ppl2_halved
					check_variable = {
						which = nhs_finished_colonies
						value = 4
					}
				}
				remove_country_modifier = nhs_lots_of_ppl2_halved
				add_country_modifier = {
					name = nhs_lots_of_ppl3_halved
					duration = -1
				}
			}
			if = {
				limit = {
					has_country_modifier = nhs_lots_of_ppl3_halved
					check_variable = {
						which = nhs_finished_colonies
						value = 7
					}
				}
				remove_country_modifier = nhs_lots_of_ppl3_halved
			}
		}
	}
	else_if = {
		limit = {
			owner = {
				OR = {
					has_country_modifier = nhs_lots_of_ppl1_winter
					has_country_modifier = nhs_lots_of_ppl2_winter
					has_country_modifier = nhs_lots_of_ppl3_winter
				}
			}
		}
		owner = {
			change_variable = {
				which = nhs_finished_colonies
				value = 1
			}
			if = {
				limit = {
					has_country_modifier = nhs_lots_of_ppl1_winter
					check_variable = {
						which = nhs_finished_colonies
						value = 2
					}
				}
				remove_country_modifier = nhs_lots_of_ppl1_winter
				add_country_modifier = {
					name = nhs_lots_of_ppl2_winter
					duration = -1
				}
			}
			if = {
				limit = {
					has_country_modifier = nhs_lots_of_ppl2_winter
					check_variable = {
						which = nhs_finished_colonies
						value = 4
					}
				}
				remove_country_modifier = nhs_lots_of_ppl2_winter
				add_country_modifier = {
					name = nhs_lots_of_ppl3_winter
					duration = -1
				}
			}
			if = {
				limit = {
					has_country_modifier = nhs_lots_of_ppl3_winter
					check_variable = {
						which = nhs_finished_colonies
						value = 7
					}
				}
				remove_country_modifier = nhs_lots_of_ppl3_winter
			}
		}
	}
}

to_nhs_handle_inwards_path_province_modifiers_all_provinces = {
	if = {
		limit = {
			OR = {
				mission_completed = to_the_promised_land_mission
				mission_completed = to_the_jewel_of_elysia_mission
				mission_completed = to_a_new_homeland_mission
				mission_completed = to_looking_inwards_mission
			}
		}
		every_province = {
			limit = {
				OR = {
					continent = north_america
					continent = south_america
				}
				owner = {
					nhs_is_elysian_tag_or_subject = yes
				}
			}
			to_nhs_handle_inwards_path_province_modifiers = yes
		}
	}
}

to_nhs_handle_inwards_path_province_modifiers = {
	if = {
		limit = {
			OR = {
				continent = north_america
				continent = south_america
			}
			owner = {
				OR = {
					mission_completed = to_the_promised_land_mission
					AND = {
						is_subject = yes
						overlord = {
							OR = {
								mission_completed = to_the_promised_land_mission
								AND = {
									is_subject = yes
									overlord = {
										mission_completed = to_the_promised_land_mission
									}
								}
							}
						}
					}
				}
			}
		}
		add_province_modifier = {
			name = to_looking_inwards_mission_province_mod_3
			duration = -1
		}
	}
	else_if = {
		limit = {
			continent = north_america
			owner = {
				OR = {
					mission_completed = to_a_new_homeland_mission
					AND = {
						is_subject = yes
						overlord = {
							OR = {
								mission_completed = to_a_new_homeland_mission
								AND = {
									is_subject = yes
									overlord = {
										mission_completed = to_a_new_homeland_mission
									}
								}
							}
						}
					}
				}
			}
		}
		add_province_modifier = {
			name = to_looking_inwards_mission_province_mod_3
			duration = -1
		}
	}
	else_if = {
		limit = {
			continent = north_america
			owner = {
				OR = {
					mission_completed = to_the_jewel_of_elysia_mission
					AND = {
						is_subject = yes
						overlord = {
							OR = {
								mission_completed = to_the_jewel_of_elysia_mission
								AND = {
									is_subject = yes
									overlord = {
										mission_completed = to_the_jewel_of_elysia_mission
									}
								}
							}
						}
					}
				}
			}
		}
		add_province_modifier = {
			name = to_looking_inwards_mission_province_mod_2
			duration = -1
		}
	}
	else_if = {
		limit = {
			continent = north_america
			owner = {
				OR = {
					mission_completed = to_looking_inwards_mission
					AND = {
						is_subject = yes
						overlord = {
							OR = {
								mission_completed = to_looking_inwards_mission
								AND = {
									is_subject = yes
									overlord = {
										mission_completed = to_looking_inwards_mission
									}
								}
							}
						}
					}
				}
			}
		}
		add_province_modifier = {
			name = to_looking_inwards_mission_province_mod_1
			duration = -1
		}
	}
}

to_assemble_an_invasion_force_mission_handle_modifiers = {
	if = {
		limit = {
			owner = {
				has_country_flag = to_assemble_an_invasion_force_mission_enable_effects
			}
		}
		if = {
			limit = {
				has_building = training_fields
			}
			to_assemble_an_invasion_force_mission_add_building_modifier = { 
				BUILDING = training_fields
				REMOVE_BUILDING_MODIFIER = barracks
			}
		}
		else_if = {
			limit = {
				has_building = barracks
			}
			to_assemble_an_invasion_force_mission_add_building_modifier = { 
				BUILDING = barracks
			}
		}
		if = {
			limit = {
				has_building = drydock
			}
			to_assemble_an_invasion_force_mission_add_building_modifier = { 
				BUILDING = drydock
				REMOVE_BUILDING_MODIFIER = dock
			}
		}
		else_if = {
			limit = {
				has_building = dock
			}
			to_assemble_an_invasion_force_mission_add_building_modifier = { 
				BUILDING = dock
			}
		}
	}
}

to_assemble_an_invasion_force_mission_remove_all_modifiers = {
	every_owned_province = {
		remove_province_modifier = to_assemble_an_invasion_force_mission_barracks_modifier
		remove_province_modifier = to_assemble_an_invasion_force_mission_training_fields_modifier
		remove_province_modifier = to_assemble_an_invasion_force_mission_dock_modifier
		remove_province_modifier = to_assemble_an_invasion_force_mission_drydock_modifier
	}
}

to_assemble_an_invasion_force_mission_add_building_modifier = {
	if = {
		limit = {
			owner = {
				has_country_flag = to_assemble_an_invasion_force_mission_enable_effects
			}
		}
		custom_tooltip = to_assemble_an_invasion_force_mission_$BUILDING$_modifier_tt
		hidden_effect = {
			[[REMOVE_BUILDING_MODIFIER]
				remove_province_modifier = to_assemble_an_invasion_force_mission_$REMOVE_BUILDING_MODIFIER$_modifier
			]
			add_province_modifier = {
				name = to_assemble_an_invasion_force_mission_$BUILDING$_modifier
				duration = -1
				hidden = yes
			}
		}
	}
}

to_assemble_an_invasion_force_mission_remove_building_modifier = {
	hidden_effect = {
		remove_province_modifier = to_assemble_an_invasion_force_mission_$BUILDING$_modifier
	}
}

nhs_set_greek_fire_sprites = {
	# hidden_effect = {
		if = {
			limit = {
				NOT = { nhs_has_greek_fire_reform = yes }
			}
			apply_sprite_pack = to_elysian_fire_pack
		}
		hidden_effect = {
			apply_sprite_pack = to_elysian_fire_pack
		}
	# }
}

nhs_reset_elysian_sprites = {
	# hidden_effect = {
		if = {
			limit = {
				nhs_has_fire_all_cases = yes
			}
			apply_sprite_pack = to_elysian_sprite_pack
		}
		hidden_effect = {
			apply_sprite_pack = to_elysian_sprite_pack
		}
	# }
}

to_nhs_remove_exarch_cores = {
	if = {
		limit = {
			is_subject = yes
			is_subject_of_type = elysian_subject
		}
		country_event = { id = nhs2_ely_marches.4 }
	}
}

to_cede_province_to_exarch = {
	if = {
		limit = {
			is_state_core = event_target:to_exarch_overlord
		}
		remove_core = event_target:to_exarch_overlord
		cede_province = ROOT
		if = {
			limit = {
				NOT = { is_state_core = ROOT }
			}
			add_core = ROOT
		}
	}
	else_if = {
		limit = {
			is_territorial_core = event_target:to_exarch_overlord
		}
		remove_core = event_target:to_exarch_overlord
		cede_province = ROOT
		add_territorial_core = ROOT
	}
	else_if = {
		limit = {
			is_permanent_claim = event_target:to_exarch_overlord
		}
		remove_claim = event_target:to_exarch_overlord
		cede_province = ROOT
		add_permanent_claim = ROOT
	}
	else_if = {
		limit = {
			is_claim = event_target:to_exarch_overlord
		}
		remove_claim = event_target:to_exarch_overlord
		cede_province = ROOT
		add_claim = ROOT
	}
	else = {
		cede_province = ROOT
	}
	remove_claim = event_target:to_exarch_overlord
	add_nationalism = -10
}

to_check_exarch_claims_check_all_provinces = {
	every_owned_province = {
		set_province_flag = nhs_eligible_for_exarch_claim@$EXARCH_TAG$
		every_neighbor_province = {
			set_province_flag = nhs_eligible_for_exarch_claim@$EXARCH_TAG$
		}
		every_neighbor_sea_zone = {
			every_neighbor_province = {
				set_province_flag = nhs_eligible_for_exarch_claim@$EXARCH_TAG$
			}
		}
	}
}

to_check_exarch_claims_on_province_gained = {
	if = {
		limit = {
			is_city = yes
			owner = {
				is_subject_of_type = elysian_subject
			}
		}
		set_province_flag = nhs_eligible_for_exarch_claim@ROOT
		every_neighbor_province = {
			set_province_flag = nhs_eligible_for_exarch_claim@ROOT
		}
		every_neighbor_sea_zone = {
			every_neighbor_province = {
				set_province_flag = nhs_eligible_for_exarch_claim@ROOT
			}
		}
	}
}

to_check_exarch_claims_on_province_lost = {
	if = {
		limit = {
			is_city = yes
			FROM = {
				is_subject_of_type = elysian_subject
			}
		}
		every_province = {
			clr_province_flag = nhs_eligible_for_exarch_claim@FROM
		}
		FROM = {
			to_check_exarch_claims_check_all_provinces = { EXARCH_TAG = FROM }
		}
	}
}

to_check_exarch_claims_on_become_subject = {
	if = {
		limit = {
			is_subject_of_type = elysian_subject
		}
		every_province = {
			clr_province_flag = nhs_eligible_for_exarch_claim@FROM
		}
		to_check_exarch_claims_check_all_provinces = { EXARCH_TAG = FROM }
	}
}

to_fabricate_exarch_claim_effect = {
	if = {
		limit = {
			$EXARCH_TAG$ = {
				is_subject_of = ROOT
				is_subject_of_type = elysian_subject
			}
			any_owned_province = {
				has_province_flag = nhs_eligible_for_exarch_claim$EXARCH_TAG$
			}
		}
		every_owned_province = {
			limit = {
				has_province_flag = nhs_eligible_for_exarch_claim$EXARCH_TAG$
				NOT = { is_claim = $EXARCH_TAG$ }
				NOT = { is_permanent_claim = $EXARCH_TAG$ }
			}
			add_claim = $EXARCH_TAG$
		}
	}
}

to_nhs_exarch_monument_mod_transfer = {
	if = {
		limit = {
			owner = {
				nhs_check_all_elysian_tags = { CONDITION = tag }
			}
		}
		custom_tooltip = to_nhs_exarch_monument_mod_transfer_tt
	}
	else_if = {
		limit = {
			owner = {
				nhs_check_all_elysian_tags = { CONDITION = is_subject_of }
			}
		}
		custom_tooltip = to_nhs_exarch_monument_mod_transfer_subject_tt
	}
}

to_nhs_exarch_kleisoura_monument_mod_transfer = {
	if = {
		limit = {
			owner = {
				nhs_check_all_elysian_tags = { CONDITION = tag }
			}
		}
		custom_tooltip = to_nhs_exarch_kleisoura_monument_mod_transfer_tt
	}
	else_if = {
		limit = {
			owner = {
				nhs_check_all_elysian_tags = { CONDITION = is_subject_of }
			}
		}
		custom_tooltip = to_nhs_exarch_kleisoura_monument_mod_transfer_subject_tt
	}
}

to_colony_monument_mod_transfer = {
	if = {
		limit = {
			owner = {
				is_colonial_nation = no
			}
		}
		custom_tooltip = to_colony_monument_mod_transfer_tt
	}
	else = {
		custom_tooltip = to_colony_monument_mod_transfer_subject_tt
	}
}

to_nhs_despotate_monument_mod_transfer = {
	if = {
		limit = {
			owner = {
				mission_completed = to_basileus_basileon_mission
				nhs_check_all_elysian_tags = { CONDITION = tag }
			}
		}
		custom_tooltip = to_nhs_despotate_monument_mod_transfer_tt
	}
	else_if = {
		limit = {
			owner = {
				is_subject_of_type = to_elysian_governor
				nhs_check_all_elysian_tags = { CONDITION = is_subject_of }
			}
		}
		custom_tooltip = to_nhs_despotate_monument_mod_transfer_subject_tt
	}
}

to_requires_control_andronika_mission_for_despotate_monument_mod_transfer = {
	if = {
		limit = {
			owner = {
				mission_completed = to_basileus_basileon_mission
				NOT = { mission_completed = to_control_andronika_mission }
				nhs_check_all_elysian_tags = { CONDITION = tag }
			}
		}
		custom_tooltip = to_requires_control_andronika_mission_for_despotate_monument_mod_transfer_tt
	}
	else_if = {
		limit = {
			owner = {
				is_subject_of_type = to_elysian_governor
				nhs_check_all_elysian_tags = { CONDITION = is_subject_of }
				overlord = {
					NOT = { mission_completed = to_control_andronika_mission }
				}
			}
		}
		custom_tooltip = to_requires_control_andronika_mission_for_despotate_monument_mod_transfer_overlord_tt
	}
}

to_advance_world_empire_reward_tier = {
	if = {
		limit = {
			calc_true_if = {
				amount = 3
				mission_completed = to_around_africa_mission
				mission_completed = to_indian_ambition_mission
				mission_completed = to_across_the_eirenic_mission
				mission_completed = to_east_asian_monopolies_mission
			}
		}
		custom_tooltip = to_maritime_empire_4_tt
		hidden_effect  = {
			remove_country_modifier = nhs_maritime_empire_1
			remove_country_modifier = nhs_maritime_empire_2
			remove_country_modifier = nhs_maritime_empire_3
			remove_country_modifier = nhs_maritime_empire_4
			if = {
				limit = {
					NOT = {
						OR = {
							has_country_modifier = nhs_maritime_empire_5
							has_country_modifier = nhs_maritime_empire_6
						}
					}
				}
				add_country_modifier = {
					name = nhs_maritime_empire_5
					duration = -1
				}
			}
		}
	}
	else_if = {
		limit = {
			calc_true_if = {
				amount = 2
				mission_completed = to_around_africa_mission
				mission_completed = to_indian_ambition_mission
				mission_completed = to_across_the_eirenic_mission
				mission_completed = to_east_asian_monopolies_mission
			}
		}
		custom_tooltip = to_maritime_empire_3_tt
		hidden_effect  = {
			remove_country_modifier = nhs_maritime_empire_1
			remove_country_modifier = nhs_maritime_empire_2
			remove_country_modifier = nhs_maritime_empire_3
			if = {
				limit = {
					NOT = {
						OR = {
							has_country_modifier = nhs_maritime_empire_4
							has_country_modifier = nhs_maritime_empire_5
							has_country_modifier = nhs_maritime_empire_6
						}
					}
				}
				add_country_modifier = {
					name = nhs_maritime_empire_4
					duration = -1
				}
			}
		}
	}
	else_if = {
		limit = {
			OR = {
				mission_completed = to_around_africa_mission
				mission_completed = to_indian_ambition_mission
				mission_completed = to_across_the_eirenic_mission
				mission_completed = to_east_asian_monopolies_mission
			}
		}
		custom_tooltip = to_maritime_empire_2_tt
		hidden_effect  = {
			remove_country_modifier = nhs_maritime_empire_1
			remove_country_modifier = nhs_maritime_empire_2
			if = {
				limit = {
					NOT = {
						OR = {
							has_country_modifier = nhs_maritime_empire_3
							has_country_modifier = nhs_maritime_empire_4
							has_country_modifier = nhs_maritime_empire_5
							has_country_modifier = nhs_maritime_empire_6
						}
					}
				}
				add_country_modifier = {
					name = nhs_maritime_empire_3
					duration = -1
				}
			}
		}
	}
	else = {
		custom_tooltip = to_maritime_empire_1_tt
		hidden_effect  = {
			remove_country_modifier = nhs_maritime_empire_1
			if = {
				limit = {
					NOT = {
						OR = {
							has_country_modifier = nhs_maritime_empire_2
							has_country_modifier = nhs_maritime_empire_3
							has_country_modifier = nhs_maritime_empire_4
							has_country_modifier = nhs_maritime_empire_5
							has_country_modifier = nhs_maritime_empire_6
						}
					}
				}
				add_country_modifier = {
					name = nhs_maritime_empire_2
					duration = -1
				}
			}
		}
	}
}

to_handle_elysian_penal_colony_modifier = {
	if = {
		limit = {
			colonial_region = colonial_australia
			owner = {
				OR = {
					has_country_flag = to_completed_penal_colony_in_australia
					AND = {
						is_colonial_nation = yes
						overlord = {
							has_country_flag = to_completed_penal_colony_in_australia
						}
					}
				}
			}
		}
		add_province_modifier = {
			name = to_elysian_penal_colony
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_province_modifier = to_elysian_penal_colony
		}
		remove_province_modifier = to_elysian_penal_colony
	}
}

to_japanese_boost_check_owned_provinces = {
	if = {
		limit = {
			has_global_flag = to_opened_japanese_ports
			culture_group = japanese_g
		}
		every_owned_province = {
			limit = {
				region = japan_region
			}
			if = {
				limit = {
					nhs_check_existing_elysian_tags_with_full_condition = {
						CONDITION = "religion = PREV"
					}
				}
				remove_province_modifier = to_japanese_production_boost
				add_province_modifier = {
					name = to_japanese_production_boost_improved
					duration = -1
				}
			}
			else = {
				remove_province_modifier = to_japanese_production_boost_improved
				add_province_modifier = {
					name = to_japanese_production_boost
					duration = -1
				}
			}
		}
	}
	if = {
		limit = {
			NOT = { culture_group = japanese_g }
			any_owned_province = {
				OR = {
					has_province_modifier = to_japanese_production_boost
					has_province_modifier = to_japanese_production_boost_improved
				}
			}
		}
		every_owned_province = {
			remove_province_modifier = to_japanese_production_boost
			remove_province_modifier = to_japanese_production_boost_improved
		}
	}
}

to_japanese_boost_check = {
	if = {
		limit = {
			is_empty = no
			has_global_flag = to_opened_japanese_ports
			region = japan_region
			owner = {
				culture_group = japanese_g
			}
		}
		if = {
			limit = {
				nhs_check_existing_elysian_tags_with_full_condition = {
					CONDITION = "religion = PREV"
				}
			}
			remove_province_modifier = to_japanese_production_boost
			add_province_modifier = {
				name = to_japanese_production_boost_improved
				duration = -1
			}
		}
		else = {
			remove_province_modifier = to_japanese_production_boost_improved
			add_province_modifier = {
				name = to_japanese_production_boost
				duration = -1
			}
		}
	}
}

to_upgrade_japanese_boosts = {
	every_province = {
		limit = {
			region = japan_region
			owner = {
				culture_group = japanese_g
			}
			nhs_check_existing_elysian_tags_with_full_condition = {
				CONDITION = "religion = PREV"
			}
		}
		remove_province_modifier = to_japanese_production_boost
		if = {
			limit = {
				owner = {
					culture_group = japanese_g
				}
			}
			add_province_modifier = {
				name = to_japanese_production_boost_improved
				duration = -1
			}
		}
	}
}

to_downgrade_japanese_boosts = {
	every_province = {
		limit = {
			has_province_modifier = to_japanese_production_boost_improved
		}
		remove_province_modifier = to_japanese_production_boost_improved
		if = {
			limit = {
				owner = {
					culture_group = japanese_g
				}
			}
			add_province_modifier = {
				name = to_japanese_production_boost
				duration = -1
			}
		}
	}
}

to_handle_para_bellum_modifier = {
	if = {
		limit = {
			province_group = elysian_fortification_pgroup
		}
		if = {
			limit = {
				has_influencing_fort = yes
				owner = {
					mission_completed = to_para_bellum_mission
				}
				NOT = { has_province_modifier = to_para_bellum_modifier_tm }
				NOT = {
					calc_true_if = {
						amount = 5
						all_province = {
							has_province_modifier = to_para_bellum_modifier_tm
						}
					}
				}
			}
			add_province_triggered_modifier = to_para_bellum_modifier_tm
		}
		else_if = {
			limit = {
				has_province_modifier = to_para_bellum_modifier_tm
				OR = {
					has_influencing_fort = no
					NOT = {
						owner = {
							mission_completed = to_para_bellum_mission
						}
					}
				}
			}
			# remove_province_triggered_modifier = to_para_bellum_modifier_tm
			hidden_effect = {
				province_event = { id = nhs_mission_events.25 }
			}
		}
	}
}

to_handle_para_bellum_modifier_fort_build = {
	if = {
		limit = {
			province_group = elysian_fortification_pgroup
			owner = {
				mission_completed = to_para_bellum_mission
			}
			NOT = {
				calc_true_if = {
					amount = 5
					all_province = {
						has_province_modifier = to_para_bellum_modifier_tm
					}
				}
			}
		}
		custom_tooltip = to_add_para_bellum_province_modifier_tt
		hidden_effect = {
			# Apparently can't directly add or remove province triggered modifiers in on_build/on_destroyed effects. Fun.
			province_event = { id = nhs_mission_events.24 }
		}
	}
}

to_handle_para_bellum_modifier_on_fort_destroyed = {
	if = {
		limit = {
			has_province_modifier = to_para_bellum_modifier_tm
		}
		if = {
			limit = {
				nhs_check_existing_elysian_tags_with_full_condition = { 
					CONDITION = "mission_completed = to_para_bellum_mission"
				}
			}
			custom_tooltip = to_remove_para_bellum_modifier_moving_tt
		}
		else = {
			custom_tooltip = to_remove_para_bellum_modifier_tt
		}
		hidden_effect = {
			province_event = { id = nhs_mission_events.25 }
		}
	}
}

to_trial_and_execute_the_pope_effect = {
	add_splendor = 50
	add_prestige_or_monarch_power = { amount = 10 }
	custom_tooltip = nhs_new_line_tt
	to_seize_papal_treasury_christian = yes
	add_estate_loyalty = {
		estate = estate_church
		loyalty = 20
	}
	custom_tooltip = nhs_new_line_tt
	define_advisor = {
		type = inquisitor
		skill = 4
		cost_multiplier = 0.1
	}
	custom_tooltip = nhs_new_line_tt
	if = {
		limit = {
			has_estate_privilege = estate_burghers_enforced_interfaith_dialogue
		}
		remove_estate_privilege = estate_burghers_enforced_interfaith_dialogue
		add_estate_loyalty = {
			estate = estate_burghers
			loyalty = -20
		}
		custom_tooltip = nhs_new_line_tt
	}
	add_country_modifier = {
		name = to_executed_pope
		duration = 18250
	}
}

to_conquer_rome_christian_effect = {
	if = {
		limit = {
			has_dlc = "Mandate of Heaven"
		}
		add_splendor = 50
	}
	else = {
		add_stability_or_adm_power = yes
	}
	add_prestige_or_monarch_power = { amount = 20 }
	add_estate_loyalty = {
		estate = estate_church
		loyalty = 10
	}
}

to_conquer_rome_pagan_syncretic_effect = {
	if = {
		limit = {
			has_dlc = "Mandate of Heaven"
		}
		add_splendor = 50
	}
	else = {
		add_stability_or_adm_power = yes
	}
	add_prestige_or_monarch_power = { amount = 20 }
	custom_tooltip = nhs_new_line_tt
	if = {
		limit = {
			NOT = { has_dlc = "Leviathan" }
		}
		add_country_modifier = {
			name = to_increased_tolerance
			duration = 36500
		}
	}
	custom_tooltip = to_pantheon_intact_tt
	custom_tooltip = nhs_new_line_tt
}

to_conquer_rome_pagan_effect = {
	if = {
		limit = {
			has_dlc = "Mandate of Heaven"
		}
		add_splendor = 50
	}
	else = {
		add_stability_or_adm_power = yes
	}
	add_prestige_or_monarch_power = { amount = 20 }
	custom_tooltip = nhs_new_line_tt
	if = {
		limit = {
			has_dlc = "Leviathan"
		}
		custom_tooltip = to_enable_pantheon_monument_tt
		hidden_effect = {
			118 = {
				set_province_flag = to_pantheon_great_project_non_syncretic
				if = {
					limit = {
						has_great_project = {
							type = nhs_pantheon_syncretic
						}
					}
					destroy_great_project = {
						type = nhs_pantheon_syncretic
					}
				}
			}
		}
		if = {
			limit = {
				118 = {
					construction_progress = 0
				}
			}
			custom_tooltip = to_monument_visible_when_construction_finished_tt
		}
		hidden_effect = {
			if = {
				limit = {
					NOT = {
						118 = {
							construction_progress = 0
						}
					}
				}
				if = {
					limit = {
						118 = {
							NOT = {
								has_great_project = {
									type = nhs_pantheon
								}
							}
						}
					}
					118 = {
						add_great_project = {
							type = nhs_pantheon
							instant = yes
						}
					}
				}
			}
		}
		custom_tooltip = nhs_new_line_tt
	}
	else = {
		add_country_modifier = {
			name = to_inspired_missionaries
			duration = 36500
		}
	}
}

to_burn_rome_effect = {
	add_splendor = 50
	to_seize_papal_treasury_pagan = yes
	if = {
		limit = {
			has_estate_privilege = estate_burghers_enforced_interfaith_dialogue
		}
		remove_estate_privilege = estate_burghers_enforced_interfaith_dialogue
		add_estate_loyalty = {
			estate = estate_burghers
			loyalty = -20
		}
	}
	custom_tooltip = nhs_new_line_tt
	if = {
		limit = {
			has_dlc = "Leviathan"
		}
		add_country_modifier = {
			name = to_religious_fanaticism
			duration = 18250
		}
	}
	else = {
		add_country_modifier = {
			name = to_religious_fanaticism
			duration = 36500
		}
	}
	custom_tooltip = to_rome_scope_tt
	custom_tooltip = to_change_religion_to_ROOT_tt
	custom_tooltip = to_gain_80_devastation_and_remova_all_loot_tt
	custom_tooltip = to_reduce_rome_base_tax_tt
	custom_tooltip = to_reduce_rome_base_production_tt
	custom_tooltip = to_reduce_rome_base_manpower_tt
	if = {
		limit = {
			has_dlc = "Leviathan"
			118 = {
				has_great_project = {
					type = stpeters_cathedral
				}
			}
		}
		if = {
			limit = {
				118 = {
					has_great_project = {
						type = stpeters_cathedral
						tier = 3
					}
				}
			}
			custom_tooltip = to_sack_stpeters_cathedral_3_tt
			hidden_effect = {
				add_treasury = 9000
			}
		}
		else_if = {
			limit = {
				118 = {
					has_great_project = {
						type = stpeters_cathedral
						tier = 2
					}
				}
			}
			custom_tooltip = to_sack_stpeters_cathedral_2_tt
			hidden_effect = {
				add_treasury = 4000
			}
		}
		else_if = {
			limit = {
				118 = {
					has_great_project = {
						type = stpeters_cathedral
						tier = 1
					}
				}
			}
			custom_tooltip = to_sack_stpeters_cathedral_1_tt
			hidden_effect = {
				add_treasury = 1500
			}
		}
		else = {
			custom_tooltip = to_sack_stpeters_cathedral_0_tt
			hidden_effect = {
				add_treasury = 500
			}
		}
		hidden_effect = {
			118 = {
				destroy_great_project = {
					type = stpeters_cathedral
				}
				hide_ambient_object = stpeters_cathedral
			}
		}
	}
	hidden_effect = {
		118 = {
			change_religion = ROOT
			add_devastation = 80
			remove_loot = {
				who = ROOT
				amount = 1000
			}
			while = {
				limit = {
					check_variable = {
						which = to_rome_removed_base_tax
						value = 1
					}
				}
				add_base_tax = -1
				subtract_variable = {
					which = to_rome_removed_base_tax
					value = 1
				}
			}
			while = {
				limit = {
					check_variable = {
						which = to_rome_removed_base_production
						value = 1
					}
				}
				add_base_production = -1
				subtract_variable = {
					which = to_rome_removed_base_production
					value = 1
				}
			}
			while = {
				limit = {
					check_variable = {
						which = to_rome_removed_base_manpower
						value = 1
					}
				}
				add_base_manpower = -1
				subtract_variable = {
					which = to_rome_removed_base_manpower
					value = 1
				}
			}
		}
	}
	custom_tooltip = nhs_new_line_tt
	if = {
		limit = {
			has_dlc = "Leviathan"
		}
		custom_tooltip = to_enable_pantheon_monument_tt
		hidden_effect = {
			118 = {
				set_province_flag = to_pantheon_great_project_non_syncretic
				if = {
					limit = {
						has_great_project = {
							type = nhs_pantheon_syncretic
						}
					}
					destroy_great_project = {
						type = nhs_pantheon_syncretic
					}
				}
			}
		}
		if = {
			limit = {
				118 = {
					construction_progress = 0
				}
			}
			custom_tooltip = to_monument_visible_when_construction_finished_tt
		}
		hidden_effect = {
			if = {
				limit = {
					NOT = {
						118 = {
							construction_progress = 0
						}
					}
				}
				if = {
					limit = {
						118 = {
							NOT = {
								has_great_project = {
									type = nhs_pantheon
								}
							}
						}
					}
					118 = {
						add_great_project = {
							type = nhs_pantheon
							instant = yes
						}
					}
				}
			}
		}
		custom_tooltip = nhs_new_line_tt
	}
}

to_seize_papal_treasury_christian = {
	if = {
		limit = {
			has_dlc = "Emperor"
		}
		# Alt: \nFurther Y15.0%! will be seized by Y[Root.GetClergyName]!, increasing their loyalty by G20!
		custom_tooltip = to_seize_papal_treasury_christian_tt
		hidden_effect = {
			# add_estate_loyalty = {
			# 	estate = estate_church
			# 	loyalty = 20
			# }
			while = {
				limit = {
					check_variable = {
						which = to_removed_curia_treasury
						value = 1000
					}
				}
				add_treasury = 1000
				add_curia_treasury = -1000
				subtract_variable = {
					which = to_removed_curia_treasury
					value = 1000
				}
			}
			while = {
				limit = {
					check_variable = {
						which = to_removed_curia_treasury
						value = 100
					}
				}
				add_treasury = 100
				add_curia_treasury = -100
				subtract_variable = {
					which = to_removed_curia_treasury
					value = 100
				}
			}
			while = {
				limit = {
					check_variable = {
						which = to_removed_curia_treasury
						value = 10
					}
				}
				add_treasury = 10
				add_curia_treasury = -10
				subtract_variable = {
					which = to_removed_curia_treasury
					value = 10
				}
			}
			while = {
				limit = {
					check_variable = {
						which = to_removed_curia_treasury
						value = 1
					}
				}
				add_treasury = 1
				add_curia_treasury = -1
				subtract_variable = {
					which = to_removed_curia_treasury
					value = 1
				}
			}
			set_variable = {
				which = to_removed_curia_treasury
				value = 0
			}
		}
	}
	else = {
		custom_tooltip = to_plunder_curia_treasury_christian_tt
		# add_estate_loyalty = {
		# 	estate = estate_church
		# 	loyalty = 20
		# }
		hidden_effect = {
			add_treasury = 2000
		}
	}
}

to_seize_papal_treasury_pagan = {
	if = {
		limit = {
			has_dlc = "Emperor"
		}
		custom_tooltip = to_seize_papal_treasury_pagan_tt
		hidden_effect = {
			while = {
				limit = {
					check_variable = {
						which = to_removed_curia_treasury
						value = 1000
					}
				}
				add_treasury = 1000
				add_curia_treasury = -1000
				subtract_variable = {
					which = to_removed_curia_treasury
					value = 1000
				}
			}
			while = {
				limit = {
					check_variable = {
						which = to_removed_curia_treasury
						value = 100
					}
				}
				add_treasury = 100
				add_curia_treasury = -100
				subtract_variable = {
					which = to_removed_curia_treasury
					value = 100
				}
			}
			while = {
				limit = {
					check_variable = {
						which = to_removed_curia_treasury
						value = 10
					}
				}
				add_treasury = 10
				add_curia_treasury = -10
				subtract_variable = {
					which = to_removed_curia_treasury
					value = 10
				}
			}
			while = {
				limit = {
					check_variable = {
						which = to_removed_curia_treasury
						value = 1
					}
				}
				add_treasury = 1
				add_curia_treasury = -1
				subtract_variable = {
					which = to_removed_curia_treasury
					value = 1
				}
			}
			set_variable = {
				which = to_removed_curia_treasury
				value = 0
			}
		}
	}
	else = {
		custom_tooltip = to_plunder_curia_treasury_pagan_tt
		hidden_effect = {
			add_treasury = 5000
		}
	}
}

to_increase_defender_of_faith_progress = {
	if = {
		limit = {
			$TARGET$ = {
				religion_group = christian
				OR = {
					nhs_check_all_elysian_tags = { CONDITION = tag }
					AND = {
						has_country_flag = to_gives_defender_of_faith_dof_credit
						nhs_check_existing_elysian_tags_with_full_condition = {
							CONDITION = "religion = PREV"
						}
					}
				}
			}
		}
		$EFFECT_SCOPE$ = {
			limit = {
				has_country_flag = to_gives_defender_of_faith_credit
				NOT = { war_with = $TARGET$ }
			}
			clr_country_flag = to_gives_defender_of_faith_credit
			if = {
				limit = {
					religion_group = christian
				}
				if = {
					limit = {
						has_country_flag = to_gives_defender_of_faith_minor_credit
					}
					clr_country_flag = to_gives_defender_of_faith_minor_credit
					$TARGET$ = {
						change_variable = {
							which = to_defender_of_faith_mission_counter_won_wars
							value = 1
						}
						change_variable = {
							which = to_defender_of_faith_progress
							value = 5
						}
					}
				}
				if = {
					limit = {
						OR = {
							is_great_power = yes
							AND = {
								NOT = { has_dlc = "Rights of Man" }
								NOT = { has_dlc = "Emperor" }
								total_development = 500
							}
							has_country_flag = to_gives_defender_of_faith_great_power_credit
						}
					}
					clr_country_flag = to_gives_defender_of_faith_great_power_credit
					$TARGET$ = {
						change_variable = {
							which = to_defender_of_faith_mission_counter_great_power
							value = 1
						}
						change_variable = {
							which = to_defender_of_faith_progress
							value = 5
						}
					}
				}
				if = {
					limit = {
						tag = PAP
						$TARGET$ = {
							NOT = { 
								check_variable = {
									which = to_defender_of_faith_mission_counter_pope
									value = 1
								}
							}
						}
					}
					$TARGET$ = {
						change_variable = {
							which = to_defender_of_faith_mission_counter_pope
							value = 1
						}
						change_variable = {
							which = to_defender_of_faith_progress
							value = 5
						}
					}
				}
			}
			else = {
				clr_country_flag = to_gives_defender_of_faith_minor_credit
				clr_country_flag = to_gives_defender_of_faith_great_power_credit
			}
		}
	}
}

to_increase_defender_of_faith_mission_progress_dof = {
	if = {
		limit = {
			has_country_flag = to_gives_defender_of_faith_dof_credit
			nhs_check_existing_elysian_tags_with_full_condition = {
				CONDITION = "religion = PREV"
			}
			NOT = {
				nhs_check_existing_elysian_tags_with_full_condition = {
					CONDITION = "
						is_in_war = {
							defenders = THIS
							defender_leader = ROOT
						}
					"
				}
			}
		}
		clr_country_flag = to_gives_defender_of_faith_dof_credit
		nhs_effect_for_existing_elysian_tag = {
			EFFECT = "
				change_variable = {
					which = to_defender_of_faith_mission_counter_dof
					value = 1
				}
				change_variable = {
					which = to_defender_of_faith_progress
					value = 20
				}
			"
		}
	}
}

to_clear_invalid_defender_of_faith_mission_flags = {
	if = {
		limit = {
			nhs_check_all_elysian_tags = { CONDITION = tag }
			religion_group = christian
		}
		if = {
			limit = {
				any_country = {
					has_country_flag = to_gives_defender_of_faith_credit
					NOT = { war_with = ROOT }
				}
			}
			every_country = {
				limit = {
					has_country_flag = to_gives_defender_of_faith_credit
					NOT = { war_with = ROOT }
				}
				clr_country_flag = to_gives_defender_of_faith_credit
				clr_country_flag = to_gives_defender_of_faith_minor_credit
				clr_country_flag = to_gives_defender_of_faith_great_power_credit
			}
		}
		if = {
			limit = {
				is_defender_of_faith = yes
				any_country = {
					religion = ROOT
					has_country_flag = to_gives_defender_of_faith_dof_credit
					NOT = {
						is_in_war = {
							defenders = ROOT
							defender_leader = THIS
						}
					}
				}
			}
			every_country = {
				limit = {
					religion = ROOT
					has_country_flag = to_gives_defender_of_faith_dof_credit
					NOT = {
						is_in_war = {
							defenders = ROOT
							defender_leader = THIS
						}
					}
				}
				clr_country_flag = to_gives_defender_of_faith_dof_credit
			}
		}
	}
}

to_clear_all_defender_of_faith_mission_flags = {
	if = {
		limit = {
			nhs_check_all_elysian_tags = { CONDITION = tag }
		}
		set_variable = {
			which = to_defender_of_faith_progress
			value = 0
		}
		every_country = {
			clr_country_flag = to_gives_defender_of_faith_credit
			clr_country_flag = to_gives_defender_of_faith_minor_credit
			clr_country_flag = to_gives_defender_of_faith_great_power_credit
			clr_country_flag = to_gives_defender_of_faith_dof_credit
		}
	}
}

to_defender_of_faith_mission_check_force_conversion = {
	if = {
		limit = {
			FROM = {
				religion_group = christian
				nhs_check_all_elysian_tags = { CONDITION = tag }
			}
		}
		FROM = {
			change_variable = {
				which = to_defender_of_faith_mission_counter_force_conversion
				value = 1
			}
			change_variable = {
				which = to_defender_of_faith_progress
				value = 5
			}
		}
	}
}

to_add_champion_of_faith_modifier = {
	if = {
		limit = {
			mission_completed = to_defender_of_the_faith_mission
			religion_group = christian
		}
		add_country_modifier = {
			name = to_improved_elysian_orthodox_defender_of_faith
			duration = -1
			desc = to_as_long_as_we_remain_dof
		}
	}
}

to_remove_champion_of_faith_modifier = {
	remove_country_modifier = to_improved_elysian_orthodox_defender_of_faith
}

to_refresh_elysian_missions = {
	if = {
		limit = {
			nhs_check_all_elysian_tags = { CONDITION = tag }
		}
		swap_non_generic_missions = yes
	}
}

to_nhs_set_up_varangians_in_province = {
	if = {
		limit = {
			any_owned_province = {
				is_core = VGD
				NOT = { province_id = $PROVINCE_ID$ }
			}
		}
		every_owned_province = {
			limit = {
				is_core = VGD
				NOT = { province_id = $PROVINCE_ID$ }
			}
			remove_core = VGD
		}
	}
	if = {
		limit = {
			any_owned_province = {
				has_province_modifier = to_varangian_headquarters
			}
		}
		every_owned_province = {
			remove_province_modifier = to_varangian_headquarters
		}
	}
	if = {
		limit = {
			has_country_flag = nhs_varangian_guard_integrated
		}
		$PROVINCE_ID$ = {
			add_province_modifier = {
				name = to_varangian_headquarters
				duration = -1
			}
			[[EXTRA_DEVELOPMENT]
			add_base_manpower = 3
			]
		}
	}
	else = {
		tooltip = {
			$PROVINCE_ID$ = {
				cede_province = VGD
				[[EXTRA_DEVELOPMENT]
				add_base_manpower = 3
				]
			}
			create_subject = {
				subject_type = elysian_subject_varangian
				subject = VGD
			}
		}
		set_country_flag = nhs_varangian_guard_substate
		if = {
			limit = {
				$PROVINCE_ID$ = {
					OR = {
						has_province_modifier = nhs2_european_enclave
						has_province_modifier = nhs2_small_por_enclave
						has_province_modifier = nhs2_por_enclave
						has_province_modifier = nhs2_large_por_enclave
					}
				}
			}
			$PROVINCE_ID$ = {
				nhs_move_t_post = yes
			}
		}
		hidden_effect = {
			$PROVINCE_ID$ = {
				add_core = VGD
				ROOT = {
					release = VGD
				}
				if = {
					limit = {
						ROOT = {
							NOT = { has_country_flag = to_varangian_culture_change }
						}
					}
					change_culture = varangian_n
				}
				else = {
					change_culture = varangian_e
				}
				change_religion = ROOT
				VGD = {
					set_capital = $PROVINCE_ID$
					change_religion = ROOT
					if = {
						limit = {
							ROOT = {
								NOT = { has_country_flag = to_varangian_culture_change }
							}
						}
						to_primary_culture_and_ruler_heir_consort_culture_if_primary = {
							CULTURE = varangian_n
							PRIMARY_CULTURE = THIS
						}
					}
					else = {
						to_primary_culture_and_ruler_heir_consort_culture_if_primary = {
							CULTURE = varangian_e
							PRIMARY_CULTURE = THIS
						}
					}
					hidden_effect = {
						nhs_change_government = { GOV = varangian_order_gov }
					}
					nhs_add_gov_reform = { REF = varangian_guard }
				}
				[[EXTRA_DEVELOPMENT]
				add_base_manpower = 3
				]
			}
			every_province = {
				limit = {
					has_discovered = ROOT
				}
				discover_country = VGD
			}
			VGD = {
				change_technology_group = viking
			}
			create_subject = {
				subject_type = elysian_subject_varangian
				subject = VGD
			}
		}
	}
}

to_nhs_set_up_independant_varangians_in_province = {
	hidden_effect = {
		cede_province = ROOT
		change_religion = norse_pagan_reformed
		if = {
			limit = {
				ROOT = {
					NOT = { has_country_flag = to_varangian_culture_change }
				}
			}
			change_culture = varangian_n
		}
		else = {
			change_culture = varangian_e
		}
		add_core = VGD
		ROOT = { release = VGD }
		VGD = {
			change_religion = norse_pagan_reformed
			if = {
				limit = {
					ROOT = {
						NOT = { has_country_flag = to_varangian_culture_change }
					}
				}
				to_primary_culture_and_ruler_heir_consort_culture_if_primary = {
					CULTURE = varangian_n
					PRIMARY_CULTURE = THIS
					ONLY_SHOW_PRIMARY = yes
				}
			}
			else = {
				to_primary_culture_and_ruler_heir_consort_culture_if_primary = {
					CULTURE = varangian_e
					PRIMARY_CULTURE = THIS
					ONLY_SHOW_PRIMARY = yes
				}
			}
			hidden_effect = {
				nhs_change_government = { GOV = varangian_order_gov }
			}
			nhs_add_gov_reform = { REF = varangian_guard }
			add_country_modifier = { 
				name = nhs_early_uprising_reduction
				duration = 7300
			}
			every_war_enemy_country = {
				white_peace = PREV
			}
		}
	}
}

to_handle_varangian_quarter_on_capital_moved = {
	if = {
		limit = {
			owner = {
				has_country_flag = established_varangians
			}
			NOT = { has_province_modifier = to_varangian_quarter }
		}
		owner = {
			every_owned_province = {
				remove_province_modifier = to_varangian_quarter
			}
		}
		add_province_modifier = {
			name = to_varangian_quarter
			duration = -1
		}
	}
}

to_handle_epilektoi_garrison_on_capital_moved = {
	if = {
		limit = {
			owner = {
				has_country_flag = to_established_epilektoi
			}
			NOT = { has_province_modifier = to_epilektoi_garrison }
		}
		owner = {
			every_owned_province = {
				remove_province_modifier = to_epilektoi_garrison
			}
		}
		add_province_modifier = {
			name = to_epilektoi_garrison
			duration = -1
		}
	}
}

to_choose_potential_varangian_province_target = {
	if = {
		limit = {
			NOT = { has_saved_event_target = $EVENT_TARGET$ }
		}
		random_owned_province = {
			limit = {
				region = northeast_america_region
				NOT = { area = chesapeake_area }
				NOT = { has_albanian_majority_modifier = yes }
				has_port = yes
				NOT = {
					OR = {
						has_province_modifier = nhs2_european_enclave
						has_province_modifier = nhs2_small_por_enclave
						has_province_modifier = nhs2_por_enclave
						has_province_modifier = nhs2_large_por_enclave
					}
				}
				is_colony = no
			}
			save_event_target_as = $EVENT_TARGET$
		}
	}
	if = {
		limit = {
			NOT = { has_saved_event_target = $EVENT_TARGET$ }
		}
		random_owned_province = {
			limit = {
				region = northeast_america_region
				NOT = { area = chesapeake_area }
				NOT = { has_albanian_majority_modifier = yes }
				NOT = {
					OR = {
						has_province_modifier = nhs2_european_enclave
						has_province_modifier = nhs2_small_por_enclave
						has_province_modifier = nhs2_por_enclave
						has_province_modifier = nhs2_large_por_enclave
					}
				}
				is_colony = no
			}
			save_event_target_as = $EVENT_TARGET$
		}
	}
	if = {
		limit = {
			NOT = { has_saved_event_target = $EVENT_TARGET$ }
		}
		random_owned_province = {
			limit = {
				region = northeast_america_region
				NOT = { area = chesapeake_area }
				NOT = { has_albanian_majority_modifier = yes }
				is_colony = no
			}
			save_event_target_as = $EVENT_TARGET$
		}
	}
}

to_disband_varangians = {
	clr_country_flag = to_disable_found_varangian_order_decision
	clr_country_flag = nhs_varangian_guard_substate
	clr_country_flag = nhs_varangian_guard_integrated
	clr_country_flag = to_promised_province_to_varangians
	clr_country_flag = to_varangians_settled_on_malta
	clr_country_flag = to_can_settle_varangians_on_malta
	clr_country_flag = nhs_delayed_varangians
	clr_country_flag = nhs_var_area
	set_country_flag = nhs_disbanded_varangians
	if = {
		limit = {
			has_regency = no
		}
		random = {
			chance = 50
			kill_ruler = yes
		}
	}
	else_if = {
		limit = {
			has_consort_regency = yes
		}
		random = {
			chance = 50
			custom_tooltip = to_kill_consort_tt
			hidden_effect = {
				remove_consort = yes
			}
		}
	}
	else = {
		random = {
			chance = 50
			kill_heir = {}
		}
	}
	custom_tooltip = to_varangian_guard_permanently_disbanded_tt
	remove_country_modifier = nhs2_varangian_influence
	if = {
		limit = {
			any_owned_province = {
				has_province_modifier = to_varangian_quarter
			}
		}
		every_owned_province = {
			limit = {
				has_province_modifier = to_varangian_quarter
			}
			remove_province_modifier = to_varangian_quarter
		}
	}
	hidden_effect = {
		if = {
			limit = {
				any_hired_mercenary_company = {
					template = merc_varangian_guard
				}
			}
			random_hired_mercenary_company = {
				limit = {
					template = merc_varangian_guard
				}
				disband_mercenary_company = THIS
			}
		}
	}
	custom_tooltip = nhs_new_line_tt
	if = {
		limit = {
			any_known_country = {
				nhs_check_all_vinland = { CONDITION = tag }
			}
		}
		every_known_country = {
			limit = {
				nhs_check_all_vinland = { CONDITION = tag }
			}
			add_opinion = {
				who = ROOT
				modifier = to_disbanded_varangian_order_om
			}
			country_event = { id = nhs_vov_varangian_order_events.15 }
		}
		custom_tooltip = nhs_new_line_tt
	}
	if = {
		limit = {
			capital_scope = {
				controlled_by = ROOT
				NOT = { units_in_province = ROOT }
				NOT = {
					any_country = {
						is_subject_of = ROOT
						PREV = {
							units_in_province = PREV
						}
					}
				}
			}
		}
		capital_scope = {
			spawn_rebels = {
				type = to_varangian_rebels
				size = 1
				win = yes
			}
		}
	}
	else_if = {
		limit = {
			capital_scope = {
				area_for_scope_province = {
					owned_by = ROOT
					controlled_by = ROOT
					NOT = { units_in_province = ROOT }
					NOT = {
						any_country = {
							is_subject_of = ROOT
							PREV = {
								units_in_province = PREV
							}
						}
					}
				}
			}
		}
		random_owned_province = {
			limit = {
				controlled_by = ROOT
				NOT = { units_in_province = ROOT }
				NOT = {
					any_country = {
						is_subject_of = ROOT
						PREV = {
							units_in_province = PREV
						}
					}
				}
				area_for_scope_province = {
					is_capital = yes
					owned_by = ROOT
				}
			}
			spawn_rebels = {
				type = to_varangian_rebels
				size = 1
				win = yes
			}
		}
	}
	else_if = {
		limit = {
			any_owned_province = {
				is_in_capital_area = yes
				controlled_by = ROOT
				NOT = { units_in_province = ROOT }
				NOT = {
					any_country = {
						is_subject_of = ROOT
						PREV = {
							units_in_province = PREV
						}
					}
				}
			}
		}
		random_owned_province = {
			limit = {
				is_in_capital_area = yes
				controlled_by = ROOT
				NOT = { units_in_province = ROOT }
				NOT = {
					any_country = {
						is_subject_of = ROOT
						PREV = {
							units_in_province = PREV
						}
					}
				}
			}
			spawn_rebels = {
				type = to_varangian_rebels
				size = 1
				win = yes
			}
		}
	}
	else_if = {
		limit = {
			capital_scope = {
				controlled_by = ROOT
			}
		}
		capital_scope = {
			spawn_rebels = {
				type = to_varangian_rebels
				size = 1
				win = yes
			}
		}
	}
	else_if = {
		limit = {
			capital_scope = {
				area_for_scope_province = {
					owned_by = ROOT
					controlled_by = ROOT
				}
			}
		}
		random_owned_province = {
			limit = {
				controlled_by = ROOT
				area_for_scope_province = {
					is_capital = yes
					owned_by = ROOT
				}
			}
			spawn_rebels = {
				type = to_varangian_rebels
				size = 1
				win = yes
			}
		}
	}
	else = {
		random_owned_province = {
			limit = {
				is_in_capital_area = yes
				controlled_by = ROOT
			}
			spawn_rebels = {
				type = to_varangian_rebels
				size = 1
				win = yes
			}
		}
	}
	[[WIPE_VARANGIAN_CORES]
	hidden_effect = {
		every_province = {
			limit = {
				is_core = VGD
			}
			remove_core = VGD
		}
	}
	]
	if = {
		limit = {
			any_owned_province = {
				OR = {
					has_province_modifier = to_varangian_headquarters
					has_province_modifier = to_varangian_stronghold
					has_province_modifier = to_varangian_stronghold_independent
				}
			}
		}
		custom_tooltip = nhs_new_line_tt
		every_owned_province = {
			limit = {
				OR = {
					has_province_modifier = to_varangian_headquarters
					has_province_modifier = to_varangian_stronghold
					has_province_modifier = to_varangian_stronghold_independent
				}
			}
			if = {
				limit = {
					has_province_modifier = to_varangian_headquarters
				}
				remove_province_modifier = to_varangian_headquarters
				spawn_rebels = {
					type = to_varangian_rebels
					size = 2
					win = yes
				}
			}
			else = {
				remove_province_modifier = to_varangian_stronghold
				remove_province_modifier = to_varangian_stronghold_independent
				spawn_rebels = {
					type = to_varangian_rebels
					size = 1
					win = yes
				}
			}
		}
	}
	[[ANNEX_PROVINCES]
	if = {
		limit = {
			exists = VGD
			VGD = {
				is_subject_of = ROOT
			}
		}
		if = {
			limit = {
				NOT = {
					any_owned_province = {
						OR = {
							has_province_modifier = to_varangian_headquarters
							has_province_modifier = to_varangian_stronghold
							has_province_modifier = to_varangian_stronghold_independent
						}
					}
				}
			}
			custom_tooltip = nhs_new_line_tt
		}
		every_province = {
			limit = {
				owned_by = VGD
			}
			if = {
				limit = {
					is_capital = yes
				}
				cede_province = ROOT
				spawn_rebels = {
					type = to_varangian_rebels
					size = 2
					win = yes
				}
			}
			else_if = {
				limit = {
					OR = { 
						culture = varangian_e
						culture = varangian_n
					}
				}
				cede_province = ROOT
				spawn_rebels = {
					type = to_varangian_rebels
					size = 1
					win = yes
				}
			}
			else = {
				cede_province = ROOT
			}
			hidden_effect = {
				remove_core = VGD
			}
		}
	}
	]

	[[SPAWN_VARANGIAN_REBEL_STATE]
	custom_tooltip = nhs_new_line_tt
	if = {
		limit = {
			any_province = {
				is_empty = yes
				region = northeast_america_region
				has_port = yes
				NOT = {
					any_neighbor_province = {
						owner = {
							OR = {
								technology_group = exiled_greek
								technology_group = viking
							}
						}
					}
				}
			}
		}
		custom_tooltip = nhs_varangians_independant_tt
		random_province = {
			limit = {
				is_empty = yes
				region = northeast_america_region
				has_port = yes
				NOT = {
					any_neighbor_province = {
						owner = {
							OR = {
								technology_group = exiled_greek
								technology_group = viking
							}
						}
					}
				}
			}
			to_nhs_set_up_independant_varangians_in_province = yes
		}
	}
	else_if = {
		limit = {
			any_province = {
				is_empty = yes
				region = northeast_america_region
				NOT = {
					any_neighbor_province = {
						owner = {
							OR = {
								technology_group = exiled_greek
								technology_group = viking
							}
						}
					}
				}
			}
		}
		custom_tooltip = nhs_varangians_independant_tt
		random_province = {
			limit = {
				is_empty = yes
				region = northeast_america_region
				NOT = {
					any_neighbor_province = {
						owner = {
							OR = {
								technology_group = exiled_greek
								technology_group = viking
							}
						}
					}
				}
			}
			to_nhs_set_up_independant_varangians_in_province = yes
		}
	}
	else_if = {
		limit = {
			any_province = {
				is_empty = yes
				has_port = yes
				region = great_lakes_region
				NOT = {
					any_neighbor_province = {
						owner = {
							OR = {
								technology_group = exiled_greek
								technology_group = viking
							}
						}
					}
				}
			}
		}
		custom_tooltip = nhs_varangians_independant_tt
		random_province = {
			limit = {
				is_empty = yes
				has_port = yes
				region = great_lakes_region
				NOT = {
					any_neighbor_province = {
						owner = {
							OR = {
								technology_group = exiled_greek
								technology_group = viking
							}
						}
					}
				}
			}
			to_nhs_set_up_independant_varangians_in_province = yes
		}
	}
	else_if = {
		limit = {
			any_province = {
				is_empty = yes
				region = great_lakes_region
				NOT = {
					any_neighbor_province = {
						owner = {
							OR = {
								technology_group = exiled_greek
								technology_group = viking
							}
						}
					}
				}
			}
		}
		custom_tooltip = nhs_varangians_independant_tt
		random_province = {
			limit = {
				is_empty = yes
				region = great_lakes_region
				NOT = {
					any_neighbor_province = {
						owner = {
							OR = {
								technology_group = exiled_greek
								technology_group = viking
							}
						}
					}
				}
			}
			to_nhs_set_up_independant_varangians_in_province = yes
		}
	}
	]
}

to_calculate_transfered_varangian_manpower = {
	hidden_effect = {
		set_variable = {
			which = to_varangian_guard_size_contribution
			which = to_varangian_guard_size
		}
		if = {
			limit = {
				any_war_enemy_country = {
					nhs_check_all_vinland = { CONDITION = tag }
					defensive_war_with = ROOT
				}
			}
			if = {
				limit = {
					exists = VGD
					VGD = {
						is_subject_of = ROOT
					}
				}
				set_country_flag = to_calculated_transfered_manpower_subject
				to_calculate_fraction_of_varangian_subject_manpower = {
					FRACTION_TRANSFERED = $FRACTION_TRANSFERED$
				}
			}
			else_if = {
				limit = {
					has_country_flag = nhs_varangian_guard_integrated
				}
				set_country_flag = to_calculated_transfered_manpower_integrated
				to_calculate_fraction_of_integrated_varangian_manpower = {
					VARIABLE = to_transfered_varangian_manpower_$FRACTION_TRANSFERED$
				}
				set_variable = {
					which = to_true_fraction_transfered
					value = $FRACTION_TRANSFERED$
				}
				divide_variable = {
					which = to_true_fraction_transfered
					value = 100
				}
				multiply_variable = {
					which = to_transfered_varangian_manpower_$FRACTION_TRANSFERED$
					which = to_true_fraction_transfered
				}
				divide_variable = {
					which = to_transfered_varangian_manpower_$FRACTION_TRANSFERED$
					value = 10
				}
				to_round_down_variable = { VARIABLE = to_transfered_varangian_manpower_$FRACTION_TRANSFERED$ }
				multiply_variable = {
					which = to_transfered_varangian_manpower_$FRACTION_TRANSFERED$
					value = 10
				}
			}
			set_variable = {
				which = to_transfered_varangian_manpower_gained_$FRACTION_TRANSFERED$
				which = to_transfered_varangian_manpower_$FRACTION_TRANSFERED$
			}

			set_variable = {
				which = to_true_fraction_transfered
				value = $FRACTION_TRANSFERED$
			}
			divide_variable = {
				which = to_true_fraction_transfered
				value = 100
			}
			multiply_variable = {
				which = to_varangian_guard_size_contribution
				which = to_true_fraction_transfered
			}
			change_variable = {
				which = to_transfered_varangian_manpower_gained_$FRACTION_TRANSFERED$
				which = to_varangian_guard_size_contribution
			}
			if = {
				limit = {
					check_variable = {
						which = to_number_of_viking_countries_at_war_with
						value = 2
					}
				}
				divide_variable = {
					which = to_transfered_varangian_manpower_gained_$FRACTION_TRANSFERED$
					which = to_number_of_viking_countries_at_war_with
				}
				divide_variable = {
					which = to_transfered_varangian_manpower_gained_$FRACTION_TRANSFERED$
					value = 10
				}
				to_round_down_variable = { VARIABLE = to_transfered_varangian_manpower_gained_$FRACTION_TRANSFERED$ }
				multiply_variable = {
					which = to_transfered_varangian_manpower_gained_$FRACTION_TRANSFERED$
					value = 10
				}
			}
		}

		to_remove_var_if_not_0 = { VARIABLE = to_varangian_guard_size_contribution }
		to_remove_var_if_not_0 = { VARIABLE = to_true_fraction_transfered }
	}
}

to_calculate_fraction_of_varangian_subject_manpower = {
	export_to_variable = {
		which = to_transfered_varangian_manpower_$FRACTION_TRANSFERED$
		value = max_manpower
		who = VGD
	}
	multiply_variable = {
		which = to_transfered_varangian_manpower_$FRACTION_TRANSFERED$
		value = 100
	}
	set_variable = {
		which = to_true_fraction_transfered
		value = $FRACTION_TRANSFERED$
	}
	divide_variable = {
		which = to_true_fraction_transfered
		value = 100
	}
	multiply_variable = {
		which = to_transfered_varangian_manpower_$FRACTION_TRANSFERED$
		which = to_true_fraction_transfered
	}
	set_variable = {
		which = to_true_fraction_transfered
		value = 0
	}
	to_round_down_variable = { VARIABLE = to_transfered_varangian_manpower_$FRACTION_TRANSFERED$ }
	multiply_variable = {
		which = to_transfered_varangian_manpower_$FRACTION_TRANSFERED$
		value = 10
	}
}

to_calculate_fraction_of_integrated_varangian_manpower = {
	set_variable = {
		which = $VARIABLE$
		value = 0
	}
	every_owned_province = {
		limit = {
			OR = {
				has_province_modifier = to_varangian_stronghold
				has_province_modifier = to_varangian_stronghold_independent
				has_province_modifier = to_varangian_headquarters
			}
		}
		ROOT = {
			export_to_variable = {
				which = to_local_varangian_base_manpower
				value = base_manpower
				who = PREV
			}
			multiply_variable = {
				which = to_local_varangian_base_manpower
				value = 250
			}
			export_to_variable = {
				which = to_local_varangian_manpower
				value = modifier:local_manpower
				who = PREV
			}
			multiply_variable = {
				which = to_local_varangian_manpower
				value = 1000
			}
			export_to_variable = {
				which = to_local_varangian_manpower_modifier
				value = modifier:local_manpower_modifier
				who = PREV
			}
			set_variable = {
				which = to_local_varangian_manpower_contribution
				value = 0
			}
			change_variable = {
				which = to_local_varangian_manpower_contribution
				which = to_local_varangian_base_manpower
			}
			change_variable = {
				which = to_local_varangian_manpower_contribution
				which = to_local_varangian_manpower
			}
			multiply_variable = {
				which = to_local_varangian_manpower_contribution
				which = to_local_varangian_manpower_modifier
			}
			if = {
				limit = {
					PREV = {
						NOT = {
							OR = {
								culture = varangian_e
								culture_group = norse_g
							}
						}
					}
				}
				divide_variable = {
					which = to_local_varangian_manpower_contribution
					value = 2
				}
			}
			change_variable = {
				which = $VARIABLE$
				which = to_local_varangian_manpower_contribution
			}
		}
	}
	to_remove_var_if_not_0 = { VARIABLE = to_local_varangian_base_manpower }
	to_remove_var_if_not_0 = { VARIABLE = to_local_varangian_manpower }
	to_remove_var_if_not_0 = { VARIABLE = to_local_varangian_manpower_modifier }
	to_remove_var_if_not_0 = { VARIABLE = to_local_varangian_manpower_contribution }
}

to_transfer_varangian_manpower = {
	if = {
		limit = {
			any_war_enemy_country = {
				nhs_check_all_vinland = { CONDITION = tag }
				defensive_war_with = ROOT
			}
		}
		if = {
			limit = {
				has_country_flag = to_calculated_transfered_manpower_subject
				VGD = {
					is_subject_of = ROOT
				}
			}
			VGD = {
				custom_tooltip = to_lose_transfered_varangian_manpower_$FRACTION_TRANSFERED$_tt
			}
		}
		else_if = {
			limit = {
				has_country_flag = to_calculated_transfered_manpower_integrated
			}
			custom_tooltip = to_lose_integrated_transfered_varangian_manpower_$FRACTION_TRANSFERED$_tt
		}
		tooltip = {
			if = {
				limit = {
					any_country = {
						has_country_flag = to_viking_country_at_war_with
					}
				}
				every_country = {
					limit = {
						has_country_flag = to_viking_country_at_war_with
					}
					custom_tooltip = to_gain_transfered_varangian_manpower_$FRACTION_TRANSFERED$_tt
					[[EXTRA_EFFECTS_FOR_OTHER_ENEMIES]
					$EXTRA_EFFECTS_FOR_OTHER_ENEMIES$
					]
				}
			}
		}
		hidden_effect = {
			if = {
				limit = {
					exists = VGD
					VGD = {
						is_subject_of = ROOT
					}
				}
				if = {
					limit = {
						NOT = { has_country_flag = to_calculated_transfered_manpower_subject }
					}
					to_calculate_transfered_varangian_manpower = { FRACTION_TRANSFERED = $FRACTION_TRANSFERED$ }
				}
				to_change_manpower_by_VARIABLE = {
					VARIABLE = to_transfered_varangian_manpower_$FRACTION_TRANSFERED$
					SIGN = "-"
					SCOPE = VGD
				}
			}
		}
	}
}

to_select_varangian_expedition_target = {
	if = {
		limit = {
			NOT = { has_saved_event_target = $EVENT_TARGET$ }
			exists = VGD
			VGD = {
				is_subject_of = ROOT
			}
		}
		random_owned_province = {
			limit = {
				is_colony = yes
				NOT = { area = chesapeake_area }
				$ADDITIONAL_TRIGGER$
				any_neighbor_province = {
					owned_by = VGD
				}
			}
			save_event_target_as = $EVENT_TARGET$
		}
	}
	if = {
		limit = {
			NOT = { has_saved_event_target = $EVENT_TARGET$ }
		}
		random_owned_province = {
			limit = {
				is_colony = yes
				region = canada_region
				NOT = { area = chesapeake_area }
				$ADDITIONAL_TRIGGER$
			}
			save_event_target_as = $EVENT_TARGET$
		}
	}
	if = {
		limit = {
			NOT = { has_saved_event_target = $EVENT_TARGET$ }
		}
		random_owned_province = {
			limit = {
				is_colony = yes
				region = northeast_america_region
				NOT = { area = chesapeake_area }
				$ADDITIONAL_TRIGGER$
			}
			save_event_target_as = $EVENT_TARGET$
		}
	}
	if = {
		limit = {
			NOT = { has_saved_event_target = $EVENT_TARGET$ }
		}
		random_owned_province = {
			limit = {
				is_colony = yes
				region = great_lakes_region
				NOT = { area = chesapeake_area }
				$ADDITIONAL_TRIGGER$
			}
			save_event_target_as = $EVENT_TARGET$
		}
	}
	if = {
		limit = {
			NOT = { has_saved_event_target = $EVENT_TARGET$ }
		}
		random_owned_province = {
			limit = {
				is_colony = yes
				region = hudson_bay_region
				NOT = { area = chesapeake_area }
				$ADDITIONAL_TRIGGER$
			}
			save_event_target_as = $EVENT_TARGET$
		}
	}
	if = {
		limit = {
			NOT = { has_saved_event_target = $EVENT_TARGET$ }
		}
		random_owned_province = {
			limit = {
				is_colony = yes
				region = southeast_america_region
				NOT = { area = chesapeake_area }
				$ADDITIONAL_TRIGGER$
			}
			save_event_target_as = $EVENT_TARGET$
		}
	}
	if = {
		limit = {
			NOT = { has_saved_event_target = $EVENT_TARGET$ }
		}
		random_owned_province = {
			limit = {
				is_colony = yes
				region = mississippi_region
				NOT = { area = chesapeake_area }
				$ADDITIONAL_TRIGGER$
			}
			save_event_target_as = $EVENT_TARGET$
		}
	}
	if = {
		limit = {
			NOT = { has_saved_event_target = $EVENT_TARGET$ }
		}
		random_owned_province = {
			limit = {
				is_colony = yes
				continent = north_america
				NOT = { area = chesapeake_area }
				$ADDITIONAL_TRIGGER$
			}
			save_event_target_as = $EVENT_TARGET$
		}
	}
}

to_varangian_expedition_on_colony_finished = {
	if = {
		limit = {
			has_province_flag = to_varangian_stronghold_on_colony_finish_flag
		}
		clr_province_flag = to_varangian_stronghold_on_colony_finish_flag
		if = {
			limit = {
				OR = {
					has_province_modifier = to_varangian_stronghold_independent
					has_province_modifier = to_varangian_stronghold
				}
			}
			add_base_manpower = 1
			if = {
				limit = {
					NOT = {
						OR = {
							culture = varangian_n
							culture = varangian_e
						}
					}
				}
				if = {
					limit = {
						owner = {
							NOT = { has_country_flag = to_varangian_culture_change }
						}
					}
					change_culture = varangian_n
				}
				else = {
					change_culture = varangian_e
				}
			}
			if = {
				limit = {
					owner = {
						NOT = { religion = PREV }
					}
					
				}
				owner = {
					PREV = {
						change_religion = PREV
					}
				}
			}
		}
	}
}

to_add_old_world_claim = {
	$TERRITORY$ = {
		limit = {
			OR = {
				owned_by = $TAG$
				NOT = { country_or_subject_holds = $TAG$ }
			}
			NOT = { is_core = $TAG$ }
		}
		add_permanent_claim = $TAG$
	}
}

to_add_old_world_exarch_claim = {
	$TERRITORY$ = {
		limit = {
			OR = {
				owned_by = $TAG$
				NOT = { country_or_subject_holds = PREV }
			}
			NOT = { is_core = $TAG$ }
		}
		add_permanent_claim = $TAG$
	}
}

# Hard to consistently display the effect without overcomplicating it... Not worth the time
# to_determine_turkish_emigration_countries = {
# 	set_variable = {
# 		which = to_turkish_dev
# 		value = 0
# 	}
# 	every_province = {
# 		limit = {
# 			country_or_subject_holds = ROOT
# 			culture = turkish
# 			OR = {
# 				area = hudavendigar_area
# 				area = aydin_area
# 				area = cukurova_area
# 				area = kastamonu_area
# 				region = balkan_region
# 				province_id = 330
# 			}
# 		}
# 		ROOT = {
# 			export_to_variable = {
# 				which = to_local_turkish_dev
# 				value = trigger_value:development
# 				who = PREV
# 			}
# 			multiply_variable = {
# 				which = to_local_turkish_dev
# 				value = 0.1
# 			}
# 			to_round_up_variable = { VARIABLE = to_local_turkish_dev }
# 			change_variable = {
# 				which = to_turkish_dev
# 				which = to_local_turkish_dev
# 			}
# 			set_variable = {
# 				which = to_local_turkish_dev
# 				value = 0
# 			}
# 		}
# 	}
# 	every_province = {
# 		limit = {
# 			ROOT = {
# 				check_variable = {
# 					which = to_turkish_dev
# 					value = 1
# 				}
# 			}
# 			to_eligible_for_turkish_migration = yes
# 			owner = {
# 				NOT = { tag = ROOT }
# 				culture = turkish
# 			}
# 		}
# 		set_province_flag = to_turkish_migration_destination
# 		owner = {
# 			set_country_flag = to_turkish_migration_destination_country
# 		}
# 		to_calc_turkish_imigration = yes
# 	}
# 	if = {
# 		limit = {
# 			check_variable = {
# 				which = to_turkish_dev
# 				value = 1
# 			}
# 		}
# 		every_province = {
# 			limit = {
# 				ROOT = {
# 					check_variable = {
# 						which = to_turkish_dev
# 						value = 1
# 					}
# 				}
# 				to_eligible_for_turkish_migration = yes
# 				owner = {
# 					NOT = { tag = ROOT }
# 					accepted_culture = turkish
# 				}
# 			}
# 			set_province_flag = to_turkish_migration_destination
# 			owner = {
# 				set_country_flag = to_turkish_migration_destination_country
# 			}
# 			change_variable = {
# 				which = to_turkish_dev
# 				value = -3
# 			}
# 		}
# 	}
# 	if = {
# 		limit = {
# 			check_variable = {
# 				which = to_turkish_dev
# 				value = 1
# 			}
# 		}
# 		every_province = {
# 			limit = {
# 				ROOT = {
# 					check_variable = {
# 						which = to_turkish_dev
# 						value = 1
# 					}
# 				}
# 				to_eligible_for_turkish_migration = yes
# 				owner = {
# 					NOT = { tag = ROOT }
# 					culture_group = turko_semitic
# 				}
# 			}
# 			set_province_flag = to_turkish_migration_destination
# 			owner = {
# 				set_country_flag = to_turkish_migration_destination_country
# 			}
# 			change_variable = {
# 				which = to_turkish_dev
# 				value = -3
# 			}
# 		}
# 	}
# 	if = {
# 		limit = {
# 			check_variable = {
# 				which = to_turkish_dev
# 				value = 1
# 			}
# 		}
# 		every_province = {
# 			limit = {
# 				ROOT = {
# 					check_variable = {
# 						which = to_turkish_dev
# 						value = 1
# 					}
# 				}
# 				to_eligible_for_turkish_migration = yes
# 				owner = {
# 					religion = sunni
# 					NOT = { tag = ROOT }
# 				}
# 			}
# 			set_province_flag = to_turkish_migration_destination
# 			owner = {
# 				set_country_flag = to_turkish_migration_destination_country
# 			}
# 			change_variable = {
# 				which = to_turkish_dev
# 				value = -3
# 			}
# 		}
# 	}
# 	if = {
# 		limit = {
# 			check_variable = {
# 				which = to_turkish_dev
# 				value = 1
# 			}
# 		}
# 		every_province = {
# 			limit = {
# 				ROOT = {
# 					check_variable = {
# 						which = to_turkish_dev
# 						value = 1
# 					}
# 				}
# 				to_eligible_for_turkish_migration = yes
# 				owner = {
# 					tag = ROOT
# 				}
# 			}
# 			set_province_flag = to_turkish_migration_destination
# 			owner = {
# 				set_country_flag = to_turkish_migration_destination_country
# 			}
# 			change_variable = {
# 				which = to_turkish_dev
# 				value = -3
# 			}
# 		}
# 	}
# 	if = {
# 		limit = {
# 			check_variable = {
# 				which = to_turkish_dev
# 				value = 1
# 			}
# 		}
# 		every_province = {
# 			limit = {
# 				ROOT = {
# 					check_variable = {
# 						which = to_turkish_dev
# 						value = 1
# 					}
# 				}
# 				to_eligible_for_turkish_migration = yes
# 			}
# 			set_province_flag = to_turkish_migration_destination
# 			owner = {
# 				set_country_flag = to_turkish_migration_destination_country
# 			}
# 			change_variable = {
# 				which = to_turkish_dev
# 				value = -3
# 			}
# 		}
# 	}
# 	set_variable = {
# 		which = to_turkish_dev
# 		value = 0
# 	}
# 	set_variable = {
# 		which = to_local_turkish_dev
# 		value = 0
# 	}
# 	every_province = {
# 		limit = {
# 			has_province_flag = to_turkish_migration_destination
# 		}
# 		clr_province_flag = to_turkish_migration_destination
# 	}
# }

# to_calc_turkish_emigration = {
# 	set_variable = {
# 		which = to_turkish_dev
# 		value = 0
# 	}
# 	every_province = {
# 		limit = {
# 			country_or_subject_holds = ROOT
# 			culture = turkish
# 			OR = {
# 				area = hudavendigar_area
# 				area = aydin_area
# 				area = cukurova_area
# 				area = kastamonu_area
# 				region = balkan_region
# 				province_id = 330
# 			}
# 		}
# 		ROOT = {
# 			export_to_variable = {
# 				which = to_local_turkish_dev
# 				value = trigger_value:development
# 				who = PREV
# 			}
# 			multiply_variable = {
# 				which = to_local_turkish_dev
# 				value = 0.1
# 			}
# 			to_round_up_variable = { VARIABLE = to_local_turkish_dev }
# 			change_variable = {
# 				which = to_turkish_dev
# 				which = to_local_turkish_dev
# 			}
# 			set_variable = {
# 				which = to_local_turkish_dev
# 				value = 0
# 			}
# 		}
# 	}
# 	every_province = {
# 		limit = {
# 			ROOT = {
# 				check_variable = {
# 					which = to_turkish_dev
# 					value = 1
# 				}
# 			}
# 			to_eligible_for_turkish_migration = yes
# 			owner = {
# 				NOT = { tag = ROOT }
# 				culture = turkish
# 			}
# 		}
# 		set_province_flag = to_turkish_migration_destination
# 		owner = {
# 			set_country_flag = to_turkish_migration_destination_country
# 		}
# 		to_calc_turkish_imigration = yes
# 	}
# 	if = {
# 		limit = {
# 			check_variable = {
# 				which = to_turkish_dev
# 				value = 1
# 			}
# 		}
# 		every_province = {
# 			limit = {
# 				ROOT = {
# 					check_variable = {
# 						which = to_turkish_dev
# 						value = 1
# 					}
# 				}
# 				to_eligible_for_turkish_migration = yes
# 				owner = {
# 					NOT = { tag = ROOT }
# 					accepted_culture = turkish
# 				}
# 			}
# 			set_province_flag = to_turkish_migration_destination
# 			owner = {
# 				set_country_flag = to_turkish_migration_destination_country
# 			}
# 			to_calc_turkish_imigration = yes
# 		}
# 	}
# 	if = {
# 		limit = {
# 			check_variable = {
# 				which = to_turkish_dev
# 				value = 1
# 			}
# 		}
# 		every_province = {
# 			limit = {
# 				ROOT = {
# 					check_variable = {
# 						which = to_turkish_dev
# 						value = 1
# 					}
# 				}
# 				to_eligible_for_turkish_migration = yes
# 				owner = {
# 					NOT = { tag = ROOT }
# 					culture_group = turko_semitic
# 				}
# 			}
# 			set_province_flag = to_turkish_migration_destination
# 			owner = {
# 				set_country_flag = to_turkish_migration_destination_country
# 			}
# 			to_calc_turkish_imigration = yes
# 		}
# 	}
# 	if = {
# 		limit = {
# 			check_variable = {
# 				which = to_turkish_dev
# 				value = 1
# 			}
# 		}
# 		every_province = {
# 			limit = {
# 				ROOT = {
# 					check_variable = {
# 						which = to_turkish_dev
# 						value = 1
# 					}
# 				}
# 				to_eligible_for_turkish_migration = yes
# 				owner = {
# 					religion = sunni
# 					NOT = { tag = ROOT }
# 				}
# 			}
# 			set_province_flag = to_turkish_migration_destination
# 			owner = {
# 				set_country_flag = to_turkish_migration_destination_country
# 			}
# 			to_calc_turkish_imigration = yes
# 		}
# 	}
# 	if = {
# 		limit = {
# 			check_variable = {
# 				which = to_turkish_dev
# 				value = 1
# 			}
# 		}
# 		every_province = {
# 			limit = {
# 				ROOT = {
# 					check_variable = {
# 						which = to_turkish_dev
# 						value = 1
# 					}
# 				}
# 				to_eligible_for_turkish_migration = yes
# 				owner = {
# 					tag = ROOT
# 				}
# 			}
# 			set_province_flag = to_turkish_migration_destination
# 			owner = {
# 				set_country_flag = to_turkish_migration_destination_country
# 			}
# 			to_calc_turkish_imigration = yes
# 		}
# 	}
# 	if = {
# 		limit = {
# 			check_variable = {
# 				which = to_turkish_dev
# 				value = 1
# 			}
# 		}
# 		every_province = {
# 			limit = {
# 				ROOT = {
# 					check_variable = {
# 						which = to_turkish_dev
# 						value = 1
# 					}
# 				}
# 				to_eligible_for_turkish_migration = yes
# 			}
# 			set_province_flag = to_turkish_migration_destination
# 			owner = {
# 				set_country_flag = to_turkish_migration_destination_country
# 			}
# 			to_calc_turkish_imigration = yes
# 		}
# 	}
# 	set_variable = {
# 		which = to_turkish_dev
# 		value = 0
# 	}
# 	every_province = {
# 		limit = {
# 			has_province_flag = to_turkish_migration_destination
# 		}
# 		clr_province_flag = to_turkish_migration_destination
# 	}
# }

# to_calc_turkish_imigration = {
# 	ROOT = {
# 		if = {
# 			limit = {
# 				check_variable = {
# 					which = to_turkish_dev
# 					value = 3
# 				}
# 			}
# 			subtract_variable = {
# 				which = to_turkish_dev
# 				value = -3
# 			}
# 			PREV = {
# 				set_variable = {
# 					which = to_incoming_turkish_dev
# 					value = 3
# 				}
# 			}
# 		}
# 		else = {
# 			if = {
# 				limit = {
# 					ROOT = {
# 						check_variable = {
# 							which = to_turkish_dev
# 							value = 2
# 						}
# 					}
# 				}
# 				set_variable = {
# 					which = to_incoming_turkish_dev
# 					value = 2
# 				}
# 			}
# 			else = {
# 				set_variable = {
# 					which = to_incoming_turkish_dev
# 					value = 1
# 				}
# 			}
# 			set_variable = {
# 				which = to_turkish_dev
# 				value = 0
# 			}
# 		}
# 	}
# }

to_compute_avg_culture_shock_progress = {
	set_variable = {
		which = $VARIABLE$
		value = 0
	}
	if = {
		limit = {
			any_province = {
				country_or_subject_holds = ROOT
				to_has_cultureshock = yes
			}
		}
		set_variable = {
			which = to_total_culture_shock_dev
			value = 0
		}
		every_province = {
			limit = {
				country_or_subject_holds = ROOT
				to_has_cultureshock = yes
			}
			ROOT = {
				export_to_variable = {
					which = to_local_dev
					value = trigger_value:development
					who = PREV
				}
				change_variable = {
					which = to_total_culture_shock_dev
					which = to_local_dev
				}

				set_variable = {
					which = to_assimilation_progress
					which = PREV
				}
				multiply_variable = {
					which = to_assimilation_progress
					which = to_local_dev
				}
				change_variable = {
					which = $VARIABLE$
					which = to_assimilation_progress
				}
			}
		}
		divide_variable = {
			which = $VARIABLE$
			which = to_total_culture_shock_dev
		}
		set_variable = {
			which = to_assimilation_progress
			value = 0
		}
		set_variable = {
			which = to_local_dev
			value = 0
		}
	}
}

to_turkish_emigration_predict_lost_dev = {
	set_variable = {
		which = $VARIABLE$
		value = 0
	}
	every_province = {
		limit = {
			country_or_subject_holds = ROOT
			culture = turkish
			OR = {
				area = hudavendigar_area
				area = aydin_area
				area = cukurova_area
				area = kastamonu_area
				region = balkan_region
			}
			development = 4
		}
		ROOT = {
			export_to_variable = {
				which = to_lost_dev
				value = trigger_value:development
				who = PREV
			}
			multiply_variable = {
				which = to_lost_dev
				value = $FRACTION$
			}
			to_round_up_variable = { VARIABLE = to_lost_dev }
			change_variable = {
				which = $VARIABLE$
				which = to_lost_dev
			}
			set_variable = {
				which = to_lost_dev
				value = 0
			}
		}
	}
}

to_turkish_emigration_remove_dev = {
	export_to_variable = {
		which = to_lost_dev
		value = trigger_value:development
	}
	multiply_variable = {
		which = to_lost_dev
		value = $FRACTION$
	}
	to_round_up_variable = { VARIABLE = to_lost_dev }
	while = {
		limit = {
			check_variable = {
				which = to_lost_dev
				value = 1
			}
			development = 4
		}
		change_variable = {
			which = to_lost_dev
			value = -1
		}
		if = {
			limit = {
				base_manpower = 2
			}
			add_base_manpower = -1
		}
		else_if = {
			limit = {
				base_tax = 2
			}
			add_base_tax = -1
		}
		else_if = {
			limit = {
				base_production = 2
			}
			add_base_production = -1
		}
	}
	set_variable = {
		which = to_lost_dev
		value = 0
	}
}

to_handle_greek_immigration_modifier = {
	if = {
		limit = {
			culture = turkish
			region = anatolia_region
			owner = {
				OR = {
					has_country_flag = to_favored_greeks_in_anatolia
					overlord = {
						has_country_flag = to_favored_greeks_in_anatolia
					}
				}
			}
		}
		if = {
			limit = {
				NOT = { has_province_modifier = to_greek_immigration }
			}
			add_province_modifier = {
				name = to_greek_immigration
				duration = -1
			}
			change_original_culture = greek
		}
	}
	else_if = {
		limit = {
			has_province_modifier = to_greek_immigration
		}
		remove_province_modifier = to_greek_immigration
	}
}

to_handle_greek_immigration_modifier_country = {
	every_owned_province = {
		limit = {
			region = anatolia_region
		}
		to_handle_greek_immigration_modifier = yes
	}
}

to_handle_familiar_administration_modifier = {
	if = {
		limit = {
			culture = turkish
			region = anatolia_region
			owner = {
				has_country_flag = to_favored_turks_in_anatolia
				overlord = {
					has_country_flag = to_favored_turks_in_anatolia
				}
			}
			
		}
		if = {
			limit = {
				NOT = { has_province_modifier = to_turkish_province_boost }
			}
			add_province_modifier = {
				name = to_turkish_province_boost
				duration = -1
			}
		}
	}
	else_if = {
		limit = {
			has_province_modifier = to_turkish_province_boost
		}
		remove_province_modifier = to_turkish_province_boost
	}
}

to_handle_familiar_administration_modifier_country = {
	every_owned_province = {
		limit = {
			region = anatolia_region
		}
		to_handle_familiar_administration_modifier = yes
	}
}

to_add_settler_heritage_three = {
	if = {
		limit = {
			has_country_modifier = nhs_handicap_settlers
		}
		set_country_flag = nhs_start_with_three
	}
	else_if = {
		limit = {
			NOT = { has_country_modifier = nhs_settler_heritage_three }
			NOT = { mission_completed = to_basileus_basileon_mission }
		}
		if = {
			limit = {
				has_country_modifier = nhs_settler_heritage
			}
			remove_country_modifier = nhs_settler_heritage
			add_country_modifier = {
				name = nhs_settler_heritage_three
				duration = -1
			}
		}
		else_if = {
			limit = {
				has_country_modifier = nhs_settler_heritage_two
			}
			custom_tooltip = nhs_settler_heritage_2_3_tt
			hidden_effect = {
				remove_country_modifier = nhs_settler_heritage_two
				add_country_modifier = {
					name = nhs_settler_heritage_three
					duration = -1
				}
			}
		}
	}
}

to_check_opinion_annex_limit = {
	if = {
		limit = {
			mission_completed = to_koine_glossa_mission
		}
		every_country = {
			limit = {
				has_opinion_modifier = {
					who = ROOT
					modifier = opinion_annex_vassal
				}
				NOT = {
					has_opinion_modifier = {
						who = ROOT
						modifier = opinion_annex_vassal
						value = -120
					}
				}
			}
			remove_opinion = {
				who = ROOT
				modifier = opinion_annex_vassal
			}
			add_opinion = {
				who = ROOT
				modifier = opinion_annex_vassal
			}
			add_opinion = {
				who = ROOT
				modifier = opinion_annex_vassal
			}
			add_opinion = {
				who = ROOT
				modifier = opinion_annex_vassal
			}
			add_opinion = {
				who = ROOT
				modifier = opinion_annex_vassal
			}
		}
	}
}

to_add_ia_upon_conquest = {
	if = {
		limit = {
			has_province_flag = to_grants_ia_upon_reconquest
			hre_size = 1
		}
		clr_province_flag = to_grants_ia_upon_reconquest
		emperor = {
			add_imperial_influence = 1
		}
	}
}

to_set_ia_per_reform = {
	hidden_effect = {
		if = {
			limit = {
				has_country_flag = to_integrated_hre_bureaucracy
			}
			to_remove_ia_per_reform = yes
			if = {
				limit = {
					to_hre_passed_x_reforms = { X = 11 }
				}
				add_country_modifier = {
					name = to_imperial_integration_11
					duration = -1
				}
			}
			else_if = {
				limit = {
					to_hre_passed_x_reforms = { X = 10 }
				}
				add_country_modifier = {
					name = to_imperial_integration_10
					duration = -1
				}
			}
			else_if = {
				limit = {
					to_hre_passed_x_reforms = { X = 9 }
				}
				add_country_modifier = {
					name = to_imperial_integration_9
					duration = -1
				}
			}
			else_if = {
				limit = {
					to_hre_passed_x_reforms = { X = 8 }
				}
				add_country_modifier = {
					name = to_imperial_integration_8
					duration = -1
				}
			}
			else_if = {
				limit = {
					to_hre_passed_x_reforms = { X = 7 }
				}
				add_country_modifier = {
					name = to_imperial_integration_7
					duration = -1
				}
			}
			else_if = {
				limit = {
					to_hre_passed_x_reforms = { X = 6 }
				}
				add_country_modifier = {
					name = to_imperial_integration_6
					duration = -1
				}
			}
			else_if = {
				limit = {
					to_hre_passed_x_reforms = { X = 5 }
				}
				add_country_modifier = {
					name = to_imperial_integration_5
					duration = -1
				}
			}
			else_if = {
				limit = {
					to_hre_passed_x_reforms = { X = 4 }
				}
				add_country_modifier = {
					name = to_imperial_integration_4
					duration = -1
				}
			}
			else_if = {
				limit = {
					to_hre_passed_x_reforms = { X = 3 }
				}
				add_country_modifier = {
					name = to_imperial_integration_3
					duration = -1
				}
			}
			else_if = {
				limit = {
					to_hre_passed_x_reforms = { X = 2 }
				}
				add_country_modifier = {
					name = to_imperial_integration_2
					duration = -1
				}
			}
			else_if = {
				limit = {
					to_hre_passed_x_reforms = { X = 1 }
				}
				add_country_modifier = {
					name = to_imperial_integration_1
					duration = -1
				}
			}
			else = {
				add_country_modifier = {
					name = to_imperial_integration
					duration = -1
				}
			}
		}
	}
}

to_remove_ia_per_reform = {
	remove_country_modifier = to_imperial_integration
	remove_country_modifier = to_imperial_integration_1
	remove_country_modifier = to_imperial_integration_2
	remove_country_modifier = to_imperial_integration_3
	remove_country_modifier = to_imperial_integration_4
	remove_country_modifier = to_imperial_integration_5
	remove_country_modifier = to_imperial_integration_6
	remove_country_modifier = to_imperial_integration_7
	remove_country_modifier = to_imperial_integration_8
	remove_country_modifier = to_imperial_integration_9
	remove_country_modifier = to_imperial_integration_10
	remove_country_modifier = to_imperial_integration_11
}

to_the_final_triumph_effect = {
	custom_tooltip = $EVENT_ID$.tt
	custom_tooltip = nhs_new_line_tt
	if = {
		limit = {
			any_country = {
				ai = yes
				NOT = { tag = ROOT }
				NOT = { tag = REB }
				NOT = { tag = PIR }
				NOT = { tag = NAT }
				exists = yes
				OR = {
					technology_group = western
					technology_group = eastern
					technology_group = muslim
					technology_group = ottoman
				}
				NOT = { is_subject_of_type = elysian_subject }
				#NOT = { is_rival = ROOT }
				NOT = {
					capital_scope = {
						PREV = {
							any_core_province = {
								region = PREV
								country_or_subject_holds = ROOT
							}
						}
					}
				}
			}
		}
		custom_tooltip = nhs_new_line_tt
		custom_tooltip = $EVENT_ID$.tt.2
		every_country = {
			limit = {
				ai = yes
				NOT = { tag = ROOT }
				NOT = { tag = REB }
				NOT = { tag = PIR }
				NOT = { tag = NAT }
				exists = yes
				OR = {
					technology_group = western
					technology_group = eastern
					technology_group = muslim
					technology_group = ottoman
				}
				NOT = { is_subject_of_type = elysian_subject }
				NOT = {
					capital_scope = {
						PREV = {
							any_core_province = {
								region = PREV
								country_or_subject_holds = ROOT
							}
						}
					}
				}
			}
			custom_tooltip = $EVENT_ID$.tt.3
			custom_tooltip = to_lose_ae_and_cores_tt
			hidden_effect = {
				remove_opinion = {
					who = ROOT
					modifier = aggressive_expansion
				}
				if = {
					limit = {
						NOT = { is_subject_of = ROOT }
						NOT = {
							AND = {
								is_subject = yes
								overlord = {
									is_subject = yes
									is_subject_of = ROOT
								}
							}
						}
					}
					every_province = {
						limit = {
							is_core = PREV
							country_or_subject_holds = ROOT
							NOT = { owned_by = PREV }
						}
						remove_core = PREV
					}
				}
			}
		}
	}
	if = {
		limit = {
			any_country = {
				ai = yes
				NOT = { tag = ROOT }
				NOT = { tag = REB }
				NOT = { tag = PIR }
				NOT = { tag = NAT }
				exists = yes
				OR = {
					technology_group = western
					technology_group = eastern
					technology_group = muslim
					technology_group = ottoman
				}
				NOT = { is_subject_of_type = elysian_subject }
				capital_scope = {
					PREV = {
						any_core_province = {
							region = PREV
							country_or_subject_holds = ROOT
						}
					}
				}
			}
		}
		custom_tooltip = nhs_new_line_tt
		custom_tooltip = $EVENT_ID$.tt.4
		every_country = {
			limit = {
				ai = yes
				NOT = { tag = ROOT }
				NOT = { tag = REB }
				NOT = { tag = PIR }
				NOT = { tag = NAT }
				exists = yes
				OR = {
					technology_group = western
					technology_group = eastern
					technology_group = muslim
					technology_group = ottoman
				}
				NOT = { is_subject_of_type = elysian_subject }
				capital_scope = {
					PREV = {
						any_core_province = {
							region = PREV
							country_or_subject_holds = ROOT
						}
					}
				}
			}
			custom_tooltip = to_do_not_lose_ae_and_cores_tt
		}
	}
}

to_add_administrative_burden = {
	if = {
		limit = {
			has_government_mechanic = to_administrative_burden_mechanic
		}
		add_government_power = {
			mechanic_type = to_administrative_burden_mechanic
			power_type = to_administrative_burden
			value = $VALUE$
		}
	}
}

to_add_administrative_burden_building_construction = {
	FROM = { to_add_administrative_burden = { VALUE = 1 } }
}

# Fires when you start the construction,  ROOT - Province FROM - Country that started
to_administrative_burden_on_construction_started = {
	if = {
		limit = {
			FROM = { has_government_mechanic = to_administrative_burden_mechanic }
		}
		FROM = { to_add_administrative_burden = { VALUE = 1 } }
		set_province_flag = to_ab_construction_$BUILDING$
	}
}

# Fires when you cancel the construction, ROOT - Province FROM - Country that canceled
to_administrative_burden_on_construction_canceled = {
	if = {
		limit = {
			has_province_flag = to_ab_construction_$BUILDING$
		}
		FROM = { to_add_administrative_burden = { VALUE = -1 } }
	}
}

to_administrative_burden_on_regiment_recruited = {
	if = {
		limit = {
			FROM = {
				NOT = { has_country_flag = to_ab_no_recruit_penalty }
			}
		}
		FROM = { to_add_administrative_burden = { VALUE = 1 } }
	}
}

to_ab_increase_colony_penalty = {
	$SCOPE$ = {
		if = {
			limit = {
				has_government_mechanic = to_administrative_burden_mechanic
			}
			change_variable = {
				which = to_ab_colony_penalty
				value = 1
			}
			to_set_administrative_burden_penalty = {
				MODIFIER_BASE = to_ab_colony_penalty_mod
				VARIABLE = to_ab_colony_penalty
			}
		}
	}
}

to_ab_decrease_colony_penalty = {
	$SCOPE$ = {
		if = {
			limit = {
				has_government_mechanic = to_administrative_burden_mechanic
			}
			change_variable = {
				which = to_ab_colony_penalty
				value = -1
			}
			if = {
				limit = {
					check_variable = {
						which = to_ab_colony_penalty
						value = 1
					}
				}
				to_set_administrative_burden_penalty = {
					MODIFIER_BASE = to_ab_colony_penalty_mod
					VARIABLE = to_ab_colony_penalty
				}
			}
			else = {
				to_remove_ab_penalty_modifiers = { MODIFIER_BASE = to_ab_colony_penalty_mod }
			}
		}
	}
}

to_administrative_burden_check_subject_penalty = {
	# The below effect cannot go here directly, since this has 500 something character limit
	nhs_effect_for_existing_elysian_tag = {
		EFFECT = "
		save_event_target_as = to_existing_elysia
		"
	}
	if = {
		limit = {
			has_saved_event_target = to_existing_elysia
		}
		event_target:to_existing_elysia = {
			if = {
				limit = {
					has_government_mechanic = to_administrative_burden_mechanic
				}
				set_variable = {
					which = to_ab_subject_penalty
					value = 0
				}
				every_subject_country = {
					limit = {
						# ai_attitude = {
						# 	who = PREV
						# 	attitude = attitude_disloyal
						# }
						liberty_desire = 50
					}
					PREV = {
						change_variable = {
							which = to_ab_subject_penalty
							value = 1
						}
					}
				}
				if = {
					limit = {
						check_variable = {
							which = to_ab_subject_penalty
							value = 1
						}
					}
					to_set_administrative_burden_penalty = {
						MODIFIER_BASE = to_ab_subject_penalty_mod
						VARIABLE = to_ab_subject_penalty
					}
				}
				else = {
					to_remove_ab_penalty_modifiers = { MODIFIER_BASE = to_ab_subject_penalty_mod }
				}
			}
		}
	}
}

to_set_administrative_burden_penalty = {
	# Code generated by administrative burden/administrative_burden.py
	if={limit={check_variable={which=$VARIABLE$ value=6}}if={limit={check_variable={which=$VARIABLE$ value=8}}if={limit={check_variable={which=$VARIABLE$ value=9}}if={limit={check_variable={which=$VARIABLE$ value=10}}if = {limit={NOT={has_country_modifier=$MODIFIER_BASE$_10}} to_remove_ab_penalty_modifiers={ MODIFIER_BASE = $MODIFIER_BASE$ } add_country_modifier={name=$MODIFIER_BASE$_10 duration=-1 hidden = yes} }}else={if = {limit={NOT={has_country_modifier=$MODIFIER_BASE$_9}} to_remove_ab_penalty_modifiers={ MODIFIER_BASE = $MODIFIER_BASE$ } add_country_modifier={name=$MODIFIER_BASE$_9 duration=-1 hidden = yes} }}}else={if = {limit={NOT={has_country_modifier=$MODIFIER_BASE$_8}} to_remove_ab_penalty_modifiers={ MODIFIER_BASE = $MODIFIER_BASE$ } add_country_modifier={name=$MODIFIER_BASE$_8 duration=-1 hidden = yes} }}}else={if={limit={check_variable={which=$VARIABLE$ value=7}}if = {limit={NOT={has_country_modifier=$MODIFIER_BASE$_7}} to_remove_ab_penalty_modifiers={ MODIFIER_BASE = $MODIFIER_BASE$ } add_country_modifier={name=$MODIFIER_BASE$_7 duration=-1 hidden = yes} }}else={if = {limit={NOT={has_country_modifier=$MODIFIER_BASE$_6}} to_remove_ab_penalty_modifiers={ MODIFIER_BASE = $MODIFIER_BASE$ } add_country_modifier={name=$MODIFIER_BASE$_6 duration=-1 hidden = yes} }}}}else={if={limit={check_variable={which=$VARIABLE$ value=3}}if={limit={check_variable={which=$VARIABLE$ value=4}}if={limit={check_variable={which=$VARIABLE$ value=5}}if = {limit={NOT={has_country_modifier=$MODIFIER_BASE$_5}} to_remove_ab_penalty_modifiers={ MODIFIER_BASE = $MODIFIER_BASE$ } add_country_modifier={name=$MODIFIER_BASE$_5 duration=-1 hidden = yes} }}else={if = {limit={NOT={has_country_modifier=$MODIFIER_BASE$_4}} to_remove_ab_penalty_modifiers={ MODIFIER_BASE = $MODIFIER_BASE$ } add_country_modifier={name=$MODIFIER_BASE$_4 duration=-1 hidden = yes} }}}else={if = {limit={NOT={has_country_modifier=$MODIFIER_BASE$_3}} to_remove_ab_penalty_modifiers={ MODIFIER_BASE = $MODIFIER_BASE$ } add_country_modifier={name=$MODIFIER_BASE$_3 duration=-1 hidden = yes} }}}else={if={limit={check_variable={which=$VARIABLE$ value=2}}if = {limit={NOT={has_country_modifier=$MODIFIER_BASE$_2}} to_remove_ab_penalty_modifiers={ MODIFIER_BASE = $MODIFIER_BASE$ } add_country_modifier={name=$MODIFIER_BASE$_2 duration=-1 hidden = yes} }}else={if = {limit={NOT={has_country_modifier=$MODIFIER_BASE$_1}} to_remove_ab_penalty_modifiers={ MODIFIER_BASE = $MODIFIER_BASE$ } add_country_modifier={name=$MODIFIER_BASE$_1 duration=-1 hidden = yes} }}}}
}
	
to_remove_ab_penalty_modifiers = {
	# Code generated by administrative burden/administrative_burden.py
	remove_country_modifier = $MODIFIER_BASE$_1
	remove_country_modifier = $MODIFIER_BASE$_2
	remove_country_modifier = $MODIFIER_BASE$_3
	remove_country_modifier = $MODIFIER_BASE$_4
	remove_country_modifier = $MODIFIER_BASE$_5
	remove_country_modifier = $MODIFIER_BASE$_6
	remove_country_modifier = $MODIFIER_BASE$_7
	remove_country_modifier = $MODIFIER_BASE$_8
	remove_country_modifier = $MODIFIER_BASE$_9
	remove_country_modifier = $MODIFIER_BASE$_10
}

to_add_corruption_from_administrative_burden = {
	# Code generated by administrative burden/administrative_burden.py
	if={limit={has_government_power={mechanic_type = to_administrative_burden_mechanic power_type = to_administrative_burden value=13 }}if={limit={has_government_power={mechanic_type = to_administrative_burden_mechanic power_type = to_administrative_burden value=17 }}if={limit={has_government_power={mechanic_type = to_administrative_burden_mechanic power_type = to_administrative_burden value=19 }}if={limit={has_government_power={mechanic_type = to_administrative_burden_mechanic power_type = to_administrative_burden value=20 }}custom_tooltip=to_add_administrative_burden_corruption_20_tt hidden_effect={add_corruption=15}}else={custom_tooltip=to_add_administrative_burden_corruption_19_tt hidden_effect={add_corruption=14}}}else={if={limit={has_government_power={mechanic_type = to_administrative_burden_mechanic power_type = to_administrative_burden value=18 }}custom_tooltip=to_add_administrative_burden_corruption_18_tt hidden_effect={add_corruption=13}}else={custom_tooltip=to_add_administrative_burden_corruption_17_tt hidden_effect={add_corruption=12}}}}else={if={limit={has_government_power={mechanic_type = to_administrative_burden_mechanic power_type = to_administrative_burden value=15 }}if={limit={has_government_power={mechanic_type = to_administrative_burden_mechanic power_type = to_administrative_burden value=16 }}custom_tooltip=to_add_administrative_burden_corruption_16_tt hidden_effect={add_corruption=11}}else={custom_tooltip=to_add_administrative_burden_corruption_15_tt hidden_effect={add_corruption=10}}}else={if={limit={has_government_power={mechanic_type = to_administrative_burden_mechanic power_type = to_administrative_burden value=14 }}custom_tooltip=to_add_administrative_burden_corruption_14_tt hidden_effect={add_corruption=9}}else={custom_tooltip=to_add_administrative_burden_corruption_13_tt hidden_effect={add_corruption=8}}}}}else={if={limit={has_government_power={mechanic_type = to_administrative_burden_mechanic power_type = to_administrative_burden value=9 }}if={limit={has_government_power={mechanic_type = to_administrative_burden_mechanic power_type = to_administrative_burden value=11 }}if={limit={has_government_power={mechanic_type = to_administrative_burden_mechanic power_type = to_administrative_burden value=12 }}custom_tooltip=to_add_administrative_burden_corruption_12_tt hidden_effect={add_corruption=7}}else={custom_tooltip=to_add_administrative_burden_corruption_11_tt hidden_effect={add_corruption=6}}}else={if={limit={has_government_power={mechanic_type = to_administrative_burden_mechanic power_type = to_administrative_burden value=10 }}custom_tooltip=to_add_administrative_burden_corruption_10_tt hidden_effect={add_corruption=5}}else={custom_tooltip=to_add_administrative_burden_corruption_9_tt hidden_effect={add_corruption=4}}}}else={if={limit={has_government_power={mechanic_type = to_administrative_burden_mechanic power_type = to_administrative_burden value=7 }}if={limit={has_government_power={mechanic_type = to_administrative_burden_mechanic power_type = to_administrative_burden value=8 }}custom_tooltip=to_add_administrative_burden_corruption_8_tt hidden_effect={add_corruption=3}}else={custom_tooltip=to_add_administrative_burden_corruption_7_tt hidden_effect={add_corruption=2}}}else={custom_tooltip=to_add_administrative_burden_corruption_6_tt hidden_effect={add_corruption=1}}}}
}

to_on_change_trade_policy_penalty = {
	add_stability = -2
	add_dip_power = -100
	hidden_effect = {
		add_country_modifier = {
			name = to_trade_policy_switch_$POLICY$_cd
			duration = 7300
			hidden = yes
		}
	}
}

to_on_change_trade_policy_protectionism = {
	if = {
		limit = {
			OR = {		
				has_country_modifier = nhs2_elysian_free_trade
				has_country_modifier = nhs2_elysian_isolationism
		
				# has_country_modifier = vov_free_trade
				# has_country_modifier = vov_isolationism
		
				# has_country_modifier = msg_free_trade
				# has_country_modifier = msg_isolationism
			}
		}
		[[SHOW_REFORM_EFFECT_TOOLTIP]
			custom_tooltip = to_reform_effects_tt
		]
		custom_tooltip = to_change_trade_policy_to_protectionism_tt
		to_on_change_trade_policy_penalty = { POLICY = protectionism }
		# if = {
		# 	limit = {
		# 		OR = {
		# 			has_country_modifier = vov_free_trade
		# 			has_country_modifier = vov_isolationism
		# 		}
		# 	}
		# 	remove_country_modifier = vov_free_trade
		# 	remove_country_modifier = vov_isolationism
		# 	add_country_modifier = {
		# 		name = vov_restricted_trade
		# 		duration = -1
		# 	}
		# }
		# else_if = {
		# 	limit = {
		# 		OR = {
		# 			has_country_modifier = msg_free_trade
		# 			has_country_modifier = msg_isolationism
		# 		}
		# 	}
		# 	remove_country_modifier = msg_free_trade
		# 	remove_country_modifier = msg_isolationism
		# 	add_country_modifier = {
		# 		name = msg_restricted_trade
		# 		duration = -1
		# 	}
		# }
		# else = {
			if = {
				limit = {
					NOT = { has_country_flag = to_got_protectionism_mercantilism }
					NOT = { has_country_flag = to_lost_protectionism_mercantilism }
				}
				add_mercantilism = 10
			}
			remove_country_modifier = nhs2_elysian_free_trade
			remove_country_modifier = nhs2_elysian_isolationism
			custom_tooltip = to_protectionism_institutions_tt
			custom_tooltip = nhs_new_line_tt
			custom_tooltip = to_add_protectionism_country_modifier_tt
			hidden_effect = {
				add_country_modifier = {
					name = nhs2_elysian_restricted_trade
					duration = -1
				}
			}
			custom_tooltip = to_forced_new_line_tt
		# }
	}
}

to_on_change_trade_policy_free_trade = {
	if = {
		limit = {
			OR = {
				has_country_modifier = nhs2_elysian_restricted_trade
				has_country_modifier = nhs2_elysian_isolationism
		
				# has_country_modifier = vov_restricted_trade
				# has_country_modifier = vov_isolationism
		
				# has_country_modifier = msg_restricted_trade
				# has_country_modifier = msg_isolationism
			}
		}
		[[SHOW_REFORM_EFFECT_TOOLTIP]
			custom_tooltip = to_reform_effects_tt
		]
		custom_tooltip = to_change_trade_policy_to_free_trade_tt
		to_on_change_trade_policy_penalty = { POLICY = free_trade }
		# if = {
		# 	limit = {
		# 		OR = {
		# 			has_country_modifier = vov_restricted_trade
		# 			has_country_modifier = vov_isolationism
		# 		}
		# 	}
		# 	remove_country_modifier = vov_restricted_trade
		# 	remove_country_modifier = vov_isolationism
		# 	add_country_modifier = {
		# 		name = vov_free_trade
		# 		duration = -1
		# 	}
		# }
		# else_if = {
		# 	limit = {
		# 		OR = {
		# 			has_country_modifier = msg_restricted_trade
		# 			has_country_modifier = msg_isolationism
		# 		}
		# 	}
		# 	remove_country_modifier = msg_restricted_trade
		# 	remove_country_modifier = msg_isolationism
		# 	add_country_modifier = {
		# 		name = msg_free_trade
		# 		duration = -1
		# 	}
		# }
		# else = {
			if = {
				limit = {
					has_country_flag = to_got_protectionism_mercantilism
				}
				clr_country_flag = to_got_protectionism_mercantilism
				set_country_flag = to_lost_protectionism_mercantilism
				add_mercantilism = -60
			}
			else = {
				add_mercantilism = -50
			}
			remove_country_modifier = nhs2_elysian_restricted_trade
			remove_country_modifier = nhs2_elysian_isolationism
			custom_tooltip = to_free_trade_institutions_tt
			custom_tooltip = nhs_new_line_tt
			custom_tooltip = to_add_free_trade_country_modifier_tt
			hidden_effect = {
				add_country_modifier = {
					name = nhs2_elysian_free_trade
					duration = -1
				}
			}
			custom_tooltip = to_forced_new_line_tt
		# }
	}
}

to_on_change_trade_policy_isolationism = {
	if = {
		limit = {
			OR = {
				has_country_modifier = nhs2_elysian_restricted_trade
				has_country_modifier = nhs2_elysian_free_trade
		
				# has_country_modifier = vov_restricted_trade
				# has_country_modifier = vov_free_trade
		
				# has_country_modifier = msg_restricted_trade
				# has_country_modifier = msg_free_trade
			}
		}
		[[SHOW_REFORM_EFFECT_TOOLTIP]
			custom_tooltip = to_reform_effects_tt
		]
		custom_tooltip = to_change_trade_policy_to_isolationism_tt
		to_on_change_trade_policy_penalty = { POLICY = isolationism }
		# if = {
		# 	limit = {
		# 		OR = {
		# 			has_country_modifier = vov_restricted_trade
		# 			has_country_modifier = vov_free_trade
		# 		}
		# 	}
		# 	remove_country_modifier = vov_restricted_trade
		# 	remove_country_modifier = vov_free_trade
		# 	add_country_modifier = {
		# 		name = vov_isolationism
		# 		duration = -1
		# 	}
		# }
		# else_if = {
		# 	limit = {
		# 		OR = {
		# 			has_country_modifier = msg_restricted_trade
		# 			has_country_modifier = msg_free_trade
		# 		}
		# 	}
		# 	remove_country_modifier = msg_restricted_trade
		# 	remove_country_modifier = msg_free_trade
		# 	add_country_modifier = {
		# 		name = msg_isolationism
		# 		duration = -1
		# 	}
		# }
		# else = {
			if = {
				limit = {
					has_country_flag = to_got_protectionism_mercantilism
				}
				clr_country_flag = to_got_protectionism_mercantilism
				set_country_flag = to_lost_protectionism_mercantilism
				add_mercantilism = -10
			}
			remove_country_modifier = nhs2_elysian_restricted_trade
			remove_country_modifier = nhs2_elysian_free_trade
			[[ISOLATIONISM_INSTITION_SPREAD]
			custom_tooltip = to_isolationism_institutions_tt
			]
			custom_tooltip = nhs_new_line_tt
			custom_tooltip = to_add_isolationism_country_modifier_tt
			hidden_effect = {
				add_country_modifier = {
					name = nhs2_elysian_isolationism
					duration = -1
				}
			}
			[[ISOLATIONISM_INSTITION_SPREAD]
			hidden_effect = {
				to_nhs_spawn_enclave = { ENCLAVE_MODIFIER = nhs2_european_enclave }
			}
			]
			custom_tooltip = to_forced_new_line_tt
		# }
	}
}

to_european_immigration_effect = {
	if = {
		limit = {
			NOT = { has_province_flag = to_static_colonial_culture }
			owner = { has_government_attribute = to_colonies_can_get_european_cultures }
		}
		random = {
			chance = 20
			owner = {
				clr_country_flag = to_found_european_emigration_province
				every_province = {
					limit = {
						NOT = { culture_group = ROOT }
						has_port = yes
						continent = europe
						sea_zone = {
							region = north_atlantic_region
						}
						NOT = { has_province_modifier = to_recent_european_emigration }
					}
					export_to_variable = {
						which = to_emigration_weight
						value = trigger_value:devastation
					}
					divide_variable = {
						which = to_emigration_weight
						value = 2
					}
					set_variable = {
						which = to_local_unrest
						value = 0
					}
					change_variable = {
						which = to_emigration_weight
						which = to_local_unrest
					}
					# Only slightly weigh by local development
					export_to_variable = {
						which = to_local_development
						value = trigger_value:development
					}
					divide_variable = {
						which = to_local_development
						value = 50
					}
					change_variable = {
						which = to_emigration_weight
						which = to_local_development
					}
					# If you own provinces, those should not be prioritized
					if = {
						limit = {
							owner = {
								has_government_attribute = to_colonies_can_get_european_cultures
							}
						}
						change_variable = {
							which = to_emigration_weight
							value = -1000
						}
					}
					set_variable = {
						which = to_tolerance_to_this
						value = 0
					}
					if = {
						limit = {
							unrest = 0.1
						}
						export_to_variable = {
							which = to_local_unrest
							value = trigger_value:unrest
						}
						divide_variable = {
							which = to_local_unrest
							value = 4
						}
					}
					change_variable = {
						which = to_emigration_weight
						which = to_local_unrest
					}
					set_variable = {
						which = to_tolerance_to_this
						value = 0
					}
					if = {
						limit = {
							has_owner_religion = no
							NOT = { tolerance_to_this = 0 }
						}
						add_base_manpower = 1
						export_to_variable = {
							which = to_tolerance_to_this
							value = trigger_value:tolerance_to_this
						}
						# Tolerance is negative, so subtracting yiels positive
						subtract_variable = {
							which = to_emigration_weight
							which = to_tolerance_to_this
						}
					}
					if = {
						limit = {
							has_owner_culture = no
							has_owner_accepted_culture = no
						}
						if = {
							limit = {
								culture_group = owner
							}
							change_variable = {
								which = to_emigration_weight
								value = 1
							}
						}
						else = {
							change_variable = {
								which = to_emigration_weight
								value = 3
							}
						}
					}
					if = {
						limit = {
							has_missionary = yes
						}
						change_variable = {
							which = to_emigration_weight
							value = 2
						}
					}
					if = {
						limit = {
							has_construction = culture
						}
						change_variable = {
							which = to_emigration_weight
							value = 10
						}
					}
					# add_province_modifier = {
					# 	name = to_show_european_emigration
					# 	duration = -1
					# }
					if = {
						limit = {
							PREV = {
								has_country_flag = to_found_european_emigration_province
							}
						}
						if = {
							limit = {
								NOT = {
									event_target:to_european_emigration_province = {
										check_variable = {
											which = to_emigration_weight
											which = PREV
										}
									}
								}
							}
							save_event_target_as = to_european_emigration_province
						}
					}
					else = {
						PREV = {
							set_country_flag = to_found_european_emigration_province
						}
						save_event_target_as = to_european_emigration_province
					}
				}
			}
			if = {
				limit = {
					owner = {
						has_country_flag = to_found_european_emigration_province
					}
				}
				event_target:to_european_emigration_province = {
					add_province_modifier = {
						name = to_recent_european_emigration
						duration = 3650
						# hidden = yes
					}
				}
				set_province_flag = to_static_colonial_culture
				if = {
					limit = {
						NOT = { culture = event_target:to_european_emigration_province }
					}
					change_culture = event_target:to_european_emigration_province
				}
				if = {
					limit = {
						NOT = { religion = event_target:to_european_emigration_province }
					}
					change_religion = event_target:to_european_emigration_province
				}
				if = {
					limit = {
						owner = {
							has_country_flag = to_has_european_immigration_event_active
						}
					}
					set_province_flag = to_european_immigration_event_pending
				}
				if = {
					limit = {
						owner = {
							NOT = { has_country_flag = to_has_european_immigration_event_active }
						}
					}
					province_event = { id = nhs2_countryevents.36 }
				}
			}
		}
	}
}

to_remove_estate_privilege_short_tooltip = {
	if = {
		limit = {
			has_estate_privilege = $PRIVILEGE$
		}
		[[CANNOT_REVOKE_EFFECT]
		if = {
			limit = {
				NOT = { can_revoke_estate_privilege = $PRIVILEGE$ }
			}
			$CANNOT_REVOKE_EFFECT$
		}
		]
		custom_tooltip = to_remove_$PRIVILEGE$_tt
		hidden_effect = {
			remove_estate_privilege = $PRIVILEGE$
		}
	}
}

to_remove_all_nobles_monopolies_and_apply_penalties = {
	if = {
		limit = {
			to_has_monopoly_estate_privilege_nobles = yes
		}
		to_remove_estate_privilege_short_tooltip = { 
			PRIVILEGE = estate_nobles_monopoly_of_metals
			CANNOT_REVOKE_EFFECT = "
			hidden_effect = {
				to_add_noble_estate_loyalty_modifier = {
					loyalty = -20
					desc = to_revoked_monopoly
					duration = 3650
				}
			}
			"
		}
		to_remove_estate_privilege_short_tooltip = { 
			PRIVILEGE = estate_nobles_monopoly_of_livestock
			CANNOT_REVOKE_EFFECT = "
			hidden_effect = {
				to_add_noble_estate_loyalty_modifier = {
					loyalty = -20
					desc = to_revoked_monopoly
					duration = 3650
				}
			}
			"
		}
		to_remove_estate_privilege_short_tooltip = { 
			PRIVILEGE = estate_nobles_monopoly_of_gems
			CANNOT_REVOKE_EFFECT = "
			hidden_effect = {
				to_add_noble_estate_loyalty_modifier = {
					loyalty = -20
					desc = to_revoked_monopoly
					duration = 3650
				}
			}
			"
		}
		if = {
			limit = {
				has_estate_privilege = estate_nobles_monopoly_of_metals
				has_estate_privilege = estate_nobles_monopoly_of_livestock
				has_estate_privilege = estate_nobles_monopoly_of_gems
			}
			to_add_noble_estate_loyalty = {
				loyalty = -60
			}
		}
		else_if = {
			limit = {
				calc_true_if = {
					amount = 2
					has_estate_privilege = estate_nobles_monopoly_of_metals
					has_estate_privilege = estate_nobles_monopoly_of_livestock
					has_estate_privilege = estate_nobles_monopoly_of_gems
				}
			}
			to_add_noble_estate_loyalty = {
				loyalty = -40
			}
		}
		else = {
			to_add_noble_estate_loyalty = {
				loyalty = -20
			}
		}
		custom_tooltip = to_nobility_monopolies_revoke_loyalty_equilibrium_tt
	}
}

to_remove_all_clergy_monopolies_and_apply_penalties = {
	if = {
		limit = {
			to_has_monopoly_estate_privilege_church = yes
		}
		to_remove_estate_privilege_short_tooltip = { 
			PRIVILEGE = estate_church_monopoly_of_incense
			CANNOT_REVOKE_EFFECT = "
			hidden_effect = {
				add_estate_loyalty_modifier = {
					estate = estate_church
					loyalty = -20
					desc = to_revoked_monopoly
					duration = 3650
				}
			}
			"
		}
		to_remove_estate_privilege_short_tooltip = { 
			PRIVILEGE = estate_church_monopoly_of_wool
			CANNOT_REVOKE_EFFECT = "
			hidden_effect = {
				add_estate_loyalty_modifier = {
					estate = estate_church
					loyalty = -20
					desc = to_revoked_monopoly
					duration = 3650
				}
			}
			"
		}
		to_remove_estate_privilege_short_tooltip = { 
			PRIVILEGE = estate_church_monopoly_of_wine
			CANNOT_REVOKE_EFFECT = "
			hidden_effect = {
				add_estate_loyalty_modifier = {
					estate = estate_church
					loyalty = -20
					desc = to_revoked_monopoly
					duration = 3650
				}
			}
			"
		}
		to_remove_estate_privilege_short_tooltip = { 
			PRIVILEGE = estate_church_monopoly_of_slaves
			CANNOT_REVOKE_EFFECT = "
			hidden_effect = {
				add_estate_loyalty_modifier = {
					estate = estate_church
					loyalty = -20
					desc = to_revoked_monopoly
					duration = 3650
				}
			}
			"
		}
		if = {
			limit = {
				has_estate_privilege = estate_church_monopoly_of_incense
				has_estate_privilege = estate_church_monopoly_of_wool
				has_estate_privilege = estate_church_monopoly_of_wine
				has_estate_privilege = estate_church_monopoly_of_slaves
			}
			add_estate_loyalty = {
				estate = estate_church
				loyalty = -80
			}
		}
		else_if = {
			limit = {
				calc_true_if = {
					amount = 3
					has_estate_privilege = estate_church_monopoly_of_incense
					has_estate_privilege = estate_church_monopoly_of_wool
					has_estate_privilege = estate_church_monopoly_of_wine
					has_estate_privilege = estate_church_monopoly_of_slaves
				}
			}
			add_estate_loyalty = {
				estate = estate_church
				loyalty = -60
			}
		}
		else_if = {
			limit = {
				calc_true_if = {
					amount = 2
					has_estate_privilege = estate_church_monopoly_of_incense
					has_estate_privilege = estate_church_monopoly_of_wool
					has_estate_privilege = estate_church_monopoly_of_wine
					has_estate_privilege = estate_church_monopoly_of_slaves
				}
			}
			add_estate_loyalty = {
				estate = estate_church
				loyalty = -40
			}
		}
		else = {
			add_estate_loyalty = {
				estate = estate_church
				loyalty = -20
			}
		}
		custom_tooltip = to_church_monopolies_revoke_loyalty_equilibrium_tt
	}
}

to_remove_all_burghers_monopolies_and_apply_penalties = {
	if = {
		limit = {
			to_has_monopoly_estate_privilege_burghers = yes
		}
		to_remove_estate_privilege_short_tooltip = { 
			PRIVILEGE = estate_burghers_monopoly_of_textiles
			CANNOT_REVOKE_EFFECT = "
			hidden_effect = {
				add_estate_loyalty_modifier = {
					estate = estate_burghers
					loyalty = -20
					desc = to_revoked_monopoly
					duration = 3650
				}
			}
			"
		}
		to_remove_estate_privilege_short_tooltip = { 
			PRIVILEGE = estate_burghers_monopoly_of_dyes
			CANNOT_REVOKE_EFFECT = "
			hidden_effect = {
				add_estate_loyalty_modifier = {
					estate = estate_burghers
					loyalty = -20
					desc = to_revoked_monopoly
					duration = 3650
				}
			}
			"
		}
		to_remove_estate_privilege_short_tooltip = { 
			PRIVILEGE = estate_burghers_monopoly_of_glass
			CANNOT_REVOKE_EFFECT = "
			hidden_effect = {
				add_estate_loyalty_modifier = {
					estate = estate_burghers
					loyalty = -20
					desc = to_revoked_monopoly
					duration = 3650
				}
			}
			"
		}
		to_remove_estate_privilege_short_tooltip = { 
			PRIVILEGE = estate_burghers_monopoly_of_paper
			CANNOT_REVOKE_EFFECT = "
			hidden_effect = {
				add_estate_loyalty_modifier = {
					estate = estate_burghers
					loyalty = -20
					desc = to_revoked_monopoly
					duration = 3650
				}
			}
			"
		}
		if = {
			limit = {
				has_estate_privilege = estate_burghers_monopoly_of_textiles
				has_estate_privilege = estate_burghers_monopoly_of_dyes
				has_estate_privilege = estate_burghers_monopoly_of_glass
				has_estate_privilege = estate_burghers_monopoly_of_paper
			}
			add_estate_loyalty = {
				estate = estate_burghers
				loyalty = -80
			}
		}
		else_if = {
			limit = {
				calc_true_if = {
					amount = 3
					has_estate_privilege = estate_burghers_monopoly_of_textiles
					has_estate_privilege = estate_burghers_monopoly_of_dyes
					has_estate_privilege = estate_burghers_monopoly_of_glass
					has_estate_privilege = estate_burghers_monopoly_of_paper
				}
			}
			add_estate_loyalty = {
				estate = estate_burghers
				loyalty = -60
			}
		}
		else_if = {
			limit = {
				calc_true_if = {
					amount = 2
					has_estate_privilege = estate_burghers_monopoly_of_textiles
					has_estate_privilege = estate_burghers_monopoly_of_dyes
					has_estate_privilege = estate_burghers_monopoly_of_glass
					has_estate_privilege = estate_burghers_monopoly_of_paper
				}
			}
			add_estate_loyalty = {
				estate = estate_burghers
				loyalty = -40
			}
		}
		else = {
			add_estate_loyalty = {
				estate = estate_burghers
				loyalty = -20
			}
		}
		custom_tooltip = to_burghers_monopolies_revoke_loyalty_equilibrium_tt
	}
}

to_handle_embrace_mercantilism_colonial_modifier = {
	if = {
		limit = {
			owner = { has_government_attribute = to_increased_colonial_growth_overseas }
			to_overseas_colony_trigger = yes
		}
		add_province_modifier = { 
			name = to_embrace_mercantilism_colonial_modifier
			duration = -1
		}
	}
	else = {
		remove_province_modifier = to_embrace_mercantilism_colonial_modifier
	}
}

to_handle_embrace_mercantilism_colonial_modifier_capital_moved = {
	if = {
		limit = {
			owner = {
				has_government_attribute = to_increased_colonial_growth_overseas
			}
		}
		owner = {
			every_owned_province = {
				to_handle_embrace_mercantilism_colonial_modifier = yes
			}
		}
	}
}

to_handle_war_economy_province_modifier = {
	if = {
		limit = {
			owner = { has_government_attribute = to_production_bonus_on_military_goods }
			to_war_economy_good_province = yes
		}
		add_province_modifier = { 
			name = to_war_economy_province_modifier
			duration = -1
		}
	}
	else = {
		remove_province_modifier = to_war_economy_province_modifier
	}
}

to_handle_cash_crops_province_modifier = {
	if = {
		limit = {
			owner = { has_government_attribute = to_improve_cash_crop_provinces }
		}
		if = {
			limit = {
				to_cash_crops_good_province = yes
			}
			remove_province_modifier = to_cash_crops_bad_province_modifier
			add_province_modifier = { 
				name = to_cash_crops_good_province_modifier
				duration = -1
			}
		}
		else = {
			remove_province_modifier = to_cash_crops_good_province_modifier
			add_province_modifier = { 
				name = to_cash_crops_bad_province_modifier
				duration = -1
			}
		}
	}
	else = {
		remove_province_modifier = to_cash_crops_bad_province_modifier
		remove_province_modifier = to_cash_crops_good_province_modifier
	}
}

to_handle_autarky_province_modifier = {
	if = {
		limit = {
			owner = { has_government_attribute = to_bonus_on_agricultural_and_mining_goods }
			to_autarky_good_province = yes
		}
		add_province_modifier = { 
			name = to_autarky_province_modifier
			duration = -1
		}
	}
	else = {
		remove_province_modifier = to_autarky_province_modifier
	}
}

to_handle_mercantile_nation_cot_boost_modifier = {
	if = {
		limit = {
			owner = { has_government_attribute = to_reduce_dev_cost_on_centers_of_trade }
			province_has_center_of_trade_of_level = 1
		}
		add_province_modifier = { 
			name = to_mercantile_nation_cot_boost
			duration = -1
		}
	}
	else = {
		remove_province_modifier = to_mercantile_nation_cot_boost
	}
}

to_handle_free_haven_pirate_opinion_modifier = {
	if = {
		limit = {
			has_government_attribute = is_pirate_republic_reform
		}
		every_country = {
			if = {
				limit = {
					has_government_attribute = to_opinion_with_pirate_nations
				}
				if = {
					limit = {
						NOT = {
							reverse_has_opinion_modifier = {
								who = PREV
								modifier = to_free_haven_pirate_opinion
							}
						}
					}
					reverse_add_opinion = {
						who = PREV
						modifier = to_free_haven_pirate_opinion
					}
				}
			}
			else = {
				reverse_remove_opinion = {
					who = PREV
					modifier = to_free_haven_pirate_opinion
				}
			}
		}
	}
}

to_handle_free_haven_pirate_opinion_modifier_remove = {
	every_country = {
		reverse_remove_opinion = {
			who = PREV
			modifier = to_free_haven_pirate_opinion
		}
	}
}

to_handle_naval_bateries_give_defensivness_modifier = {
	if = {
		limit = {
			owner = { has_government_attribute = to_naval_bateries_give_defensivness }
		}
		add_province_modifier = { 
			name = to_coastal_defence_defensivness_modifier
			duration = -1
		}
	}
	else = {
		remove_province_modifier = to_coastal_defence_defensivness_modifier
	}
}

to_handle_naval_bateries_give_defensivness_modifier_on_build = {
	if = {
		limit = {
			owner = { has_government_attribute = to_naval_bateries_give_defensivness }
		}
		add_province_modifier = { 
			name = to_coastal_defence_defensivness_modifier
			duration = -1
		}
	}
}

to_remove_naval_bateries_give_defensivness = {
	remove_province_modifier = to_coastal_defence_defensivness_modifier
}

# root = country, from = location
to_check_increase_devastation_upon_fort_capture = {
	if = {
		limit = {
			has_reform = to_indiscriminate_greek_fire_use_reform
			FROM = {
				fort_level = 1
				NOT = { has_province_modifier = to_devastated_by_greek_fire }
				owner = {
					war_with = ROOT
				}
			}
			if = {
				limit = {
					has_country_flag = to_spared_greeks_from_fire_modifier
				}
				if = {
					limit = {
						has_country_flag = to_spared_albanians_from_fire_modifier
					}
					NOT = { to_eligible_for_spared_from_greek_fire_with_albanians = yes }
				}
				else = {
					NOT = { to_eligible_for_spared_from_greek_fire_greeks = yes }
				}
			}
		}
		FROM = {
			add_devastation = 50
			add_permanent_province_modifier = {
				name = to_devastated_by_greek_fire
				duration = 7300
			}
			if = {
				limit = {
					development = 1
				}
				if = {
					limit = {
						has_province_modifier = to_nat_tribal_development
					}
					export_to_variable = {
						which = to_base_tax
						value = trigger_value:base_tax
					}
					export_to_variable = {
						which = to_base_production
						value = trigger_value:base_production
					}
					export_to_variable = {
						which = to_base_manpower
						value = trigger_value:base_manpower
					}
					random_list = {
						1 = {
							trigger = {
								base_tax = 1
								OR = {
									NOT = {
										check_variable = {
											which = to_nat_local_tribal_tax
											which = to_base_tax
										}
									}
									AND = {
										check_variable = {
											which = to_nat_local_tribal_production
											which = to_base_production
										}
										check_variable = {
											which = to_nat_local_tribal_manpower
											which = to_base_manpower
										}
									}
								}
							}
							add_base_tax = -1
							if = {
								limit = {
									check_variable = {
										which = to_nat_local_tribal_tax
										which = to_base_tax
									}
								}
								subtract_variable = {
									which = to_base_tax
									value = 1
								}
								set_variable = {
									which = to_nat_local_tribal_tax
									which = to_base_tax
								}
							}
						}
						1 = {
							trigger = {
								base_production = 1
								OR = {
									NOT = {
										check_variable = {
											which = to_nat_local_tribal_production
											which = to_base_production
										}
									}
									AND = {
										check_variable = {
											which = to_nat_local_tribal_tax
											which = to_base_tax
										}
										check_variable = {
											which = to_nat_local_tribal_manpower
											which = to_base_manpower
										}
									}
								}
							}
							add_base_production = -1
							if = {
								limit = {
									check_variable = {
										which = to_nat_local_tribal_production
										which = to_base_production
									}
								}
								subtract_variable = {
									which = to_base_production
									value = 1
								}
								set_variable = {
									which = to_nat_local_tribal_production
									which = to_base_production
								}
							}
						}
						1 = {
							trigger = {
								base_manpower = 1
								OR = {
									NOT = {
										check_variable = {
											which = to_nat_local_tribal_manpower
											which = to_base_manpower
										}
									}
									AND = {
										check_variable = {
											which = to_nat_local_tribal_tax
											which = to_base_tax
										}
										check_variable = {
											which = to_nat_local_tribal_production
											which = to_base_production
										}
									}
								}
							}
							add_base_manpower = -1
							if = {
								limit = {
									check_variable = {
										which = to_nat_local_tribal_manpower
										which = to_base_manpower
									}
								}
								subtract_variable = {
									which = to_base_manpower
									value = 1
								}
								set_variable = {
									which = to_nat_local_tribal_manpower
									which = to_base_manpower
								}
							}
						}
					}
					if = {
						limit = {
							NOT = {
								development = 1
							}
						}
						to_nat_clear_local_tribal_development = yes
					}
				}
				else = {
					random_list = {
						1 = {
							trigger = {
								base_tax = 1
							}
							add_base_tax = -1
						}
						1 = {
							trigger = {
								base_production = 1
							}
							add_base_production = -1
						}
						1 = {	
							trigger = {
								base_manpower = 1
							}
							add_base_manpower = -1
						}
					}
				}
			}
		}
	}
}

to_check_spared_from_greek_fire = {
	if = {
		limit = {
			has_province_modifier = to_spared_from_greek_fire_tm
		}
		if = {
			limit = {
				OR = {
					owner = {
						NOT = {
							nhs_check_all_elysian_tags = { CONDITION = war_with }
						}
					}
					NOT = { to_eligible_for_spared_from_greek_fire = yes }
					NOT = { fort_level = 1 }
				}
			}
			remove_province_triggered_modifier = to_spared_from_greek_fire_tm
		}
	}
	else_if = {
		limit = {
			to_eligible_for_spared_from_greek_fire = yes
			fort_level = 1
			owner = {
				has_country_flag = to_got_spared_from_greek_fire_modifier
			}
		}
		add_province_triggered_modifier = to_spared_from_greek_fire_tm
	}
}

to_check_spared_from_greek_fire_on_fort_build = {
	if = {
		limit = {
			owner = {
				has_country_flag = to_got_spared_from_greek_fire_modifier
			}
			NOT = { has_province_modifier = to_spared_from_greek_fire_tm }
			to_eligible_for_spared_from_greek_fire = yes
		}
		add_province_triggered_modifier = to_spared_from_greek_fire_tm
	}
}

to_check_spared_from_greek_fire_on_fort_destroyed = {
	if = {
		limit = {
			has_province_modifier = to_spared_from_greek_fire_tm
		}
		remove_province_triggered_modifier = to_spared_from_greek_fire_tm
	}
}

to_check_spared_from_greek_fire_on_war_ended = {
	if = {
		limit = {
			has_country_flag = to_got_spared_from_greek_fire_modifier
			NOT = {
				any_war_enemy_country = {
					nhs_check_all_elysian_tags = { CONDITION = tag }
					has_reform = to_indiscriminate_greek_fire_use_reform
				}
			}
		}
		clr_country_flag = to_got_spared_from_greek_fire_modifier
		every_owned_province = {
			remove_province_triggered_modifier = to_spared_from_greek_fire_tm
		}
	}
	FROM = {
		if = {
			limit = {
				has_country_flag = to_got_spared_from_greek_fire_modifier
				NOT = {
					any_war_enemy_country = {
						nhs_check_all_elysian_tags = { CONDITION = tag }
						has_reform = to_indiscriminate_greek_fire_use_reform
					}
				}
			}
			clr_country_flag = to_got_spared_from_greek_fire_modifier
			every_owned_province = {
				remove_province_triggered_modifier = to_spared_from_greek_fire_tm
			}
		}
	}
}

to_check_discouraged_recruits = {
	if = {
		limit = {
			has_province_modifier = to_discouraged_recruits
			OR = {
				AND = {
					NOT = { culture = shqiperi }
					NOT = { culture = shqipproi }
				}
				# This part doesn't work properly if you release Albania as a vassal, since they don't become subject until getting all the provinces internally. So far I have no idea how to handle this.
				owner = {
					NOT = { has_or_overlord_has = { TRIGGER = "has_country_flag = to_used_greek_fire_on_greeks" } }
				}
			}
		}
		remove_province_modifier = to_discouraged_recruits
	}
}

to_check_discouraged_recruits_dependancy_lost = {
	if = {
		limit = {
			has_country_flag = to_used_greek_fire_on_greeks
			NOT = { had_country_flag = {flag = to_used_greek_fire_on_greeks days = 10950 } }
		}
		FROM = {
			every_owned_province = {
				limit = {
					has_province_modifier = to_discouraged_recruits
				}
				remove_province_modifier = to_discouraged_recruits
				export_to_variable = {
					which = to_base_manpower
					value = trigger_value:base_manpower
				}
				while = {
					limit = {
						check_variable = {
							which = to_base_manpower
							value = 1
						}
					}
					if = {
						limit = {
							check_variable = {
								which = to_base_manpower
								value = 5
							}
						}
						subtract_variable = {
							which = to_base_manpower
							value = 5
						}
						owner = {
							add_manpower = 1.25
						}
					}
					else = {
						subtract_variable = {
							which = to_base_manpower
							value = 1
						}
						owner = {
							add_manpower = 0.25
						}
					}
				}
			}
		}
	}
}

###################################
# Roman Janissaries
###################################

to_roman_janissaries_check = {
	nhs_effect_for_existing_elysian_tag = {
		EFFECT = "to_roman_janissaries_maintenance = { CHANGE_POWER = yes }"
	}
}

to_roman_janissaries_maintenance = {
	if = {
		limit = {
			has_government_mechanic = to_roman_janissary_mechanic
		}

		set_variable = {
			which = to_janissary_regiments_change
			value = 0.225
		}

		# Num of Janissary Regiments
		export_to_variable = {
			which = to_num_of_janissaries
			value = trigger_value:num_of_janissaries
		}

		multiply_variable = {
			which = to_num_of_janissaries
			value = -0.1
		}

		change_variable = {
			which = to_janissary_regiments_change
			which = to_num_of_janissaries
		}

		if = {
			limit = {
				has_country_modifier = to_janissary_child_levy
			}
			set_variable = {
				which = to_janissary_regiments_child_levy
				value = 0
			}

			if = {
				limit = {
					to_has_abrahamic_religion = yes
				}
				every_owned_province = {
					limit = {
						has_owner_culture = no
						NOT = { religion_group = PREV }
						is_state = yes
					}
					PREV = {
						export_to_variable = {
							which = to_local_development
							value = trigger_value:development
							who = PREV
						}
						change_variable = {
							which = to_janissary_regiments_child_levy
							which = to_local_development
						}
					}
				}
			}
			else = {
				every_owned_province = {
					limit = {
						has_owner_culture = no
						has_owner_religion = no
						is_state = yes
					}
					PREV = {
						export_to_variable = {
							which = to_local_development
							value = trigger_value:development
							who = PREV
						}
						change_variable = {
							which = to_janissary_regiments_child_levy
							which = to_local_development
						}
					}
				}
			}
			
			multiply_variable = {
				which = to_janissary_regiments_child_levy
				value = 0.01
			}
		}

		if = {
			limit = {
				has_country_modifier = to_janissaries_from_true_faith
			}
			set_variable = {
				which = to_janissary_regiments_from_true_faith
				value = 0
			}

			if = {
				limit = {
					to_has_abrahamic_religion = yes
				}
				every_owned_province = {
					limit = {
						OR = {
							NOT = { culture_group = PREV }
							culture = elysameric
						}
						religion_group = PREV
						is_state = yes
					}
					PREV = {
						export_to_variable = {
							which = to_local_development
							value = trigger_value:development
							who = PREV
						}
						change_variable = {
							which = to_janissary_regiments_from_true_faith
							which = to_local_development
						}
					}
				}
			}
			else = {
				every_owned_province = {
					limit = {
						OR = {
							NOT = { culture_group = PREV }
							culture = elysameric
						}
						has_owner_religion = yes
						is_state = yes
					}
					PREV = {
						export_to_variable = {
							which = to_local_development
							value = trigger_value:development
							who = PREV
						}
						change_variable = {
							which = to_janissary_regiments_from_true_faith
							which = to_local_development
						}
					}
				}
			}
			
			multiply_variable = {
				which = to_janissary_regiments_from_true_faith
				value = 0.005
			}
		}

		if = {
			limit = {
				has_country_modifier = to_janissary_recruitment_quotas
			}
			set_variable = {
				which = to_janissary_regiments_recruitment_quotas
				which = to_janissary_regiments_child_levy
			}
			multiply_variable = {
				which = to_janissary_regiments_recruitment_quotas
				value = 1.50
			}
			change_variable = {
				which = to_janissary_regiments_change
				which = to_janissary_regiments_recruitment_quotas
			}
			subtract_variable = {
				which = to_janissary_regiments_recruitment_quotas
				which = to_janissary_regiments_child_levy
			}
			
			if = {
				limit = {
					has_country_modifier = to_janissaries_from_true_faith
				}
				set_variable = {
					which = to_janissary_regiments_recruitment_quotas_from_true_faith
					which = to_janissary_regiments_from_true_faith
				}
				multiply_variable = {
					which = to_janissary_regiments_recruitment_quotas_from_true_faith
					value = 1.25
				}
				change_variable = {
					which = to_janissary_regiments_change
					which = to_janissary_regiments_recruitment_quotas_from_true_faith
				}
				subtract_variable = {
					which = to_janissary_regiments_recruitment_quotas_from_true_faith
					which = to_janissary_regiments_from_true_faith
				}
				change_variable = {
					which = to_janissary_regiments_recruitment_quotas
					which = to_janissary_regiments_recruitment_quotas_from_true_faith
				}
			}
		}
		else = {
			change_variable = {
				which = to_janissary_regiments_change
				which = to_janissary_regiments_child_levy
			}
			if = {
				limit = {
					has_country_modifier = to_janissaries_from_true_faith
				}
				change_variable = {
					which = to_janissary_regiments_change
					which = to_janissary_regiments_from_true_faith
				}
			}
		}

		if = {
			limit = {
				has_country_modifier = to_janissary_open_recruitment
			}
			set_variable = {
				which = to_janissary_regiments_open_recruitment
				value = 0
			}

			every_owned_province = {
				limit = {
					#culture_group = PREV
					#has_owner_culture = yes
					has_owner_religion = yes
					is_state = yes
				}
				PREV = {
					export_to_variable = {
						which = to_local_development
						value = trigger_value:development
						who = PREV
					}
					if = {
						limit = {
							culture_group = PREV
						}
						multiply_variable = {
							which = to_local_development
							value = 2
						}
					}
					change_variable = {
						which = to_janissary_regiments_open_recruitment
						which = to_local_development
					}
				}
			}
			
			multiply_variable = {
				which = to_janissary_regiments_open_recruitment
				value = 0.001
			}

			change_variable = {
				which = to_janissary_regiments_change
				which = to_janissary_regiments_open_recruitment
			}
		}

		to_roman_janissaries_maintenance_subjects = yes

		set_variable = {
			which = to_janissary_regiments_change_tooltip
			which = to_janissary_regiments_change
		}

		[[CHANGE_POWER]
		while = {
			limit = {
				check_variable = {
					which = to_janissary_regiments_change
					value = 0.001
				}
			}
			if = {
				limit = {
					check_variable = {
						which = to_janissary_regiments_change
						value = 1
					}
				}
				add_government_power = {
					mechanic_type = to_roman_janissary_mechanic
					power_type = to_janissary_regiments
					value = 1
				}
				change_variable = {
					which = to_janissary_regiments_change
					value = -1
				}
			}
			else_if = {
				limit = {
					check_variable = {
						which = to_janissary_regiments_change
						value = 0.1
					}
				}
				add_government_power = {
					mechanic_type = to_roman_janissary_mechanic
					power_type = to_janissary_regiments
					value = 0.1
				}
				change_variable = {
					which = to_janissary_regiments_change
					value = -0.1
				}
			}
			else_if = {
				limit = {
					check_variable = {
						which = to_janissary_regiments_change
						value = 0.01
					}
				}
				add_government_power = {
					mechanic_type = to_roman_janissary_mechanic
					power_type = to_janissary_regiments
					value = 0.01
				}
				change_variable = {
					which = to_janissary_regiments_change
					value = -0.01
				}
			}
			else_if = {
				limit = {
					check_variable = {
						which = to_janissary_regiments_change
						value = 0.001
					}
				}
				add_government_power = {
					mechanic_type = to_roman_janissary_mechanic
					power_type = to_janissary_regiments
					value = 0.001
				}
				change_variable = {
					which = to_janissary_regiments_change
					value = -0.001
				}
			}
		}

		multiply_variable = {
			which = to_janissary_regiments_change
			value = -1
		}

		while = {
			limit = {
				check_variable = {
					which = to_janissary_regiments_change
					value = 0.001
				}
			}
			if = {
				limit = {
					check_variable = {
						which = to_janissary_regiments_change
						value = 1
					}
				}
				add_government_power = {
					mechanic_type = to_roman_janissary_mechanic
					power_type = to_janissary_regiments
					value = -1
				}
				change_variable = {
					which = to_janissary_regiments_change
					value = -1
				}
			}
			else_if = {
				limit = {
					check_variable = {
						which = to_janissary_regiments_change
						value = 0.1
					}
				}
				add_government_power = {
					mechanic_type = to_roman_janissary_mechanic
					power_type = to_janissary_regiments
					value = -0.1
				}
				change_variable = {
					which = to_janissary_regiments_change
					value = -0.1
				}
			}
			else_if = {
				limit = {
					check_variable = {
						which = to_janissary_regiments_change
						value = 0.01
					}
				}
				add_government_power = {
					mechanic_type = to_roman_janissary_mechanic
					power_type = to_janissary_regiments
					value = -0.01
				}
				change_variable = {
					which = to_janissary_regiments_change
					value = -0.01
				}
			}
			else_if = {
				limit = {
					check_variable = {
						which = to_janissary_regiments_change
						value = 0.001
					}
				}
				add_government_power = {
					mechanic_type = to_roman_janissary_mechanic
					power_type = to_janissary_regiments
					value = -0.001
				}
				change_variable = {
					which = to_janissary_regiments_change
					value = -0.001
				}
			}
		}

		if = {
			limit = {
				NOT = {
					has_government_power = {
						mechanic_type = to_roman_janissary_mechanic
						power_type = to_janissary_regiments
						value = 0.001
					}
				}
			}
			add_country_modifier = {
				name = to_janissary_low_reserve
				duration = -1
				hidden = yes
			}
		}
		else = {
			remove_country_modifier = to_janissary_low_reserve
		}
		
		]
	}
}

to_roman_janissaries_maintenance_subjects = {
	if = {
		limit = {
			has_country_modifier = to_janissary_child_levy
		}
		save_event_target_as = to_blood_tax_overlord
		set_variable = {
			which = to_janissary_regiments_blood_tax
			value = 0
		}
		every_subject_country = {
			to_calculate_janissary_reserve_potential_subject = yes
			if = {
				limit = {
					OR = {
						has_country_modifier = to_blood_tax
						has_country_modifier = to_blood_tax_true_faith
					}
				}
				if = {
					limit = {
						PREV = { has_country_modifier = to_janissaries_from_true_faith }
					}
					PREV = {
						set_variable = {
							which = to_blood_tax_from_true_faith_potential
							which = PREV
						}
						change_variable = {
							which = to_janissary_regiments_blood_tax
							which = to_blood_tax_from_true_faith_potential
						}
					}
				}
				else = {
					PREV = {
						set_variable = {
							which = to_blood_tax_potential
							which = PREV
						}
						change_variable = {
							which = to_janissary_regiments_blood_tax
							which = to_blood_tax_potential
						}
					}
				}
			}
		}
		change_variable = {
			which = to_janissary_regiments_change
			which = to_janissary_regiments_blood_tax
		}
	}
}

to_switch_janissary_law_event = {
	hidden_effect = {
		country_event = { id = to_janissary_events.6 }
	}
}

to_switch_janissary_law_event_2 = {
	hidden_effect = {
		country_event = { id = to_janissary_events.5 }
	}
}

to_consider_child_levy = {
	custom_tooltip = to_child_levy_flavor_tt
	custom_tooltip = nhs_new_line_tt
	custom_tooltip = to_child_levy_enact_tt
	custom_tooltip = nhs_new_line_tt
	custom_tooltip = to_child_levy_gain_tt

	if = {
		limit = {
			has_country_flag = to_consider_child_levy
		}
		clr_country_flag = to_consider_child_levy
	}
	else = {
		set_country_flag = to_consider_child_levy
	}
}

to_consider_revoke_child_levy = {
	custom_tooltip = to_child_levy_flavor_tt
	custom_tooltip = nhs_new_line_tt
	custom_tooltip = to_child_levy_revoke_tt
	custom_tooltip = nhs_new_line_tt
	custom_tooltip = to_child_levy_loss_tt
	if = {
		limit = {
			has_country_flag = to_consider_revoke_child_levy
		}
		clr_country_flag = to_consider_revoke_child_levy
	}
	else = {
		set_country_flag = to_consider_revoke_child_levy
	}

	if = {
		limit = {
			has_country_flag = to_janissary_from_subjects
		}
		custom_tooltip = nhs_new_line_tt
		custom_tooltip = to_from_subjects_revoke_tt
	}

	if = {
		limit = {
			has_country_modifier = to_janissaries_from_true_faith
		}
		custom_tooltip = to_from_true_faith_revoke_tt
	}
}

to_consider_from_true_faith = {
	custom_tooltip = to_from_true_faith_flavor_tt
	custom_tooltip = nhs_new_line_tt
	custom_tooltip = to_from_true_faith_enact_tt
	custom_tooltip = nhs_new_line_tt
	custom_tooltip = to_from_true_faith_gain_tt

	if = {
		limit = {
			has_country_flag = to_consider_from_true_faith
		}
		clr_country_flag = to_consider_from_true_faith
	}
	else = {
		set_country_flag = to_consider_from_true_faith
	}
}

to_consider_revoke_from_true_faith = {
	custom_tooltip = to_from_true_faith_flavor_tt
	custom_tooltip = nhs_new_line_tt
	custom_tooltip = to_from_true_faith_revoke_tt
	custom_tooltip = nhs_new_line_tt
	custom_tooltip = to_from_true_faith_loss_tt

	if = {
		limit = {
			has_country_flag = to_consider_revoke_from_true_faith
		}
		clr_country_flag = to_consider_revoke_from_true_faith
	}
	else = {
		set_country_flag = to_consider_revoke_from_true_faith
	}
}

to_consider_recruitment_quotas = {
	custom_tooltip = to_recruitment_quotas_flavor_tt
	custom_tooltip = nhs_new_line_tt
	custom_tooltip = to_recruitment_quotas_enact_tt
	custom_tooltip = nhs_new_line_tt
	custom_tooltip = to_recruitment_quotas_gain_tt

	if = {
		limit = {
			has_country_flag = to_consider_recruitment_quotas
		}
		clr_country_flag = to_consider_recruitment_quotas
	}
	else = {
		set_country_flag = to_consider_recruitment_quotas
	}
}

to_consider_revoke_recruitment_quotas = {
	custom_tooltip = to_recruitment_quotas_flavor_tt
	custom_tooltip = nhs_new_line_tt
	custom_tooltip = to_recruitment_quotas_revoke_tt
	custom_tooltip = nhs_new_line_tt
	custom_tooltip = to_recruitment_quotas_loss_tt

	if = {
		limit = {
			has_country_flag = to_consider_revoke_recruitment_quotas
		}
		clr_country_flag = to_consider_revoke_recruitment_quotas
	}
	else = {
		set_country_flag = to_consider_revoke_recruitment_quotas
	}
}

to_consider_open_recruitment = {
	custom_tooltip = to_open_recruitment_flavor_tt
	custom_tooltip = nhs_new_line_tt
	custom_tooltip = to_open_recruitment_enact_tt
	custom_tooltip = nhs_new_line_tt
	custom_tooltip = to_open_recruitment_gain_tt

	if = {
		limit = {
			has_country_flag = to_consider_open_recruitment
		}
		clr_country_flag = to_consider_open_recruitment
	}
	else = {
		set_country_flag = to_consider_open_recruitment
	}
}

to_consider_revoke_open_recruitment = {
	custom_tooltip = to_open_recruitment_flavor_tt
	custom_tooltip = nhs_new_line_tt
	custom_tooltip = to_open_recruitment_revoke_tt
	custom_tooltip = nhs_new_line_tt
	custom_tooltip = to_open_recruitment_loss_tt

	if = {
		limit = {
			has_country_flag = to_consider_revoke_open_recruitment
		}
		clr_country_flag = to_consider_revoke_open_recruitment
	}
	else = {
		set_country_flag = to_consider_revoke_open_recruitment
	}
}

to_consider_increase_compensation = {
	custom_tooltip = to_increase_compensation_flavor_tt
	custom_tooltip = nhs_new_line_tt
	custom_tooltip = to_increase_compensation_enact_tt

	if = {
		limit = {
			has_country_flag = to_consider_increase_compensation
		}
		clr_country_flag = to_consider_increase_compensation
	}
	else = {
		set_country_flag = to_consider_increase_compensation
	}
}

to_consider_revoke_increase_compensation = {
	custom_tooltip = to_increase_compensation_flavor_tt
	custom_tooltip = nhs_new_line_tt
	custom_tooltip = to_increase_compensation_revoke_tt

	if = {
		limit = {
			has_country_flag = to_consider_revoke_increase_compensation
		}
		clr_country_flag = to_consider_revoke_increase_compensation
	}
	else = {
		set_country_flag = to_consider_revoke_increase_compensation
	}
}

to_enact_janissary_law_changes = {
	if = {
		limit = {
			has_country_flag = to_consider_child_levy
		}
		hidden_effect = {
			add_country_modifier = {
				name = to_janissary_child_levy
				duration = -1
				hidden = yes
			}
			to_calculate_janissary_reserve_potential_all_subjects = yes
		}
		custom_tooltip = to_child_levy_enact_tt
		custom_tooltip = nhs_new_line_tt
	}
	else_if = {
		limit = {
			has_country_flag = to_consider_revoke_child_levy
		}
		hidden_effect = {
			remove_country_modifier = to_janissary_child_levy
			every_subject_country = {
				remove_country_modifier = to_blood_tax
				remove_country_modifier = to_blood_tax_true_faith
				clr_country_flag = to_has_blood_tax
			}
		}
		custom_tooltip = to_child_levy_revoke_tt

		if = {
			limit = {
				has_country_modifier = to_janissaries_from_true_faith
			}
			clr_country_flag = to_consider_from_true_faith
			clr_country_flag = to_consider_revoke_from_true_faith
			custom_tooltip = nhs_new_line_tt
			custom_tooltip = to_from_subjects_revoke_tt
			hidden_effect = {
				remove_country_modifier = to_janissaries_from_true_faith
				every_subject_country = {
					remove_country_modifier = to_blood_tax_true_faith
					clr_country_flag = to_has_blood_tax
				}
			}
		}

		if = {
			limit = {
				has_country_modifier = to_janissary_recruitment_quotas
			}
			clr_country_flag = to_consider_recruitment_quotas
			clr_country_flag = to_consider_revoke_recruitment_quotas
			custom_tooltip = nhs_new_line_tt
			custom_tooltip = to_recruitment_quotas_revoke_tt
			hidden_effect = {
				remove_country_modifier = to_janissary_recruitment_quotas
			}
		}
		custom_tooltip = nhs_new_line_tt
	}

	if = {
		limit = {
			has_country_flag = to_consider_from_true_faith
			OR = {
				has_country_modifier = to_janissary_child_levy
				has_country_flag = to_consider_child_levy
			}
		}
		hidden_effect = {
			add_country_modifier = {
				name = to_janissaries_from_true_faith
				duration = -1
				hidden = yes
			}
			every_subject_country = {
				limit = {
					has_country_modifier = to_blood_tax
					OR = {
						religion = ROOT
						AND = {
							to_has_abrahamic_religion = yes
							religion_group = ROOT
						}
					}
				}
				remove_country_modifier = to_blood_tax
				add_country_modifier = {
					name = to_blood_tax_true_faith
					duration = -1
				}
			}
		}
		custom_tooltip = to_from_true_faith_enact_tt
		custom_tooltip = nhs_new_line_tt
	}
	else_if = {
		limit = {
			has_country_flag = to_consider_revoke_from_true_faith
			NOT = { has_country_flag = to_consider_revoke_child_levy }
		}
		hidden_effect = {
			remove_country_modifier = to_janissaries_from_true_faith
			every_subject_country = {
				remove_country_modifier = to_blood_tax_true_faith
				clr_country_flag = to_has_blood_tax
			}
		}
		custom_tooltip = to_from_true_faith_revoke_tt
		custom_tooltip = nhs_new_line_tt
	}

	if = {
		limit = {
			has_country_flag = to_consider_recruitment_quotas
			OR = {
				has_country_modifier = to_janissary_child_levy
				has_country_flag = to_consider_child_levy
			}
		}
		hidden_effect = {
			add_country_modifier = {
				name = to_janissary_recruitment_quotas
				duration = -1
				hidden = yes
			}
		}
		custom_tooltip = to_recruitment_quotas_enact_tt
		custom_tooltip = nhs_new_line_tt
	}
	else_if = {
		limit = {
			has_country_flag = to_consider_revoke_recruitment_quotas
			NOT = { has_country_flag = to_consider_revoke_child_levy }
		}
		hidden_effect = {
			remove_country_modifier = to_janissary_recruitment_quotas
		}
		custom_tooltip = to_recruitment_quotas_revoke_tt
		custom_tooltip = nhs_new_line_tt
	}

	if = {
		limit = {
			has_country_flag = to_consider_open_recruitment
		}
		hidden_effect = {
			add_country_modifier = {
				name = to_janissary_open_recruitment
				duration = -1
				hidden = yes
			}
		}
		custom_tooltip = to_open_recruitment_enact_tt
		custom_tooltip = nhs_new_line_tt
	}
	else_if = {
		limit = {
			has_country_flag = to_consider_revoke_open_recruitment
		}
		hidden_effect = {
			remove_country_modifier = to_janissary_open_recruitment
		}
		custom_tooltip = to_open_recruitment_revoke_tt
		custom_tooltip = nhs_new_line_tt
	}

	if = {
		limit = {
			has_country_flag = to_consider_increase_compensation
		}
		hidden_effect = {
			add_country_modifier = {
				name = to_janissary_increase_compensation
				duration = -1
				hidden = yes
			}
			add_country_modifier = {
				name = to_janissary_increase_compensation_regiments
				duration = -1
				hidden = yes
			}
		}
		custom_tooltip = to_increase_compensation_enact_tt
		custom_tooltip = nhs_new_line_tt
	}
	else_if = {
		limit = {
			has_country_flag = to_consider_revoke_increase_compensation
		}
		hidden_effect = {
			remove_country_modifier = to_janissary_increase_compensation
			remove_country_modifier = to_janissary_increase_compensation_regiments
		}
		custom_tooltip = to_increase_compensation_revoke_tt
		custom_tooltip = nhs_new_line_tt
	}

	custom_tooltip = to_add_recently_changed_law_tt
	hidden_effect = {
		add_country_modifier = {
			name = to_recent_janissary_law
			duration = 7300
		}
	}
}

to_on_janissary_law_open = {
	if = {
		limit = {
			NOT = { has_country_flag = to_janissary_laws_menu_open }
		}
		set_country_flag = to_janissary_laws_menu_open

		clr_country_flag = to_consider_child_levy
		clr_country_flag = to_consider_revoke_child_levy
		clr_country_flag = to_consider_from_true_faith
		clr_country_flag = to_consider_revoke_from_true_faith
		clr_country_flag = to_consider_recruitment_quotas
		clr_country_flag = to_consider_revoke_recruitment_quotas
		clr_country_flag = to_consider_open_recruitment
		clr_country_flag = to_consider_revoke_open_recruitment
		clr_country_flag = to_consider_increase_compensation
		clr_country_flag = to_consider_revoke_increase_compensation

		set_variable = {
			which = to_child_levy_potential
			value = 0
		}
		if = {
			limit = {
				to_has_abrahamic_religion = yes
			}
			every_owned_province = {
				limit = {
					has_owner_culture = no
					NOT = { religion_group = PREV }
					is_state = yes
				}
				PREV = {
					export_to_variable = {
						which = to_local_development
						value = trigger_value:development
						who = PREV
					}
					change_variable = {
						which = to_child_levy_potential
						which = to_local_development
					}
				}
			}
		}
		else = {
			every_owned_province = {
				limit = {
					has_owner_culture = no
					has_owner_religion = no
					is_state = yes
				}
				PREV = {
					export_to_variable = {
						which = to_local_development
						value = trigger_value:development
						who = PREV
					}
					change_variable = {
						which = to_child_levy_potential
						which = to_local_development
					}
				}
			}
		}
		multiply_variable = {
			which = to_child_levy_potential
			value = 0.01
		}
		####
		set_variable = {
			which = to_from_true_faith_potential
			value = 0
		}
		if = {
			limit = {
				to_has_abrahamic_religion = yes
			}
			every_owned_province = {
				limit = {
					OR = {
						NOT = { culture_group = PREV }
						culture = elysameric
					}
					religion_group = PREV
					is_state = yes
				}
				PREV = {
					export_to_variable = {
						which = to_local_development
						value = trigger_value:development
						who = PREV
					}
					change_variable = {
						which = to_from_true_faith_potential
						which = to_local_development
					}
				}
			}
		}
		else = {
			every_owned_province = {
				limit = {
					OR = {
						NOT = { culture_group = PREV }
						culture = elysameric
					}
					has_owner_religion = yes
					is_state = yes
				}
				PREV = {
					export_to_variable = {
						which = to_local_development
						value = trigger_value:development
						who = PREV
					}
					change_variable = {
						which = to_from_true_faith_potential
						which = to_local_development
					}
				}
			}
		}
		multiply_variable = {
			which = to_from_true_faith_potential
			value = 0.005
		}

		set_variable = {
			which = to_recruitment_quotas_potential
			which = to_child_levy_potential
		}
		multiply_variable = {
			which = to_recruitment_quotas_potential
			value = 1.50
		}
		set_variable = {
			which = to_recruitment_quotas_potential_with_from_true_faith
			which = to_from_true_faith_potential
		}
		multiply_variable = {
			which = to_recruitment_quotas_potential_with_from_true_faith
			value = 1.25
		}
		change_variable = {
			which = to_recruitment_quotas_potential_with_from_true_faith
			which = to_recruitment_quotas_potential
		}
		subtract_variable = {
			which = to_recruitment_quotas_potential
			which = to_child_levy_potential
		}
		subtract_variable = {
			which = to_recruitment_quotas_potential_with_from_true_faith
			which = to_child_levy_potential
		}
		subtract_variable = {
			which = to_recruitment_quotas_potential_with_from_true_faith
			which = to_from_true_faith_potential
		}
		####
		# Blood Tax
		every_subject_country = {
			limit = {
				OR = {
					has_country_modifier = to_blood_tax
					has_country_modifier = to_blood_tax_true_faith
				}
			}
			PREV = {
				set_variable = {
					which = to_blood_tax_potential
					which = PREV
				}
				change_variable = {
					which = to_child_levy_potential
					which = to_blood_tax_potential
				}
			}
			PREV = {
				set_variable = {
					which = to_blood_tax_from_true_faith_potential
					which = PREV
				}
				subtract_variable = {
					which = to_blood_tax_from_true_faith_potential
					which = to_blood_tax_potential
				}
				change_variable = {
					which = to_from_true_faith_potential
					which = to_blood_tax_from_true_faith_potential
				}
			}
		}
		####
		# Child Levy full potential
		if = {
			limit = {
				has_country_modifier = to_janissary_child_levy
			}
			set_variable = {
				which = to_child_levy_full_potential
				which = to_child_levy_potential
			}
			if = {
				limit = {
					has_country_modifier = to_janissaries_from_true_faith
				}
				change_variable = {
					which = to_child_levy_full_potential
					which = to_from_true_faith_potential
				}
			}
			if = {
				limit = {
					has_country_modifier = to_janissaries_from_true_faith
					has_country_modifier = to_janissary_recruitment_quotas
				}
				change_variable = {
					which = to_child_levy_full_potential
					which = to_recruitment_quotas_potential_with_from_true_faith
				}
			}
			else = {
				if = {
					limit = {
						has_country_modifier = to_janissary_recruitment_quotas
					}
					change_variable = {
						which = to_child_levy_full_potential
						which = to_recruitment_quotas_potential
					}
				}
			}
		}
		####
		set_variable = {
			which = to_open_recruitment_potential
			value = 0
		}

		every_owned_province = {
			limit = {
				has_owner_religion = yes
				is_state = yes
			}
			PREV = {
				export_to_variable = {
					which = to_local_development
					value = trigger_value:development
					who = PREV
				}
				if = {
					limit = {
						culture_group = PREV
					}
					multiply_variable = {
						which = to_local_development
						value = 2
					}
				}
				change_variable = {
					which = to_open_recruitment_potential
					which = to_local_development
				}
			}
		}
		
		multiply_variable = {
			which = to_open_recruitment_potential
			value = 0.001
		}
	}
}

to_calculate_janissary_reserve_potential_all_subjects = {
	every_subject_country = {
		to_calculate_janissary_reserve_potential_subject = yes
	}
}

to_calculate_janissary_reserve_potential_subject = {
	overlord = {
		save_event_target_as = to_blood_tax_overlord
	}
	if = {
		limit = {
			event_target:to_blood_tax_overlord = {
				to_has_abrahamic_religion = yes
			}
		}
		every_owned_province = {
			limit = {
				event_target:to_blood_tax_overlord = {
					NOT = { primary_culture = PREV }
					NOT = { religion_group = PREV }
				}
				is_state = yes
			}
			PREV = {
				export_to_variable = {
					which = to_local_development
					value = trigger_value:development
					who = PREV
				}
				change_variable = {
					which = to_child_levy_potential
					which = to_local_development
				}
			}
		}
	}
	else = {
		every_owned_province = {
			limit = {
				event_target:to_blood_tax_overlord = {
					NOT = { primary_culture = PREV }
					NOT = { religion = PREV }
				}
				is_state = yes
			}
			PREV = {
				export_to_variable = {
					which = to_local_development
					value = trigger_value:development
					who = PREV
				}
				change_variable = {
					which = to_child_levy_potential
					which = to_local_development
				}
			}
		}
	}
	multiply_variable = {
		which = to_child_levy_potential
		value = 0.006
	}
	####
	set_variable = {
		which = to_from_true_faith_potential
		value = 0
	}
	if = {
		limit = {
			event_target:to_blood_tax_overlord = {
				has_country_modifier = to_janissaries_from_true_faith
				to_has_abrahamic_religion = yes
			}
		}
		every_owned_province = {
			limit = {
				event_target:to_blood_tax_overlord = {
					OR = {
						NOT = { culture_group = PREV }
						culture = elysameric
					}
					religion_group = PREV
				}
				is_state = yes
			}
			PREV = {
				export_to_variable = {
					which = to_local_development
					value = trigger_value:development
					who = PREV
				}
				change_variable = {
					which = to_from_true_faith_potential
					which = to_local_development
				}
			}
		}
	}
	else = {
		every_owned_province = {
			limit = {
				event_target:to_blood_tax_overlord = {
					OR = {
						NOT = { culture_group = PREV }
						culture = elysameric
					}
					religion = PREV
				}
				is_state = yes
			}
			PREV = {
				export_to_variable = {
					which = to_local_development
					value = trigger_value:development
					who = PREV
				}
				change_variable = {
					which = to_from_true_faith_potential
					which = to_local_development
				}
			}
		}
	}
	multiply_variable = {
		which = to_from_true_faith_potential
		value = 0.003
	}

	set_variable = {
		which = to_blood_tax_potential
		which = to_child_levy_potential
	}

	set_variable = {
		which = to_blood_tax_from_true_faith_potential
		which = to_blood_tax_potential
	}
	change_variable = {
		which = to_blood_tax_from_true_faith_potential
		which = to_from_true_faith_potential
	}
}

to_janissaries_on_become_subject = {
	if = {
		limit = {
			overlord = {
				has_country_modifier = to_janissary_child_levy
			}
		}
		to_calculate_janissary_reserve_potential_subject = yes
	}
}

to_janissaries_on_independence_subject = {
	remove_country_modifier = to_blood_tax
	remove_country_modifier = to_blood_tax_true_faith
	clr_country_flag = to_has_blood_tax
}

to_roman_janissaries_on_religion_change = {
	if = {
		limit = {
			has_government_mechanic = to_roman_janissary_mechanic
		}
		every_subject_country = {
			limit = {
				has_country_modifier = to_blood_tax
				OR = {
					religion = ROOT
					AND = {
						to_has_abrahamic_religion = yes
						religion_group = ROOT
					}
				}
			}
			remove_country_modifier = to_blood_tax
			add_country_modifier = {
				name = to_blood_tax_true_faith
				duration = -1
			}
		}
		every_subject_country = {
			limit = {
				has_country_modifier = to_blood_tax_true_faith
				NOT = {
					OR = {
						religion = ROOT
						AND = {
							to_has_abrahamic_religion = yes
							religion_group = ROOT
						}
					}
				}
			}
			remove_country_modifier = to_blood_tax_true_faith
			add_country_modifier = {
				name = to_blood_tax
				duration = -1
			}
		}
	}
}

to_spawn_janissary_regiments = {
	if = {
		limit = {
			OR = {
				has_dlc = "Cradle of Civilization"
				has_dlc = "Domination"
			}
		}
		custom_tooltip = to_spawn_janissary_regiments_tt
		hidden_effect = {
			janissary_infantry = ROOT
			janissary_infantry = ROOT
		}
		custom_tooltip = nhs_new_line_tt
	}
	[[INFANTRY_WITHOUT_DLC]
	else = {
		infantry = ROOT
		infantry = ROOT
	}
	]
}