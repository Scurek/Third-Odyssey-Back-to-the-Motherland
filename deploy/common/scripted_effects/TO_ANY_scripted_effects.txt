
to_replace_idea_group_with_exploration = {
	remove_idea_group = $IDEA_GROUP$
	add_idea_group = exploration_ideas
}

to_replace_idea_group_with_exploration_keep_progress = {
	if = {
		limit = {
			has_idea_group = $IDEA_GROUP$
			NOT = { has_idea_group = exploration_ideas }
		}
		if = {
			limit = {
				$IDEA_GROUP$ = 7
			}
			to_replace_idea_group_with_exploration = { IDEA_GROUP = $IDEA_GROUP$ }
			add_idea = global_empire
		}
		else_if = {
			limit = {
				$IDEA_GROUP$ = 6
			}
			to_replace_idea_group_with_exploration = { IDEA_GROUP = $IDEA_GROUP$ }
			add_idea = free_colonies
		}
		else_if = {
			limit = {
				$IDEA_GROUP$ = 5
			}
			to_replace_idea_group_with_exploration = { IDEA_GROUP = $IDEA_GROUP$ }
			add_idea = vice_roys
		}
		else_if = {
			limit = {
				$IDEA_GROUP$ = 4
			}
			to_replace_idea_group_with_exploration = { IDEA_GROUP = $IDEA_GROUP$ }
			add_idea = land_of_opportunity
		}
		else_if = {
			limit = {
				$IDEA_GROUP$ = 3
			}
			to_replace_idea_group_with_exploration = { IDEA_GROUP = $IDEA_GROUP$ }
			add_idea = overseas_exploration
		}
		else_if = {
			limit = {
				$IDEA_GROUP$ = 2
			}
			to_replace_idea_group_with_exploration = { IDEA_GROUP = $IDEA_GROUP$ }
			add_idea = colonial_ventures
		}
		else_if = {
			limit = {
				$IDEA_GROUP$ = 1
			}
			to_replace_idea_group_with_exploration = { IDEA_GROUP = $IDEA_GROUP$ }
			add_idea = quest_for_the_new_world
		}
		else = {
			to_replace_idea_group_with_exploration = { IDEA_GROUP = $IDEA_GROUP$ }
		}
	}
}

to_replace_idea_group_with_exploration_for_ai = {
	if = {
		limit = {
			has_idea_group = spy_ideas
		}
		to_replace_idea_group_with_exploration_keep_progress = { IDEA_GROUP = spy_ideas }
	}
	else_if = {
		limit = {
			has_idea_group = maritime_ideas
		}
		to_replace_idea_group_with_exploration_keep_progress = { IDEA_GROUP = maritime_ideas }
	}
	else_if = {
		limit = {
			has_idea_group = indigenous_ideas
		}
		to_replace_idea_group_with_exploration_keep_progress = { IDEA_GROUP = indigenous_ideas }
	}
	else_if = {
		limit = {
			has_idea_group = administrative_ideas
			NOt = { full_idea_group = administrative_ideas }
		}
		to_replace_idea_group_with_exploration_keep_progress = { IDEA_GROUP = administrative_ideas }
	}
	else_if = {
		limit = {
			has_idea_group = influence_ideas
		}
		to_replace_idea_group_with_exploration_keep_progress = { IDEA_GROUP = influence_ideas }
	}
	else_if = {
		limit = {
			has_idea_group = diplomatic_ideas
		}
		to_replace_idea_group_with_exploration_keep_progress = { IDEA_GROUP = diplomatic_ideas }
	}
	else_if = {
		limit = {
			has_idea_group = innovativeness_ideas
		}
		to_replace_idea_group_with_exploration_keep_progress = { IDEA_GROUP = innovativeness_ideas }
	}
	else_if = {
		limit = {
			has_idea_group = trade_ideas
		}
		to_replace_idea_group_with_exploration_keep_progress = { IDEA_GROUP = trade_ideas }
	}
	else_if = {
		limit = {
			has_idea_group = economic_ideas
		}
		to_replace_idea_group_with_exploration_keep_progress = { IDEA_GROUP = economic_ideas }
	}
	else_if = {
		limit = {
			has_idea_group = humanist_ideas
		}
		to_replace_idea_group_with_exploration_keep_progress = { IDEA_GROUP = humanist_ideas }
	}
	else_if = {
		limit = {
			has_idea_group = religious_ideas
		}
		to_replace_idea_group_with_exploration_keep_progress = { IDEA_GROUP = religious_ideas }
	}
	else_if = {
		limit = {
			has_idea_group = plutocracy_ideas
		}
		to_replace_idea_group_with_exploration_keep_progress = { IDEA_GROUP = plutocracy_ideas }
	}
	else_if = {
		limit = {
			has_idea_group = horde_gov_ideas
		}
		to_replace_idea_group_with_exploration_keep_progress = { IDEA_GROUP = horde_gov_ideas }
	}
	else_if = {
		limit = {
			has_idea_group = theocracy_gov_ideas
		}
		to_replace_idea_group_with_exploration_keep_progress = { IDEA_GROUP = theocracy_gov_ideas }
	}
	else_if = {
		limit = {
			has_idea_group = aristocracy_ideas
		}
		to_replace_idea_group_with_exploration_keep_progress = { IDEA_GROUP = aristocracy_ideas }
	}
	else_if = {
		limit = {
			has_idea_group = naval_ideas
		}
		to_replace_idea_group_with_exploration_keep_progress = { IDEA_GROUP = naval_ideas }
	}
	else_if = {
		limit = {
			has_idea_group = offensive_ideas
		}
		to_replace_idea_group_with_exploration_keep_progress = { IDEA_GROUP = offensive_ideas }
	}
	else_if = {
		limit = {
			has_idea_group = defensive_ideas
		}
		to_replace_idea_group_with_exploration_keep_progress = { IDEA_GROUP = defensive_ideas }
	}
	else_if = {
		limit = {
			has_idea_group = quality_ideas
		}
		to_replace_idea_group_with_exploration_keep_progress = { IDEA_GROUP = quality_ideas }
	}
	else_if = {
		limit = {
			has_idea_group = quantity_ideas
		}
		to_replace_idea_group_with_exploration_keep_progress = { IDEA_GROUP = quantity_ideas }
	}
	else_if = {
		limit = {
			has_idea_group = expansion_ideas
		}
		to_replace_idea_group_with_exploration_keep_progress = { IDEA_GROUP = expansion_ideas }
	}
	else_if = {
		limit = {
			has_idea_group = administrative_ideas
		}
		to_replace_idea_group_with_exploration_keep_progress = { IDEA_GROUP = administrative_ideas }
	}
}

to_replace_idea_group_with_exploration_master_effect = {
	if = {
		limit = {
			NOT = { has_idea_group = exploration_ideas }
			to_there_is_a_switchable_idea_group = yes
		}
		if = {
			limit = {
				ai = no
			}
			if = {
				limit = {
					adm_tech = 5
					NOT = { adm_tech = 7 }
					OR = {
						has_idea_group = spy_ideas
						has_idea_group = maritime_ideas
						has_idea_group = indigenous_ideas
						has_idea_group = administrative_ideas
						has_idea_group = influence_ideas
						has_idea_group = diplomatic_ideas
						has_idea_group = innovativeness_ideas
						has_idea_group = trade_ideas
						has_idea_group = economic_ideas
						has_idea_group = humanist_ideas
						has_idea_group = religious_ideas
						has_idea_group = plutocracy_ideas
						has_idea_group = horde_gov_ideas
						has_idea_group = theocracy_gov_ideas
						has_idea_group = aristocracy_ideas
						has_idea_group = naval_ideas
						has_idea_group = offensive_ideas
						has_idea_group = defensive_ideas
						has_idea_group = quality_ideas
						has_idea_group = quantity_ideas
						has_idea_group = expansion_ideas
					}
				}
				# Also works for the player if they only have a single idea group
				to_replace_idea_group_with_exploration_for_ai = yes
			}
			if = {
				limit = {
					NOT = {
						AND = {
							adm_tech = 5
							NOT = { adm_tech = 7 }
							OR = {
								has_idea_group = spy_ideas
								has_idea_group = maritime_ideas
								has_idea_group = indigenous_ideas
								has_idea_group = administrative_ideas
								has_idea_group = influence_ideas
								has_idea_group = diplomatic_ideas
								has_idea_group = innovativeness_ideas
								has_idea_group = trade_ideas
								has_idea_group = economic_ideas
								has_idea_group = humanist_ideas
								has_idea_group = religious_ideas
								has_idea_group = plutocracy_ideas
								has_idea_group = horde_gov_ideas
								has_idea_group = theocracy_gov_ideas
								has_idea_group = aristocracy_ideas
								has_idea_group = naval_ideas
								has_idea_group = offensive_ideas
								has_idea_group = defensive_ideas
								has_idea_group = quality_ideas
								has_idea_group = quantity_ideas
								has_idea_group = expansion_ideas
							}
						}
					}
				}
				custom_tooltip = nhs_new_line_tt
				# custom_tooltip = to_event_to_switch_idea_groups_tt
				country_event = { id = to_colonialism_events.3 tooltip = to_event_to_switch_idea_groups_tt }
			}
		}
		else = {
			to_replace_idea_group_with_exploration_for_ai = yes
		}
	}
	else_if = {
		limit = {
			NOT = { has_idea_group = exploration_ideas }
			adm_tech = 5
		}
		add_idea_group = exploration_ideas
	}
}

to_trigger_colonialism_events_no_portugal = {
	every_country = {
		limit = {
			NOT = { tag = ROOT }
			technology_group = western
			adm_tech = 5
			is_subject = no
			OR = {
				ai = no
				AND = {
					num_of_cities = 8
					num_of_owned_provinces_with = {
						value = 3
						has_port = yes
						continent = europe
						sea_zone = {
							region = north_atlantic_region
						}
					}
				}
			}
			OR = {
				tag = GBR
				tag = NED
				tag = ENG
				tag = FRA
				tag = CAS
				tag = SPA
				tag = POR
				capital_scope = {
					OR = {
						region = france_region
						region = iberia_region
						region = british_isles_region
						region = low_countries_region
					}
				}
			}
			any_owned_province = {
				has_port = yes
				continent = europe
				sea_zone = {
					region = north_atlantic_region
				}
			}
		}
		country_event = { id = to_colonialism_events.2 }
	}
	hidden_effect = {
		every_country = {
			limit = {
				nhs_condition_all_ely = { KOMANDA = tag }
			}
			country_event = { id = to_colonialism_events.5 }
		}
		every_country = {
			limit = {
				NOT = { tag = ROOT }
				NOT = { nhs_condition_all_ely = { KOMANDA = tag } }
				ai = no
				NOT = {
					AND = {
						technology_group = western
						OR = {
							tag = GBR
							tag = NED
							tag = ENG
							tag = FRA
							tag = CAS
							tag = SPA
							tag = POR
							capital_scope = {
								OR = {
									region = france_region
									region = iberia_region
									region = british_isles_region
									region = low_countries_region
								}
							}
						}
						any_owned_province = {
							has_port = yes
							continent = europe
							sea_zone = {
								region = north_atlantic_region
							}
						}
					}
				}
			}
			if = {
				limit = {
					knows_country = ROOT
				}
				country_event = { id = institution_events.300 }
			}
			else = {
				country_event = { id = institution_events.301 }
			}
		}
	}
}

to_development_events_add_next_flag = {
	# if = {
	# 	limit = {
	# 		has_province_flag = nhs_had_dev_events_2
	# 	}
	# 	set_province_flag = nhs_had_dev_events_3
	# }
	if = {
		limit = {
			has_province_flag = nhs_had_dev_events_1
		}
		set_province_flag = nhs_had_dev_events_2
	}
	else = {
		set_province_flag = nhs_had_dev_events_2
	}
}

to_add_2_stability_or_adm_power = {
	if = {
		limit = {
			stability = 3
		}
		add_adm_power = 100
	}
	else_if = {
		limit = {
			stability = 2
		}
		add_stability = 1
		add_adm_power = 50
	}
	else = {
		add_stability = 2
	}
}

to_round_up_variable = {
	change_variable = {
		which = $VARIABLE$
		value = 0.5
	}
	multiply_variable = { 
		which = $VARIABLE$
		value = 0.001 
	}
	multiply_variable = { 
		which = $VARIABLE$
		value = 1000 
	}
}

to_restore_historal_friends_and_rivals = {
	hidden_effect = {
		every_country = {
			limit = {
				$PREVIOUS_TAG$ = {
					historical_friend_with = PREV
				}
			}
			ROOT = {
				add_historical_friend = PREV
			}
		}
		every_country = {
			limit = {
				$PREVIOUS_TAG$ = {
					PREV = {
						historical_friend_with = PREV
					}
				}
			}
			add_historical_friend = ROOT
		}
		every_country = {
			limit = {
				$PREVIOUS_TAG$ = {
					historical_rival_with = PREV
				}
			}
			ROOT = {
				add_historical_rival = PREV
			}
		}
		every_country = {
			limit = {
				$PREVIOUS_TAG$ = {
					PREV = {
						historical_rival_with = PREV
					}
				}
			}
			add_historical_rival = ROOT
		}
	}
}