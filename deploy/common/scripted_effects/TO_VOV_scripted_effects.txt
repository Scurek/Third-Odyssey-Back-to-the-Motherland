vov_handle_coastal_bonus = {
	if = {
		limit = {
			to_vov_eligible_for_coastal_bonus = yes
		}
		if = {
			limit = {
				owner = {
					OR = {
						primary_culture = varangian_e
						culture_group = norse_g
					}
				}
			}
			if = {
				limit = {
					has_province_modifier = vov_coastal_bonus
				}
				remove_province_modifier = vov_coastal_bonus
			}
			add_province_modifier = {
				name = vov_coastal_bonus_norse
				duration = -1
			}
		}
		else = {
			if = {
				limit = {
					has_province_modifier = vov_coastal_bonus_norse
				}
				remove_province_modifier = vov_coastal_bonus_norse
			}
			add_province_modifier = {
				name = vov_coastal_bonus
				duration = -1
			}
		}
	}
}

vov_handle_coastal_bonus_all_owned_provinces = {
	every_owned_province = {
		limit = {
			to_vov_eligible_for_coastal_bonus = yes
		}
		vov_handle_coastal_bonus = yes
	}
}

vov_handle_grand_forestries = {
	if = {
		limit = {
			has_province_modifier = nhs_grand_forestries_modifier
			OR = {
				NOT = { owner = { has_idea = grand_forestries } }
				NOT = { trade_goods = naval_supplies }
			}
		}
		remove_province_modifier = nhs_grand_forestries_modifier
	}
	else_if = {
		limit = {
			trade_goods = naval_supplies
			NOT = { has_province_modifier = nhs_grand_forestries_modifier }
			owner = { has_idea = grand_forestries }
		}
		add_province_modifier = { 
			name = nhs_grand_forestries_modifier
			duration = -1
			hidden = yes
		}
	}
}

vov_setup_coastal_bonus = {
	every_province = {
		limit = {
			to_vov_eligible_for_coastal_bonus = yes
		}
		vov_handle_coastal_bonus = yes
	}
}

vov_handle_brave_the_elements = {
	if = {
		limit = {
			owner = { has_idea = brave_the_elements }
			OR = {
				has_climate = tropical
				has_climate = arid
				has_climate = arctic
			}
			NOT = { has_province_modifier = nhs_brave_the_elements_modifier1 }
			NOT = { has_province_modifier = nhs_brave_the_elements_modifier2 }
		}
		if = {
			limit = {
				OR = {
					has_climate = tropical
					has_climate = arid
				}
			}
			add_province_modifier = {
				name = nhs_brave_the_elements_modifier1
				duration = -1
			}
		}
		if = {
			limit = {
				has_climate = arctic
			}
			add_province_modifier = {
				name = nhs_brave_the_elements_modifier2
				duration = -1
			}
		}
	}
	else_if = {
		limit = {
			OR = {
				has_province_modifier = nhs_brave_the_elements_modifier1
				has_province_modifier = nhs_brave_the_elements_modifier2
			}
			NOT = { owner = { has_idea = grand_forestries } }
		}
		remove_province_modifier = nhs_brave_the_elements_modifier1
		remove_province_modifier = nhs_brave_the_elements_modifier2
	}
}

to_nhs_set_up_varangians_in_province = {
	tooltip = {
		$PROVINCE_ID$ = {
			cede_province = VGD
			add_base_manpower = 3
		}
		create_subject = {
			subject_type = elysian_subject_varangian
			subject = VGD
		}
	}
	if = {
		limit = {
			any_province = {
				has_province_modifier = nhs2_varangian_m
			}
		}
		every_province = {
			limit = {
				has_province_modifier = nhs2_varangian_m
			}
			remove_province_modifier = nhs2_varangian_m
		}
	}
	set_country_flag = nhs_varangian_guard_substate
	if = {
		limit = {
			$PROVINCE_ID$ = {
				OR = {
					has_province_modifier = nhs2_european_enclave
					has_province_modifier = nhs2_small_por_enclave
					has_province_modifier = nhs2_por_enclave
					has_province_modifier = nhs2_large_por_enclave
				}
			}
		}
		$PROVINCE_ID$ = {
			nhs_move_t_post = yes
		}
	}
	
	hidden_effect = {
		$PROVINCE_ID$ = {
			add_core = VGD
			ROOT = {
				release = VGD
			}
			change_culture = varangian_n
			change_religion = ROOT
			hidden_effect = {
				nhs_on_province_culture_converted_general = yes
			}
			VGD = {
				set_capital = $PROVINCE_ID$
				change_religion = ROOT
				change_primary_culture = varangian_n
				hidden_effect = {
					nhs_change_government = { GOV = varangian_order_gov }
				}
				nhs_add_gov_reform = { REF = varangian_guard }
			}
			add_base_manpower = 3
		}
		every_province = {
			limit = {
				has_discovered = ROOT
			}
			discover_country = VGD
		}
		VGD = {
			if = {
				limit = {
					technology_group = exiled_greek
				}
				change_technology_group = viking
			}
			else_if = {
				limit = {
					technology_group = modern_greek
				}
				change_technology_group = modern_vinlandic
			}
		}
		create_subject = {
			subject_type = elysian_subject_varangian
			subject = VGD
		}
	}
}

to_nhs_set_up_independant_varangians_in_province = {
	hidden_effect = {
		cede_province = ROOT
		change_religion = norse_pagan_reformed
		change_culture = varangian_n
		hidden_effect = {
			nhs_on_province_culture_converted_general = yes
		}
		add_core = VGD
		ROOT = { release = VGD }
		VGD = {
			change_religion = norse_pagan_reformed
			change_primary_culture = varangian_n
			hidden_effect = {
				nhs_change_government = { GOV = varangian_order_gov }
			}
			nhs_add_gov_reform = { REF = varangian_guard }
			add_country_modifier = { 
				name = nhs_early_uprising_reduction
				duration = 3650
			}
		}
	}
	tooltip = {
		cede_province = VGD
	}
}