to_exarch_reform_effect = {
	custom_tooltip = to_reform_effects_for_overlord_tt
	if = {
		limit = {
			overlord = {
				mission_completed = to_the_eagle_rises_mission
			}
		}
		custom_tooltip = to_reduce_overlord_govcap_exarch_reduced_tt
		custom_tooltip = to_reduce_overlord_forcelimit_exarch_reduced_tt
	}
	else = {
		custom_tooltip = to_reduce_overlord_govcap_exarch_tt
		custom_tooltip = to_reduce_overlord_forcelimit_exarch_tt
	}
	custom_tooltip = nhs_new_line_tt
	custom_tooltip = to_reform_effects_tt
	custom_tooltip = to_automatically_accepts_culture_tt
	custom_tooltip = to_min_autonomy_exarch_modifier_tt
	hidden_effect = {
		every_owned_province = {
			to_handle_exarch_autonomy_modifier = yes
			if = {
				limit = {
					PREV = {
						NOT = { accepted_culture = PREV }
					}
				}
				PREV = {
					add_accepted_culture = PREV
				}
			}
		}
	}
	custom_tooltip = to_forced_new_line_tt
	hidden_effect = {
		to_imperial_integration_country_check = yes
	}
}

to_exarch_reform_removed_effect = {
	hidden_effect = {
		to_imperial_integration_country_check = yes
		every_owned_province = {
			remove_province_modifier = to_exarch_autonomy_penalty
		}
	}
}

to_set_initial_exarch_targets = {
	EEH = { save_global_event_target_as = to_EEH_target }
	EEY = { save_global_event_target_as = to_EEY_target }	
}

to_swap_exarch_dynamic_tag = {
	hidden_effect = {
		$NEW_TAG$ = {
			save_global_event_target_as = to_$BASE_TAG$_target
		}
		$BASE_TAG$ = {
			override_country_name = $NEW_NAME$
		}
		$CURRENT_TAG$ = {
			$NEW_TAG$ = {
				set_variable = {
					which = to_exarch_needed_provinces_for_merchant
					which = PREV
				}
				every_owned_province = {
					limit = {
						nhs_$NEW_TAG$_province = yes
						NOT = { to_province_always_counts_for_exarch_merchant = yes }
					}
					set_province_flag = to_was_counted_for_exarch_merchant
					PREV = {
						change_variable = {
							which = to_exarch_owned_provinces_for_merchant
							value = 1
						}
					}
				}
			}
		}
	}
}

to_set_exarch_always_count_for_merchant = {
	set_province_flag = to_exarch_always_count_for_merchant
	to_exarch_effect_from_province = {
		EFFECT = "
		if = {
			limit = {
				PREV = {
					has_province_flag = to_was_counted_for_exarch_merchant
				}
			}
			PREV = {
				clr_province_flag = to_was_counted_for_exarch_merchant
			}
			change_variable = {
				which = to_exarch_owned_provinces_for_merchant
				value = -1
			}
		}
		change_variable = {
			which = to_exarch_needed_provinces_for_merchant
			value = -1
		}
		"
	}
}

to_setup_exarch_merchant_counters = {
	if = {
		limit = {
			NOT = { has_global_flag = to_setup_exarch_merchant_provinces }
		}
		set_global_flag = to_setup_exarch_merchant_provinces
		to_exarch_effect_including_inactive = {
			EFFECT = "
				set_variable = {
					which = to_exarch_needed_provinces_for_merchant
					value = 0
				}
				change_variable = {
					which = to_exarch_owned_provinces_for_merchant
					value = 0
				}
				"
		}
		every_province = {
			limit = {
				is_empty = no
				is_colony = no
				OR = {
					continent = europe
					continent = africa
					continent = asia
				}
				NOT = { to_province_always_counts_for_exarch_merchant = yes }
			}
			to_exarch_effect_from_province = {
				EFFECT = "
				change_variable = {
					which = to_exarch_needed_provinces_for_merchant
					value = 1
				}
				if = {
					limit = {
						PREV = {
							owned_by = PREV
						}
					}
					PREV = {
						set_province_flag = to_was_counted_for_exarch_merchant
					}
					change_variable = {
						which = to_exarch_owned_provinces_for_merchant
						value = 1
					}
				}
				"
			}
		}
	}
}

to_check_exarch_merchant_counter_all_owned_provinces = {
	if = {
		limit = {
			is_subject_of_type = elysian_subject
		}
		set_variable = {
			which = to_exarch_owned_provinces_for_merchant
			value = 0
		}
		every_owned_province = {
			limit = {
				NOT = { to_province_always_counts_for_exarch_merchant = yes }
				to_exarch_land = {
					SCOPE = "owner"
				}
			}
			set_province_flag = to_was_counted_for_exarch_merchant
			PREV = {
				change_variable = {
					which = to_exarch_owned_provinces_for_merchant
					value = 1
				}
			}
		}
	}
}

to_check_exarch_merchant_counter = {
	if = {
		limit = {
			owner = {
				is_subject_of_type = elysian_subject
			}
			NOT = { has_province_flag = to_was_counted_for_exarch_merchant }
		}
		if = {
			limit = {
				NOT = { to_province_always_counts_for_exarch_merchant = yes }
				to_exarch_land = {
					SCOPE = "owner"
				}
			}
			set_province_flag = to_was_counted_for_exarch_merchant
			owner = {
				change_variable = {
					which = to_exarch_owned_provinces_for_merchant
					value = 1
				}
			}
		}
	}
	else_if = {
		limit = {
			FROM = {
				is_subject_of_type = elysian_subject
			}
			has_province_flag = to_was_counted_for_exarch_merchant
		}
		clr_province_flag = to_was_counted_for_exarch_merchant
		FROM = {
			change_variable = {
				which = to_exarch_owned_provinces_for_merchant
				value = -1
			}
		}
	}
}

to_trigger_exarch_ownership_events = {
	to_exarch_effect = {
		EFFECT = "country_event = { id = nhs2_ely_marches.3 days = 1 }"
	}
}

to_assign_provinces_to_exarch = {
	hidden_effect = {
		if = {
			limit = {
				any_owned_province = {
					NOT = { is_core = ROOT }
					NOT = { has_construction = core }
					is_owned_by_trade_company = no
					NOT = { has_province_flag = nhs_exarch_province_exemption }
					NOT = { has_province_modifier = to_varangian_headquarters }
					religion = ROOT
					nhs_$TAG$_province = yes
					development = 25
					NOT = { province_has_center_of_trade_of_level = 1 }
					NOT = { has_province_modifier = nhs2_supply_lines_tm }
				}
				
			}
			random_owned_province = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { has_construction = core }
					is_owned_by_trade_company = no
					NOT = { has_province_flag = nhs_exarch_province_exemption }
					NOT = { has_province_modifier = to_varangian_headquarters }
					religion = ROOT
					nhs_$TAG$_province = yes
					development = 25
					NOT = { province_has_center_of_trade_of_level = 1 }
					NOT = { has_province_modifier = nhs2_supply_lines_tm }
				}
				to_add_core_and_release_exarch = { TAG = $TAG$ }
			}
		}
		else_if = {
			limit = {
				any_owned_province = {
					NOT = { is_core = ROOT }
					NOT = { has_construction = core }
					is_owned_by_trade_company = no
					NOT = { has_province_flag = nhs_exarch_province_exemption }
					NOT = { has_province_modifier = to_varangian_headquarters }
					nhs_$TAG$_province = yes
					development = 25
					NOT = { province_has_center_of_trade_of_level = 1 }
					NOT = { has_province_modifier = nhs2_supply_lines_tm }
				}
			}
			random_owned_province = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { has_construction = core }
					is_owned_by_trade_company = no
					NOT = { has_province_flag = nhs_exarch_province_exemption }
					NOT = { has_province_modifier = to_varangian_headquarters }
					nhs_$TAG$_province = yes
					development = 25
					NOT = { province_has_center_of_trade_of_level = 1 }
					NOT = { has_province_modifier = nhs2_supply_lines_tm }
				}
				to_add_core_and_release_exarch = { TAG = $TAG$ }
			}
		}
		else_if = {
			limit = {
				any_owned_province = {
					NOT = { is_core = ROOT }
					NOT = { has_construction = core }
					is_owned_by_trade_company = no
					NOT = { has_province_flag = nhs_exarch_province_exemption }
					NOT = { has_province_modifier = to_varangian_headquarters }
					religion = ROOT
					nhs_$TAG$_province = yes
					development = 15
					NOT = { province_has_center_of_trade_of_level = 1 }
					NOT = { has_province_modifier = nhs2_supply_lines_tm }
				}
				
			}
			random_owned_province = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { has_construction = core }
					is_owned_by_trade_company = no
					NOT = { has_province_flag = nhs_exarch_province_exemption }
					NOT = { has_province_modifier = to_varangian_headquarters }
					religion = ROOT
					nhs_$TAG$_province = yes
					development = 15
					NOT = { province_has_center_of_trade_of_level = 1 }
					NOT = { has_province_modifier = nhs2_supply_lines_tm }
				}
				to_add_core_and_release_exarch = { TAG = $TAG$ }
			}
		}
		else_if = {
			limit = {
				any_owned_province = {
					NOT = { is_core = ROOT }
					NOT = { has_construction = core }
					is_owned_by_trade_company = no
					NOT = { has_province_flag = nhs_exarch_province_exemption }
					NOT = { has_province_modifier = to_varangian_headquarters }
					nhs_$TAG$_province = yes
					development = 15
					NOT = { province_has_center_of_trade_of_level = 1 }
					NOT = { has_province_modifier = nhs2_supply_lines_tm }
				}
			}
			random_owned_province = {
				limit = {
					NOT = { is_core = ROOT }
					NOT = { has_construction = core }
					is_owned_by_trade_company = no
					NOT = { has_province_flag = nhs_exarch_province_exemption }
					NOT = { has_province_modifier = to_varangian_headquarters }
					nhs_$TAG$_province = yes
					development = 15
					NOT = { province_has_center_of_trade_of_level = 1 }
					NOT = { has_province_modifier = nhs2_supply_lines_tm }
				}
				to_add_core_and_release_exarch = { TAG = $TAG$ }
			}
		}
		else_if = {
			limit = {
				any_owned_province = {
					nhs_$TAG$_province = yes
					NOT = { is_core = ROOT }
					NOT = { has_construction = core }
					is_owned_by_trade_company = no
					NOT = { has_province_flag = nhs_exarch_province_exemption }
					NOT = { has_province_modifier = to_varangian_headquarters }
					NOT = { has_province_modifier = nhs2_supply_lines_tm }
					religion = ROOT
				}
			}
			random_owned_province = {
				limit = {
					nhs_$TAG$_province = yes
					NOT = { is_core = ROOT }
					NOT = { has_construction = core }
					is_owned_by_trade_company = no
					NOT = { has_province_flag = nhs_exarch_province_exemption }
					NOT = { has_province_modifier = to_varangian_headquarters }
					NOT = { has_province_modifier = nhs2_supply_lines_tm }
					religion = ROOT
				}
				to_add_core_and_release_exarch = { TAG = $TAG$ }
			}
		}
		else_if = {
			limit = {
				any_owned_province = {
					nhs_$TAG$_province = yes
					NOT = { is_core = ROOT }
					NOT = { has_construction = core }
					is_owned_by_trade_company = no
					NOT = { has_province_flag = nhs_exarch_province_exemption }
					NOT = { has_province_modifier = to_varangian_headquarters }
					NOT = { has_province_modifier = nhs2_supply_lines_tm }
				}
			}
			random_owned_province = {
				limit = {
					nhs_$TAG$_province = yes
					NOT = { is_core = ROOT }
					NOT = { has_construction = core }
					is_owned_by_trade_company = no
					NOT = { has_province_flag = nhs_exarch_province_exemption }
					NOT = { has_province_modifier = to_varangian_headquarters }
					NOT = { has_province_modifier = nhs2_supply_lines_tm }
				}
				to_add_core_and_release_exarch = { TAG = $TAG$ }
			}
		}
		else_if = {
			limit = {
				any_owned_province = {
					NOT = { is_state_core = ROOT }
					NOT = { has_construction = core }
					is_owned_by_trade_company = no
					NOT = { has_province_flag = nhs_exarch_province_exemption }
					NOT = { has_province_modifier = to_varangian_headquarters }
					religion = ROOT
					nhs_$TAG$_province = yes
					development = 25
					NOT = { province_has_center_of_trade_of_level = 1 }
					NOT = { has_province_modifier = nhs2_supply_lines_tm }
				}
				
			}
			random_owned_province = {
				limit = {
					NOT = { is_state_core = ROOT }
					NOT = { has_construction = core }
					is_owned_by_trade_company = no
					NOT = { has_province_flag = nhs_exarch_province_exemption }
					NOT = { has_province_modifier = to_varangian_headquarters }
					religion = ROOT
					nhs_$TAG$_province = yes
					development = 25
					NOT = { province_has_center_of_trade_of_level = 1 }
					NOT = { has_province_modifier = nhs2_supply_lines_tm }
				}
				to_add_core_and_release_exarch = { TAG = $TAG$ }
			}
		}
		else_if = {
			limit = {
				any_owned_province = {
					NOT = { is_state_core = ROOT }
					NOT = { has_construction = core }
					is_owned_by_trade_company = no
					NOT = { has_province_flag = nhs_exarch_province_exemption }
					NOT = { has_province_modifier = to_varangian_headquarters }
					nhs_$TAG$_province = yes
					development = 25
					NOT = { province_has_center_of_trade_of_level = 1 }
					NOT = { has_province_modifier = nhs2_supply_lines_tm }
				}
			}
			random_owned_province = {
				limit = {
					NOT = { is_state_core = ROOT }
					NOT = { has_construction = core }
					is_owned_by_trade_company = no
					NOT = { has_province_flag = nhs_exarch_province_exemption }
					NOT = { has_province_modifier = to_varangian_headquarters }
					nhs_$TAG$_province = yes
					development = 25
					NOT = { province_has_center_of_trade_of_level = 1 }
					NOT = { has_province_modifier = nhs2_supply_lines_tm }
				}
				to_add_core_and_release_exarch = { TAG = $TAG$ }
			}
		}
		else_if = {
			limit = {
				any_owned_province = {
					NOT = { is_state_core = ROOT }
					NOT = { has_construction = core }
					is_owned_by_trade_company = no
					NOT = { has_province_flag = nhs_exarch_province_exemption }
					NOT = { has_province_modifier = to_varangian_headquarters }
					religion = ROOT
					nhs_$TAG$_province = yes
					development = 15
					NOT = { province_has_center_of_trade_of_level = 1 }
					NOT = { has_province_modifier = nhs2_supply_lines_tm }
				}
				
			}
			random_owned_province = {
				limit = {
					NOT = { is_state_core = ROOT }
					NOT = { has_construction = core }
					is_owned_by_trade_company = no
					NOT = { has_province_flag = nhs_exarch_province_exemption }
					NOT = { has_province_modifier = to_varangian_headquarters }
					religion = ROOT
					nhs_$TAG$_province = yes
					development = 15
					NOT = { province_has_center_of_trade_of_level = 1 }
					NOT = { has_province_modifier = nhs2_supply_lines_tm }
				}
				to_add_core_and_release_exarch = { TAG = $TAG$ }
			}
		}
		else_if = {
			limit = {
				any_owned_province = {
					NOT = { is_state_core = ROOT }
					NOT = { has_construction = core }
					is_owned_by_trade_company = no
					NOT = { has_province_flag = nhs_exarch_province_exemption }
					NOT = { has_province_modifier = to_varangian_headquarters }
					nhs_$TAG$_province = yes
					development = 15
					NOT = { province_has_center_of_trade_of_level = 1 }
					NOT = { has_province_modifier = nhs2_supply_lines_tm }
				}
			}
			random_owned_province = {
				limit = {
					NOT = { is_state_core = ROOT }
					NOT = { has_construction = core }
					is_owned_by_trade_company = no
					NOT = { has_province_flag = nhs_exarch_province_exemption }
					NOT = { has_province_modifier = to_varangian_headquarters }
					nhs_$TAG$_province = yes
					development = 15
					NOT = { province_has_center_of_trade_of_level = 1 }
					NOT = { has_province_modifier = nhs2_supply_lines_tm }
				}
				to_add_core_and_release_exarch = { TAG = $TAG$ }
			}
		}
		else_if = {
			limit = {
				any_owned_province = {
					nhs_$TAG$_province = yes
					NOT = { is_state_core = ROOT }
					NOT = { has_construction = core }
					is_owned_by_trade_company = no
					NOT = { has_province_flag = nhs_exarch_province_exemption }
					NOT = { has_province_modifier = to_varangian_headquarters }
					NOT = { has_province_modifier = nhs2_supply_lines_tm }
					religion = ROOT
				}
			}
			random_owned_province = {
				limit = {
					nhs_$TAG$_province = yes
					NOT = { is_state_core = ROOT }
					NOT = { has_construction = core }
					is_owned_by_trade_company = no
					NOT = { has_province_flag = nhs_exarch_province_exemption }
					NOT = { has_province_modifier = to_varangian_headquarters }
					NOT = { has_province_modifier = nhs2_supply_lines_tm }
					religion = ROOT
				}
				to_add_core_and_release_exarch = { TAG = $TAG$ }
			}
		}
		else_if = {
			limit = {
				any_owned_province = {
					nhs_$TAG$_province = yes
					NOT = { is_state_core = ROOT }
					NOT = { has_construction = core }
					is_owned_by_trade_company = no
					NOT = { has_province_flag = nhs_exarch_province_exemption }
					NOT = { has_province_modifier = to_varangian_headquarters }
					NOT = { has_province_modifier = nhs2_supply_lines_tm }
				}
			}
			random_owned_province = {
				limit = {
					nhs_$TAG$_province = yes
					NOT = { is_state_core = ROOT }
					NOT = { has_construction = core }
					is_owned_by_trade_company = no
					NOT = { has_province_flag = nhs_exarch_province_exemption }
					NOT = { has_province_modifier = to_varangian_headquarters }
					NOT = { has_province_modifier = nhs2_supply_lines_tm }
				}
				to_add_core_and_release_exarch = { TAG = $TAG$ }
			}
		}
		create_subject = {
			subject_type = elysian_subject
			subject = $TAG$
		}
		to_transfer_provinces_to_exarch = {
			TAG = $TAG$
		}
	}
}

to_transfer_provinces_to_exarch = {
	every_province = {
		limit = {
			nhs_$TAG$_province = yes
			NOT = { has_province_flag = nhs_exarch_province_exemption }
			NOT = { has_province_modifier = to_varangian_headquarters }
			NOT = { is_core = ROOT }
			NOT = { is_territorial_core = ROOT }
			NOT = { has_construction = core }
			NOT = { has_construction = missionary }
			is_owned_by_trade_company = no
			OR = {
				owned_by = ROOT
				owner = {
					tag = ELG
					is_subject_of = ROOT
				}
			}
			NOT = { has_province_modifier = nhs2_supply_lines_tm }
		}
		if = {
			limit = {
				owner = {
					PREV = {
						is_permanent_claim = PREV
					}
				}
			}
			owner = {
				PREV = {
					remove_claim = PREV
				}
			}
			cede_province = $TAG$
			add_permanent_claim = $TAG$
		}
		else_if = {
			limit = {
				owner = {
					PREV = {
						is_claim = PREV
					}
				}
			}
			owner = {
				PREV = {
					remove_claim = PREV
				}
			}
			cede_province = $TAG$
			add_claim = $TAG$
		}
		else = {
			cede_province = $TAG$
		}
	}
}

to_add_core_and_release_exarch = {
	hidden_effect = {
		# tooltip = {
		# 	cede_province = $TAG$
		# }
		add_core = $TAG$
		if = {
			limit = {
				is_core = ROOT
			}
			remove_core = ROOT
		}
		if = {
			limit = {
				is_part_of_hre = yes
			}
			set_in_empire = no
		}
		if = {
			limit = {
				is_claim = ROOT
			}
			remove_claim = ROOT
		}
		# set_province_flag = to_ignore_triumph_check
		ROOT = {
			release = $TAG$
		}
		# clr_province_flag = to_ignore_triumph_check
	}
}

to_handle_exarch_autonomy_modifier = {
	if = {
		limit = {
			owner = {
				to_has_exarch_government_reform = yes
			}
			NOT = { culture_group = byzantine }
		}
		add_province_modifier = {
			name = to_exarch_autonomy_penalty
			duration = -1
			hidden = yes
		}
	}
}

to_handle_exarch_change_capital = {
	if = {
		limit = {
			owner = {
				to_has_exarch_government_reform = yes
				NOT = { primary_culture = PREV }
			}
		}
		owner = {
			change_primary_culture = PREV
		}
	}
}

to_setup_exarch = {
	change_government = republic
	add_government_reform = to_exarch_reform
	if = {
		limit = {
			always = yes
			[[DO_NOT_SET_PRIMARY_CULTURE] always = no ]
		}
		capital_scope = {
			PREV = {
				change_primary_culture = PREV
			}
		}
	}
}

to_setup_greek_exarch = {
	to_setup_exarch = { DO_NOT_SET_PRIMARY_CULTURE = yes }
	change_primary_culture = greek
}

to_setup_anatolia_exarch = {
	if = {
		limit = {
			has_global_flag = to_orhans_descendant_rules_anatolia
		}
		change_government = monarchy
		change_primary_culture = turkish
		define_ruler = {
			dynasty = "Osmanoglu"
			male = yes
			culture = turkish
			hide_skills = yes
			claim = 95
		}
		add_government_reform = to_exarch_reform_monarchy_locked_dynasty
	}
	else = {
		to_setup_exarch = { DO_NOT_SET_PRIMARY_CULTURE = yes }
		change_primary_culture = turkish
	}
}

to_setup_anatolia_exarch_tooltip = {
	if = {
		limit = {
			has_global_flag = to_orhans_descendant_rules_anatolia
		}
		custom_tooltip = to_set_exarch_reform_monarchy_keep_dynasty_tt
	}
	else = {
		custom_tooltip = to_set_exarch_reform_republic_tt
	}
}

to_setup_illyris_exarch = {
	if = {
		limit = {
			has_global_flag = to_kastrioti_rule_albania
		}
		change_government = monarchy
		change_primary_culture = shqipproi
		define_ruler = {
			dynasty = "Kastrioti"
			male = yes
			culture = shqipproi
			hide_skills = yes
			claim = 95
		}
		add_government_reform = to_exarch_reform_monarchy_locked_dynasty
	}
	else = {
		to_setup_exarch = {}
	}
}

to_setup_illyris_exarch_tooltip = {
	if = {
		limit = {
			has_global_flag = to_kastrioti_rule_albania
		}
		custom_tooltip = to_set_exarch_reform_monarchy_keep_dynasty_tt
	}
	else = {
		custom_tooltip = to_set_exarch_reform_republic_tt
	}
}

to_transfer_province_or_create_exarch = {
	if = {
		limit = {
			$EXARCH_SCOPE$ = {
				exists = yes
			}
		}
		to_cede_province_to_exarch = {
			CURRENT_OWNER = $CURRENT_OWNER$
			NEW_OWNER = $EXARCH_SCOPE$
		}
	}
	else = {
		to_release_exarch_from_province = {
			EXARCH_SCOPE = $EXARCH_SCOPE$
			CURRENT_OWNER = $CURRENT_OWNER$
		}

		to_setup_exarch_government_and_transfer_provinces = {
			EXARCH_SCOPE = $EXARCH_SCOPE$
			EXARCH_TAG = $EXARCH_TAG$
			OVERLORD = $CURRENT_OWNER$
			ON_CREATED_EFFECT = $ON_CREATED_EFFECT$
			ON_CREATED_TOOLTIP = $ON_CREATED_TOOLTIP$
		}
	}
}

to_release_exarch_from_province = {
	hidden_effect = {
		if = {
			limit = {
				is_part_of_hre = yes
			}
			set_in_empire = no
		}

		if = {
			limit = {
				owner = {
					PREV = {
						is_state_core = PREV
					}
				}
			}
			remove_core = $CURRENT_OWNER$
			if = {
				limit = {
					NOT = { is_state_core = $EXARCH_SCOPE$ }
				}
				add_core = $EXARCH_SCOPE$
			}
		}
		else_if = {
			limit = {
				owner = {
					PREV = {
						is_territorial_core = PREV
					}
				}
			}
			remove_core = $CURRENT_OWNER$
			set_province_flag = to_add_territorial_core
		}
		else_if = {
			limit = {
				owner = {
					PREV = {
						is_permanent_claim = PREV
					}
				}
			}
			remove_claim = $CURRENT_OWNER$
			set_province_flag = to_add_permanent_claim
		}
		else_if = {
			limit = {
				owner = {
					PREV = {
						is_claim = PREV
					}
				}
			}
			remove_claim = $CURRENT_OWNER$
			set_province_flag = to_add_claim
		}

		if = {
			limit = {
				NOT = { is_core = $CURRENT_OWNER$ }
				NOT = { is_core = $EXARCH_SCOPE$ }
			}
			set_province_flag = to_temp_core
			add_core = $EXARCH_SCOPE$
		}
		
		$CURRENT_OWNER$ = {
			release = $EXARCH_SCOPE$
			create_subject = {
				subject_type = elysian_subject
				subject = $EXARCH_SCOPE$
			}
		}

		if = {
			limit = {
				has_province_flag = to_temp_core
			}
			clr_province_flag = to_temp_core
			remove_core = $EXARCH_SCOPE$
		}

		if = {
			limit = {
				has_province_flag = to_add_territorial_core
			}
			clr_province_flag = to_add_territorial_core
			add_territorial_core = $EXARCH_SCOPE$
		}
		else_if = {
			limit = {
				has_province_flag = to_add_permanent_claim
			}
			clr_province_flag = to_add_permanent_claim
			add_permanent_claim = $EXARCH_SCOPE$
		}
		else_if = {
			limit = {
				has_province_flag = to_add_claim
			}
			clr_province_flag = to_add_claim
			add_claim = $EXARCH_SCOPE$
		}
	}
}

to_setup_exarch_government_and_transfer_provinces = {
	hidden_effect = {
		$EXARCH_SCOPE$ = {
			change_religion = $OVERLORD$
			to_set_unit_type = yes
			swap_free_idea_group = yes
			
			$ON_CREATED_EFFECT$

			set_ruler_culture = THIS

			add_republican_tradition = 100
			add_republican_tradition = -20
			add_adm_power = 200
			add_dip_power = 200
			add_mil_power = 200
			if = {
				limit = {
					NOT = { prestige = 15 }
				}
				add_prestige = 20
			}
			if = {
				limit = {
					NOT = { treasury = 100 }
				}
				add_treasury = 150
			}
			if = {
				limit = {
					NOT = { manpower = 3 }
				}
				add_manpower = 5
			}
		}
	
		to_transfer_exarch_provinces = {
			EXARCH_SCOPE = $EXARCH_SCOPE$
			EXARCH_TAG = $EXARCH_TAG$
			OVERLORD_SCOPE = $OVERLORD$
		}
	}
	
	custom_tooltip = to_exarch_starting_land_$EXARCH_TAG$_tt
	custom_tooltip = to_exarch_creation_starting_land_limits_tt
	custom_tooltip = nhs_new_line_tt
	
	$EXARCH_SCOPE$ = {
		$ON_CREATED_TOOLTIP$
	}

	custom_tooltip = to_reform_effects_for_overlord_tt
	if = {
		limit = {
			$OVERLORD$ = {
				mission_completed = to_the_eagle_rises_mission
			}
		}
		custom_tooltip = to_reduce_overlord_govcap_exarch_reduced_tt
		custom_tooltip = to_reduce_overlord_forcelimit_exarch_reduced_tt
	}
	else = {
		custom_tooltip = to_reduce_overlord_govcap_exarch_tt
		custom_tooltip = to_reduce_overlord_forcelimit_exarch_tt
	}
	custom_tooltip = to_exarch_bonus_merchant_tt
	custom_tooltip = nhs_new_line_tt

	custom_tooltip = to_reform_effects_tt
	custom_tooltip = to_automatically_accepts_culture_tt
	custom_tooltip = to_min_autonomy_exarch_modifier_tt
	custom_tooltip = nhs_new_line_tt

	custom_tooltip = to_reform_modifiers_tt
	custom_tooltip = to_exarch_reform_modifiers_tt
	custom_tooltip = nhs_new_line_tt

	custom_tooltip = to_reform_government_attributes_tt
	custom_tooltip = to_exarch_reform_government_attributes_tt
}

to_check_exarch_incorrect_province = {
	if = {
		limit = {
			OR = {
				nhs_exarch_province_owned_incorrectly = { EXARCH_TAG = ELG }

				nhs_exarch_province_owned_incorrectly = { EXARCH_TAG = EEA }
				nhs_exarch_province_owned_incorrectly = { EXARCH_TAG = EEB }
				nhs_exarch_province_owned_incorrectly = { EXARCH_TAG = EEC }
				nhs_exarch_province_owned_incorrectly = { EXARCH_TAG = EED }
				nhs_exarch_province_owned_incorrectly = { EXARCH_TAG = EEE }
	
				nhs_exarch_province_owned_incorrectly = { EXARCH_TAG = EEF }
				nhs_exarch_province_owned_incorrectly = { EXARCH_TAG = EEG }
				nhs_exarch_province_owned_incorrectly = { EXARCH_TAG = EEH }
				nhs_exarch_province_owned_incorrectly = { EXARCH_TAG = EEI }
				nhs_exarch_province_owned_incorrectly = { EXARCH_TAG = EEJ }
	
				nhs_exarch_province_owned_incorrectly = { EXARCH_TAG = EEL }
				nhs_exarch_province_owned_incorrectly = { EXARCH_TAG = EEM }
				nhs_exarch_province_owned_incorrectly = { EXARCH_TAG = EEO }
				nhs_exarch_province_owned_incorrectly = { EXARCH_TAG = EER }
				nhs_exarch_province_owned_incorrectly = { EXARCH_TAG = EES }
	
				nhs_exarch_province_owned_incorrectly = { EXARCH_TAG = EET }
				nhs_exarch_province_owned_incorrectly = { EXARCH_TAG = EEU }
				nhs_exarch_province_owned_incorrectly = { EXARCH_TAG = EEV }
				nhs_exarch_province_owned_incorrectly = { EXARCH_TAG = EEP }
				nhs_exarch_province_owned_incorrectly = { EXARCH_TAG = EEQ }

				nhs_exarch_province_owned_incorrectly = { EXARCH_TAG = EEY }
			}
		}
		owner = {
			overlord = {
				ROOT = {
					cede_province = PREV
				}
			}
		}
	}
}

to_transfer_exarch_provinces = {
	$EXARCH_SCOPE$ = {
		overlord = {
			every_owned_province = {
				limit = {
					[[PROVINCE_TRIGGER]
					$PROVINCE_TRIGGER$
					]
					[[EXARCH_TAG]
					nhs_$EXARCH_TAG$_province = yes
					]
					to_exarch_can_get_province_passive = yes
				}
				to_cede_province_to_exarch = {
					CURRENT_OWNER = $OVERLORD_SCOPE$
					NEW_OWNER = $EXARCH_SCOPE$
				}
			}
		}
		if = {
			limit = {
				ELG = {
					exists = yes
					NOT = { tag = $EXARCH_SCOPE$ }
					overlord = {
						overlord_of = $EXARCH_SCOPE$
					}
				}
			}
			ELG = {
				every_owned_province = {
					limit = {
						[[PROVINCE_TRIGGER]
						$PROVINCE_TRIGGER$
						]
						[[EXARCH_TAG]
						nhs_$EXARCH_TAG$_province = yes
						]
						to_exarch_can_get_province_passive = yes
					}
					to_cede_province_to_exarch = {
						CURRENT_OWNER = ELG
						NEW_OWNER = $EXARCH_SCOPE$
					}
				}
			}
		}
	}
}

to_remove_exarch_cores = {
	if = {
		limit = {
			is_subject = yes
			is_subject_of_type = elysian_subject
		}
		country_event = { id = nhs2_ely_marches.4 }
	}
}

to_cede_province_to_exarch = {
	if = {
		limit = {
			is_part_of_hre = yes
		}
		set_in_empire = no
	}
	clr_province_flag = nhs_exarch_province_exemption
	if = {
		limit = {
			is_state_core = $CURRENT_OWNER$
		}
		remove_core = $CURRENT_OWNER$
		cede_province = $NEW_OWNER$
		if = {
			limit = {
				NOT = { is_state_core = $NEW_OWNER$ }
			}
			add_core = $NEW_OWNER$
		}
	}
	else_if = {
		limit = {
			is_territorial_core = $CURRENT_OWNER$
		}
		remove_core = $CURRENT_OWNER$
		cede_province = $NEW_OWNER$
		add_territorial_core = $NEW_OWNER$
	}
	else_if = {
		limit = {
			is_permanent_claim = $CURRENT_OWNER$
		}
		remove_claim = $CURRENT_OWNER$
		cede_province = $NEW_OWNER$
		add_permanent_claim = $NEW_OWNER$
	}
	else_if = {
		limit = {
			is_claim = $CURRENT_OWNER$
		}
		remove_claim = $CURRENT_OWNER$
		cede_province = $NEW_OWNER$
		add_claim = $NEW_OWNER$
	}
	else = {
		cede_province = $NEW_OWNER$
	}
	if = {
		limit = {
			$NEW_OWNER$ = {
				NOT = { accepted_culture = PREV }
			}
		}
		$NEW_OWNER$ = {
			add_accepted_culture = PREV
		}
	}
}

to_exarch_effect = {
	# Code generated by exarchs/exarch_generation.py
	if = {
		limit = { exists = EEA }
		EEA = { $EFFECT$ }
	}
	if = {
		limit = { exists = EEB }
		EEB = { $EFFECT$ }
	}
	if = {
		limit = { exists = EEC }
		EEC = { $EFFECT$ }
	}
	if = {
		limit = { exists = EED }
		EED = { $EFFECT$ }
	}
	if = {
		limit = { exists = EEE }
		EEE = { $EFFECT$ }
	}
	if = {
		limit = { exists = EEF }
		EEF = { $EFFECT$ }
	}
	if = {
		limit = { exists = EEG }
		EEG = { $EFFECT$ }
	}
	if = {
		limit = { exists = event_target:to_EEH_target }
		event_target:to_EEH_target = { $EFFECT$ }
	}
	if = {
		limit = { exists = EEI }
		EEI = { $EFFECT$ }
	}
	if = {
		limit = { exists = EEJ }
		EEJ = { $EFFECT$ }
	}
	if = {
		limit = { exists = EEL }
		EEL = { $EFFECT$ }
	}
	if = {
		limit = { exists = EEM }
		EEM = { $EFFECT$ }
	}
	if = {
		limit = { exists = EEO }
		EEO = { $EFFECT$ }
	}
	if = {
		limit = { exists = EER }
		EER = { $EFFECT$ }
	}
	if = {
		limit = { exists = EES }
		EES = { $EFFECT$ }
	}
	if = {
		limit = { exists = EET }
		EET = { $EFFECT$ }
	}
	if = {
		limit = { exists = EEU }
		EEU = { $EFFECT$ }
	}
	if = {
		limit = { exists = EEV }
		EEV = { $EFFECT$ }
	}
	if = {
		limit = { exists = EEQ }
		EEQ = { $EFFECT$ }
	}
	if = {
		limit = { exists = EEP }
		EEP = { $EFFECT$ }
	}
	if = {
		limit = { exists = event_target:to_EEY_target }
		event_target:to_EEY_target = { $EFFECT$ }
	}
	if = {
		limit = { exists = EEN }
		EEN = { $EFFECT$ }
	}
	if = {
		limit = { exists = ELG }
		ELG = { $EFFECT$ }
	}
}

to_exarch_effect_including_inactive = {
	# Code generated by exarchs/exarch_generation.py
	EEA = { $EFFECT$ }
	EEB = { $EFFECT$ }
	EEC = { $EFFECT$ }
	EED = { $EFFECT$ }
	EEE = { $EFFECT$ }
	EEF = { $EFFECT$ }
	EEG = { $EFFECT$ }
	event_target:to_EEH_target = { $EFFECT$ }
	EEI = { $EFFECT$ }
	EEJ = { $EFFECT$ }
	EEL = { $EFFECT$ }
	EEM = { $EFFECT$ }
	EEO = { $EFFECT$ }
	EER = { $EFFECT$ }
	EES = { $EFFECT$ }
	EET = { $EFFECT$ }
	EEU = { $EFFECT$ }
	EEV = { $EFFECT$ }
	EEQ = { $EFFECT$ }
	EEP = { $EFFECT$ }
	event_target:to_EEY_target = { $EFFECT$ }
	EEN = { $EFFECT$ }
	ELG = { $EFFECT$ }
}

to_exarch_effect_from_province = {
	# Code generated by exarchs/exarch_generation.py
	if = {
		limit = { nhs_EEA_province = yes }
		EEA = { $EFFECT$ }
	}
	else_if = {
		limit = { nhs_EEB_province = yes }
		EEB = { $EFFECT$ }
	}
	else_if = {
		limit = { nhs_EEC_province = yes }
		EEC = { $EFFECT$ }
	}
	else_if = {
		limit = { nhs_EED_province = yes }
		EED = { $EFFECT$ }
	}
	else_if = {
		limit = { nhs_EEE_province = yes }
		EEE = { $EFFECT$ }
	}
	else_if = {
		limit = { nhs_EEF_province = yes }
		EEF = { $EFFECT$ }
	}
	else_if = {
		limit = { nhs_EEG_province = yes }
		EEG = { $EFFECT$ }
	}
	else_if = {
		limit = { nhs_EEH_province = yes }
		event_target:to_EEH_target = { $EFFECT$ }
	}
	else_if = {
		limit = { nhs_EEI_province = yes }
		EEI = { $EFFECT$ }
	}
	else_if = {
		limit = { nhs_EEJ_province = yes }
		EEJ = { $EFFECT$ }
	}
	else_if = {
		limit = { nhs_EEL_province = yes }
		EEL = { $EFFECT$ }
	}
	else_if = {
		limit = { nhs_EEM_province = yes }
		EEM = { $EFFECT$ }
	}
	else_if = {
		limit = { nhs_EEO_province = yes }
		EEO = { $EFFECT$ }
	}
	else_if = {
		limit = { nhs_EER_province = yes }
		EER = { $EFFECT$ }
	}
	else_if = {
		limit = { nhs_EES_province = yes }
		EES = { $EFFECT$ }
	}
	else_if = {
		limit = { nhs_EET_province = yes }
		EET = { $EFFECT$ }
	}
	else_if = {
		limit = { nhs_EEU_province = yes }
		EEU = { $EFFECT$ }
	}
	else_if = {
		limit = { nhs_EEV_province = yes }
		EEV = { $EFFECT$ }
	}
	else_if = {
		limit = { nhs_EEQ_province = yes }
		EEQ = { $EFFECT$ }
	}
	else_if = {
		limit = { nhs_EEP_province = yes }
		EEP = { $EFFECT$ }
	}
	else_if = {
		limit = { nhs_EEY_province = yes }
		event_target:to_EEY_target = { $EFFECT$ }
	}
	else_if = {
		limit = { nhs_EEN_province = yes }
		EEN = { $EFFECT$ }
	}
	else_if = {
		limit = { nhs_ELG_province = yes }
		ELG = { $EFFECT$ }
	}
}

to_check_exarch_claims_check_all_provinces = {
	every_owned_province = {
		set_province_flag = nhs_eligible_for_exarch_claim@$EXARCH_TAG$
		every_neighbor_province = {
			set_province_flag = nhs_eligible_for_exarch_claim@$EXARCH_TAG$
		}
		every_neighbor_sea_zone = {
			every_neighbor_province = {
				set_province_flag = nhs_eligible_for_exarch_claim@$EXARCH_TAG$
			}
		}
	}
}

to_check_exarch_claims_on_province_gained = {
	if = {
		limit = {
			is_city = yes
			owner = {
				is_subject_of_type = elysian_subject
			}
		}
		set_province_flag = nhs_eligible_for_exarch_claim@ROOT
		every_neighbor_province = {
			set_province_flag = nhs_eligible_for_exarch_claim@ROOT
		}
		every_neighbor_sea_zone = {
			every_neighbor_province = {
				set_province_flag = nhs_eligible_for_exarch_claim@ROOT
			}
		}
	}
}

to_check_exarch_claims_on_province_lost = {
	if = {
		limit = {
			is_city = yes
			FROM = {
				is_subject_of_type = elysian_subject
			}
		}
		every_province = {
			clr_province_flag = nhs_eligible_for_exarch_claim@FROM
		}
		FROM = {
			to_check_exarch_claims_check_all_provinces = { EXARCH_TAG = FROM }
		}
	}
}

to_check_exarch_claims_on_become_subject = {
	if = {
		limit = {
			is_subject_of_type = elysian_subject
		}
		every_province = {
			clr_province_flag = nhs_eligible_for_exarch_claim@FROM
		}
		to_check_exarch_claims_check_all_provinces = { EXARCH_TAG = FROM }
	}
}

to_fabricate_exarch_claim_effect = {
	if = {
		limit = {
			$EXARCH_TAG$ = {
				is_subject_of = ROOT
				is_subject_of_type = elysian_subject
			}
			any_owned_province = {
				has_province_flag = nhs_eligible_for_exarch_claim$EXARCH_TAG$
			}
		}
		every_owned_province = {
			limit = {
				has_province_flag = nhs_eligible_for_exarch_claim$EXARCH_TAG$
				NOT = { is_claim = $EXARCH_TAG$ }
				NOT = { is_permanent_claim = $EXARCH_TAG$ }
			}
			add_claim = $EXARCH_TAG$
		}
	}
}

to_initialize_custom_exarch_peripheral_territories = {
	set_variable = {
		which = to_custom_exarch_province_cost
		value = 0
	}
	set_variable = {
		which = to_custom_exarch_province_local_cost
		value = 0
	}
	every_owned_province = {
		limit = {
			$PROVINCE_TRIGGER$
		}
		set_province_flag = to_exarch_permanently_owned_land_@PREV
		PREV = {
			change_variable = {
				which = to_custom_exarch_province_cost
				value = 5
			}
		}
		to_exarch_effect_from_province = {
			EFFECT = "
			change_variable = {
				which = to_exarch_owned_provinces_for_merchant
				value = -1
			}
			"
		}
	}
	if = {
		limit = {
			check_variable = {
				which = to_custom_exarch_province_cost
				value = 501
			}
		}
		set_variable = {
			which = to_custom_exarch_province_cost
			value = 500
		}
	}
	# else_if = {
	# 	limit = {
	# 		NOT = {
	# 			check_variable = {
	# 				which = to_custom_exarch_province_cost
	# 				value = 50
	# 			}
	# 		}
	# 	}
	# 	set_variable = {
	# 		which = to_custom_exarch_province_cost
	# 		value = 50
	# 	}
	# }
}

to_exarch_monument_mod_transfer = {
	if = {
		limit = {
			owner = {
				nhs_check_all_elysian_tags = { CONDITION = tag }
			}
		}
		custom_tooltip = to_exarch_monument_mod_transfer_tt
	}
	else_if = {
		limit = {
			owner = {
				nhs_check_all_elysian_tags = { CONDITION = is_subject_of }
			}
		}
		custom_tooltip = to_exarch_monument_mod_transfer_subject_tt
	}
}

to_exarch_kleisoura_monument_mod_transfer = {
	if = {
		limit = {
			owner = {
				nhs_check_all_elysian_tags = { CONDITION = tag }
			}
		}
		custom_tooltip = to_exarch_kleisoura_monument_mod_transfer_tt
	}
	else_if = {
		limit = {
			owner = {
				nhs_check_all_elysian_tags = { CONDITION = is_subject_of }
			}
		}
		custom_tooltip = to_exarch_kleisoura_monument_mod_transfer_subject_tt
	}
}