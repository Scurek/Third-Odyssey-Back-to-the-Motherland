namespace = elysian_revolution

# Revolution
country_event = {
	id = elysian_revolution.1
	title = elysian_revolution.1.t
	desc = elysian_revolution.1.d
	picture = REVOLUTION_eventPicture
	
	major = yes
	
	is_triggered_only = yes
	
	immediate = {
		set_country_flag = nhs_had_first_civil_war
	}
	option = {
		name = elysian_revolution.1.a			# Bring me their heads!
		#custom_tooltip = nhs_elysian_revolution_begun
		#set_country_flag = elysian_revolution
		add_prestige = -30
		add_stability = -6
		random_owned_province = {
			limit = {
				is_capital = no
			}
			cede_province = ERF
		}
		set_country_flag = nhs_in_civil_war
		ERF = {
			set_country_flag = nhs_in_civil_war
		}
		declare_war_with_cb = {
			who = ERF
			casus_belli = cb_nhs_elysian_civil_war
		}
	}
	option = {
		name = elysian_revolution.1.b			# Vive la revolution!
		#custom_tooltip = nhs_elysian_revolution_begun
		#set_country_flag = elysian_revolution
		add_prestige = -30
		add_stability = -6
		random_owned_province = {
			limit = {
				is_capital = no
			}
			cede_province = ELR
		}
	}
}

###################################################
### EVENTS LEADING UP TO REVOLUTION
###################################################

# Event triggerer
country_event = {
	id = elysian_revolution.2
	title = elysian_revolution.2.t
	desc = elysian_revolution.2.d
	picture = REVOLUTION_eventPicture

	hidden = yes
		
	trigger = {
		tag = ELY
		is_free_or_tributary_trigger = yes
		has_reform = elysian_absolute_empire
		OR = {
			current_age = age_of_absolutism
			current_age = age_of_revolutions
		}
		OR = {
			AND = {
				NOT = { has_country_flag = nhs_elysian_revolution_progress_25 }
				has_disaster_progress = {
					disaster = elysian_revolution
					value = 25
				}
			}
			AND = {
				NOT = { has_country_flag = nhs_elysian_revolution_progress_50 }
				has_disaster_progress = {
					disaster = elysian_revolution
					value = 50
				}
			}
			AND = {
				NOT = { has_country_flag = nhs_elysian_revolution_progress_75 }
				has_disaster_progress = {
					disaster = elysian_revolution
					value = 75
				}
			}
		}
	}
	
	immediate = {
		if = {
			limit = {
				NOT = { has_country_flag = nhs_elysian_revolution_progress_25 }
			}
			set_country_flag = nhs_elysian_revolution_progress_25
		}
		else_if = {
			limit = {
				NOT = { has_country_flag = nhs_elysian_revolution_progress_50 }
			}
			set_country_flag = nhs_elysian_revolution_progress_50
		}
		else_if = {
			limit = {
				NOT = { has_country_flag = nhs_elysian_revolution_progress_75 }
			}
			set_country_flag = nhs_elysian_revolution_progress_75
		}

		if = {
			limit = {
				NOT = { has_country_flag = nhs_elysian_revolution_scythian_unrest }
				num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
					value = 10
					continent = north_america
					is_city = yes
					OR = {
						culture = skythiai
						culture = scythian_c
					}
				}
			}
			set_country_flag = nhs_elysian_revolution_scythian_unrest
			
			country_event = { id = elysian_revolution.3 }
		}
	}

	option = {
		name = elysian_revolution.2.a
		
	}
}

# Unrest in scythia
country_event = {
	id = elysian_revolution.3
	title = elysian_revolution.3.t
	desc = elysian_revolution.3.d
	picture = REVOLUTION_eventPicture
		
	is_triggered_only = yes

	immediate = {
		set_country_flag = nhs_elysian_revolution_progress_25
		hidden_effect = {
			every_province = {
				limit = {
					nhs_scythian_revolt_province = yes
				}
				add_core = SKY
			}
			## Find target province
			nhs_highest_dev_province = {
				PROVINCE_CONDITION = nhs_scythian_revolt_province 
				TRADE_CENTER_BONUS = 5
				EVENT_TARGET = nhs_scythian_stronghold_target
			}
		}
	}

	option = {
		name = elysian_revolution.3.a			# Bring me their heads!
		set_country_flag = nhs_elysian_revolution_scythian_revolt
		custom_tooltip = nhs_elysian_revolution_scythian_cores_tt

		add_disaster_progress = {
			disaster = nhs_scythian_revolt
			value = 100
		}

		event_target:nhs_scythian_stronghold_target = {
			set_province_flag = nhs_scythian_revolt_rebels
			nhs_remove_fort = yes
			add_province_modifier = {
				name = nhs2_scythian_rebel_stronghold
				duration = -1
			}
			tooltip = {
				spawn_rebels = {
					size = 3
					type = nationalist_rebels
					win = yes
				}
			}
			hidden_effect = {
				random_list = {
					50 = {
						spawn_rebels = {
							size = 3
							type = scythian_nationalist_rebels
							win = yes
							culture = skythiai
						}
					}
					50 = {
						spawn_rebels = {
							size = 3
							type = scythian_nationalist_rebels
							win = yes
							culture = scythian_c
						}
					}
				}
			}
		}

		custom_tooltip = nhs_elysian_revolution_scythian_additional_rebels_tt

		hidden_effect = {
			set_variable = {            
				which = nhs_scythian_revolt_stacks
				value = 4
			}
			while = {
				limit = {
					check_variable = {
						which = nhs_scythian_revolt_stacks
						value = 0
					}
				}
				subtract_variable = {            
					which = nhs_scythian_revolt_stacks
					value = 1
				}
				if = {
					limit = {
						any_owned_province = {
							NOT = { has_province_flag = nhs_scythian_revolt_rebels }
							nhs_scythian_revolt_province = yes
							any_neighbor_province = {
								has_province_flag = nhs_scythian_revolt_rebels
							}
						}
					}
					random_owned_province = {
						limit = {
							NOT = { has_province_flag = nhs_scythian_revolt_rebels }
							nhs_scythian_revolt_province = yes
							any_neighbor_province = {
								has_province_flag = nhs_scythian_revolt_rebels
							}
						}
						set_province_flag = nhs_scythian_revolt_rebels
						random_list = {
							50 = {
								spawn_rebels = {
									size = 1
									type = scythian_nationalist_rebels
									win = yes
									culture = skythiai
								}
							}
							50 = {
								spawn_rebels = {
									size = 1
									type = scythian_nationalist_rebels
									win = yes
									culture = scythian_c
								}
							}
						}
					}
				}
				else = {
					event_target:nhs_scythian_stronghold_target = {
						random_list = {
							50 = {
								spawn_rebels = {
									size = 1
									type = scythian_nationalist_rebels
									win = yes
									culture = skythiai
								}
							}
							50 = {
								spawn_rebels = {
									size = 1
									type = scythian_nationalist_rebels
									win = yes
									culture = scythian_c
								}
							}
						}
					}
				}
			}
		}
		
	}
	option = {
		name = elysian_revolution.3.b			# 
		custom_tooltip = nhs_elysian_revolution_scythian_cores_tt
		add_absolutism = -15
		add_prestige = -20
		add_disaster_progress = {
			disaster = elysian_revolution
			value = -10
		}
		every_owned_province = {
			limit = {
				nhs_scythian_revolt_province = yes
			}
			add_province_modifier = {
				name = nhs2_scythian_autonomy
				duration = -1
			}
		}
		custom_tooltip = nhs_elysian_revolution_scythian_autonomy_tt

		set_country_flag = nhs_elysian_revolution_scythian_appeasement
	}
}




country_event = {
	id = elysian_revolution.6
	title = "ELYREVNAME06"
	desc = "ELYREVDESC06"
	picture = {
		trigger = {
			OR = {
				AND = {
					check_variable = {
						which = RevolutionCountingVariable
						value = 80
					}
					has_regency = yes
				}
				check_variable = {
					which = RevolutionCountingVariable
					value = 110
				}
			}
		}
		picture = VICTORY_eventPicture
	}
	picture = {
		trigger = {
			NOT = {
				check_variable = {
					which = RevolutionCountingVariable
					value = 11
				}
			}
		}
		picture = BYZANTINE_EMPEROR_eventPicture
	}
	
	trigger = {
		has_disaster = elysian_revolution
		OR = {
			check_variable = {
				which = RevolutionCountingVariable
				value = 110
			}
			NOT = {
				check_variable = {
					which = RevolutionCountingVariable
					value = 11
				}
			}
			AND = {
				check_variable = {
					which = RevolutionCountingVariable
					value = 80
				}
				has_regency = yes
			}
		}
	}
	
	major = yes
	
	immediate = {
		hidden_effect = {
			end_disaster = elysian_revolution
			set_country_flag = elysian_revolution_over
		}
	}
	
	option = {
		name = "ELYREVOPTA601"			# The Emperor flees into exile! Zíto i epanástasi!
		trigger = {
			OR = {
				AND = {
					check_variable = {
						which = RevolutionCountingVariable
						value = 80
					}
					has_regency = yes
				}
				check_variable = {
					which = RevolutionCountingVariable
					value = 110
				}
			}
		}
		tooltip = {
			end_disaster = elysian_revolution
		}
		custom_tooltip = nhs_revolution_success
		disband_rebels = revolutionary_rebels
		if = {
			limit = {
				has_heir = yes
				has_regency = no
			}
			exile_heir_as = nhs_rev_exiled_heir
			set_global_flag = nhs_has_exiled_heir
			exile_ruler_as = nhs_rev_exiled_ruler
			set_global_flag = nhs_has_exiled_ruler
			#custom_tooltip = nhs_ruler_and_heir_exiled_tt
		}
		else_if = {
			limit = {
				has_regency = no
				has_heir = no
			}
			exile_ruler_as = nhs_rev_exiled_ruler
			set_global_flag = nhs_has_exiled_ruler
			#custom_tooltip = nhs_ruler_and_heir_exiled_tt
			#tooltip = {
			#	kill_ruler = yes
			#}
		}
		else_if = {
			limit = {
				has_regency = yes
			}
			exile_heir_as = nhs_rev_exiled_heir
			set_global_flag = nhs_has_exiled_heir
			#tooltip = {
			#	kill_ruler = yes
			#}
		}
		change_tag = ERF
		nhs_change_government = { GOV = republic }
		add_government_reform = elysian_republic
		define_ruler = {
			mil = 3
			dip = 3
			adm = 3
		}
		# if = {
			# limit = {
				# has_dlc = "Dharma"
			# }
			# lose_reforms = 2
		# }
		if = {
			limit = {
				NOT = { has_dlc = "Dharma" }
			}
			custom_tooltip = nhs_starts_with_senate_disolved_tt
			hidden_effect = {
				dissolve_parliament = yes
			}
		}
		add_stability = 1
		# hidden_effect = {
			# define_ruler = {
				# mil = 3
				# dip = 3
				# adm = 3
			# }
		# }
	}
	
	option = {
		name = "ELYREVOPTA602"			# The Revolution has been put down! Zíto o Basileus!
		trigger = {
			NOT = {
				check_variable = {
					which = RevolutionCountingVariable
					value = 11
				}
			}
		}
		tooltip = {
			end_disaster = elysian_revolution
		}
		custom_tooltip = nhs_revolution_failure
		disband_rebels = revolutionary_rebels
		add_stability = 2
		add_country_modifier = {
			name = rev_absolute_authority
			duration = -1
		}
	}
}
#country_event = {
#	id = elysian_revolution.7
#	title = "ELYREVNAME07"
#	desc = "ELYREVDESC07"
#	picture = AWESOMECITY_eventPicture
#	
#	fire_only_once = yes
#	
#	hidden = yes
#	
#	trigger = {
#		has_disaster = elysian_revolution
#		check_variable = {
#			which = RevolutionCountingVariable
#			value = 110
#		}
#	}
#	
#	mean_time_to_happen = {
#		days = 1
#	}
#	
#	immediate = {
#		hidden_effect = {
#			set_country_flag = elysian_revolution_over
#		}
#	}
#	
#	option = {
#		name = "ELYREVOPTA701"
#	}
#}
#country_event = {
#	id = elysian_revolution.8
#	title = "ELYREVNAME07"
#	desc = "ELYREVDESC07"
#	picture = AWESOMECITY_eventPicture
#	
#	fire_only_once = yes
#	
#	hidden = yes
#	
#	trigger = {
#		has_disaster = elysian_revolution
#		has_regency = yes
#	}
#	
#	mean_time_to_happen = {
#		days = 1
#	}
#	
#	immediate = {
#		hidden_effect = {
#			set_country_flag = elysian_revolution_over
#		}
#	}
#	
#	option = {
#		name = "ELYREVOPTA701"
#	}
#}
#country_event = {
#	id = elysian_revolution.9
#	title = "ELYREVNAME07"
#	desc = "ELYREVDESC07"
#	picture = AWESOMECITY_eventPicture
#	
#	fire_only_once = yes
#	
#	hidden = yes
#	
#	trigger = {
#		has_disaster = elysian_revolution
#		NOT = {
#			check_variable = {
#				which = RevolutionCountingVariable
#				value = 11
#			}
#		}
#	}
#	
#	immediate = {
#		hidden_effect = {
#			set_country_flag = elysian_revolution_over
#		}
#	}
#	
#	option = {
#		name = "ELYREVOPTA701"
#	}
#}