namespace = nhs_exploration

### CM1 related events

# Discovery of the shipwrecked nation CM1
country_event = {
	id = nhs_exploration.1
	title = nhs_exploration.1.t
	desc = nhs_exploration.1.d
	picture = western_coast_eventPicture

	goto = 481
	
	fire_only_once = yes
	
	trigger = {
		nhs_check_all_elysian_tags = { CONDITION = tag }
		exists = CM1
		OR = {
			capital_scope = { has_discovered = CM1 }
			CM1 = { capital_scope = { has_discovered = ROOT } }
		}
	}
	
	mean_time_to_happen = {
		days = 1
	}

	immediate = {
		hidden_effect = {
			discover_province = 481
			discover_province = 1572
			discover_province = 1570
		}
	}
	
	option = {
		name = nhs_exploration.1.a
		# Event: our brethren!
		if = {
			limit = {
				OR = {
					religion = orthodox
					religion = elysian_orthodoxy
				}
			}
			country_event = { id = nhs_exploration.2 days = 10 }
		}
		else_if = {
			limit = {
				religion = pantheon_worship
			}
			country_event = { id = nhs_exploration.3 days = 10 }
		}
		hidden_effect = {
			CM1 = { country_event = { id = nhs_exploration.5 days = 3 } }
		}
		set_country_flag = nhs_discovered_survivors
	}
}

# If Elysia also orthodox: they want to join freely
country_event = {
	id = nhs_exploration.2
	title = nhs_exploration.2.t
	desc = nhs_exploration.2.d
	picture = golden_century_EUROPEAN_REFUGEES_eventPicture

	goto = 481
	
	fire_only_once = yes
	is_triggered_only = yes
	
	trigger = {
		nhs_check_all_elysian_tags = { CONDITION = tag }
		OR = {
			religion = orthodox
			religion = elysian_orthodoxy
		}
		exists = CM1
		has_country_flag = nhs_discovered_survivors
		NOT = { has_country_flag = nhs_interacted_survivors }
	}

	immediate = {
		set_country_flag = nhs_interacted_survivors
	}
	
	option = { # Welcome them with open arms
		ai_chance = { 
			factor = 90
			# modifier = {
			# 	factor = 0.5
			# 	NOT = { legitimacy = 60 }
			# }
			# modifier = {
			# 	factor = 0
			# 	CM1 = { ai = no }
			# }
		}
		name = nhs_exploration.2.a
		add_adm_power = -50
		vassalize = CM1
		add_historical_friend = CM1
		CM1 = {
			add_historical_friend = ROOT
		}
		# create_subject = {
		# 	subject_type = elysian_subject_non_exarch
		# 	subject = CM1
		# }
		# add_legitimacy = -5
		
		hidden_effect = {
			CM1 = {
				set_country_flag = cm1_elysia_made_its_decision
				every_province = {
					limit = {
						has_discovered = ROOT
					}
					discover_country = CM1
				}
				remove_country_modifier = nhs_settler_heritage_two
			}
		}
	}
	option = { # They'll manage fine on their own
		name = nhs_exploration.2.b
		ai_chance = { 
			factor = 10
			# modifier = {
			# 	factor = 3
			# 	NOT = { legitimacy = 60 }
			# }
		}
		# add_legitimacy = 10
		# Event: left on our own
		CM1 = { country_event = { id = oth_ctm_events.3 days = 3 } }
	}
	after = {
		CM1 = {
			set_country_flag = nhs_interacted_survivors
		}
	}
}

# If Elysia pantheon: they need convincing to join
country_event = {
	id = nhs_exploration.3
	title = nhs_exploration.3.t
	desc = nhs_exploration.3.d
	picture = golden_century_EUROPEAN_REFUGEES_eventPicture

	goto = 481
	
	fire_only_once = yes
	is_triggered_only = yes
	
	trigger = {
		nhs_check_all_elysian_tags = { CONDITION = tag }
		religion = pantheon_worship
		exists = CM1
		has_country_flag = nhs_discovered_survivors
		NOT = { has_country_flag = nhs_interacted_survivors }
	}

	immediate = {
		set_country_flag = nhs_interacted_survivors
	}
	
	option = { # Convince them of the power and glory of our nation and our gods
		name = "nhs_exploration.3.a"
		ai_chance = { 
			factor = 60
		}
		add_adm_power = -50
		add_dip_power = -100
		vassalize = CM1
		add_historical_friend = CM1
		CM1 = {
			add_historical_friend = ROOT
		}
		# create_subject = {
		# 	subject_type = elysian_subject_non_exarch
		# 	subject = CM1
		# }
		custom_tooltip = nhs_new_line_tt
		CM1 = { 
			change_religion = pantheon_worship
			capital_scope = { change_religion = pantheon_worship }
			hidden_effect = {
				set_country_flag = cm1_elysia_made_its_decision
				every_province = {
					limit = {
						has_discovered = ROOT
					}
					discover_country = CM1
				}
				remove_country_modifier = nhs_settler_heritage_two
			}
		}
		# add_treasury = -250
		# add_legitimacy = -10	
	}
	option = { # Leave them to their own doing
		name = nhs_exploration.3.b
		ai_chance = {
			factor = 40
		}
		add_legitimacy = 20
		add_prestige = 10
		custom_tooltip = nhs_new_line_tt
		# Event: left on our own
		CM1 = { country_event = { id = oth_ctm_events.3 days = 3 } }
	}
	after = {
		CM1 = {
			set_country_flag = nhs_interacted_survivors
		}
	}
}

# Event to auto-discover CM1 when exploration idea 3 - event 54
country_event = {
	id = nhs_exploration.4
	title = nhs_exploration.4.t
	desc = nhs_exploration.4.d
	picture = western_SHIP_SAILING_eventPicture

	goto = 481
	
	fire_only_once = yes
	
	trigger = {
		nhs_check_all_elysian_tags = { CONDITION = tag }
		exists = CM1
		OR = {
			has_idea = quest_for_the_new_world
			has_idea = a_new_start
			is_year = 1480
		}
		is_year = 1476
		NOT = { 481 = { has_discovered = ROOT } }
		NOT = { has_country_flag = nhs_discovered_survivors }
	}
	
	mean_time_to_happen = {
		months = 12
		modifier = {
			factor = 0.2
			num_of_explorers = 1
		}
		modifier = {
			factor = 0.25
			1572 = { has_discovered = ROOT }
		}
	}

	immediate = {
		hidden_effect = {
			discover_province = 481
			discover_province = 1572
			discover_province = 1570
		}
	}
	
	option = {
		name = nhs_exploration.4.a
	}
}

# CM1 survivors discovered event
country_event = {
	id = nhs_exploration.5
	title = nhs_exploration.5.t
	desc = nhs_exploration.5.d
	picture = western_coast_eventPicture

	goto = elysian_capital
	
	is_triggered_only = yes

    trigger = {
		tag = CM1
	}

	immediate = {
		hidden_effect = {
			discover_province = 1570
			FROM = {
				capital_scope = {
					save_event_target_as = elysian_capital
					every_province = {
						limit = {
							area = PREV
						}
						discover_country = ROOT
					}
				}
			}
		}
	}

	option = {
		name = nhs_exploration.5.a
		add_stability = 2
		custom_tooltip = nhs_new_line_tt
		custom_tooltip = nhs_settler_heritage_0_2_tt
		custom_tooltip = to_cm1_settler_heritage_two_duration_tt
		hidden_effect = {
			remove_country_modifier = nhs_handicap_settlers
			add_country_modifier = {
				name = nhs_settler_heritage_two
				duration = 18250
			}
		}
		# capital_scope = { add_base_tax = 2 }
		set_country_flag = had_event_nhs_exploration_5
	}
}