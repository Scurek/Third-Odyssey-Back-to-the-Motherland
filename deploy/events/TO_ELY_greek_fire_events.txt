namespace = nhs2_greek_fire

###################################################
### GREEK FIRE
###################################################

# Supply running out
country_event = {
	id = nhs2_greek_fire.1
	title = nhs2_greek_fire.1.t
	desc = nhs2_greek_fire.1.d
	picture = alchemist_eventpicture

	fire_only_once = yes

	trigger = {
		nhs_condition_all_ely = { KOMANDA = tag }
		is_year = 1453
		NOT = { has_country_flag = nhs_searching_for_naphtha }
		OR = {
			has_country_modifier = nhs_secrets_greekfire
			has_country_modifier = nhs_greekfire_update
		}
	}

	immediate = {
		set_country_flag = nhs_depleting_fire
	}

	option = { ## Reserve it for Fort defense
		name = "nhs2_greek_fire.1.a"
		ai_chance = {
			factor = 90
		}
		remove_country_modifier = nhs_secrets_greekfire
		add_country_modifier = {
			name = nhs2_depleting_fire_forts
			duration = 5475
		}
	}
	option = { ## Reserve it for ships
		name = "nhs2_greek_fire.1.b"
		ai_chance = {
			factor = 10
		}
		remove_country_modifier = nhs_secrets_greekfire
		add_country_modifier = {
			name = nhs2_depleting_fire_ships
			duration = 5475
		}
	}
}

# Search for new sources of Naphtha
country_event = {
	id = nhs2_greek_fire.2
	title = nhs2_greek_fire.2.t
	desc = nhs2_greek_fire.2.d
	picture = EXPLORERS_eventPicture

	fire_only_once = yes

	trigger = {
		nhs_condition_all_ely = { KOMANDA = tag }
		is_year = 1453
		has_country_flag = nhs_depleting_fire
	}

	mean_time_to_happen = {
		days = 50
	}

	option = { ## Send out the search parties
		name = "nhs2_greek_fire.2.a"
		set_country_flag = nhs_searching_for_naphtha
	}
}

# Found a new sources of Naphtha -Oil Creek/Titusville
country_event = {
	id = nhs2_greek_fire.3
	title = nhs2_greek_fire.3.t
	desc = nhs2_greek_fire.3.d
	picture = niagara_falls_eventPicture

	fire_only_once = yes

	trigger = {
		nhs_condition_all_ely = { KOMANDA = tag }
		has_country_flag = nhs_searching_for_naphtha
		954 = {
			NOT = { has_province_modifier = nhs2_source_of_naphta }
			NOT = { has_province_modifier = nhs2_source_of_naphta_e }
		}
		OR = {
			NOT = { has_country_flag = nhs_fire_discovery_delay }
			had_country_flag = { flag = nhs_fire_discovery_delay days = 100 }
		}
		OR = {
			owns = 954
			AND = {
				had_country_flag = { flag = nhs_searching_for_naphtha days = 4745 }
				has_country_flag = nhs_expanded_the_limits
			}
			AND = {
				had_country_flag = { flag = nhs_searching_for_naphtha days = 2555 }
				OR = {
					has_country_flag = nhs_didnot_expand_the_limits
					NOT = { has_country_flag = nhs_expanded_the_limits }
				}
			}
			AND = {
				has_discovered = 954
				had_country_flag = { flag = nhs_searching_for_naphtha days = 365 }
			}
		}
	}

	immediate = {
		hidden_effect = {
			save_event_target_as = nhs2_greek_fire_3_target
		}
	}

	option = { ##
		name = "nhs2_greek_fire.3.a"
		if = {
			limit = {
				954 = {
					NOT = {
						owned_by = ROOT
						owner = {
							is_subject_of = ROOT
						}
					}
				}
			}
			discover_province = 954
			954 = {
				add_permanent_province_modifier = {
					name = nhs2_source_of_naphta
					duration = -1
				}
			}
			custom_tooltip = nhs2_greek_fire.3.tt # Will have to either deal with natives (via decision), or conquer/colonise the province
		}
		else = {
			set_country_flag = nhs_found_the_source
			954 = {
				if = {
					limit = {
						has_province_modifier = nhs2_source_of_naphta
					}
					remove_province_modifier = nhs2_source_of_naphta
				}
				if = {
					limit = {
						NOT = { has_province_modifier = nhs2_source_of_naphta_e }
					}
					add_permanent_province_modifier = {
						name = nhs2_source_of_naphta_e
						duration = -1
					}
				}
			}
			if = {
				limit = {
					has_country_modifier = nhs2_depleting_fire_ships
				}
				remove_country_modifier = nhs2_depleting_fire_ships
			}
			if = {
				limit = {
					has_country_modifier = nhs2_depleting_fire_forts
				}
				remove_country_modifier = nhs2_depleting_fire_forts
			}
			nhs_set_the_fire_on = yes
		}
	}
}

##987,Niagara

# Found Alternative Source -Trinidad, Pitch Lake
country_event = {
	id = nhs2_greek_fire.4
	title = nhs2_greek_fire.4.t
	desc = {
		trigger = {
			502 = {
				NOT = {
					owned_by = ROOT
					owner = {
						is_subject_of = ROOT
					}
				}
			}
		}
		desc = nhs2_greek_fire.4.da
	}
	desc = {
		trigger = {
			502 = {
				OR = {
					owned_by = ROOT
					owner = {
						is_subject_of = ROOT
					}
				}
			}
		}
		desc = nhs2_greek_fire.4.db
	}
	picture = caribbean_arrival_eventPicture

	fire_only_once = yes

	trigger = {
		nhs_condition_all_ely = { KOMANDA = tag }
		has_country_flag = nhs_searching_for_naphtha
		has_discovered = 502
		OR = {
			NOT = { has_country_flag = nhs_fire_discovery_delay }
			had_country_flag = { flag = nhs_fire_discovery_delay days = 150 }
		}
		502 = {
			NOT = { has_province_modifier = nhs2_source_of_naphta }
			NOT = { has_province_modifier = nhs2_source_of_naphta_e }
		}
	}

	immediate = {
		hidden_effect = {
			save_event_target_as = nhs2_greek_fire_4_target
		}
	}

	option = { ##
		name = "nhs2_greek_fire.4.a"
		if = {
			limit = {
				502 = {
					NOT = {
						owned_by = ROOT
						owner = {
							is_subject_of = ROOT
						}
					}
				}
			}
			502 = {
				add_permanent_province_modifier = {
					name = nhs2_source_of_naphta
					duration = -1
				}
			}
			custom_tooltip = nhs2_greek_fire.3.tt # Will have to either deal with natives (via decision), or conquer/colonise the province
		}
		else = {
			set_country_flag = nhs_found_the_source
			502 = {
				if = {
					limit = {
						has_province_modifier = nhs2_source_of_naphta
					}
					remove_province_modifier = nhs2_source_of_naphta
				}
				if = {
					limit = {
						NOT = { has_province_modifier = nhs2_source_of_naphta_e }
					}
					add_permanent_province_modifier = {
						name = nhs2_source_of_naphta_e
						duration = -1
					}
				}
			}
			if = {
				limit = {
					has_country_modifier = nhs2_depleting_fire_ships
				}
				remove_country_modifier = nhs2_depleting_fire_ships
			}
			if = {
				limit = {
					has_country_modifier = nhs2_depleting_fire_forts
				}
				remove_country_modifier = nhs2_depleting_fire_forts
			}
			nhs_set_the_fire_on = yes
		}
	}
}

# Acquired the source
country_event = {
	id = nhs2_greek_fire.5
	title = nhs2_greek_fire.5.t
	desc = nhs2_greek_fire.5.d
	picture = greek_fire_storage_eventpicture

	trigger = {
		nhs_condition_all_ely = { KOMANDA = tag }
		has_country_flag = nhs_searching_for_naphtha
		any_province = {
			is_colony = no
			has_province_modifier = nhs2_source_of_naphta
			NOT = { has_province_modifier = nhs2_source_of_naphta_e }
			OR = {
				owned_by = ROOT
				owner = {
					OR = {
						has_country_modifier = nhs_greek_fire_deal
						is_subject_of = ROOT
					}
				}
			}
		}
		NOT = { has_country_flag = nhs_temp_fire }
	}

	immediate = {
		set_country_flag = nhs_found_the_source
	}

	option = { ##
		name = "nhs2_greek_fire.5.a"
		every_province = {
			limit = {
				has_province_modifier = nhs2_source_of_naphta
				NOT = { has_province_modifier = nhs2_source_of_naphta_e }
				OR = {
					owned_by = ROOT
					owner = {
						OR = {
							has_country_modifier = nhs_greek_fire_deal
							is_subject_of = ROOT
						}
					}
				}
			}
			if = {
				limit = {
					has_province_modifier = nhs2_source_of_naphta
				}
				remove_province_modifier = nhs2_source_of_naphta
			}
			if = {
				limit = {
					NOT = { has_province_modifier = nhs2_source_of_naphta_e }
				}
				add_permanent_province_modifier = {
					name = nhs2_source_of_naphta_e
					duration = -1
				}
			}
		}
		if = {
			limit = {
				has_country_modifier = nhs2_depleting_fire_ships
			}
			remove_country_modifier = nhs2_depleting_fire_ships
		}
		if = {
			limit = {
				has_country_modifier = nhs2_depleting_fire_forts
			}
			remove_country_modifier = nhs2_depleting_fire_forts
		}
		nhs_set_the_fire_on = yes
	}
}

# Fuel running out, hidden
country_event = {
	id = nhs2_greek_fire.6
	title = nhs2_greek_fire.6.t  ###HIDDEN EVENT
	desc = nhs2_greek_fire.6.d
	picture = CITY_VIEW_eventPicture

	hidden = yes

	trigger = {
		nhs_condition_all_ely = { KOMANDA = tag }
		OR = {
			has_country_modifier = nhs_secrets_greekfire
			has_country_modifier = nhs_greekfire_update
		}
		NOT = {
			any_province = {
				has_province_modifier = nhs2_source_of_naphta_e
				OR = {
					owned_by = ROOT
					owner = {
						OR = {
							has_country_modifier = nhs_greek_fire_deal
							is_subject_of = ROOT
						}
					}
				}
			}
		}
	}

	immediate = {
		set_country_flag = nhs_depleting_fire_fuel
		add_country_modifier = {
			name = nhs2_depleting_fire_fuel_timer
			duration = 1825
			hidden = yes
		}
	}

	option = { ##
		name = "nhs2_greek_fire.6.a"
	}
}

# Fuel reserves depleted
country_event = {
	id = nhs2_greek_fire.7
	title = nhs2_greek_fire.7.t
	desc = nhs2_greek_fire.7.d
	picture = alchemist_eventpicture

	trigger = {
		nhs_condition_all_ely = { KOMANDA = tag }
		OR = {
			has_country_modifier = nhs_secrets_greekfire
			has_country_modifier = nhs_greekfire_update
		}
		has_country_flag = nhs_depleting_fire_fuel
		NOT = { has_country_modifier = nhs2_depleting_fire_fuel_timer }
		NOT = {
			any_province = {
				has_province_modifier = nhs2_source_of_naphta_e
				OR = {
					owned_by = ROOT
					owner = {
						OR = {
							has_country_modifier = nhs_greek_fire_deal
							is_subject_of = ROOT
						}
					}
				}
			}
		}
	}

	immediate = {
		set_country_flag = nhs2_had_greek_fire
	}

	option = { ##
		name = "nhs2_greek_fire.7.a"
		nhs_set_the_fire_off = yes
		clr_country_flag = nhs_depleting_fire_fuel
	}
}

# Fuel reserves reacquired before depleting, hidden
country_event = {
	id = nhs2_greek_fire.8
	title = nhs2_greek_fire.8.t  ###HIDDEN EVENT
	desc = nhs2_greek_fire.8.d
	picture = CITY_VIEW_eventPicture

	hidden = yes

	trigger = {
		nhs_condition_all_ely = { KOMANDA = tag }
		OR = {
			has_country_modifier = nhs_secrets_greekfire
			has_country_modifier = nhs_greekfire_update
		}
		OR = {
			has_country_flag = nhs_depleting_fire_fuel
			has_country_modifier = nhs2_depleting_fire_fuel_timer
		}
		any_province = {
			is_colony = no
			has_province_modifier = nhs2_source_of_naphta_e
			OR = {
				owned_by = ROOT
				owner = {
					OR = {
						has_country_modifier = nhs_greek_fire_deal
						is_subject_of = ROOT
					}
				}
			}
		}
	}

	immediate = {
		clr_country_flag = nhs_depleting_fire_fuel
		remove_country_modifier = nhs2_depleting_fire_fuel_timer
	}

	option = { ##
		name = "nhs2_greek_fire.8.a"
	}
}

# Fuel reserves reacquired after depleting
country_event = {
	id = nhs2_greek_fire.9
	title = nhs2_greek_fire.9.t
	desc = nhs2_greek_fire.9.d
	picture = barrels_eventpicture

	trigger = {
		nhs_condition_all_ely = { KOMANDA = tag }
		NOT = {
			OR = {
				has_country_modifier = nhs_secrets_greekfire
				has_country_modifier = nhs_greekfire_update
			}
		}
		has_country_flag = nhs2_had_greek_fire
		any_province = {
			is_colony = no
			has_province_modifier = nhs2_source_of_naphta_e
			OR = {
				owned_by = ROOT
				owner = {
					OR = {
						has_country_modifier = nhs_greek_fire_deal
						is_subject_of = ROOT
					}
				}
			}
		}
	}

	immediate = {
		clr_country_flag = nhs2_had_greek_fire
	}

	option = { ##
		name = "nhs2_greek_fire.9.a"
		nhs_set_the_fire_on = yes
	}
}

# Elysian propose a naphta deal
country_event = {
	id = nhs2_greek_fire.10
	title = nhs2_greek_fire.10.t
	desc = nhs2_greek_fire.10.d
	picture = NATIVE_REFORM_eventPicture

	is_triggered_only = yes

	option = {
		ai_chance = {
			factor = 90
		}
		name = "nhs2_greek_fire.10.a"
		add_opinion = {
			who = FROM
			modifier = nhs_naphta_deal
		}
		add_country_modifier = {
			name = nhs_greek_fire_deal
			duration = -1
		}
		tooltip = {
			every_province = {
				limit = {
					has_province_modifier = nhs2_source_of_naphta
					NOT = { has_province_modifier = nhs2_source_of_naphta_e }
					owned_by = ROOT
				}
				if = {
					limit = {
						has_province_modifier = nhs2_source_of_naphta
					}
					remove_province_modifier = nhs2_source_of_naphta
				}
				if = {
					limit = {
						NOT = { has_province_modifier = nhs2_source_of_naphta_e }
					}
					add_permanent_province_modifier = {
						name = nhs2_source_of_naphta_e
						duration = -1
					}
				}
			}
		}
		hidden_effect = {
			every_country = {
				limit = {
					has_country_modifier = nhs_greek_fire_deal
				}
				remove_country_modifier = nhs_greek_fire_deal
			}
		}
		FROM = { country_event = { id = nhs2_greek_fire.11 days = 1 } }
	}
	
	option = {
		name = "nhs2_greek_fire.10.b"
		ai_chance = {
			factor = 10
		}
		FROM = { country_event = { id = nhs2_greek_fire.12 days = 1 } }
	}
}

# Natives have agreed
country_event = {
	id = nhs2_greek_fire.11
	title = nhs2_greek_fire.11.t
	desc = nhs2_greek_fire.11.d
	picture = NATIVE_COURT_eventPicture

	is_triggered_only = yes
	
	immediate = {
		set_country_flag = nhs_found_the_source
		set_country_flag = nhs_temp_fire
		clr_country_flag = nhs_proposing_n_deal
	}

	option = { ##Agree
		name = "nhs2_greek_fire.11.a"
		if = {
			limit = {
				has_country_modifier = nhs2_depleting_fire_ships
			}
			remove_country_modifier = nhs2_depleting_fire_ships
		}
		if = {
			limit = {
				has_country_modifier = nhs2_depleting_fire_forts
			}
			remove_country_modifier = nhs2_depleting_fire_forts
		}
		nhs_set_the_fire_on = yes
		add_opinion = {
			who = FROM
			modifier = nhs_naphta_deal
		}
		FROM = {
			add_country_modifier = {
				name = nhs_greek_fire_deal
				duration = -1
			}
			every_province = {
				limit = {
					has_province_modifier = nhs2_source_of_naphta
					NOT = { has_province_modifier = nhs2_source_of_naphta_e }
					owned_by = ROOT
				}
				if = {
					limit = {
						has_province_modifier = nhs2_source_of_naphta
					}
					remove_province_modifier = nhs2_source_of_naphta
				}
				if = {
					limit = {
						NOT = { has_province_modifier = nhs2_source_of_naphta_e }
					}
					add_permanent_province_modifier = {
						name = nhs2_source_of_naphta_e
						duration = -1
					}
				}
			}
		}
		clr_country_flag = nhs_temp_fire
		hidden_effect = {
			every_country = {
				limit = {
					has_country_modifier = nhs_greek_fire_deal
				}
				remove_country_modifier = nhs_greek_fire_deal
			}
		}
	}
}

# Natives dissagree
country_event = {
	id = nhs2_greek_fire.12
	title = nhs2_greek_fire.12.t
	desc = nhs2_greek_fire.12.d
	picture = NATIVE_ACCUSATION_eventPicture

	is_triggered_only = yes

	option = {
		name = "nhs2_greek_fire.12.a"
		clr_country_flag = nhs_proposing_n_deal
	}
	option = {
		name = "nhs2_greek_fire.12.b"
		add_casus_belli = {
			type = cb_vassalize_mission
			months = 300
			target = FROM
		}
		clr_country_flag = nhs_proposing_n_deal
	}
}

# Update to greek fire, cannons reduce effect at sea, but learn grenades
country_event = {
	id = nhs2_greek_fire.13
	title = nhs2_greek_fire.13.t
	desc = nhs2_greek_fire.13.d
	picture = BATTLE_eventPicture
	
	trigger = {
		nhs_condition_all_ely = { KOMANDA = tag }
		NOT = { has_country_modifier = nhs_greekfire_update }
		has_country_modifier = nhs_secrets_greekfire
		is_year = 1520
		had_country_flag = { flag = nhs_searching_for_naphtha days = 18250 }
	}

	mean_time_to_happen = {
		months = 12
	}

	option = {		# Accept the changes
		name = "nhs2_greek_fire.13.a"
		remove_country_modifier = nhs_secrets_greekfire
		set_country_flag = nhs_updated_fire
		add_country_modifier = {
			name = "nhs_greekfire_update"
			duration = -1
		}
	}
}